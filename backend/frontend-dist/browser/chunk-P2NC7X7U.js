import{a as He,b as ze,g as Ue,h as je,j as qe,l as Ke,m as Je}from"./chunk-S3CU4R5P.js";import{a as A}from"./chunk-33BSEKWX.js";import{a as de,b as $e,d as Ge}from"./chunk-RFXIYJE6.js";import{c as De}from"./chunk-U2QMYJWS.js";import{a as Fe}from"./chunk-YL74CBNY.js";import{b as Y,c as z,f as G,h as Ne,j as le,k as se,l as ce,p as U}from"./chunk-CRXYTJXZ.js";import{e as Re,g as Ae,i as We,k as H}from"./chunk-QU66LBKX.js";import{$b as oe,Bb as Ie,Cb as Ee,Db as Oe,Fa as X,Fb as re,Gb as I,Ia as c,Ib as p,Jb as E,Kb as x,Lb as ae,Nb as V,O as F,Ob as B,Pb as R,Qa as Pe,Qb as Le,T,Tb as Ve,Ua as N,Ub as j,Vb as J,Wb as Be,Y as m,Z as u,a as P,b as O,da as w,db as $,eb as ie,fb as b,gb as C,hb as ne,ia as te,ib as K,jb as M,kb as k,la as ke,lb as S,mb as l,nb as s,ob as L,sb as y,wb as f,yb as d}from"./chunk-EGMLUSXW.js";var pe=class o{store=T(A);partyCharacters=new Map;setPartyCharacters(t){this.partyCharacters=t}calculateSpeed(t){let e=t.speed;if(!e)return 10;let i=e.base+e.bonus+t.level/(e.gain||1);return Math.floor(i)||10}getHealth(t){let e=t.statuses?.find(i=>i.statusName==="Leben");return e?{current:e.statusCurrent||0,max:(e.statusBase||0)+(e.statusBonus||0)}:{current:0,max:0}}getAvailableCharactersForBattle(t){return t.map(e=>({id:e.id,name:e.sheet.name||e.id,speed:this.calculateSpeed(e.sheet)}))}addToBattle(t){let e=this.store.worldValue;if(!e)return;let i=this.partyCharacters.get(t);if(!i)return;let n=this.calculateSpeed(i),r=this.getHealth(i),a=e.battleParticipants.length>0?Math.max(...e.battleParticipants.map(_=>_.nextTurnAt)):0,g={characterId:t,name:i.name||t,speed:n,turnFrequency:n,nextTurnAt:a+10,team:"blue",portrait:i.portrait,currentHealth:r.current,maxHealth:r.max},h=[...e.battleParticipants,g];this.store.applyPatch({path:"battleParticipants",value:h})}removeFromBattle(t){let e=this.store.worldValue;if(!e)return;let i=e.battleParticipants.filter(n=>n.characterId!==t);this.store.applyPatch({path:"battleParticipants",value:i})}advanceTurn(){let t=this.store.worldValue;if(!t||t.battleParticipants.length===0)return;let e=this.getBattleQueue();if(e.length===0)return;let i=e[0],n=new Set(i.turns.map(a=>a.characterId)),r=t.battleParticipants.map(a=>{let g=this.partyCharacters.get(a.characterId),h=g?this.calculateSpeed(g):a.speed;if(n.has(a.characterId)){let _=a.nextTurnAt+1e3/h;return O(P({},a),{speed:h,nextTurnAt:_})}return O(P({},a),{speed:h})});this.store.applyPatch({path:"battleParticipants",value:r})}resetBattle(){let t=this.store.worldValue;if(!t)return;let e=t.battleParticipants.map(i=>{let n=this.partyCharacters.get(i.characterId),r=n?this.calculateSpeed(n):i.speed;return O(P({},i),{speed:r,nextTurnAt:0})});this.store.applyPatch({path:"battleParticipants",value:e})}refreshBattleSpeeds(){let t=this.store.worldValue;if(!t)return;let e=t.battleParticipants.map(i=>{let n=this.partyCharacters.get(i.characterId),r=n?this.calculateSpeed(n):i.speed;return O(P({},i),{speed:r})});this.store.applyPatch({path:"battleParticipants",value:e})}syncTurns(t,e){let i=this.store.worldValue;if(!i)return;let n=i.battleParticipants.find(a=>a.characterId===e);if(!n)return;let r=i.battleParticipants.map(a=>a.characterId===t?O(P({},a),{nextTurnAt:n.nextTurnAt}):a);this.store.applyPatch({path:"battleParticipants",value:r})}setTurnOrder(t,e){let i=this.store.worldValue;if(!i||i.battleParticipants.length===0)return;let n=[],r=i.battleParticipants.map(h=>P({},h));for(let h=0;h<10;h++){r.sort((v,D)=>v.nextTurnAt-D.nextTurnAt);let _=r[0];n.push(P({},_)),_.nextTurnAt=_.nextTurnAt+1e3/_.speed}let a=n[e]?.nextTurnAt;if(a===void 0)return;let g=i.battleParticipants.map(h=>h.characterId===t?O(P({},h),{nextTurnAt:a}):h);this.store.applyPatch({path:"battleParticipants",value:g})}changeParticipantTeam(t,e){let i=this.store.worldValue;if(!i)return;let n=i.battleParticipants.map(r=>r.characterId===t?O(P({},r),{team:e}):r);this.store.applyPatch({path:"battleParticipants",value:n})}reorderParticipants(t,e){let i=this.store.worldValue;if(!i)return;let n=this.getBattleQueue();if(n.length===0)return;let r;if(e<=0)r=n[0].startTime-10;else if(e>=n.length)r=n[n.length-1].startTime+10;else{let g=n[e-1],h=n[e];r=(g.startTime+h.startTime)/2}let a=i.battleParticipants.map(g=>g.characterId===t?O(P({},g),{nextTurnAt:r}):g);this.store.applyPatch({path:"battleParticipants",value:a})}getBattleQueue(){let t=this.store.worldValue;if(!t||t.battleParticipants.length===0)return[];let e=[],i=t.battleParticipants.map(h=>O(P({},h),{currentTurnAt:h.nextTurnAt,speed:this.partyCharacters.get(h.characterId)?this.calculateSpeed(this.partyCharacters.get(h.characterId)):h.speed}));for(let h=0;h<50;h++){i.sort((W,ee)=>W.currentTurnAt-ee.currentTurnAt);let _=i[0],v=t.battleParticipants.find(W=>W.characterId===_.characterId),D=v?Math.abs(v.nextTurnAt-_.currentTurnAt)<.001:!1;e.push({characterId:_.characterId,name:_.name,team:_.team||"blue",time:_.currentTurnAt,isAnchor:D,speed:_.speed}),_.currentTurnAt+=1e3/_.speed}let n=[];if(e.length===0)return[];let r=1,a={turns:[e[0]],team:e[0].team,startTime:e[0].time},g=new Set([e[0].characterId]);for(let h=1;h<e.length;h++){let _=e[h],v=Math.abs(_.time-a.startTime);_.team===a.team&&!g.has(_.characterId)&&v<r?(a.turns.push(_),g.add(_.characterId)):(n.push(a),a={turns:[_],team:_.team,startTime:_.time},g=new Set([_.characterId]))}return n.push(a),n}static \u0275fac=function(e){return new(e||o)};static \u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"})};var Q=class o{store=T(A);getTrash(){return this.store.worldValue?.trash||[]}addToTrash(t,e){let i=this.store.worldValue;if(!i)return;let n=[...i.trash||[],{type:t,data:e,deletedAt:Date.now()}];this.store.applyPatch({path:"trash",value:n})}restoreFromTrash(t){let e=this.store.worldValue;if(!e||!e.trash)return;let i=e.trash[t],n=[...e.trash];switch(n.splice(t,1),i.type){case"item":this.store.applyPatch({path:"itemLibrary",value:[...e.itemLibrary,i.data]});break;case"rune":this.store.applyPatch({path:"runeLibrary",value:[...e.runeLibrary,i.data]});break;case"spell":this.store.applyPatch({path:"spellLibrary",value:[...e.spellLibrary,i.data]});break;case"skill":this.store.applyPatch({path:"skillLibrary",value:[...e.skillLibrary,i.data]});break}this.store.applyPatch({path:"trash",value:n})}permanentlyDelete(t){let e=this.store.worldValue;if(!e||!e.trash)return;let i=[...e.trash];i.splice(t,1),this.store.applyPatch({path:"trash",value:i})}emptyTrash(){this.store.applyPatch({path:"trash",value:[]})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"})};var me=class{name;class;description;type;enlightened;level;skillId;statModifiers};var Z=class{name;description;weight;lost;requirements;armorDebuff;statModifiers};var ue=class extends Z{durability;efficiency;range;weaponType;damageType;primaryMaterial;secondaryMaterial;additiveMaterial;craftingPointsUsed;bonuses=[];generatedName};var Se=(r=>(r.HELMET="Helm",r.CHEST="Brustpanzer",r.LEGGINGS="Beinschutz",r.BOOTS="Stiefel",r.GAUNTLETS="Handschuhe",r))(Se||{}),ge=class extends Z{durability;stability;armorType;primaryMaterial;secondaryMaterial;additiveMaterial;craftingPointsUsed;generatedName};var he=[{name:"Eisen",type:"schwer",rarity:"h\xE4ufig",locations:["\xFCberall"],durability:80,efficiency:7,durabilityModifier:3,efficiencyModifier:3,specialEffect:"Mit jeder Reparatur wird die Haltbarkeit der Waffe dauerhaft um 10 erh\xF6ht."},{name:"Holz",type:"leicht",rarity:"sehr h\xE4ufig",locations:["\xFCberall"],durability:50,efficiency:4,durabilityModifier:5,efficiencyModifier:3,specialEffect:"Vorraussetzung-1(\u221E) reduziert Vorraussetzung um 2 statt 1."},{name:"Ahnenholz",type:"sehr leicht",rarity:"selten",locations:["in magischen W\xE4ldern"],durability:70,efficiency:5,durabilityModifier:4,efficiencyModifier:3,specialEffect:"+2 beim W\xFCrfeln f\xFCr Zaubercasts"},{name:"Stein",type:"sehr schwer",rarity:"sehr h\xE4ufig",locations:["\xFCberall"],durability:60,efficiency:5,durabilityModifier:3,efficiencyModifier:4},{name:"Silber",type:"mittel",rarity:"selten",locations:["\xFCberall"],durability:70,efficiency:10,durabilityModifier:3,efficiencyModifier:2,specialEffect:"+2 im Kampf gegen Monster/Untote"},{name:"Gold",type:"schwer",rarity:"selten",locations:["\xFCberall"],durability:50,efficiency:6,durabilityModifier:5,efficiencyModifier:3,specialEffect:"+1 Charismamodifikator"},{name:"Platin",type:"sehr schwer",rarity:"sehr selten",locations:["\xFCberall"],durability:100,efficiency:12,durabilityModifier:4,efficiencyModifier:4},{name:"Adamantit",type:"sehr schwer",rarity:"selten",locations:["tief unter der Erde"],durability:150,efficiency:9,durabilityModifier:6,efficiencyModifier:6,specialEffect:"+5 W\xFCrfelbonus, wenn die Waffe zerst\xF6rt wird"},{name:"Meteoritenerz",type:"?",rarity:"???",locations:["???"],durability:120,efficiency:12,durabilityModifier:2,efficiencyModifier:2,specialEffect:"Effekt variiert"},{name:"Asremit",type:"sehr leicht",rarity:"h\xE4ufig",locations:["in der \xDCberwelt"],durability:40,efficiency:15,durabilityModifier:5,efficiencyModifier:2,specialEffect:"Werfen+1, unabh\xE4ngig vom Waffenbonus"},{name:"Blutrubin",type:"leicht",rarity:"selten",locations:["Vulkangebiet"],durability:80,efficiency:8,durabilityModifier:4,efficiencyModifier:2,specialEffect:"Kann bis zu 50 Leben speichern, die ihm freiwillig vom Tr\xE4ger oder vom Gegner durch Kontakt mit tiefen Wunden gegeben werden kann. Diese Leben k\xF6nnen dem Tr\xE4ger zur\xFCckgegeben werden, um ihn um diesen Betrag zu heilen."},{name:"\xC4thersaphir",type:"leicht",rarity:"selten",locations:["im Meer"],durability:80,efficiency:8,durabilityModifier:4,efficiencyModifier:2,specialEffect:"Kann bis zu 50 Mana speichern, die ihm vom Tr\xE4ger gegeben wird. Diese Mana kann dem Tr\xE4ger zur\xFCckgegeben werden, um die Mana um diesen Betrag wiederherzustellen."},{name:"Natursmaragd",type:"leicht",rarity:"selten",locations:["in Urw\xE4ldern"],durability:80,efficiency:8,durabilityModifier:4,efficiencyModifier:2,specialEffect:"Kann bis zu 50 Ausdauer speichern, die ihm vom Tr\xE4ger gegeben wird. Diese Ausdauer kann dem Tr\xE4ger zur\xFCckgegeben werden, um die Ausdauer um diesen Betrag wiederherzustellen."},{name:"Elementarkristall",type:"leicht",rarity:"sehr selten",locations:["an Orten mit hoher Manakonzentration"],durability:60,efficiency:7,durabilityModifier:3,efficiencyModifier:3,specialEffect:"Kann Spells speichern und sp\xE4ter ausf\xFChren. Komplexit\xE4t der gespeicherten Spells kann nicht Eff./2 \xFCberschreiten."},{name:"Seraphit",type:"schwer",rarity:"selten",locations:["in der \xDCberwelt"],durability:80,efficiency:6,durabilityModifier:3,efficiencyModifier:4,specialEffect:"Verst\xE4rkt Heilzauber um 50%"},{name:"Vulkanit",type:"leicht",rarity:"h\xE4ufig",locations:["in Lava"],durability:90,efficiency:8,durabilityModifier:4,efficiencyModifier:5,specialEffect:"Leuchtet im Dunkeln"}];var _e=[{name:"Stoff",type:"sehr leicht",rarity:"sehr h\xE4ufig",locations:["\xFCberall"],durability:50,durabilityModifier:5,efficiency:0,efficiencyModifier:0,stability:5,stabilityModifier:5},{name:"Mondseide",type:"sehr leicht",rarity:"sehr selten",locations:["\xFCberall"],durability:80,durabilityModifier:3,efficiency:0,efficiencyModifier:0,stability:5,stabilityModifier:4,specialEffect:"10% des erlittenen Schadens werden zu Mana konvertiert"},{name:"Leder",type:"leicht",rarity:"sehr h\xE4ufig",locations:["\xFCberall"],durability:70,durabilityModifier:3,efficiency:0,efficiencyModifier:0,stability:6,stabilityModifier:4},{name:"Eisen",type:"schwer",rarity:"h\xE4ufig",locations:["\xFCberall"],durability:80,durabilityModifier:3,efficiency:0,efficiencyModifier:0,stability:8,stabilityModifier:2,specialEffect:"Mit jeder Reparatur wird die Haltbarkeit der R\xFCstung dauerhaft um 10 erh\xF6ht."},{name:"Silber",type:"schwer",rarity:"selten",locations:["\xFCberall"],durability:80,durabilityModifier:2,efficiency:0,efficiencyModifier:0,stability:11,stabilityModifier:2},{name:"Gold",type:"schwer",rarity:"selten",locations:["\xFCberall"],durability:50,durabilityModifier:5,efficiency:0,efficiencyModifier:0,stability:9,stabilityModifier:3,specialEffect:"+1 Charismamodifikator"},{name:"Platin",type:"schwer",rarity:"sehr selten",locations:["\xFCberall"],durability:100,durabilityModifier:4,efficiency:0,efficiencyModifier:0,stability:12,stabilityModifier:4},{name:"Adamantit",type:"sehr schwer",rarity:"selten",locations:["tief unter der Erde"],durability:150,durabilityModifier:6,efficiency:0,efficiencyModifier:0,stability:12,stabilityModifier:6,specialEffect:"+5 beim Wurf, wenn die R\xFCstung zerst\xF6rt wird"},{name:"Meteoritenerz",type:"?",rarity:"???",locations:["???"],durability:150,durabilityModifier:2,efficiency:0,efficiencyModifier:0,stability:10,stabilityModifier:2,specialEffect:"Effekt variiert"},{name:"Asremit",type:"sehr leicht",rarity:"h\xE4ufig",locations:["in der \xDCberwelt"],durability:40,durabilityModifier:5,efficiency:0,efficiencyModifier:0,stability:7,stabilityModifier:3,specialEffect:"-2 R\xFCstungsmalus, unabh\xE4ngig vom R\xFCstungsbonus"},{name:"Elementarkristall",type:"leicht",rarity:"sehr selten",locations:["an der Oberfl\xE4che an Orten mit hoher Manakonzentration"],durability:50,durabilityModifier:4,efficiency:0,efficiencyModifier:0,stability:6,stabilityModifier:4,specialEffect:"Kann Spells speichern und sp\xE4ter ausf\xFChren. Komplexit\xE4t der gespeicherten Spells darf nicht Eff./4 \xFCberschreiten."},{name:"Seraphit",type:"schwer",rarity:"selten",locations:["in der \xDCberwelt"],durability:80,durabilityModifier:3,efficiency:0,efficiencyModifier:0,stability:12,stabilityModifier:2,specialEffect:"Verst\xE4rkt Heilung auf Tr\xE4ger um 50%"},{name:"Vulkanit",type:"leicht",rarity:"h\xE4ufig",locations:["in Lava"],durability:70,durabilityModifier:4,efficiency:0,efficiencyModifier:0,stability:8,stabilityModifier:3,specialEffect:"Leuchtet im Dunkeln"}];var Ye=[{name:"Messer",damageType:"Schnitt",range:.5,type:"Leicht"},{name:"Sichel",damageType:"Schnitt",range:.5,type:"Leicht"},{name:"Kurzschwert",damageType:"Schnitt",range:1,type:"Leicht"},{name:"Peitsche",damageType:"Schnitt",range:3,type:"Leicht"},{name:"Dolch",damageType:"Stich",range:.5,type:"Leicht"},{name:"Rapier",damageType:"Stich",range:1.5,type:"Leicht"},{name:"Handschuhe",damageType:"Wucht",range:.5,type:"Leicht"},{name:"Nunchaku",damageType:"Wucht",range:.5,type:"Leicht"},{name:"Stab",damageType:"Wucht",range:1,type:"Leicht"},{name:"Wurfbeil",damageType:"Schnitt",range:10,type:"Fernkampf"},{name:"Wurfmesser",damageType:"Schnitt",range:20,type:"Fernkampf"},{name:"Wurfspeer",damageType:"Stich",range:50,type:"Fernkampf"},{name:"Kurzbogen",damageType:"Stich",range:50,type:"Fernkampf"},{name:"Armbrust",damageType:"Stich",range:100,type:"Fernkampf"},{name:"Langbogen",damageType:"Stich",range:100,type:"Fernkampf"},{name:"Bola",damageType:"Wucht",range:20,type:"Fernkampf"},{name:"Bumerang",damageType:"Wucht",range:30,type:"Fernkampf"},{name:"Schleuder",damageType:"Wucht",range:50,type:"Fernkampf"},{name:"Axt",damageType:"Schnitt",range:1.5,type:"Schwer"},{name:"S\xE4bel",damageType:"Schnitt",range:1.5,type:"Schwer"},{name:"Sense",damageType:"Schnitt",range:1.5,type:"Schwer"},{name:"Kriegsaxt",damageType:"Schnitt",range:2,type:"Schwer"},{name:"Langschwert",damageType:"Schnitt",range:2,type:"Schwer"},{name:"Gleve",damageType:"Schnitt",range:2.5,type:"Schwer"},{name:"Gro\xDFschwert",damageType:"Schnitt",range:2.5,type:"Schwer"},{name:"Hellebarde",damageType:"Schnitt",range:3,type:"Schwer"},{name:"Hacke",damageType:"Stich",range:1,type:"Schwer"},{name:"Dreizack",damageType:"Stich",range:2,type:"Schwer"},{name:"Langspeer",damageType:"Stich",range:3,type:"Schwer"},{name:"Lanze",damageType:"Stich",range:3,type:"Schwer"},{name:"Schild",damageType:"Wucht",range:.5,type:"Schwer"},{name:"Hammer",damageType:"Wucht",range:1,type:"Schwer"},{name:"Keule",damageType:"Wucht",range:2,type:"Schwer"},{name:"Kriegshammer",damageType:"Wucht",range:2,type:"Schwer"},{name:"Morgenstern",damageType:"Wucht",range:2.5,type:"Schwer"}];var fe=class o{namePrefixes=["M\xE4chtige(r)","Verfluchte(r)","Gesegnete(r)","Alte(r)","Meisterlich gefertigte(r)","Brutale(r)","Elegante(r)","T\xF6dliche(r)","Rostige(r)","Leuchtende(r)","D\xE4monische(r)","Himmlische(r)"];nameSuffixes=["der Verdammnis","des Lichts","der Zerst\xF6rung","des Schutzes","aus der Tiefe","des K\xF6nigs","der alten G\xF6tter","des Chaos","der Ordnung","des Blutes"];constructor(){}generateWeapon(t,e){let i=new ue,n=Ye;e&&(n=n.filter(v=>v.type===e));let r=this.getRandomElement(n);i.weaponType=r.type,i.damageType=r.damageType,i.range=r.range,i.weight=this.getWeightFromType(r.type);let a=this.getRandomElement(he),g=this.getRandomElement(he),h=this.getRandomElement(he);i.primaryMaterial=a,i.secondaryMaterial=g,i.additiveMaterial=h,i.durability=a.durability+Math.floor(g.durability/2),i.efficiency=a.efficiency+Math.floor(g.efficiency/2);let _=10+this.rollD20();return i.craftingPointsUsed=0,i.requirements=this.calculateRequirements(i.durability,i.efficiency),i.generatedName=this.generateName(r,a),i.name=i.generatedName,i.description=this.generateDescription(i),i}generateArmor(t,e){let i=new ge,n=e||this.getRandomElement(Object.values(Se));i.armorType=n,i.weight=this.getWeightFromType(n);let r=this.getRandomElement(_e),a=this.getRandomElement(_e),g=this.getRandomElement(_e);i.primaryMaterial=r,i.secondaryMaterial=a,i.additiveMaterial=g,i.durability=r.durability+Math.floor(a.durability/2),i.stability=(r.stability||0)+Math.floor((a.stability||0)/2);let h=10+this.rollD20();return i.craftingPointsUsed=0,i.requirements={},i.generatedName=`${r.name}-${n}`,i.name=i.generatedName,i.description=this.generateArmorDescription(i),i}generateArmorDescription(t){let e=`Eine R\xFCstung vom Typ ${t.armorType}.`;return e+=` Hergestellt aus ${t.primaryMaterial.name}, ${t.secondaryMaterial.name} und ${t.additiveMaterial.name}.`,t.primaryMaterial.specialEffect&&(e+=`
Prim\xE4r-Effekt: ${t.primaryMaterial.specialEffect}`),t.secondaryMaterial.specialEffect&&(e+=`
Sekund\xE4r-Effekt: ${t.secondaryMaterial.specialEffect}`),t.additiveMaterial.specialEffect&&(e+=`
Zusatz-Effekt: ${t.additiveMaterial.specialEffect}`),e}generateName(t,e){let i=this.getRandomElement(this.namePrefixes),n=this.getRandomElement(this.nameSuffixes),r=e.name;switch(["a","e","i","o","u"].includes(r.slice(-1).toLowerCase())||(r+="s"),this.rollDie(4)){case 1:return`${e.name}-${t.name}`;case 2:return`${i} ${t.name}`;case 3:return`${t.name} ${n}`;case 4:return`${i} ${e.name}-${t.name} ${n}`;default:return`${e.name}-${t.name}`}}generateDescription(t){let e=`Eine Waffe vom Typ ${t.weaponType}.`;return e+=` Hergestellt aus ${t.primaryMaterial.name}, ${t.secondaryMaterial.name} und ${t.additiveMaterial.name}.`,t.primaryMaterial.specialEffect&&(e+=`
Prim\xE4r-Effekt: ${t.primaryMaterial.specialEffect}`),t.secondaryMaterial.specialEffect&&(e+=`
Sekund\xE4r-Effekt: ${t.secondaryMaterial.specialEffect}`),t.additiveMaterial.specialEffect&&(e+=`
Zusatz-Effekt: ${t.additiveMaterial.specialEffect}`),e}calculateRequirements(t,e){return{strength:Math.floor(5+t/20+e/2)}}getWeightFromType(t){switch(t){case"Leicht":return this.rollDie(5)+2;case"Schwer":return this.rollDie(10)+10;case"Fernkampf":return this.rollDie(6)+4;case"Helm":return this.rollDie(4)+1;case"Brustpanzer":return this.rollDie(10)+8;case"Beinschutz":return this.rollDie(6)+6;case"Stiefel":return this.rollDie(3)+1;case"Handschuhe":return this.rollDie(2)+1}}getRandomElement(t){return t[Math.floor(Math.random()*t.length)]}rollD20(){return Math.floor(Math.random()*20)+1}rollDie(t){return Math.floor(Math.random()*t)+1}static \u0275fac=function(e){return new(e||o)};static \u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"})};var be=class o{store=T(A);trashService=T(Q);weaponGenerator=T(fe);createItem(t){let e=this.store.worldValue;e&&this.store.applyPatch({path:"itemLibrary",value:[...e.itemLibrary,t]})}generateRandomWeapon(t=5){let e=this.store.worldValue;if(!e)return;let i=this.weaponGenerator.generateWeapon(t);this.store.applyPatch({path:"itemLibrary",value:[...e.itemLibrary,i]})}generateRandomArmor(t=5){let e=this.store.worldValue;if(!e)return;let i=this.weaponGenerator.generateArmor(t);this.store.applyPatch({path:"itemLibrary",value:[...e.itemLibrary,i]})}updateItem(t,e){let i=e.path.replace(/\//g,".");i.startsWith(".")&&(i=i.substring(1)),this.store.applyPatch({path:`itemLibrary.${t}.${i}`,value:e.value})}removeItem(t){let e=this.store.worldValue;if(!e)return new Set;let i=e.itemLibrary[t],n=[...e.itemLibrary];return n.splice(t,1),this.trashService.addToTrash("item",i),this.store.applyPatch({path:"itemLibrary",value:n}),this.shiftIndices(t)}addRune(){let t=this.store.worldValue;if(t){let e={name:"New Rune",description:"",drawing:"",tags:[]};this.store.applyPatch({path:"runeLibrary",value:[...t.runeLibrary,e]})}}updateRune(t,e){let i=e.path.replace(/\//g,".");i.startsWith(".")&&(i=i.substring(1)),this.store.applyPatch({path:`runeLibrary.${t}.${i}`,value:e.value})}removeRune(t){let e=this.store.worldValue;if(!e)return new Set;let i=e.runeLibrary[t],n=[...e.runeLibrary];return n.splice(t,1),this.trashService.addToTrash("rune",i),this.store.applyPatch({path:"runeLibrary",value:n}),this.shiftIndices(t)}addSpell(){let t=this.store.worldValue;if(t){let e={name:"New Spell",description:"",drawing:"",tags:[],binding:{type:"learned"}};this.store.applyPatch({path:"spellLibrary",value:[...t.spellLibrary,e]})}}updateSpell(t,e){let i=e.path.replace(/\//g,".");i.startsWith(".")&&(i=i.substring(1)),this.store.applyPatch({path:`spellLibrary.${t}.${i}`,value:e.value})}removeSpell(t){let e=this.store.worldValue;if(!e)return new Set;let i=e.spellLibrary[t],n=[...e.spellLibrary];return n.splice(t,1),this.trashService.addToTrash("spell",i),this.store.applyPatch({path:"spellLibrary",value:n}),this.shiftIndices(t)}addSkill(){let t=this.store.worldValue;if(t){let e=new me;e.name="New Skill",e.description="",e.type="passive",e.class="",e.enlightened=!1,this.store.applyPatch({path:"skillLibrary",value:[...t.skillLibrary,e]})}}updateSkill(t,e){let i=e.path.replace(/\//g,".");i.startsWith(".")&&(i=i.substring(1)),this.store.applyPatch({path:`skillLibrary.${t}.${i}`,value:e.value})}removeSkill(t){let e=this.store.worldValue;if(!e)return new Set;let i=e.skillLibrary[t],n=[...e.skillLibrary];return n.splice(t,1),this.trashService.addToTrash("skill",i),this.store.applyPatch({path:"skillLibrary",value:n}),this.shiftIndices(t)}shiftIndices(t){return new Set}getItemLibrary(){return this.store.worldValue?.itemLibrary||[]}getRuneLibrary(){return this.store.worldValue?.runeLibrary||[]}getSpellLibrary(){return this.store.worldValue?.spellLibrary||[]}getSkillLibrary(){return this.store.worldValue?.skillLibrary||[]}static \u0275fac=function(e){return new(e||o)};static \u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"})};function et(o,t){return this.getOriginalIndex(t,"runes")}function tt(o,t){return this.getOriginalIndex(t,"spells")}function it(o,t){return this.getOriginalIndex(t,"skills")}function nt(o,t){if(o&1){let e=y();l(0,"div",9),f("dragstart",function(n){let r=m(e).$implicit,a=d(2);return u(a.onDragStart(n,"item",a.getOriginalIndex(r,"items")))}),l(1,"app-item",10),f("patch",function(n){let r=m(e).$implicit,a=d(2);return u(a.onItemUpdate(a.getOriginalIndex(r,"items"),n))})("delete",function(){let n=m(e).$implicit,r=d(2);return u(r.removeItem.emit(r.getOriginalIndex(n,"items")))})("editingChange",function(n){let r=m(e).$implicit,a=d(2);return u(a.onItemEditingChange(a.getOriginalIndex(r,"items"),n))}),s()()}if(o&2){let e=t.$implicit,i=d(2);I("draggable",!i.isItemEditing(i.getOriginalIndex(e,"items"))),$("draggable",!i.isItemEditing(i.getOriginalIndex(e,"items"))),c(),S("item",e)("sheet",i.dummySheet)("index",i.getOriginalIndex(e,"items"))("isEditing",i.isItemEditing(i.getOriginalIndex(e,"items")))}}function rt(o,t){if(o&1){let e=y();l(0,"div",6),M(1,nt,2,7,"div",7,ne),l(3,"button",8),f("click",function(){m(e);let n=d();return u(n.addItem.emit())}),p(4,"+ Add Item"),s()()}if(o&2){let e=d();c(),k(e.filteredItems)}}function at(o,t){if(o&1){let e=y();l(0,"div",9),f("dragstart",function(n){let r=m(e).$implicit,a=d(2);return u(a.onDragStart(n,"rune",a.getOriginalIndex(r,"runes")))}),l(1,"app-rune",11),f("patch",function(n){let r=m(e).$implicit,a=d(2);return u(a.onRuneUpdate(a.getOriginalIndex(r,"runes"),n))})("delete",function(){let n=m(e).$implicit,r=d(2);return u(r.removeRune.emit(r.getOriginalIndex(n,"runes")))})("editingChange",function(n){let r=m(e).$implicit,a=d(2);return u(a.onRuneEditingChange(a.getOriginalIndex(r,"runes"),n))}),s()()}if(o&2){let e=t.$implicit,i=d(2);I("draggable",!i.isRuneEditing(i.getOriginalIndex(e,"runes"))),$("draggable",!i.isRuneEditing(i.getOriginalIndex(e,"runes"))),c(),S("rune",e)("index",i.getOriginalIndex(e,"runes"))("isEditing",i.isRuneEditing(i.getOriginalIndex(e,"runes")))}}function ot(o,t){if(o&1){let e=y();l(0,"div",6),M(1,at,2,6,"div",7,et,!0),l(3,"button",8),f("click",function(){m(e);let n=d();return u(n.addRune.emit())}),p(4,"+ Add Rune"),s()()}if(o&2){let e=d();c(),k(e.filteredRunes)}}function lt(o,t){if(o&1){let e=y();l(0,"div",9),f("dragstart",function(n){let r=m(e).$implicit,a=d(2);return u(a.onDragStart(n,"spell",a.getOriginalIndex(r,"spells")))}),l(1,"app-spell",12),f("patch",function(n){let r=m(e).$implicit,a=d(2);return u(a.onSpellUpdate(a.getOriginalIndex(r,"spells"),n))})("delete",function(){let n=m(e).$implicit,r=d(2);return u(r.removeSpell.emit(r.getOriginalIndex(n,"spells")))})("editingChange",function(n){let r=m(e).$implicit,a=d(2);return u(a.onSpellEditingChange(a.getOriginalIndex(r,"spells"),n))}),s()()}if(o&2){let e=t.$implicit,i=d(2);I("draggable",!i.isSpellEditing(i.getOriginalIndex(e,"spells"))),$("draggable",!i.isSpellEditing(i.getOriginalIndex(e,"spells"))),c(),S("spell",e)("sheet",i.dummySheet)("index",i.getOriginalIndex(e,"spells"))("isEditing",i.isSpellEditing(i.getOriginalIndex(e,"spells")))}}function st(o,t){if(o&1){let e=y();l(0,"div",6),M(1,lt,2,7,"div",7,tt,!0),l(3,"button",8),f("click",function(){m(e);let n=d();return u(n.addSpell.emit())}),p(4,"+ Add Spell"),s()()}if(o&2){let e=d();c(),k(e.filteredSpells)}}function ct(o,t){if(o&1){let e=y();l(0,"div",9),f("dragstart",function(n){let r=m(e).$implicit,a=d(2);return u(a.onDragStart(n,"skill",a.getOriginalIndex(r,"skills")))}),l(1,"app-skill",13),f("patch",function(n){let r=m(e).$implicit,a=d(2);return u(a.onSkillUpdate(a.getOriginalIndex(r,"skills"),n))})("delete",function(){let n=m(e).$implicit,r=d(2);return u(r.removeSkill.emit(r.getOriginalIndex(n,"skills")))})("editingChange",function(n){let r=m(e).$implicit,a=d(2);return u(a.onSkillEditingChange(a.getOriginalIndex(r,"skills"),n))}),s()()}if(o&2){let e=t.$implicit,i=d(2);I("draggable",!i.isSkillEditing(i.getOriginalIndex(e,"skills"))),$("draggable",!i.isSkillEditing(i.getOriginalIndex(e,"skills"))),c(),S("skill",e)("sheet",i.dummySheet)("index",i.getOriginalIndex(e,"skills"))("isEditing",i.isSkillEditing(i.getOriginalIndex(e,"skills")))}}function dt(o,t){if(o&1){let e=y();l(0,"div",6),M(1,ct,2,7,"div",7,it,!0),l(3,"button",8),f("click",function(){m(e);let n=d();return u(n.addSkill.emit())}),p(4,"+ Add Skill"),s()()}if(o&2){let e=d();c(),k(e.filteredSkills)}}var Ce=class o{items=[];runes=[];spells=[];skills=[];dummySheet;editingItems;editingRunes;editingSpells;editingSkills;addItem=new w;addRune=new w;addSpell=new w;addSkill=new w;updateItem=new w;updateRune=new w;updateSpell=new w;updateSkill=new w;removeItem=new w;removeRune=new w;removeSpell=new w;removeSkill=new w;itemEditingChange=new w;runeEditingChange=new w;spellEditingChange=new w;skillEditingChange=new w;dragStart=new w;activeTab="items";_searchTerm="";filteredItems=[];filteredRunes=[];filteredSpells=[];filteredSkills=[];prevItemsLength=0;prevRunesLength=0;prevSpellsLength=0;prevSkillsLength=0;get searchTerm(){return this._searchTerm}set searchTerm(t){this._searchTerm=t,this.updateFilteredArrays()}ngOnChanges(t){let e=!1;t.items&&this.items.length!==this.prevItemsLength&&(this.prevItemsLength=this.items.length,e=!0),t.runes&&this.runes.length!==this.prevRunesLength&&(this.prevRunesLength=this.runes.length,e=!0),t.spells&&this.spells.length!==this.prevSpellsLength&&(this.prevSpellsLength=this.spells.length,e=!0),t.skills&&this.skills.length!==this.prevSkillsLength&&(this.prevSkillsLength=this.skills.length,e=!0),(t.items?.firstChange||t.runes?.firstChange||t.spells?.firstChange||t.skills?.firstChange)&&(e=!0),e&&this.updateFilteredArrays()}updateFilteredArrays(){this.filteredItems=this.filterAndSort(this.items,this._searchTerm),this.filteredRunes=this.filterAndSort(this.runes,this._searchTerm),this.filteredSpells=this.filterAndSort(this.spells,this._searchTerm),this.filteredSkills=this.filterAndSort(this.skills,this._searchTerm)}filterAndSort(t,e){let i=t;if(e){let n=e.toLowerCase();i=t.filter(r=>r.name?.toLowerCase().includes(n)||r.description?.toLowerCase().includes(n))}return[...i].sort((n,r)=>{if(n.type&&r.type){let h={dice_bonus:0,active:1,passive:2,stat_bonus:3},_=h[n.type]??4,v=h[r.type]??4;if(_!==v)return _-v}let a=(n.name||"").toLowerCase(),g=(r.name||"").toLowerCase();return a.localeCompare(g)})}getOriginalIndex(t,e){return(e==="items"?this.items:e==="runes"?this.runes:e==="spells"?this.spells:this.skills).indexOf(t)}setActiveTab(t){this.activeTab=t}onDragStart(t,e,i){this.dragStart.emit({event:t,type:e,index:i})}isItemEditing(t){return this.editingItems.has(t)}isRuneEditing(t){return this.editingRunes.has(t)}isSpellEditing(t){return this.editingSpells.has(t)}isSkillEditing(t){return this.editingSkills.has(t)}onItemUpdate(t,e){this.updateItem.emit({index:t,patch:e})}onRuneUpdate(t,e){this.updateRune.emit({index:t,patch:e})}onSpellUpdate(t,e){this.updateSpell.emit({index:t,patch:e})}onSkillUpdate(t,e){this.updateSkill.emit({index:t,patch:e})}onItemEditingChange(t,e){this.itemEditingChange.emit({index:t,isEditing:e})}onRuneEditingChange(t,e){this.runeEditingChange.emit({index:t,isEditing:e})}onSpellEditingChange(t,e){this.spellEditingChange.emit({index:t,isEditing:e})}onSkillEditingChange(t,e){this.skillEditingChange.emit({index:t,isEditing:e})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=N({type:o,selectors:[["app-library-tabs"]],inputs:{items:"items",runes:"runes",spells:"spells",skills:"skills",dummySheet:"dummySheet",editingItems:"editingItems",editingRunes:"editingRunes",editingSpells:"editingSpells",editingSkills:"editingSkills"},outputs:{addItem:"addItem",addRune:"addRune",addSpell:"addSpell",addSkill:"addSkill",updateItem:"updateItem",updateRune:"updateRune",updateSpell:"updateSpell",updateSkill:"updateSkill",removeItem:"removeItem",removeRune:"removeRune",removeSpell:"removeSpell",removeSkill:"removeSkill",itemEditingChange:"itemEditingChange",runeEditingChange:"runeEditingChange",spellEditingChange:"spellEditingChange",skillEditingChange:"skillEditingChange",dragStart:"dragStart"},features:[ke],decls:17,vars:17,consts:[[1,"library-tabs-container"],[1,"tabs-header"],[1,"tab-button",3,"click"],[1,"search-container"],["type","text","placeholder","Search by name or description...",1,"search-input",3,"ngModelChange","ngModel"],[1,"tab-content"],[1,"library-list"],[1,"library-item-wrapper",3,"draggable"],[1,"add-button",3,"click"],[1,"library-item-wrapper",3,"dragstart"],[3,"patch","delete","editingChange","item","sheet","index","isEditing"],[3,"patch","delete","editingChange","rune","index","isEditing"],[3,"patch","delete","editingChange","spell","sheet","index","isEditing"],[3,"patch","delete","editingChange","skill","sheet","index","isEditing"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"button",2),f("click",function(){return i.setActiveTab("items")}),p(3),s(),l(4,"button",2),f("click",function(){return i.setActiveTab("runes")}),p(5),s(),l(6,"button",2),f("click",function(){return i.setActiveTab("spells")}),p(7),s(),l(8,"button",2),f("click",function(){return i.setActiveTab("skills")}),p(9),s()(),l(10,"div",3)(11,"input",4),R("ngModelChange",function(r){return B(i.searchTerm,r)||(i.searchTerm=r),r}),s()(),l(12,"div",5),b(13,rt,5,0,"div",6),b(14,ot,5,0,"div",6),b(15,st,5,0,"div",6),b(16,dt,5,0,"div",6),s()()),e&2&&(c(2),I("active",i.activeTab==="items"),c(),x(" Items (",i.items.length,") "),c(),I("active",i.activeTab==="runes"),c(),x(" Runes (",i.runes.length,") "),c(),I("active",i.activeTab==="spells"),c(),x(" Spells (",i.spells.length,") "),c(),I("active",i.activeTab==="skills"),c(),x(" Skills (",i.skills.length,") "),c(2),V("ngModel",i.searchTerm),c(2),C(i.activeTab==="items"?13:-1),c(),C(i.activeTab==="runes"?14:-1),c(),C(i.activeTab==="spells"?15:-1),c(),C(i.activeTab==="skills"?16:-1))},dependencies:[H,U,Y,z,G,Ue,Ke,qe,Je],styles:[".library-tabs-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:var(--card);border:1px solid var(--border);border-radius:10px;overflow:hidden}.tabs-header[_ngcontent-%COMP%]{display:flex;background:var(--bg);border-bottom:2px solid var(--border)}.tab-button[_ngcontent-%COMP%]{flex:1;padding:1rem;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-weight:600;font-size:14px;color:var(--muted);transition:all .2s}.tab-button[_ngcontent-%COMP%]:hover{background:#6b46c10d;color:var(--accent)}.tab-button.active[_ngcontent-%COMP%]{color:var(--accent);border-bottom-color:var(--accent);background:var(--card)}.search-container[_ngcontent-%COMP%]{padding:1rem;background:var(--card);border-bottom:1px solid var(--border)}.search-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:14px;transition:border-color .2s}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent)}.search-input[_ngcontent-%COMP%]::placeholder{color:var(--muted)}.tab-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem}.library-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.library-item-wrapper[_ngcontent-%COMP%]{cursor:grab;transition:opacity .2s}.library-item-wrapper[draggable=true][_ngcontent-%COMP%]:active{cursor:grabbing}.library-item-wrapper[draggable=false][_ngcontent-%COMP%]{cursor:default}.add-button[_ngcontent-%COMP%]{padding:.75rem;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:14px;transition:background .2s;margin-top:.5rem}.add-button[_ngcontent-%COMP%]:hover{background:var(--accentdark)}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bg)}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--muted)}"]})};var mt=["timelineContainer"];function ut(o,t){if(o&1&&(l(0,"div",4)(1,"span",13),p(2,"Current Turn:"),s(),l(3,"span",14),p(4),s()()),o&2){let e=d();c(4),E(e.currentTurnDisplay())}}function gt(o,t){if(o&1&&(l(0,"option",25),p(1),s()),o&2){let e=t.$implicit;S("value",e),c(),E(e)}}function ht(o,t){if(o&1){let e=y();l(0,"select",24),f("ngModelChange",function(n){m(e);let r=d().$implicit,a=d(2);return u(a.onTeamChange(r.id,n))}),M(1,gt,2,2,"option",25,K),s()}if(o&2){let e=d().$implicit,i=d(2);S("ngModel",e.team),c(),k(i.teams)}}function _t(o,t){if(o&1){let e=y();l(0,"div",16)(1,"div",17),L(2,"img",18),j(3,"imageUrl"),l(4,"div",19)(5,"span",20),p(6),s(),l(7,"span",21),p(8),s(),b(9,ht,3,1,"select",22),s()(),l(10,"button",23),f("click",function(){let n=m(e).$implicit,r=d(2);return u(n.isInBattle?r.onRemoveCharacter(n.id):r.onAddCharacter(n.id))}),p(11),s()()}if(o&2){let e=t.$implicit;I("in-battle",e.isInBattle),c(2),S("src",J(3,9,e.portrait),X),c(4),E(e.name),c(2),x("Speed: ",e.speed),c(),C(e.isInBattle?9:-1),c(),I("remove",e.isInBattle),c(),x(" ",e.isInBattle?"Remove":"Add"," ")}}function ft(o,t){if(o&1&&(l(0,"div",6),M(1,_t,12,11,"div",15,ie().trackChar,!0),s()),o&2){let e=d();c(),k(e.characters())}}function bt(o,t){o&1&&(l(0,"p",7),p(1,"No characters available"),s())}function Ct(o,t){o&1&&(l(0,"div",10)(1,"span"),p(2,"Add characters to start battle"),s()())}function yt(o,t){o&1&&L(0,"div",28)}function xt(o,t){if(o&1){let e=y();l(0,"div",32),f("dragstart",function(n){let r=m(e).$implicit,a=d(3);return u(a.onDragStart(n,r))})("dragend",function(){m(e);let n=d(3);return u(n.onDragEnd())}),L(1,"img",33),j(2,"imageUrl"),l(3,"span",34),p(4),s(),l(5,"span",35),p(6),s()()}if(o&2){let e=t.$implicit,i=d(3);I("dragged",i.isDragged(e.id))("animating",i.isAnimating(e.id))("scripted",e.isScripted)("calculated",!e.isScripted),S("ngClass","team-"+e.team),$("data-tile-id",e.id),c(),S("src",J(2,14,e.portrait),X)("alt",e.name),c(3),E(e.name),c(2),x("T",e.turnNumber)}}function vt(o,t){o&1&&L(0,"div",30)}function St(o,t){o&1&&L(0,"div",31)}function Tt(o,t){if(o&1&&(l(0,"div",27),b(1,yt,1,0,"div",28),M(2,xt,7,16,"div",29,ie().trackTile,!0),b(4,vt,1,0,"div",30),b(5,St,1,0,"div",31),s()),o&2){let e=t.$implicit,i=t.$index,n=d(2);I("scripted",e.isScripted)("calculated",!e.isScripted),S("ngClass","team-"+e.team),$("data-group-id",e.id),c(),C(n.dragOverGroupIndex===i&&n.dropPosition==="before"?1:-1),c(),k(e.tiles),c(2),C(e.tiles.length>1?4:-1),c(),C(n.dragOverGroupIndex===i&&n.dropPosition==="after"?5:-1)}}function wt(o,t){if(o&1&&M(0,Tt,6,9,"div",26,ie().trackGroup,!0),o&2){let e=d();k(e.timeline())}}var ye=class o{engine;timelineRef;cdr=T(oe);timeline=te([]);characters=te([]);currentTurnDisplay=te(null);teams=["blue","red","green","yellow","purple","orange"];draggedTileId=null;dragOverGroupIndex=null;dropPosition=null;animState={previousPositions:new Map,animatingIds:new Set,removedTiles:new Map,isAnimating:!1};pendingAnimation=!1;ngOnInit(){this.engine&&(this.engine.setChangeCallback(()=>this.onEngineChange()),this.refresh())}ngOnDestroy(){this.engine&&this.engine.setChangeCallback(()=>{})}onEngineChange(){console.log("[ANIM] onEngineChange called, isAnimating:",this.animState.isAnimating),this.animState.isAnimating=!0,this.refresh(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.animateTransitions(),setTimeout(()=>{this.animState.isAnimating=!1},350)})})}refresh(){this.timeline.set(this.engine.getTimeline()),this.characters.set(this.engine.getCharacters()),this.currentTurnDisplay.set(this.engine.getCurrentTurnDisplay()),this.cdr.detectChanges()}recordPositions(){if(!this.timelineRef?.nativeElement)return;let t=this.timelineRef.nativeElement;this.animState.previousPositions.clear(),t.querySelectorAll("[data-tile-id]").forEach(n=>{let r=n.dataset.tileId;if(r){let a=n.getBoundingClientRect();this.animState.previousPositions.set(r,{x:a.left,y:a.top})}}),t.querySelectorAll("[data-group-id]").forEach(n=>{let r=n.dataset.groupId;if(r){let a=n.getBoundingClientRect();this.animState.previousPositions.set(`group_${r}`,{x:a.left,y:a.top})}})}animateTransitions(){if(!this.timelineRef?.nativeElement)return;let t=this.timelineRef.nativeElement;console.log("[ANIM] Starting animation cycle"),console.log("[ANIM] Recorded positions:",Array.from(this.animState.previousPositions.keys()));let e=t.querySelectorAll("[data-tile-id]");console.log("[ANIM] Current tiles in DOM:",e.length),e.forEach(i=>{let n=i.dataset.tileId;if(!n)return;let r=this.animState.previousPositions.get(n),a=i.getBoundingClientRect();console.log(`[ANIM] Tile ${n}: prevPos=${r?`(${r.x.toFixed(1)}, ${r.y.toFixed(1)})`:"NEW"}, currentPos=(${a.left.toFixed(1)}, ${a.top.toFixed(1)})`),r?this.animateMove(i,n,r):this.animateIn(i,n)})}animateIn(t,e){this.animState.animatingIds.has(e)||(this.animState.animatingIds.add(e),t.style.transition="none",t.style.transform="translateY(-40px)",t.style.opacity="0",t.offsetHeight,t.style.transition="transform 0.3s ease-out, opacity 0.3s ease-out",t.style.transform="translateY(0)",t.style.opacity="1",this.cleanupAfterAnimation(t,e,350))}animateMove(t,e,i){let n=t.getBoundingClientRect(),r=i.x-n.left,a=i.y-n.top;console.log(`[ANIM] Tile ${e}: deltaX=${r.toFixed(1)}, deltaY=${a.toFixed(1)}`),!(Math.abs(r)<2&&Math.abs(a)<2)&&(this.animState.animatingIds.has(e)||(this.animState.animatingIds.add(e),t.style.transition="none",t.style.transform=`translate(${r}px, ${a}px)`,t.offsetHeight,t.style.transition="transform 0.3s ease-out",t.style.transform="translate(0, 0)",this.cleanupAfterAnimation(t,e,350)))}cleanupAfterAnimation(t,e,i){let n=!1;setTimeout(()=>{n||(n=!0,t.style.transition="",t.style.transform="",t.style.opacity="",this.animState.animatingIds.delete(e))},i)}onAddCharacter(t){this.recordPositions(),this.engine.addCharacter(t)}onRemoveCharacter(t){this.recordPositions(),this.engine.removeCharacter(t)}onTeamChange(t,e){this.recordPositions(),this.engine.setTeam(t,e)}onNextTurn(){this.animState.isAnimating||(this.recordPositions(),this.engine.nextTurn())}onResetBattle(){this.recordPositions(),this.engine.resetBattle()}onDragStart(t,e){this.draggedTileId=e.id,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e.id))}onDragOver(t){if(t.preventDefault(),!this.draggedTileId)return;let e=t.currentTarget,i=Array.from(e.querySelectorAll("[data-group-id]"));if(i.length===0){this.dragOverGroupIndex=0,this.dropPosition="before";return}let n=t.clientX,r=i[0].getBoundingClientRect();if(n<r.left){this.dragOverGroupIndex=0,this.dropPosition="before";return}let a=i[i.length-1].getBoundingClientRect();if(n>a.right){this.dragOverGroupIndex=i.length-1,this.dropPosition="after";return}let g=0,h=1/0,_="before";i.forEach((v,D)=>{let W=v.getBoundingClientRect(),ee=W.left+W.width/2,Me=Math.abs(n-ee);Me<h&&(h=Me,g=D,_=n<ee?"before":"after")}),this.dragOverGroupIndex=g,this.dropPosition=_}onDragLeave(t){let e=t.currentTarget,i=t.relatedTarget;i&&e.contains(i)||(this.dragOverGroupIndex=null,this.dropPosition=null)}onDrop(t){if(t.preventDefault(),!this.draggedTileId||this.dragOverGroupIndex===null||!this.dropPosition){this.clearDragState();return}this.recordPositions(),this.engine.dropTile(this.draggedTileId,this.dragOverGroupIndex,this.dropPosition),this.clearDragState()}onDragEnd(){this.clearDragState()}clearDragState(){this.draggedTileId=null,this.dragOverGroupIndex=null,this.dropPosition=null}isAnimating(t){return this.animState.animatingIds.has(t)}isDragged(t){return this.draggedTileId===t}trackGroup(t,e){return e.id}trackTile(t,e){return e.id}trackChar(t,e){return e.id}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=N({type:o,selectors:[["app-battle-tracker"]],viewQuery:function(e,i){if(e&1&&Ie(mt,5),e&2){let n;Ee(n=Oe())&&(i.timelineRef=n.first)}},inputs:{engine:"engine"},decls:20,vars:6,consts:[["timelineContainer",""],[1,"battle-tracker-container"],[1,"battle-header"],["title","Reset battle",1,"reset-button",3,"click"],[1,"current-turn-display"],[1,"characters-section"],[1,"character-list"],[1,"no-chars"],[1,"timeline-section"],[1,"timeline",3,"dragover","dragleave","drop"],[1,"empty-timeline"],[1,"controls"],[1,"next-turn-btn",3,"click","disabled"],[1,"label"],[1,"names"],[1,"character-option",3,"in-battle"],[1,"character-option"],[1,"character-info"],["alt","",1,"portrait-small",3,"src"],[1,"details"],[1,"name"],[1,"speed"],[1,"team-selector",3,"ngModel"],[1,"toggle-btn",3,"click"],[1,"team-selector",3,"ngModelChange","ngModel"],[3,"value"],[1,"turn-group",3,"scripted","calculated","ngClass"],[1,"turn-group",3,"ngClass"],[1,"drop-indicator","before"],["draggable","true",1,"tile",3,"dragged","animating","scripted","calculated","ngClass"],[1,"group-line"],[1,"drop-indicator","after"],["draggable","true",1,"tile",3,"dragstart","dragend","ngClass"],[1,"tile-portrait",3,"src","alt"],[1,"tile-name"],[1,"turn-number"]],template:function(e,i){if(e&1){let n=y();l(0,"div",1)(1,"div",2)(2,"h2"),p(3,"Battle Tracker"),s(),l(4,"button",3),f("click",function(){return m(n),u(i.onResetBattle())}),p(5," Reset "),s()(),b(6,ut,5,1,"div",4),l(7,"div",5)(8,"h3"),p(9,"Characters"),s(),b(10,ft,3,0,"div",6)(11,bt,2,0,"p",7),s(),l(12,"div",8)(13,"div",9,0),f("dragover",function(a){return m(n),u(i.onDragOver(a))})("dragleave",function(a){return m(n),u(i.onDragLeave(a))})("drop",function(a){return m(n),u(i.onDrop(a))}),b(15,Ct,3,0,"div",10)(16,wt,2,0),s()(),l(17,"div",11)(18,"button",12),f("click",function(){return m(n),u(i.onNextTurn())}),p(19," Next Turn "),s()()()}e&2&&(c(6),C(i.currentTurnDisplay()?6:-1),c(4),C(i.characters().length>0?10:11),c(3),I("dragging",!!i.draggedTileId),c(2),C(i.timeline().length===0?15:16),c(3),S("disabled",i.timeline().length===0))},dependencies:[H,Re,U,se,ce,le,z,G,de],styles:[".battle-tracker-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding:1rem;background:var(--bg-secondary);border-radius:8px}.battle-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:.5rem;border-bottom:1px solid var(--border)}.battle-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--accent);font-size:1.2rem}.reset-button[_ngcontent-%COMP%]{padding:4px 12px;background:transparent;border:1px solid var(--border);color:var(--text-muted);border-radius:4px;cursor:pointer;transition:all .2s}.reset-button[_ngcontent-%COMP%]:hover{border-color:var(--accent);color:var(--accent)}.current-turn-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:rgba(var(--accent-rgb),.1);border-left:3px solid var(--accent);border-radius:0 4px 4px 0}.current-turn-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted);font-size:.85rem}.current-turn-display[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{color:var(--accent);font-weight:500}.characters-section[_ngcontent-%COMP%]{margin-bottom:.5rem}.characters-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1rem;color:var(--text)}.character-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;max-height:250px;overflow-y:auto;padding-right:4px}.character-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.character-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0000000d}.character-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}.character-option[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.5rem;background:var(--bg);border:1px solid var(--border);border-radius:6px;transition:border-color .2s}.character-option.in-battle[_ngcontent-%COMP%]{border-color:var(--accent);background:rgba(var(--accent-rgb),.05)}.character-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.portrait-small[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover}.details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem}.details[_ngcontent-%COMP%]   .speed[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted)}.team-selector[_ngcontent-%COMP%]{margin-top:2px;padding:2px 4px;font-size:.75rem;background:var(--bg);color:var(--text);border:1px solid var(--border);border-radius:4px}.toggle-btn[_ngcontent-%COMP%]{padding:4px 12px;border:none;border-radius:4px;cursor:pointer;font-size:.8rem;background:var(--accent);color:#fff;transition:opacity .2s}.toggle-btn[_ngcontent-%COMP%]:hover{opacity:.9}.toggle-btn.remove[_ngcontent-%COMP%]{background:var(--bg-secondary);color:var(--text);border:1px solid var(--border)}.no-chars[_ngcontent-%COMP%]{color:var(--text-muted);font-style:italic;margin:0}.timeline-section[_ngcontent-%COMP%]{overflow-x:auto;padding-bottom:.5rem}.timeline-section[_ngcontent-%COMP%]::-webkit-scrollbar{height:6px}.timeline-section[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0000000d;border-radius:3px}.timeline-section[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px}.timeline[_ngcontent-%COMP%]{display:flex;gap:6px;min-height:100px;align-items:center;padding:8px 4px}.empty-timeline[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:80px;width:100%;color:var(--text-muted);font-style:italic}.turn-group[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:3px;padding:6px 6px 10px;border-radius:8px;background:#0000001a;position:relative}.turn-group.scripted[_ngcontent-%COMP%]{background:rgba(var(--accent-rgb),.15)}.turn-group.calculated[_ngcontent-%COMP%]{background:#0000000d}.group-line[_ngcontent-%COMP%]{position:absolute;bottom:2px;left:6px;right:6px;height:3px;border-radius:2px;background:currentColor}.turn-group.team-blue[_ngcontent-%COMP%]   .group-line[_ngcontent-%COMP%]{background:#3b82f6}.turn-group.team-red[_ngcontent-%COMP%]   .group-line[_ngcontent-%COMP%]{background:#ef4444}.turn-group.team-green[_ngcontent-%COMP%]   .group-line[_ngcontent-%COMP%]{background:#10b981}.turn-group.team-yellow[_ngcontent-%COMP%]   .group-line[_ngcontent-%COMP%]{background:#eab308}.turn-group.team-purple[_ngcontent-%COMP%]   .group-line[_ngcontent-%COMP%]{background:#a855f7}.turn-group.team-orange[_ngcontent-%COMP%]   .group-line[_ngcontent-%COMP%]{background:#f97316}.tile[_ngcontent-%COMP%]{position:relative;width:60px;height:85px;background:var(--card-bg, #2a2a2a);border:2px solid transparent;border-radius:6px;display:flex;flex-direction:column;align-items:center;overflow:hidden;cursor:grab;-webkit-user-select:none;user-select:none;transition:transform .15s ease,box-shadow .15s ease}.tile[_ngcontent-%COMP%]:active{cursor:grabbing}.tile-portrait[_ngcontent-%COMP%]{width:100%;height:55px;object-fit:cover;opacity:.9}.tile-name[_ngcontent-%COMP%]{position:absolute;bottom:12px;left:0;right:0;background:#000000bf;color:#fff;text-align:center;padding:2px 4px;font-size:9px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.turn-number[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;background:#00000080;color:var(--text-muted);text-align:center;font-size:8px;padding:1px}.tile.scripted[_ngcontent-%COMP%]{border-top:3px solid var(--accent)}.tile.calculated[_ngcontent-%COMP%]{border-top:3px dashed rgba(255,255,255,.3);opacity:.85}.tile.team-blue[_ngcontent-%COMP%]{border-bottom:3px solid #3b82f6}.tile.team-red[_ngcontent-%COMP%]{border-bottom:3px solid #ef4444}.tile.team-green[_ngcontent-%COMP%]{border-bottom:3px solid #10b981}.tile.team-yellow[_ngcontent-%COMP%]{border-bottom:3px solid #eab308}.tile.team-purple[_ngcontent-%COMP%]{border-bottom:3px solid #a855f7}.tile.team-orange[_ngcontent-%COMP%]{border-bottom:3px solid #f97316}.timeline[_ngcontent-%COMP%]:not(.dragging)   .tile[_ngcontent-%COMP%]:hover{transform:scale(1.1) translateY(-4px);z-index:10;box-shadow:0 6px 16px #0000004d}.timeline.dragging[_ngcontent-%COMP%]   .tile[_ngcontent-%COMP%]{pointer-events:none}.tile.dragged[_ngcontent-%COMP%]{opacity:.4}.tile.animating[_ngcontent-%COMP%]{pointer-events:none}.drop-indicator[_ngcontent-%COMP%]{position:absolute;top:4px;bottom:4px;width:4px;background:var(--accent);border-radius:2px;z-index:20;box-shadow:0 0 8px var(--accent),0 0 16px var(--accent);pointer-events:none;animation:_ngcontent-%COMP%_pulse .8s ease-in-out infinite}.drop-indicator.before[_ngcontent-%COMP%]{left:-4px}.drop-indicator.after[_ngcontent-%COMP%]{right:-4px}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.6}}.controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem}.next-turn-btn[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:1rem;font-weight:500;transition:opacity .2s,transform .1s}.next-turn-btn[_ngcontent-%COMP%]:hover:not(:disabled){opacity:.9}.next-turn-btn[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98)}.next-turn-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@keyframes _ngcontent-%COMP%_slideInFromTop{0%{opacity:0;transform:translateY(-40px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideOutToBottom{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(40px)}}"]})};var Mt=(o,t)=>t.name,Qe=(o,t)=>t.id;function kt(o,t){if(o&1){let e=y();l(0,"div",16),f("dragstart",function(n){let r=m(e).$index,a=d();return u(a.onDragStartBundle(n,r))}),l(1,"button",17),f("click",function(n){let r=m(e).$index,a=d();return u(a.deleteBundle(r,n))}),p(2,"\xD7"),s(),l(3,"span",18),p(4),s(),l(5,"span",19),p(6),s()()}if(o&2){let e=t.$implicit;c(4),E(e.name),c(2),x("",e.items.length+e.runes.length+e.spells.length," items")}}function Pt(o,t){o&1&&(l(0,"div",14),p(1," Drag items or bundles here to add loot "),s())}function It(o,t){if(o&1&&(l(0,"span"),p(1),s()),o&2){let e=d(2).$implicit;c(),x("",e.data.platinum," pp ")}}function Et(o,t){if(o&1&&(l(0,"span"),p(1),s()),o&2){let e=d(2).$implicit;c(),x("",e.data.gold," gp ")}}function Ot(o,t){if(o&1&&(l(0,"span"),p(1),s()),o&2){let e=d(2).$implicit;c(),x("",e.data.silver," sp ")}}function Lt(o,t){if(o&1&&(l(0,"span"),p(1),s()),o&2){let e=d(2).$implicit;c(),x("",e.data.copper," cp")}}function Vt(o,t){if(o&1&&(l(0,"div",22),b(1,It,2,1,"span"),b(2,Et,2,1,"span"),b(3,Ot,2,1,"span"),b(4,Lt,2,1,"span"),s()),o&2){let e=d().$implicit;c(),C(e.data.platinum?1:-1),c(),C(e.data.gold?2:-1),c(),C(e.data.silver?3:-1),c(),C(e.data.copper?4:-1)}}function Bt(o,t){if(o&1){let e=y();l(0,"label",26)(1,"input",27),f("change",function(){let n=m(e).$implicit,r=d().$index,a=d();return u(a.toggleRecipient(r,n.id))}),s(),p(2),s()}if(o&2){let e=t.$implicit,i=d().$implicit,n=d();c(),S("checked",n.isRecipient(i,e.id)),c(),x(" ",e.name," ")}}function Rt(o,t){if(o&1){let e=y();l(0,"div",15)(1,"div",20)(2,"div")(3,"span",21),p(4),s(),l(5,"strong"),p(6),s()(),l(7,"button",12),f("click",function(){let n=m(e).$index,r=d();return u(r.removeLoot(n))}),p(8,"\xD7"),s()(),b(9,Vt,5,4,"div",22),l(10,"div",23)(11,"span",24),p(12,"Send to:"),s(),l(13,"div",25),M(14,Bt,3,2,"label",26,Qe),s()()()}if(o&2){let e=t.$implicit,i=d();c(4),E(e.type),c(2),E(e.data.name||"Currency"),c(3),C(e.type==="currency"?9:-1),c(5),k(i.partyMembers)}}var xe=class o{store=T(A);bundles=[];partyMembers=[];bundleCreated=new w;bundleDeleted=new w;newCurrency={copper:0,silver:0,gold:0,platinum:0};addCurrency(){let t=this.store.worldValue;if(t&&(this.newCurrency.copper||this.newCurrency.silver||this.newCurrency.gold||this.newCurrency.platinum)){let e={id:`currency_${Date.now()}_${Math.random()}`,type:"currency",data:P({},this.newCurrency),claimedBy:[],recipientIds:t.partyIds};this.store.applyPatch({path:"battleLoot",value:[...t.battleLoot,e]}),this.newCurrency={copper:0,silver:0,gold:0,platinum:0}}}removeLoot(t){let e=this.store.worldValue;if(!e)return;let i=[...e.battleLoot];i.splice(t,1),this.store.applyPatch({path:"battleLoot",value:i})}clearLoot(){this.store.applyPatch({path:"battleLoot",value:[]})}revealLoot(){this.store.revealBattleLoot()}isRecipient(t,e){return!t.recipientIds||t.recipientIds.length===0?!0:t.recipientIds.includes(e)}toggleRecipient(t,e){let i=this.store.worldValue;if(!i)return;let r=i.battleLoot[t].recipientIds||[];r.length===0&&(r=[...i.partyIds]),r.includes(e)?r=r.filter(a=>a!==e):r=[...r,e],this.store.applyPatch({path:`battleLoot.${t}.recipientIds`,value:r})}createBundleFromLoot(){let t=this.store.worldValue;if(!t||t.battleLoot.length===0)return;let e=prompt("Enter bundle name:");if(!e||this.bundles.some(n=>n.name===e)&&!confirm(`A bundle named "${e}" already exists. Overwrite it?`))return;let i={name:e,description:"Created from battle loot",items:[],runes:[],spells:[],skills:[],currency:{copper:0,silver:0,gold:0,platinum:0}};t.battleLoot.forEach(n=>{n.type==="item"?i.items.push(n.data):n.type==="rune"?i.runes.push(n.data):n.type==="spell"?i.spells.push(n.data):n.type==="skill"?i.skills.push(n.data):n.type==="currency"&&(i.currency.copper+=n.data.copper||0,i.currency.silver+=n.data.silver||0,i.currency.gold+=n.data.gold||0,i.currency.platinum+=n.data.platinum||0)}),this.bundleCreated.emit(i)}deleteBundle(t,e){e.stopPropagation(),confirm("Are you sure you want to delete this bundle?")&&this.bundleDeleted.emit(t)}onDragStartBundle(t,e){t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("lootType","bundle"),t.dataTransfer.setData("lootIndex",e.toString())}onDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"}onDrop(t){t.preventDefault();let e=t.dataTransfer.getData("lootType"),i=parseInt(t.dataTransfer.getData("lootIndex")),n=this.store.worldValue;if(n)if(e==="bundle"){let r=this.bundles[i];if(!r)return;let a=[],g=(h,_)=>({id:`${h}_${Date.now()}_${Math.random()}`,type:h,data:_,claimedBy:[],recipientIds:n.partyIds});r.items.forEach(h=>a.push(g("item",h))),r.runes.forEach(h=>a.push(g("rune",h))),r.spells.forEach(h=>a.push(g("spell",h))),r.skills.forEach(h=>a.push(g("skill",h))),(r.currency.copper||r.currency.silver||r.currency.gold||r.currency.platinum)&&a.push({id:`curr_${Date.now()}`,type:"currency",data:P({},r.currency),claimedBy:[],recipientIds:n.partyIds}),this.store.applyPatch({path:"battleLoot",value:[...n.battleLoot,...a]})}else{let r;switch(e){case"item":r=n.itemLibrary[i];break;case"rune":r=n.runeLibrary[i];break;case"spell":r=n.spellLibrary[i];break;case"skill":r=n.skillLibrary[i];break}if(r){let a={id:`${e}_${Date.now()}_${Math.random()}`,type:e,data:r,claimedBy:[],recipientIds:n.partyIds};this.store.applyPatch({path:"battleLoot",value:[...n.battleLoot,a]})}}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=N({type:o,selectors:[["app-loot-manager"]],inputs:{bundles:"bundles",partyMembers:"partyMembers"},outputs:{bundleCreated:"bundleCreated",bundleDeleted:"bundleDeleted"},decls:42,vars:5,consts:[[1,"loot-manager-container"],[1,"currency-form"],[1,"currency-input"],["type","number",3,"ngModelChange","ngModel"],[3,"click"],[1,"bundles-section"],[1,"section-header"],[1,"secondary",3,"click"],[1,"bundle-list"],["draggable","true",1,"bundle-card"],[1,"loot-section"],[2,"display","flex","gap","0.5rem"],[1,"danger",3,"click"],[1,"loot-list",3,"dragover","drop"],[1,"empty-loot"],[1,"loot-item"],["draggable","true",1,"bundle-card",3,"dragstart"],["title","Delete Bundle",1,"bundle-delete",3,"click"],[1,"bundle-name"],[1,"bundle-desc"],[1,"loot-item-header"],[1,"loot-type"],[1,"currency-display"],[1,"loot-recipients"],[1,"recipients-label"],[1,"recipient-checkboxes"],[1,"recipient-checkbox"],["type","checkbox",3,"change","checked"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"label"),p(4,"CP"),s(),l(5,"input",3),R("ngModelChange",function(r){return B(i.newCurrency.copper,r)||(i.newCurrency.copper=r),r}),s()(),l(6,"div",2)(7,"label"),p(8,"SP"),s(),l(9,"input",3),R("ngModelChange",function(r){return B(i.newCurrency.silver,r)||(i.newCurrency.silver=r),r}),s()(),l(10,"div",2)(11,"label"),p(12,"GP"),s(),l(13,"input",3),R("ngModelChange",function(r){return B(i.newCurrency.gold,r)||(i.newCurrency.gold=r),r}),s()(),l(14,"div",2)(15,"label"),p(16,"PP"),s(),l(17,"input",3),R("ngModelChange",function(r){return B(i.newCurrency.platinum,r)||(i.newCurrency.platinum=r),r}),s()(),l(18,"button",4),f("click",function(){return i.addCurrency()}),p(19,"Add"),s()(),l(20,"div",5)(21,"div",6)(22,"h3"),p(23,"Loot Bundles"),s(),l(24,"button",7),f("click",function(){return i.createBundleFromLoot()}),p(25,"Save Current as Bundle"),s()(),l(26,"div",8),M(27,kt,7,2,"div",9,Mt),s()(),l(29,"div",10)(30,"div",6)(31,"h3"),p(32,"Battle Loot"),s(),l(33,"div",11)(34,"button",4),f("click",function(){return i.revealLoot()}),p(35,"Reveal All"),s(),l(36,"button",12),f("click",function(){return i.clearLoot()}),p(37,"Clear"),s()()(),l(38,"div",13),f("dragover",function(r){return i.onDragOver(r)})("drop",function(r){return i.onDrop(r)}),b(39,Pt,2,0,"div",14),M(40,Rt,16,3,"div",15,Qe),s()()()),e&2&&(c(5),V("ngModel",i.newCurrency.copper),c(4),V("ngModel",i.newCurrency.silver),c(4),V("ngModel",i.newCurrency.gold),c(4),V("ngModel",i.newCurrency.platinum),c(10),k(i.bundles),c(12),C((i.store.worldValue==null||i.store.worldValue.battleLoot==null?null:i.store.worldValue.battleLoot.length)===0?39:-1),c(),k(i.store.worldValue==null?null:i.store.worldValue.battleLoot))},dependencies:[H,U,Y,Ne,z,G],styles:[".loot-manager-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;height:100%}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--accent);font-size:1.1rem}.loot-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:.5rem;min-height:200px}.loot-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;background:var(--card);border:1px solid var(--border);border-radius:4px;padding:.5rem;margin-bottom:.5rem}.loot-item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.loot-type[_ngcontent-%COMP%]{font-size:.7rem;text-transform:uppercase;background:#0000001a;padding:2px 4px;border-radius:3px;margin-right:.5rem}.loot-controls[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem}.currency-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr) auto;gap:.5rem;align-items:end;background:var(--bg-secondary);padding:.5rem;border-radius:6px}.currency-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.7rem;color:var(--text-muted)}.currency-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:4px;border:1px solid var(--border);border-radius:4px;background:var(--bg);color:var(--text)}.bundle-list[_ngcontent-%COMP%]{display:flex;gap:.5rem;overflow-x:auto;padding-bottom:.5rem}.bundle-card[_ngcontent-%COMP%]{min-width:120px;padding:.5rem;background:var(--card-bg);border:1px solid var(--border);border-radius:6px;cursor:grab;text-align:center;position:relative}.bundle-card[_ngcontent-%COMP%]:active{cursor:grabbing}.bundle-name[_ngcontent-%COMP%]{font-weight:700;font-size:.9rem;display:block;margin-bottom:4px}.bundle-desc[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted)}.bundle-delete[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;width:18px;height:18px;border-radius:50%;background:#ef4444;color:#fff;border:none;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;opacity:0;transition:opacity .2s}.bundle-card[_ngcontent-%COMP%]:hover   .bundle-delete[_ngcontent-%COMP%]{opacity:1}button[_ngcontent-%COMP%]{padding:4px 8px;background:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background:var(--accent-hover)}button.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--border);color:var(--text)}button.secondary[_ngcontent-%COMP%]:hover{border-color:var(--accent);color:var(--accent)}button.danger[_ngcontent-%COMP%]{background:#ef4444}.loot-recipients[_ngcontent-%COMP%]{margin-top:.5rem;padding-top:.5rem;border-top:1px solid var(--border)}.recipients-label[_ngcontent-%COMP%]{font-size:.7rem;color:var(--text-muted);display:block;margin-bottom:4px}.recipient-checkboxes[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.recipient-checkbox[_ngcontent-%COMP%]{font-size:.8rem;display:flex;align-items:center;gap:4px;cursor:pointer}.loot-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.empty-loot[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:gray;font-style:italic}.currency-display[_ngcontent-%COMP%]{font-size:.8rem;margin-top:4px}"]})};var ve=class{onChange=null;worldStore=null;isSaving=!1;isInitialized=!1;allCharacters=new Map;participants=new Map;tiles=[];scriptedCount=0;TIMELINE_LENGTH=12;TEAMS=["blue","red","green","yellow","purple","orange"];setChangeCallback(t){this.onChange=t}setWorldStore(t){this.worldStore=t}setAvailableCharacters(t){this.allCharacters.clear();for(let e of t)this.allCharacters.set(e.id,{id:e.id,name:e.name,portrait:e.portrait,speed:e.speed??10});for(let[e,i]of this.participants){let n=this.allCharacters.get(e);n&&(i.name=n.name,i.portrait=n.portrait,i.speed=n.speed)}for(let e of this.tiles){let i=this.allCharacters.get(e.characterId);i&&(e.name=i.name,e.portrait=i.portrait,e.speed=i.speed)}this.notifyChange()}loadFromWorldStore(){if(this.isInitialized||this.isSaving||!this.worldStore)return;let t=this.worldStore.worldValue;if(!t)return;this.isInitialized=!0;let e=t.battleParticipants||[];if(e.length===0){this.participants.clear(),this.tiles=[],this.scriptedCount=0,this.notifyChange();return}let i=e[0];this.scriptedCount=i.turnFrequency>=1e4?i.turnFrequency-1e4:0,this.participants.clear();for(let r of e){let a=this.allCharacters.get(r.characterId);this.participants.set(r.characterId,{characterId:r.characterId,name:a?.name||r.name,portrait:a?.portrait,speed:a?.speed||r.speed,team:r.team||"blue",currentTurn:r.currentTurn||1})}let n=[...e].sort((r,a)=>r.nextTurnAt-a.nextTurnAt);this.tiles=[];for(let r of n){let a=this.participants.get(r.characterId);a&&(this.tiles.push(this.createTile(a,1,this.tiles.length)),a.currentTurn=2)}this.fillCalculatedTiles(),this.scriptedCount=Math.min(this.scriptedCount,this.tiles.length),this.notifyChange()}saveToWorldStore(){if(!this.worldStore)return;this.isSaving=!0;let t=[],e=new Set;for(let i of this.tiles){if(e.has(i.characterId))continue;e.add(i.characterId);let n=this.participants.get(i.characterId);if(!n)continue;let r=t.length;t.push({characterId:n.characterId,name:n.name,team:n.team,speed:n.speed,currentTurn:n.currentTurn,turnFrequency:r===0?1e4+this.scriptedCount:n.speed,nextTurnAt:r})}this.worldStore.applyPatch({path:"battleParticipants",value:t}),setTimeout(()=>{this.isSaving=!1},100)}calculateTiming(t,e){return t*1e3/Math.max(e,1)}createTile(t,e,i){return{id:`${t.characterId}_t${e}`,characterId:t.characterId,name:t.name,portrait:t.portrait,team:t.team,speed:t.speed,turnNumber:e,timing:this.calculateTiming(e,t.speed)}}fillCalculatedTiles(){if(this.participants.size===0)return;this.tiles.length>this.TIMELINE_LENGTH&&(this.tiles=this.tiles.slice(0,this.TIMELINE_LENGTH));let t=new Map;for(let g of this.tiles)t.has(g.characterId)||t.set(g.characterId,new Set),t.get(g.characterId).add(g.turnNumber);let e=new Map;for(let[g,h]of this.participants){let _=h.currentTurn,v=t.get(g)||new Set;for(;v.has(_);)_++;e.set(g,_)}let i=this.TIMELINE_LENGTH*2,n=0;for(;this.tiles.length<this.TIMELINE_LENGTH&&n<i;){n++;let g=null;for(let[_,v]of this.participants){let D=e.get(_)||1,W=this.calculateTiming(D,v.speed);(!g||W<g.timing)&&(g={characterId:_,turn:D,timing:W})}if(!g)break;let h=this.participants.get(g.characterId);this.tiles.push(this.createTile(h,g.turn,this.tiles.length)),e.set(g.characterId,g.turn+1)}let r=this.tiles.slice(0,this.scriptedCount),a=this.tiles.slice(this.scriptedCount);a.sort((g,h)=>g.timing-h.timing),this.tiles=[...r,...a]}rebuildTimeline(){this.tiles=[],this.scriptedCount=0;for(let t of this.participants.values())t.currentTurn=1;this.fillCalculatedTiles()}getTimeline(){if(this.tiles.length===0)return[];let t=[],e=[],i=null,n=new Set,r=0;for(let a of this.tiles){let g=r<this.scriptedCount,h=i===null||a.team!==i||n.has(a.characterId);if(h&&e.length>0){let _=r-e.length;t.push({id:`group_${t.length}`,tiles:e,team:i,isScripted:_<this.scriptedCount}),e=[],n.clear()}h&&(i=a.team),e.push(O(P({},a),{isScripted:g})),n.add(a.characterId),r++}if(e.length>0){let a=this.tiles.length-e.length;t.push({id:`group_${t.length}`,tiles:e,team:i,isScripted:a<this.scriptedCount})}return t}getCharacters(){let t=[];for(let[e,i]of this.allCharacters){let n=this.participants.get(e);t.push({id:e,name:i.name,portrait:i.portrait,speed:i.speed,team:n?.team||"blue",isInBattle:!!n})}return t}getCurrentTurnDisplay(){let t=this.getTimeline();return t.length===0?null:t[0].tiles.map(i=>i.name).join(" & ")}hasTiles(){return this.tiles.length>0}addCharacter(t){let e=this.allCharacters.get(t);!e||this.participants.has(t)||(this.participants.set(t,{characterId:t,name:e.name,portrait:e.portrait,speed:e.speed,team:"blue",currentTurn:1}),this.rebuildTimeline(),this.notifyChange(),this.saveToWorldStore())}removeCharacter(t){this.participants.delete(t);let e=this.tiles;this.tiles=this.tiles.filter(r=>r.characterId!==t);let i=e.length-this.tiles.length,n=e.slice(0,this.scriptedCount).filter(r=>r.characterId===t).length;this.scriptedCount=Math.max(0,this.scriptedCount-n),this.fillCalculatedTiles(),this.notifyChange(),this.saveToWorldStore()}setTeam(t,e){let i=this.participants.get(t);if(i){i.team=e;for(let n of this.tiles)n.characterId===t&&(n.team=e);this.notifyChange(),this.saveToWorldStore()}}nextTurn(){if(this.tiles.length===0)return;let t=this.getTimeline();if(t.length===0)return;let e=t[0],i=e.tiles.length;for(let n of e.tiles){let r=this.participants.get(n.characterId);r&&(r.currentTurn=n.turnNumber+1)}this.tiles=this.tiles.slice(i),this.scriptedCount=Math.max(0,this.scriptedCount-i),this.tiles.length>this.TIMELINE_LENGTH&&(this.tiles=this.tiles.slice(0,this.TIMELINE_LENGTH)),this.fillCalculatedTiles(),this.notifyChange(),this.saveToWorldStore()}resetBattle(){this.participants.clear(),this.tiles=[],this.scriptedCount=0,this.isInitialized=!1,this.notifyChange(),this.saveToWorldStore()}dropTile(t,e,i){let n=this.tiles.findIndex(v=>v.id===t);if(n===-1)return;let r=this.tiles[n],a=this.getTimeline(),g=0;for(let v=0;v<e;v++)g+=a[v]?.tiles.length||0;if(i==="after"&&(g+=a[e]?.tiles.length||0),g<=n)return;let h=[...this.tiles];h.splice(n,1);let _=g-1;h.splice(_,0,r),this.tiles=h,this.scriptedCount=_+1,this.notifyChange(),this.saveToWorldStore()}notifyChange(){this.onChange&&this.onChange()}};var At=()=>[],Wt=(o,t)=>t.id;function Dt(o,t){if(o&1){let e=y();l(0,"div",4)(1,"span"),p(2),s(),l(3,"button",7),f("click",function(){let n=m(e).$index,r=d(2);return u(r.removeCharacter(n))}),p(4,"Remove"),s()()}if(o&2){let e=t.$implicit;c(2),E(e)}}function Ft(o,t){if(o&1){let e=y();l(0,"div",9)(1,"span"),p(2),s(),l(3,"button",7),f("click",function(){let n=m(e).$index,r=d(2);return u(r.removeFromParty(n))}),p(4,"Remove"),s()()}if(o&2){let e=t.$implicit;c(2),E(e)}}function Nt(o,t){if(o&1&&(l(0,"option",27),p(1),s()),o&2){let e=d().$implicit;S("value",e),c(),E(e)}}function $t(o,t){if(o&1&&b(0,Nt,2,2,"option",27),o&2){let e=t.$implicit,i=d();C(i.partyIds.includes(e)?-1:0)}}function Ht(o,t){o&1&&(l(0,"p"),p(1,"No characters in party. Add characters to see their stats."),s())}function zt(o,t){if(o&1&&(l(0,"div",31),L(1,"img",47),j(2,"imageUrl"),s()),o&2){let e=d().$implicit;c(),S("alt",Le(e.sheet.name||e.id))("src",J(2,3,e.sheet.portrait),X)}}function Gt(o,t){if(o&1){let e=y();l(0,"div",29),f("dragover",function(n){m(e);let r=d(3);return u(r.onDragOver(n))})("drop",function(n){let r=m(e).$implicit,a=d(3);return u(a.onDropOnCharacter(n,r.id))})("dblclick",function(){let n=m(e).$implicit,r=d(3);return u(r.openCharacterSheet(n.id))}),l(1,"div",30),b(2,zt,3,5,"div",31),l(3,"div",32)(4,"h3"),p(5),s()()(),l(6,"div",33)(7,"div",34)(8,"span",35),p(9,"Health"),s(),l(10,"div",36),L(11,"div",37),l(12,"span",38),p(13),s()()(),l(14,"div",34)(15,"span",35),p(16,"Energy"),s(),l(17,"div",36),L(18,"div",39),l(19,"span",38),p(20),s()()(),l(21,"div",34)(22,"span",35),p(23,"Mana"),s(),l(24,"div",36),L(25,"div",40),l(26,"span",38),p(27),s()()(),l(28,"div",41)(29,"span",35),p(30,"Money:"),s(),l(31,"div",42)(32,"span",43),p(33),s(),l(34,"span",44),p(35),s(),l(36,"span",45),p(37),s(),l(38,"span",46),p(39),s()()()()()}if(o&2){let e=t.$implicit;c(2),C(e.sheet.portrait?2:-1),c(3),E(e.sheet.name||e.id),c(6),re("width",((e.sheet.statuses[0]==null?null:e.sheet.statuses[0].statusCurrent)||0)/((e.sheet.statuses[0]==null?null:e.sheet.statuses[0].statusBase)||1)*100,"%"),c(2),ae("",(e.sheet.statuses[0]==null?null:e.sheet.statuses[0].statusCurrent)||0," / ",(e.sheet.statuses[0]==null?null:e.sheet.statuses[0].statusBase)||0),c(5),re("width",((e.sheet.statuses[1]==null?null:e.sheet.statuses[1].statusCurrent)||0)/((e.sheet.statuses[1]==null?null:e.sheet.statuses[1].statusBase)||1)*100,"%"),c(2),ae("",(e.sheet.statuses[1]==null?null:e.sheet.statuses[1].statusCurrent)||0," / ",(e.sheet.statuses[1]==null?null:e.sheet.statuses[1].statusBase)||0),c(5),re("width",((e.sheet.statuses[2]==null?null:e.sheet.statuses[2].statusCurrent)||0)/((e.sheet.statuses[2]==null?null:e.sheet.statuses[2].statusBase)||1)*100,"%"),c(2),ae("",(e.sheet.statuses[2]==null?null:e.sheet.statuses[2].statusCurrent)||0," / ",(e.sheet.statuses[2]==null?null:e.sheet.statuses[2].statusBase)||0),c(6),x("",(e.sheet.currency==null?null:e.sheet.currency.copper)||0,"c"),c(2),x("",(e.sheet.currency==null?null:e.sheet.currency.silver)||0,"s"),c(2),x("",(e.sheet.currency==null?null:e.sheet.currency.gold)||0,"g"),c(2),x("",(e.sheet.currency==null?null:e.sheet.currency.platinum)||0,"p")}}function Ut(o,t){if(o&1&&(l(0,"div",13),M(1,Gt,40,18,"div",28,Wt),s()),o&2){let e=d(2);c(),k(e.getPartyCharacterArray())}}function jt(o,t){if(o&1){let e=y();l(0,"div",48),f("mousedown",function(){m(e);let n=d(2);return u(n.closeItemCreator())}),l(1,"div",49),f("click",function(n){return m(e),u(n.stopPropagation())})("mousedown",function(n){return m(e),u(n.stopPropagation())}),l(2,"app-item-creator",50),f("create",function(n){m(e);let r=d(2);return u(r.createItem(n))})("cancel",function(){m(e);let n=d(2);return u(n.closeItemCreator())}),s()()()}}function qt(o,t){o&1&&(l(0,"p",57),p(1,"Trash is empty"),s())}function Kt(o,t){if(o&1&&(l(0,"div",64),p(1),s()),o&2){let e=d().$implicit;c(),x(" ",e.data.description," ")}}function Jt(o,t){if(o&1){let e=y();l(0,"div",59)(1,"div",60)(2,"div",61)(3,"span",62),p(4),s(),l(5,"strong"),p(6),s()(),l(7,"div",63),p(8),j(9,"date"),s(),b(10,Kt,2,1,"div",64),s(),l(11,"div",54)(12,"button",65),f("click",function(){let n=m(e).$index,r=d(4);return u(r.restoreFromTrash(n))}),p(13," Restore "),s(),l(14,"button",66),f("click",function(){let n=m(e).$index,r=d(4);return u(r.permanentlyDelete(n))}),p(15," Delete Forever "),s()()()}if(o&2){let e=t.$implicit;c(4),x(" ",e.type," "),c(2),E(e.data.name||"Unnamed"),c(2),x(" Deleted: ",Be(9,4,e.deletedAt,"short")," "),c(2),C(e.data.description?10:-1)}}function Yt(o,t){if(o&1&&(l(0,"div",58),M(1,Jt,16,7,"div",59,ne),s()),o&2){let e=d(2);c(),k(e.trash)}}function Qt(o,t){if(o&1){let e=y();l(0,"div",51),f("click",function(){m(e);let n=d(2);return u(n.closeTrash())}),l(1,"div",52),f("click",function(n){return m(e),u(n.stopPropagation())}),l(2,"div",53)(3,"h2"),p(4,"\u{1F5D1}\uFE0F Trash"),s(),l(5,"div",54)(6,"button",55),f("click",function(){m(e);let n=d(2);return u(n.emptyTrash())}),p(7," Empty Trash "),s(),l(8,"button",56),f("click",function(){m(e);let n=d(2);return u(n.closeTrash())}),p(9," Close "),s()()(),b(10,qt,2,0,"p",57)(11,Yt,3,0,"div",58),s()()}if(o&2){let e=d();c(6),S("disabled",!e.trash||e.trash.length===0),c(4),C(!e.trash||e.trash.length===0?10:11)}}function Zt(o,t){if(o&1){let e=y();l(0,"div",0)(1,"div",1)(2,"h1"),p(3),s()(),l(4,"div",2)(5,"app-card")(6,"h2"),p(7,"All Characters"),s(),l(8,"div",3),M(9,Dt,5,1,"div",4,K),s(),l(11,"div",5)(12,"input",6),R("ngModelChange",function(n){m(e);let r=d();return B(r.newCharacterId,n)||(r.newCharacterId=n),u(n)}),s(),l(13,"button",7),f("click",function(){m(e);let n=d();return u(n.addCharacter())}),p(14,"Add Character"),s()()(),l(15,"app-card")(16,"h2"),p(17,"Active Party"),s(),l(18,"div",8),M(19,Ft,5,1,"div",9,K),s(),l(21,"div",5)(22,"select",10),R("ngModelChange",function(n){m(e);let r=d();return B(r.selectedCharacterForParty,n)||(r.selectedCharacterForParty=n),u(n)}),l(23,"option",11),p(24,"Select a character..."),s(),M(25,$t,1,1,null,null,K),s(),l(27,"button",7),f("click",function(){m(e);let n=d();return u(n.addToParty())}),p(28,"Add to Party"),s()()(),l(29,"app-card",12)(30,"h2"),p(31,"Party Dashboard"),s(),b(32,Ht,2,0,"p")(33,Ut,3,0,"div",13),s()(),l(34,"div",14),L(35,"app-battle-tracker",15),s(),l(36,"div",16)(37,"app-card",17)(38,"h2"),p(39,"Battle Loot"),s(),l(40,"app-loot-manager",18),f("bundleCreated",function(n){m(e);let r=d();return u(r.onBundleCreated(n))})("bundleDeleted",function(n){m(e);let r=d();return u(r.onBundleDeleted(n))}),s()(),l(41,"app-card",19)(42,"div",20)(43,"h2"),p(44,"Library"),s(),l(45,"button",21),f("click",function(){m(e);let n=d();return u(n.openTrash())}),p(46),s()(),l(47,"div",22)(48,"button",23),f("click",function(){m(e);let n=d();return u(n.generateRandomWeapon())}),p(49,"Zuf\xE4llige Waffe schmieden"),s(),l(50,"button",23),f("click",function(){m(e);let n=d();return u(n.generateRandomArmor())}),p(51,"Zuf\xE4llige R\xFCstung schmieden"),s()(),l(52,"p",24),p(53,"Drag items onto characters or battle loot. Double-click to edit."),s(),l(54,"app-library-tabs",25),f("addItem",function(){m(e);let n=d();return u(n.openItemCreator())})("addRune",function(){m(e);let n=d();return u(n.addRune())})("addSpell",function(){m(e);let n=d();return u(n.addSpell())})("addSkill",function(){m(e);let n=d();return u(n.addSkill())})("updateItem",function(n){m(e);let r=d();return u(r.updateItem(n.index,n.patch))})("updateRune",function(n){m(e);let r=d();return u(r.updateRune(n.index,n.patch))})("updateSpell",function(n){m(e);let r=d();return u(r.updateSpell(n.index,n.patch))})("updateSkill",function(n){m(e);let r=d();return u(r.updateSkill(n.index,n.patch))})("removeItem",function(n){m(e);let r=d();return u(r.removeItem(n))})("removeRune",function(n){m(e);let r=d();return u(r.removeRune(n))})("removeSpell",function(n){m(e);let r=d();return u(r.removeSpell(n))})("removeSkill",function(n){m(e);let r=d();return u(r.removeSkill(n))})("itemEditingChange",function(n){m(e);let r=d();return u(r.onItemEditingChange(n))})("runeEditingChange",function(n){m(e);let r=d();return u(r.onRuneEditingChange(n))})("spellEditingChange",function(n){m(e);let r=d();return u(r.onSpellEditingChange(n))})("skillEditingChange",function(n){m(e);let r=d();return u(r.onSkillEditingChange(n))})("dragStart",function(n){m(e);let r=d();return u(r.onDragStart(n.event,n.type,n.index))}),s()()()(),b(55,jt,3,0,"div",26),b(56,Qt,12,2,"div",26)}if(o&2){let e=t,i=d();c(3),x("",i.worldName," - GM View"),c(6),k(e.characterIds),c(3),V("ngModel",i.newCharacterId),c(7),k(e.partyIds),c(3),V("ngModel",i.selectedCharacterForParty),c(3),k(e.characterIds),c(7),C(i.getPartyCharacterArray().length===0?32:33),c(3),S("engine",i.battleEngine),c(5),S("bundles",i.lootBundleLibrary)("partyMembers",i.partyMembersForLoot),c(6),x(" \u{1F5D1}\uFE0F Trash (",(e.trash||Ve(19,At)).length,") "),c(8),S("items",e.itemLibrary)("runes",e.runeLibrary)("spells",e.spellLibrary)("skills",e.skillLibrary)("dummySheet",i.dummySheet)("editingItems",i.editingItems)("editingRunes",i.editingRunes)("editingSpells",i.editingSpells)("editingSkills",i.editingSkills),c(),C(i.showItemCreator?55:-1),c(),C(i.showTrash?56:-1)}}var Ze=class o{constructor(t){this.route=t}worldName="";store=T(A);worldSocket=T(Ge);characterApi=T($e);characterSocket=T(ze);battleService=T(pe);libraryService=T(be);trashService=T(Q);cdr=T(oe);newCharacterId="";selectedCharacterForParty="";partyCharacters=new Map;characterPortraitsMap=new Map;characterPatchSubscription;battleEngine=new ve;dummySheet=He();showItemCreator=!1;showTrash=!1;editingItems=new Set;editingRunes=new Set;editingSpells=new Set;editingSkills=new Set;dragScrollInterval;isDragging=!1;get lootBundleLibrary(){return this.store.worldValue?.lootBundleLibrary||[]}get battleQueue(){return this.battleService.getBattleQueue()}get availableCharactersForBattle(){return this.battleService.getAvailableCharactersForBattle(this.getPartyCharacterArray())}ngOnInit(){this.battleEngine.setWorldStore(this.store),this.route.params.subscribe(t=>{this.worldName=t.worldName,this.store.load(this.worldName)}),this.characterSocket.connect(),this.characterPatchSubscription=this.characterSocket.patches$.subscribe(t=>{let e=this.partyCharacters.get(t.characterId);e&&(this.applyJsonPatch(e,t.patch),(t.patch.path.includes("speed")||t.patch.path==="level")&&this.battleService.refreshBattleSpeeds(),t.patch.path.includes("portrait")&&this.updateCharacterPortraits(),this.cdr.markForCheck())}),this.store.world$.subscribe(t=>{t&&this.loadPartyCharacters(t.partyIds)})}ngOnDestroy(){this.characterPatchSubscription?.unsubscribe()}async loadPartyCharacters(t){for(let i of t)if(!this.partyCharacters.has(i))try{let n=await this.characterApi.loadCharacter(i);if(n&&(n.currency||(n.currency={copper:0,silver:0,gold:0,platinum:0}),this.partyCharacters.set(i,n),this.characterSocket.joinCharacter(i),n.worldName!==this.worldName))try{await this.characterApi.patchCharacter(i,{path:"worldName",value:this.worldName})}catch(r){console.error(`Failed to auto-assign world to character ${i}:`,r)}}catch(n){console.error(`Failed to load character ${i}:`,n)}let e=new Set(t);for(let i of this.partyCharacters.keys())e.has(i)||this.partyCharacters.delete(i);this.battleService.setPartyCharacters(this.partyCharacters),this.updateCharacterPortraits(),this.battleEngine.setAvailableCharacters(Array.from(this.partyCharacters.entries()).map(([i,n])=>({id:i,name:n.name||i,portrait:n.portrait,speed:this.battleService.calculateSpeed(n)}))),this.battleEngine.loadFromWorldStore(),this.cdr.detectChanges()}updateCharacterPortraits(){let t=new Map;this.partyCharacters.forEach((e,i)=>{e.portrait&&t.set(i,e.portrait)}),this.characterPortraitsMap=t}getPartyCharacterArray(){return Array.from(this.partyCharacters.entries()).map(([t,e])=>({id:t,sheet:e}))}get partyMembersForLoot(){return this.getPartyCharacterArray().map(t=>({id:t.id,name:t.sheet.name||t.id}))}addCharacter(){if(!this.newCharacterId.trim())return;let t=this.store.worldValue;t&&!t.characterIds.includes(this.newCharacterId)&&(this.store.applyPatch({path:"characterIds",value:[...t.characterIds,this.newCharacterId]}),this.newCharacterId="")}removeCharacter(t){let e=this.store.worldValue;if(e){let i=[...e.characterIds],n=i[t];i.splice(t,1);let r=e.partyIds.filter(a=>a!==n);this.store.applyPatch({path:"characterIds",value:i}),r.length!==e.partyIds.length&&this.store.applyPatch({path:"partyIds",value:r})}}async addToParty(){if(!this.selectedCharacterForParty)return;let t=this.store.worldValue;if(t&&!t.partyIds.includes(this.selectedCharacterForParty)){this.store.applyPatch({path:"partyIds",value:[...t.partyIds,this.selectedCharacterForParty]});try{await this.characterApi.patchCharacter(this.selectedCharacterForParty,{path:"worldName",value:t.name})}catch(e){console.error("Failed to update character worldName:",e)}this.selectedCharacterForParty=""}}removeFromParty(t){let e=this.store.worldValue;if(e){let i=[...e.partyIds];i.splice(t,1),this.store.applyPatch({path:"partyIds",value:i})}}openItemCreator(){this.showItemCreator=!0}closeItemCreator(){this.showItemCreator=!1}createItem(t){this.libraryService.createItem(t),this.closeItemCreator()}generateRandomWeapon(){this.libraryService.generateRandomWeapon(5)}generateRandomArmor(){this.libraryService.generateRandomArmor(5)}updateItem(t,e){this.libraryService.updateItem(t,e)}removeItem(t){this.libraryService.removeItem(t),this.editingItems=this.shiftEditingSet(this.editingItems,t)}addRune(){this.libraryService.addRune()}updateRune(t,e){this.libraryService.updateRune(t,e)}removeRune(t){this.libraryService.removeRune(t),this.editingRunes=this.shiftEditingSet(this.editingRunes,t)}addSpell(){this.libraryService.addSpell()}updateSpell(t,e){this.libraryService.updateSpell(t,e)}removeSpell(t){this.libraryService.removeSpell(t)}addSkill(){this.libraryService.addSkill()}updateSkill(t,e){this.libraryService.updateSkill(t,e)}removeSkill(t){this.libraryService.removeSkill(t)}onItemEditingChange({index:t,isEditing:e}){this.editingItems=this.updateEditingSet(this.editingItems,t,e)}onRuneEditingChange({index:t,isEditing:e}){this.editingRunes=this.updateEditingSet(this.editingRunes,t,e)}onSpellEditingChange({index:t,isEditing:e}){this.editingSpells=this.updateEditingSet(this.editingSpells,t,e)}onSkillEditingChange({index:t,isEditing:e}){this.editingSkills=this.updateEditingSet(this.editingSkills,t,e)}isItemEditing(t){return this.editingItems.has(t)}isRuneEditing(t){return this.editingRunes.has(t)}isSpellEditing(t){return this.editingSpells.has(t)}updateEditingSet(t,e,i){let n=new Set(t);return i?n.add(e):n.delete(e),n}shiftEditingSet(t,e){let i=new Set;return t.forEach(n=>{n<e?i.add(n):n>e&&i.add(n-1)}),i}trackByIndex(t){return t}addToBattle(t){this.battleService.addToBattle(t)}removeFromBattle(t){this.battleService.removeFromBattle(t)}advanceTurn(){this.battleService.advanceTurn()}resetBattle(){this.battleService.resetBattle()}changeParticipantTeam(t,e){this.battleService.changeParticipantTeam(t,e)}reorderParticipants(t,e){this.battleService.reorderParticipants(t,e)}openTrash(){this.showTrash=!0}closeTrash(){this.showTrash=!1}restoreFromTrash(t){this.trashService.restoreFromTrash(t)}permanentlyDelete(t){this.trashService.permanentlyDelete(t)}emptyTrash(){this.trashService.emptyTrash()}onDragStart(t,e,i){t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("lootType",e),t.dataTransfer.setData("lootIndex",i.toString()),this.isDragging=!0,this.startAutoScroll()}onDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="copy",this.updateAutoScroll(t.clientY)}startAutoScroll(){this.dragScrollInterval&&clearInterval(this.dragScrollInterval),this.dragScrollInterval=window.setInterval(()=>{this.isDragging||this.stopAutoScroll()},16)}updateAutoScroll(t){let n=window.innerHeight;t<100?window.scrollBy(0,-10):t>n-100&&window.scrollBy(0,10)}stopAutoScroll(){this.dragScrollInterval&&(clearInterval(this.dragScrollInterval),this.dragScrollInterval=void 0),this.isDragging=!1}onDropOnCharacter(t,e){t.preventDefault(),this.stopAutoScroll();let i=t.dataTransfer.getData("lootType"),n=parseInt(t.dataTransfer.getData("lootIndex")),r=this.store.worldValue;if(!r)return;if(i==="bundle"){let g=this.lootBundleLibrary[n];g&&this.characterApi.loadCharacter(e).then(h=>{h&&(g.items.forEach(_=>this.giveItemToCharacter(e,"item",_,h)),g.runes.forEach(_=>this.giveItemToCharacter(e,"rune",_,h)),g.spells.forEach(_=>this.giveItemToCharacter(e,"spell",_,h)),g.skills.forEach(_=>this.giveItemToCharacter(e,"skill",_,h)))});return}let a;switch(i){case"item":a=r.itemLibrary[n];break;case"rune":a=r.runeLibrary[n];break;case"spell":a=r.spellLibrary[n];break;case"skill":a=r.skillLibrary[n];break}a&&this.characterApi.loadCharacter(e).then(g=>{g&&this.giveItemToCharacter(e,i,a,g)})}giveItemToCharacter(t,e,i,n){let r,a;switch(e){case"item":r="inventory",a=n.inventory||[];break;case"rune":r="runes",a=n.runes||[];break;case"spell":r="spells",a=n.spells||[];break;case"skill":r="skills",a=n.skills||[];break}a.push(P({},i)),this.characterSocket.sendPatch(t,{path:r,value:a}),this.sendDirectLootNotification(t,e,i)}sendDirectLootNotification(t,e,i){let n={id:`direct_${e}_${Date.now()}_${Math.random()}`,type:e,data:i,claimedBy:[]};this.worldSocket.sendDirectLoot(t,n)}onBundleCreated(t){let e=this.store.worldValue;if(e){let i=e.lootBundleLibrary||[],n=i.findIndex(a=>a.name===t.name),r=n>=0?i.map((a,g)=>g===n?t:a):[...i,t];this.store.applyPatch({path:"lootBundleLibrary",value:r})}}onBundleDeleted(t){let e=this.store.worldValue;if(e){let n=[...e.lootBundleLibrary||[]];n.splice(t,1),this.store.applyPatch({path:"lootBundleLibrary",value:n})}}openCharacterSheet(t){let e=`/characters/${t}`;window.open(e,"_blank")}applyJsonPatch(t,e){let i=e.path.startsWith("/")?e.path.substring(1).split("/"):e.path.split("."),n=t;for(let g=0;g<i.length-1;g++){let h=i[g],_=parseInt(h,10);!isNaN(_)&&Array.isArray(n)?n=n[_]:n=n[h]??={}}let r=i[i.length-1],a=parseInt(r,10);!isNaN(a)&&Array.isArray(n)?n[a]=e.value:n[r]=e.value}static \u0275fac=function(e){return new(e||o)(Pe(De))};static \u0275cmp=N({type:o,selectors:[["app-world"]],decls:2,vars:3,consts:[[1,"world-container"],[1,"world-header"],[1,"management-grid"],[1,"character-list"],[1,"character-item"],[1,"add-section"],["type","text","placeholder","Character ID",3,"ngModelChange","ngModel"],[3,"click"],[1,"party-list"],[1,"party-item"],[3,"ngModelChange","ngModel"],["value",""],[1,"party-dashboard-card"],[1,"dashboard-grid"],[1,"battle-tracker-section"],[3,"engine"],[1,"content-grid"],[1,"battle-loot-card"],[3,"bundleCreated","bundleDeleted","bundles","partyMembers"],[1,"library-card"],[2,"display","flex","justify-content","space-between","align-items","center"],["title","Open Trash",2,"background","#666","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click"],[2,"margin-bottom","1rem","display","flex","gap","0.5rem"],[2,"width","100%","background","var(--accent)","color","white","padding","8px",3,"click"],[1,"drag-hint"],[3,"addItem","addRune","addSpell","addSkill","updateItem","updateRune","updateSpell","updateSkill","removeItem","removeRune","removeSpell","removeSkill","itemEditingChange","runeEditingChange","spellEditingChange","skillEditingChange","dragStart","items","runes","spells","skills","dummySheet","editingItems","editingRunes","editingSpells","editingSkills"],[1,"dialog-overlay"],[3,"value"],[1,"character-card","drop-zone"],[1,"character-card","drop-zone",3,"dragover","drop","dblclick"],[1,"character-header"],[1,"character-portrait"],[1,"character-info"],[1,"character-stats"],[1,"stat-row"],[1,"stat-label"],[1,"stat-bar-wrapper"],[1,"stat-bar-fill","health"],[1,"stat-value"],[1,"stat-bar-fill","energy"],[1,"stat-bar-fill","mana"],[1,"stat-row","money"],[1,"currency"],[1,"copper"],[1,"silver"],[1,"gold"],[1,"platinum"],[3,"src","alt"],[1,"dialog-overlay",3,"mousedown"],[1,"dialog-content",3,"click","mousedown"],[3,"create","cancel"],[1,"dialog-overlay",3,"click"],[1,"dialog-content","trash-dialog",2,"max-width","800px","max-height","80vh","overflow-y","auto",3,"click"],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","1rem"],[2,"display","flex","gap","0.5rem"],[2,"background","#d32f2f","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click","disabled"],[2,"background","#666","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click"],[2,"text-align","center","color","#999","padding","2rem"],[2,"display","flex","flex-direction","column","gap","0.5rem"],[2,"background","var(--card-bg)","border","1px solid var(--border-color)","border-radius","4px","padding","1rem","display","flex","justify-content","space-between","align-items","center"],[2,"flex","1"],[2,"display","flex","align-items","center","gap","0.5rem"],[2,"background","var(--accent)","color","white","padding","2px 8px","border-radius","3px","font-size","0.75rem","text-transform","uppercase"],[2,"color","#999","font-size","0.85rem","margin-top","0.25rem"],[2,"color","#ccc","font-size","0.9rem","margin-top","0.5rem","max-width","500px","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],[2,"background","#4caf50","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click"],[2,"background","#d32f2f","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click"]],template:function(e,i){if(e&1&&(b(0,Zt,57,20),j(1,"async")),e&2){let n;C((n=J(1,1,i.store.world$))?0:-1,n)}},dependencies:[H,Fe,U,se,ce,Y,le,z,G,je,Ce,ye,xe,Ae,We,de],styles:[".world-container[_ngcontent-%COMP%]{padding:1rem;max-width:1800px;margin:0 auto}.world-header[_ngcontent-%COMP%]{margin-bottom:2rem}.world-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:var(--accent);font-size:28px;font-weight:600}.management-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 2fr;gap:1rem;margin-bottom:1rem}.content-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;gap:1rem;height:calc(100vh - 400px);min-height:600px}.battle-loot-card[_ngcontent-%COMP%], .library-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.party-dashboard-card[_ngcontent-%COMP%]{grid-column:span 3}.character-list[_ngcontent-%COMP%], .party-list[_ngcontent-%COMP%], .library-list[_ngcontent-%COMP%], .loot-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1rem;max-height:300px;overflow-y:auto}.character-item[_ngcontent-%COMP%], .party-item[_ngcontent-%COMP%], .loot-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:var(--bg);border-radius:6px;border:1px solid var(--border)}.library-list[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-bottom:.5rem}.character-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .party-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .loot-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;color:var(--text)}.character-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .party-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .loot-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.25rem .75rem;background:#ef4444;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px;transition:background .2s}.character-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .party-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .loot-item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#dc2626}.add-section[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem}.add-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .add-section[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{flex:1;padding:.5rem;border:1px solid var(--border);border-radius:6px;font-size:14px}.add-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], app-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:500;transition:background .2s}.add-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, app-card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:var(--accentdark)}.dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}.character-card[_ngcontent-%COMP%]{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px;box-shadow:0 1px 2px #0000000d}.character-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 12px;color:var(--accent);font-size:18px;font-weight:600;border-bottom:none;padding-bottom:0}.stat-row[_ngcontent-%COMP%]{margin-bottom:12px}.stat-label[_ngcontent-%COMP%]{display:block;font-size:12px;font-weight:500;color:var(--muted);margin-bottom:6px}.stat-bar-wrapper[_ngcontent-%COMP%]{height:14px;background:#0009;border-radius:6px;overflow:hidden;position:relative}.stat-bar-fill[_ngcontent-%COMP%]{height:100%;background:var(--accent);border-radius:6px;transition:width .3s ease}.stat-bar-fill.health[_ngcontent-%COMP%]{background:var(--health-color);box-shadow:inset 0 0 30px #ef444499,inset 0 0 60px #ef444466,inset 0 0 90px #ef444433;filter:brightness(1.3)}.stat-bar-fill.energy[_ngcontent-%COMP%]{background:var(--energy-color);box-shadow:inset 0 0 30px #22c55e99,inset 0 0 60px #22c55e66,inset 0 0 90px #22c55e33;filter:brightness(1.3)}.stat-bar-fill.mana[_ngcontent-%COMP%]{background:var(--mana-color);box-shadow:inset 0 0 30px #3b82f699,inset 0 0 60px #3b82f666,inset 0 0 90px #3b82f633;filter:brightness(1.3)}.stat-value[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;color:var(--text)}.stat-row.money[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px;border-top:1px solid var(--border)}.currency[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.currency[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;padding:4px 8px;border-radius:6px;font-size:12px}.currency[_ngcontent-%COMP%]   .copper[_ngcontent-%COMP%]{background:#cd7f32;color:#000}.currency[_ngcontent-%COMP%]   .silver[_ngcontent-%COMP%]{background:silver;color:#000}.currency[_ngcontent-%COMP%]   .gold[_ngcontent-%COMP%]{background:gold;color:#000}.currency[_ngcontent-%COMP%]   .platinum[_ngcontent-%COMP%]{background:#e5e4e2;color:#000;border:1px solid #9ca3af}.draggable[_ngcontent-%COMP%]{cursor:move;transition:transform .2s,box-shadow .2s}.draggable[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 2px 4px #0000001a}.draggable[_ngcontent-%COMP%]:active{cursor:grabbing}.drop-zone[_ngcontent-%COMP%]{position:relative;transition:background .2s,border .2s}.drop-zone.drag-over[_ngcontent-%COMP%]{background:#f3f4f6;border:2px dashed var(--accent)}.character-card.drop-zone[_ngcontent-%COMP%]{border:1px solid var(--border)}.character-card.drop-zone[_ngcontent-%COMP%]:hover{border-color:var(--accent)}.drop-hint[_ngcontent-%COMP%]{display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#6b46c1f2;color:#fff;padding:8px 16px;border-radius:6px;font-weight:600;font-size:14px;z-index:10;pointer-events:none;box-shadow:0 4px 6px #0000001a}.drop-zone[_ngcontent-%COMP%]:hover   .drop-hint[_ngcontent-%COMP%]{display:block}.drag-hint[_ngcontent-%COMP%]{font-size:12px;color:var(--muted);font-style:italic;margin:8px 0}.empty-loot[_ngcontent-%COMP%]{text-align:center;color:var(--muted);font-style:italic;padding:2rem;min-height:100px;display:flex;align-items:center;justify-content:center;border:2px dashed var(--border);border-radius:6px;margin:0;background:var(--bg)}.claimed-count[_ngcontent-%COMP%]{font-size:11px;color:var(--muted);background:var(--bg);padding:4px 8px;border-radius:6px;margin-left:8px;font-weight:500}.reveal-loot-btn[_ngcontent-%COMP%]{width:100%;margin-top:1rem;padding:12px;background:var(--accent);color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:background .2s}.reveal-loot-btn[_ngcontent-%COMP%]:hover{background:var(--accent-hover)}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.dialog-content[_ngcontent-%COMP%]{background:var(--card);padding:2rem;border-radius:8px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}.dialog-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:var(--accent)}.empty-message[_ngcontent-%COMP%]{text-align:center;color:var(--text-muted);padding:2rem;font-style:italic}.character-header[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem;align-items:flex-start}.character-portrait[_ngcontent-%COMP%]{width:120px;height:120px;flex-shrink:0;border-radius:10px;overflow:hidden;border:3px solid var(--accent);box-shadow:0 3px 6px #00000026}.character-portrait[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.character-info[_ngcontent-%COMP%]{flex:1;min-width:0}.character-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:18px;font-weight:600;color:var(--accent)}.character-stats[_ngcontent-%COMP%]{flex:1}.battle-tracker-section[_ngcontent-%COMP%]{margin-bottom:1rem}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .3s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})};export{Ze as WorldComponent};
