import{a as bi,b as Ot,c as vi,d as yi,e as Tt,f as wi,g as Rt,h as Si,i as Mi,j as ki,k as Pi,l as Ei,m as Oi}from"./chunk-TLJHWCTZ.js";import{a as Ee,b as Et,d as Dt,e as xi}from"./chunk-RFXIYJE6.js";import{c as _i}from"./chunk-U2QMYJWS.js";import{a as Q}from"./chunk-YL74CBNY.js";import{a as Pt,b as Y,c as G,d as Je,e as Ke,f as U,g as Ze,h as oe,i as fi,j as Be,k as ze,l as We,m as Ci,n as Pe,o as Qe,p as q,q as et}from"./chunk-CRXYTJXZ.js";import{e as ci,f as di,g as pi,h as mi,i as ui,j as gi,k as A,o as hi,p as kt}from"./chunk-QU66LBKX.js";import{$ as lt,$b as ie,A as bn,Bb as Te,Cb as Re,D as Kn,Db as Ie,Eb as oi,Fa as Se,Fb as z,Ga as ni,Gb as T,H as yt,Ha as ii,Hb as le,I as xn,Ia as c,Ib as l,J as Ge,Jb as M,K as Zn,Kb as D,Lb as se,Ma as vn,Mb as Mt,Na as yn,Nb as k,O as ae,Oa as Xe,Ob as P,P as wt,Pb as E,Qa as K,Qb as ri,R as ke,Ra as wn,Rb as ai,S as st,Sb as mt,T as L,Tb as Z,Ua as F,Ub as re,Va as St,Vb as ce,W as Qn,Wa as dt,Wb as ut,Y as m,Z as u,Za as ge,Zb as Ne,_ as Ue,a as ee,aa as qe,b as De,bc as $e,cb as Sn,cc as si,d as He,da as v,db as he,dc as li,ea as we,f as rt,fb as f,g as X,gb as C,h as Ye,hb as ue,i as Cn,ia as B,ib as te,jb as I,kb as V,l as Gn,la as ct,lb as b,mb as a,na as Ae,nb as s,ob as W,p as at,pa as ei,pb as S,q as Un,qb as w,ra as ti,rb as je,sb as y,tb as pt,wb as g,x as Xn,xb as _e,y as vt,yb as d,z as Jn}from"./chunk-EGMLUSXW.js";var It=class r{constructor(t){this.cd=t}stat;sheet;isPopupVisible=!1;getStatKey(){return{St\u00E4rke:"strength",Geschicklichkeit:"dexterity",Geschwindigkeit:"speed",Intelligenz:"intelligence",Konstitution:"constitution",Chill:"chill"}[this.stat.name]||null}get effectBonus(){let t=this.getStatKey();if(!t)return 0;let e=0;if(this.sheet.skills){for(let n of this.sheet.skills)if(n.statModifiers){for(let i of n.statModifiers)if(i.stat===t){let o=n.level||1;e+=i.amount*o}}}if(this.sheet.equipment){for(let n of this.sheet.equipment)if(n.statModifiers)for(let i of n.statModifiers)i.stat===t&&(e+=i.amount)}return e}get effectSources(){let t=this.getStatKey();if(!t)return[];let e=[];if(this.sheet.skills){for(let n of this.sheet.skills)if(n.statModifiers){for(let i of n.statModifiers)if(i.stat===t){let o=n.level||1,p=i.amount*o,h=p>=0?"+":"";e.push(`${n.name}: ${h}${p}`)}}}if(this.sheet.equipment){for(let n of this.sheet.equipment)if(n.statModifiers){for(let i of n.statModifiers)if(i.stat===t){let o=i.amount>=0?"+":"";e.push(`${n.name}: ${o}${i.amount}`)}}}return e}get total(){let t=this.effectBonus;return this.stat.current=this.stat.base+this.stat.bonus+t+this.stat.gain*this.sheet.level|0,this.stat.current}get bonusNumeric(){return-5+this.total/2|0}get bonusValue(){let t=this.bonusNumeric;return t<0?""+t:t>0?"+"+t:"0"}pressed(){this.isPopupVisible=!0,setTimeout(()=>{this.isPopupVisible=!1,this.cd.detectChanges()},1e3)}get bonusClass(){let t=this.bonusNumeric;return t<0?"negative":t>0?"positive":""}get popupClass(){return this.isPopupVisible?"show":(this.isPopupVisible,"")}ngOnChanges(){this.cd.markForCheck()}patch=new v;updateField(t,e){this.stat[t]=Number(e),this.patch.emit({path:t,value:e}),this.cd.detectChanges()}static \u0275fac=function(e){return new(e||r)(K(ie))};static \u0275cmp=F({type:r,selectors:[["app-stat"]],inputs:{stat:"stat",sheet:"sheet"},outputs:{patch:"patch"},features:[ct],decls:27,vars:10,consts:[[1,"container",3,"click"],[1,"stat-title"],[1,"statbox"],[1,"column"],[1,"text"],["type","number","min","1","max","99",3,"ngModelChange","ngModel"],[1,"text","effect-label",3,"title"],[1,"effect-value",3,"title"],[1,"right-values"],[1,"value"],[1,"value","bonus",3,"ngClass"]],template:function(e,n){e&1&&(a(0,"div",0),g("click",function(){return n.pressed()}),a(1,"app-card")(2,"div",1),l(3),s(),a(4,"div",2)(5,"div",3)(6,"label",4),l(7,"Basis"),s(),a(8,"input",5),g("ngModelChange",function(o){return n.updateField("base",o)}),s()(),a(9,"div",3)(10,"label",4),l(11,"Steigung"),s(),a(12,"input",5),g("ngModelChange",function(o){return n.updateField("gain",o)}),s()(),a(13,"div",3)(14,"label",4),l(15,"Bonus"),s(),a(16,"input",5),g("ngModelChange",function(o){return n.updateField("bonus",o)}),s()(),a(17,"div",3)(18,"label",6),l(19,"Effekt"),s(),a(20,"div",7),l(21),s()(),a(22,"div",8)(23,"div",9),l(24),s(),a(25,"div",10),l(26),s()()()()()),e&2&&(c(3),M(n.stat.name),c(5),b("ngModel",n.stat.base),c(4),b("ngModel",n.stat.gain),c(4),b("ngModel",n.stat.bonus),c(2),b("title",n.effectSources.join(`
`)),c(2),b("title",n.effectSources.join(`
`)),c(),M(n.effectBonus),c(3),M(n.total),c(),b("ngClass",n.bonusClass),c(),M(n.bonusValue))},dependencies:[Q,q,Y,oe,G,Pe,Ci,U,A,ci],styles:[".container[_ngcontent-%COMP%]{width:100%;box-sizing:border-box}.statbox[_ngcontent-%COMP%]{background-color:var(--card);display:grid;grid-template-columns:repeat(4,1fr) auto;gap:16px;padding:14px;border-radius:8px;min-width:0}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;min-width:0}input[type=number][_ngcontent-%COMP%]{width:100%;padding:5px 6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text);box-sizing:border-box}.right-values[_ngcontent-%COMP%]{min-width:40px;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;gap:6px;font-weight:600;font-size:.95rem}.bonus[_ngcontent-%COMP%]{color:var(--accent);font-size:24px}.stat-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:var(--foreground);letter-spacing:.3px}.value.bonus.negative[_ngcontent-%COMP%]{color:#ff4d6d}.value.bonus.positive[_ngcontent-%COMP%]{color:#a259ff}.effect-label[_ngcontent-%COMP%]{cursor:help;text-decoration:underline dotted}.effect-value[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:5px 6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--accent);font-weight:600;cursor:help;min-height:30px}.popup[_ngcontent-%COMP%]{background:var(--card);padding:1rem;border:1px solid var(--border);box-shadow:0 4px 8px #0003;opacity:0;transition:opacity .5s ease}.popup.show[_ngcontent-%COMP%]{opacity:1}"]})};var Vt=class r{sheet;patch=new v;updateField(t,e){e.path=t+"."+e.path,this.patch.emit(e)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-stats"]],inputs:{sheet:"sheet"},outputs:{patch:"patch"},decls:11,vars:12,consts:[[1,"stats"],[1,"statgrid"],[3,"patch","stat","sheet"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"app-card")(2,"h2"),l(3,"Stats"),s(),a(4,"div",1)(5,"app-stat",2),g("patch",function(o){return n.updateField("strength",o)}),s(),a(6,"app-stat",2),g("patch",function(o){return n.updateField("constitution",o)}),s(),a(7,"app-stat",2),g("patch",function(o){return n.updateField("speed",o)}),s(),a(8,"app-stat",2),g("patch",function(o){return n.updateField("dexterity",o)}),s(),a(9,"app-stat",2),g("patch",function(o){return n.updateField("intelligence",o)}),s(),a(10,"app-stat",2),g("patch",function(o){return n.updateField("chill",o)}),s()()()()),e&2&&(c(5),b("stat",n.sheet.strength)("sheet",n.sheet),c(),b("stat",n.sheet.constitution)("sheet",n.sheet),c(),b("stat",n.sheet.speed)("sheet",n.sheet),c(),b("stat",n.sheet.dexterity)("sheet",n.sheet),c(),b("stat",n.sheet.intelligence)("sheet",n.sheet),c(),b("stat",n.sheet.chill)("sheet",n.sheet))},dependencies:[Q,It,q],styles:[".stats[_ngcontent-%COMP%]{padding:0;font-family:sans-serif}.statgrid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem}"]})};function wo(r,t){if(r&1){let e=y();a(0,"div",5),g("click",function(){m(e),d();let i=oi(2);return u(i.click())}),a(1,"p"),l(2,"Drag & drop an image here"),s(),a(3,"span"),l(4,"or click to upload"),s()()}}function So(r,t){if(r&1&&(W(0,"img",6),re(1,"imageUrl")),r&2){let e=d();b("src",ce(1,1,e.sheet.portrait),Se)}}var Ft=class r{constructor(t,e,n,i){this.zone=t;this.cd=e;this.api=n;this.imageService=i}isDragging=!1;baseImage=new v;sheet;charId;onDragOver(t){t.preventDefault(),this.isDragging=!0}onDragLeave(t){t.preventDefault(),this.isDragging=!1}onDrop(t){t.preventDefault(),this.zone.run(()=>{this.isDragging=!1;let e=t.dataTransfer?.files?.[0];e&&this.loadImage(e)})}onFileSelected(t){let e=t.target;e.files?.length&&this.loadImage(e.files[0])}async loadImage(t){if(!t.type.startsWith("image/"))return;let e=new FileReader;e.onload=()=>{let n=e.result;this.sheet.portrait=n,this.cd.detectChanges()},e.readAsDataURL(t);try{await this.api.uploadPortrait(this.charId,t)}catch(n){console.error("Failed to upload portrait:",n)}}static \u0275fac=function(e){return new(e||r)(K(we),K(ie),K(Et),K(et))};static \u0275cmp=F({type:r,selectors:[["app-portrait"]],inputs:{sheet:"sheet",charId:"charId"},outputs:{baseImage:"baseImage"},decls:5,vars:4,consts:[["fileInput",""],[1,"drop-zone",3,"dragover","dragleave","drop"],["type","file","accept","image/*","hidden","",3,"change"],[3,"click",4,"ngIf"],["alt","Preview",3,"src",4,"ngIf"],[3,"click"],["alt","Preview",3,"src"]],template:function(e,n){if(e&1){let i=y();a(0,"div",1),g("dragover",function(p){return m(i),u(n.onDragOver(p))})("dragleave",function(p){return m(i),u(n.onDragLeave(p))})("drop",function(p){return m(i),u(n.onDrop(p))}),a(1,"input",2,0),g("change",function(p){return m(i),u(n.onFileSelected(p))}),s(),ge(3,wo,5,0,"div",3)(4,So,2,3,"img",4),s()}e&2&&(T("dragging",n.isDragging),c(3),b("ngIf",!n.sheet.portrait),c(),b("ngIf",n.sheet.portrait))},dependencies:[A,di,q,Ee],styles:[".drop-zone[_ngcontent-%COMP%]{border:2px dashed var(--border);border-radius:12px;padding:1rem;text-align:center;cursor:pointer;transition:border-color .2s,background-color .2s;min-height:80px;display:flex;align-items:center;justify-content:center}.drop-zone.dragging[_ngcontent-%COMP%]{border-color:var(--accent);background-color:#6b46c11a}.drop-zone[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:16px;color:var(--text)}.drop-zone[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:13px;color:var(--muted)}.drop-zone[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:200px;border-radius:8px;object-fit:cover}"]})};function kn(){return{id:"",name:"",baseImage:"",ageRange:"20-80",lore:"",baseHealth:80,baseEnergy:50,baseMana:40,baseStrength:10,baseDexterity:10,baseSpeed:10,baseIntelligence:10,baseConstitution:10,baseChill:10,healthPerLevel:5,energyPerLevel:3,manaPerLevel:2,strengthPerLevel:0,dexterityPerLevel:0,speedPerLevel:0,intelligencePerLevel:0,constitutionPerLevel:0,chillPerLevel:0,skills:[]}}function Mo(r,t){if(r&1&&(je(0,"img",2),re(1,"imageUrl")),r&2){let e=d();pt("src",ce(1,2,e.race.baseImage),Se)("alt",e.race.name)}}function ko(r,t){r&1&&(S(0,"div",3),l(1,"?"),w())}function Po(r,t){if(r&1&&(S(0,"div",8),l(1),w()),r&2){let e=d();c(),M(e.race.lore)}}function Eo(r,t){if(r&1&&(S(0,"p",27),l(1),w()),r&2){let e=d().$implicit;c(),M(e.skill.description)}}function Oo(r,t){if(r&1&&(S(0,"div",22)(1,"span",23),l(2),w(),S(3,"div",24)(4,"span",25),l(5),w(),S(6,"span",26),l(7),w(),f(8,Eo,2,1,"p",27),w()()),r&2){let e=t.$implicit;c(2),D("Lvl ",e.levelRequired),c(3),M(e.skill.name),c(2),D("(",e.skill.type,")"),c(),C(e.skill.description?8:-1)}}function Do(r,t){if(r&1&&(S(0,"div",21)(1,"h4"),l(2,"Racial Skills"),w(),I(3,Oo,9,4,"div",22,ue),w()),r&2){let e=d();c(3),V(e.race.skills)}}var Lt=class r{race;isSelected=!1;select=new v;edit=new v;onClick(){this.select.emit(this.race)}onDoubleClick(){this.edit.emit(this.race)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-race-card"]],inputs:{race:"race",isSelected:"isSelected"},outputs:{select:"select",edit:"edit"},decls:77,vars:22,consts:[[1,"race-card",3,"click","dblclick"],[1,"race-card-image"],[3,"src","alt"],[1,"placeholder-image"],[1,"race-card-content"],[1,"race-card-header"],[1,"race-card-name"],[1,"race-card-age"],[1,"race-card-lore"],[1,"race-card-resources"],[1,"resource","health"],[1,"resource-icon"],[1,"resource-value"],[1,"resource-label"],[1,"resource","energy"],[1,"resource","mana"],[1,"race-card-stats"],[1,"stat"],[1,"label"],[1,"value"],[1,"gain"],[1,"race-card-skills"],[1,"skill-item"],[1,"skill-level"],[1,"skill-info"],[1,"skill-name"],[1,"skill-type"],[1,"skill-desc"]],template:function(e,n){e&1&&(S(0,"div",0),_e("click",function(){return n.onClick()})("dblclick",function(){return n.onDoubleClick()}),S(1,"div",1),f(2,Mo,2,4,"img",2)(3,ko,2,0,"div",3),w(),S(4,"div",4)(5,"div",5)(6,"h3",6),l(7),w(),S(8,"span",7),l(9),w()(),f(10,Po,2,1,"div",8),S(11,"div",9)(12,"div",10)(13,"span",11),l(14,"\u2764"),w(),S(15,"span",12),l(16),w(),S(17,"span",13),l(18,"Health"),w()(),S(19,"div",14)(20,"span",11),l(21,"\u26A1"),w(),S(22,"span",12),l(23),w(),S(24,"span",13),l(25,"Energy"),w()(),S(26,"div",15)(27,"span",11),l(28,"\u2726"),w(),S(29,"span",12),l(30),w(),S(31,"span",13),l(32,"Mana"),w()()(),S(33,"div",16)(34,"div",17)(35,"span",18),l(36,"STR"),w(),S(37,"span",19),l(38),w(),S(39,"span",20),l(40),w()(),S(41,"div",17)(42,"span",18),l(43,"DEX"),w(),S(44,"span",19),l(45),w(),S(46,"span",20),l(47),w()(),S(48,"div",17)(49,"span",18),l(50,"SPD"),w(),S(51,"span",19),l(52),w(),S(53,"span",20),l(54),w()(),S(55,"div",17)(56,"span",18),l(57,"INT"),w(),S(58,"span",19),l(59),w(),S(60,"span",20),l(61),w()(),S(62,"div",17)(63,"span",18),l(64,"CON"),w(),S(65,"span",19),l(66),w(),S(67,"span",20),l(68),w()(),S(69,"div",17)(70,"span",18),l(71,"CHL"),w(),S(72,"span",19),l(73),w(),S(74,"span",20),l(75),w()()(),f(76,Do,5,0,"div",21),w()()),e&2&&(T("selected",n.isSelected),c(2),C(n.race.baseImage?2:3),c(5),M(n.race.name),c(2),D("Lifespan: ",n.race.ageRange," years"),c(),C(n.race.lore?10:-1),c(6),M(n.race.baseHealth),c(7),M(n.race.baseEnergy),c(7),M(n.race.baseMana),c(8),M(n.race.baseStrength),c(2),D("+",n.race.strengthPerLevel,"/lvl"),c(5),M(n.race.baseDexterity),c(2),D("+",n.race.dexterityPerLevel,"/lvl"),c(5),M(n.race.baseSpeed),c(2),D("+",n.race.speedPerLevel,"/lvl"),c(5),M(n.race.baseIntelligence),c(2),D("+",n.race.intelligencePerLevel,"/lvl"),c(5),M(n.race.baseConstitution),c(2),D("+",n.race.constitutionPerLevel,"/lvl"),c(5),M(n.race.baseChill),c(2),D("+",n.race.chillPerLevel,"/lvl"),c(),C(n.race.skills.length>0?76:-1))},dependencies:[A,Ee],styles:[".race-card[_ngcontent-%COMP%]{background:var(--bg-secondary, #1a1a2e);border:2px solid var(--border, #333);border-radius:16px;padding:2rem;cursor:pointer;display:flex;gap:2rem}.race-card[_ngcontent-%COMP%]:hover, .race-card.selected[_ngcontent-%COMP%]{border-color:var(--accent, #4a9eff)}.race-card.selected[_ngcontent-%COMP%]{background:#4a9eff1a}.race-card-image[_ngcontent-%COMP%]{width:250px;height:250px;border-radius:16px;overflow:hidden;background:var(--bg);flex-shrink:0}.race-card-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.placeholder-image[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:4rem;color:var(--text-muted);background:var(--bg)}.race-card-content[_ngcontent-%COMP%]{flex:1}.race-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.race-card-name[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;color:var(--text, #fff);margin:0}.race-card-age[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1.1rem}.race-card-lore[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1.1rem;line-height:1.7;margin-bottom:1.5rem}.race-card-resources[_ngcontent-%COMP%]{display:flex;gap:1.25rem;margin-bottom:1.5rem}.resource[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1.25rem;border-radius:10px}.resource.health[_ngcontent-%COMP%]{background:#ef444426;border:2px solid #ef4444}.resource.energy[_ngcontent-%COMP%]{background:#22c55e26;border:2px solid #22c55e}.resource.mana[_ngcontent-%COMP%]{background:#3b82f626;border:2px solid #3b82f6}.resource-icon[_ngcontent-%COMP%]{font-size:1.75rem}.resource.health[_ngcontent-%COMP%]   .resource-icon[_ngcontent-%COMP%]{color:#ef4444}.resource.energy[_ngcontent-%COMP%]   .resource-icon[_ngcontent-%COMP%]{color:#22c55e}.resource.mana[_ngcontent-%COMP%]   .resource-icon[_ngcontent-%COMP%]{color:#3b82f6}.resource-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--text)}.resource-label[_ngcontent-%COMP%]{font-size:1rem;color:var(--text-muted)}.race-card-stats[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem;margin-bottom:1.5rem}.stat[_ngcontent-%COMP%]{background:var(--bg);padding:.6rem 1rem;border-radius:8px;display:flex;flex-direction:column;align-items:center;min-width:70px}.stat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#fff;font-size:.9rem;font-weight:500}.stat[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:1.3rem}.stat[_ngcontent-%COMP%]   .gain[_ngcontent-%COMP%]{color:#22c55e;font-size:.9rem;font-weight:600}.race-card-skills[_ngcontent-%COMP%]{background:var(--bg);border-radius:12px;padding:1.25rem}.race-card-skills[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--text);font-size:1.1rem}.skill-item[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:.75rem 0;border-bottom:1px solid var(--border, #333)}.skill-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.skill-level[_ngcontent-%COMP%]{background:var(--accent);color:#fff;padding:.35rem .75rem;border-radius:6px;font-size:.95rem;font-weight:600;white-space:nowrap;height:fit-content}.skill-info[_ngcontent-%COMP%]{flex:1}.skill-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text);font-size:1.1rem}.skill-type[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1rem;margin-left:.5rem}.skill-desc[_ngcontent-%COMP%]{margin:.5rem 0 0;color:var(--text-muted);font-size:1rem;line-height:1.5}@media(max-width:800px){.race-card[_ngcontent-%COMP%]{flex-direction:column}.race-card-image[_ngcontent-%COMP%]{width:100%;height:300px}.race-card-resources[_ngcontent-%COMP%]{flex-direction:column}}"]})};function To(r,t){if(r&1&&W(0,"img",7),r&2){let e=d();b("src",e.pendingImagePreview,Se)}}function Ro(r,t){if(r&1&&(W(0,"img",7),re(1,"imageUrl")),r&2){let e=d();b("src",ce(1,1,e.race.baseImage),Se)}}function Io(r,t){if(r&1){let e=y();a(0,"div",32)(1,"span",33),l(2),s(),a(3,"span",34),l(4),s(),a(5,"span",35),l(6),s(),a(7,"button",36),g("click",function(){let i=m(e).$index,o=d(2);return u(o.removeSkillFromRace(i))}),l(8,"\xD7"),s()()}if(r&2){let e=t.$implicit;c(2),D("Lvl ",e.levelRequired),c(2),M(e.skill.name),c(2),D("(",e.skill.type,")")}}function Vo(r,t){if(r&1&&(a(0,"div",18),I(1,Io,9,3,"div",32,ue),s()),r&2){let e=d();c(),V(e.race.skills)}}function Fo(r,t){if(r&1){let e=y();a(0,"button",37),g("click",function(){m(e);let i=d();return u(i.onDelete())}),l(1,"Delete Race"),s()}if(r&2){let e=d();b("disabled",e.saving)}}var At=class r{race;isCreate=!1;saving=!1;pendingImagePreview="";save=new v;cancel=new v;delete=new v;imageSelect=new v;newSkillLevelRequired=1;newSkill=this.createEmptySkill();createEmptySkill(){return{name:"",class:"",description:"",type:"passive",enlightened:!1}}addSkillToRace(){if(!this.newSkill.name.trim())return;let t={levelRequired:this.newSkillLevelRequired,skill:ee({},this.newSkill)};this.race.skills.push(t),this.newSkill=this.createEmptySkill(),this.newSkillLevelRequired=1}removeSkillFromRace(t){this.race.skills.splice(t,1)}onImageSelect(t){this.imageSelect.emit(t)}onSave(){this.save.emit()}onCancel(){this.cancel.emit()}onDelete(){this.delete.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-race-form"]],inputs:{race:"race",isCreate:"isCreate",saving:"saving",pendingImagePreview:"pendingImagePreview"},outputs:{save:"save",cancel:"cancel",delete:"delete",imageSelect:"imageSelect"},decls:142,vars:29,consts:[[1,"edit-screen"],[1,"form-section"],[1,"form-row"],[1,"form-field"],["type","text","placeholder","Race name",3,"ngModelChange","ngModel"],["type","text","placeholder","e.g., 60-80",3,"ngModelChange","ngModel"],[1,"image-upload"],[1,"preview-image",3,"src"],["type","file","accept","image/*",3,"change"],["rows","4","placeholder","Race description and lore...",3,"ngModelChange","ngModel"],[1,"resources-edit-grid"],[1,"resource-edit-row","health"],[1,"resource-icon"],["type","number",3,"ngModelChange","ngModel"],[1,"resource-edit-row","energy"],[1,"resource-edit-row","mana"],[1,"stats-edit-grid"],[1,"stat-edit-row"],[1,"skills-edit-list"],[1,"add-skill-form"],[1,"form-field","small"],["type","number","min","1",3,"ngModelChange","ngModel"],["type","text","placeholder","Skill name",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","passive"],["value","active"],["rows","2","placeholder","Skill description",3,"ngModelChange","ngModel"],[1,"btn","btn-secondary",3,"click"],[1,"actions"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"btn","btn-danger",3,"disabled"],[1,"skill-edit-item"],[1,"skill-level"],[1,"skill-name"],[1,"skill-type"],[1,"btn-remove",3,"click"],[1,"btn","btn-danger",3,"click","disabled"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"h2"),l(2),s(),a(3,"div",1)(4,"h3"),l(5,"Basic Info"),s(),a(6,"div",2)(7,"div",3)(8,"label"),l(9,"Name *"),s(),a(10,"input",4),E("ngModelChange",function(o){return P(n.race.name,o)||(n.race.name=o),o}),s()(),a(11,"div",3)(12,"label"),l(13,"Age Range"),s(),a(14,"input",5),E("ngModelChange",function(o){return P(n.race.ageRange,o)||(n.race.ageRange=o),o}),s()()(),a(15,"div",3)(16,"label"),l(17,"Base Image"),s(),a(18,"div",6),f(19,To,1,1,"img",7)(20,Ro,2,3,"img",7),a(21,"input",8),g("change",function(o){return n.onImageSelect(o)}),s()()(),a(22,"div",3)(23,"label"),l(24,"Lore"),s(),a(25,"textarea",9),E("ngModelChange",function(o){return P(n.race.lore,o)||(n.race.lore=o),o}),s()()(),a(26,"div",1)(27,"h3"),l(28,"Resources"),s(),a(29,"div",10)(30,"div",11)(31,"span",12),l(32,"\u2764"),s(),a(33,"label"),l(34,"Health"),s(),a(35,"input",13),E("ngModelChange",function(o){return P(n.race.baseHealth,o)||(n.race.baseHealth=o),o}),s()(),a(36,"div",14)(37,"span",12),l(38,"\u26A1"),s(),a(39,"label"),l(40,"Energy"),s(),a(41,"input",13),E("ngModelChange",function(o){return P(n.race.baseEnergy,o)||(n.race.baseEnergy=o),o}),s()(),a(42,"div",15)(43,"span",12),l(44,"\u2726"),s(),a(45,"label"),l(46,"Mana"),s(),a(47,"input",13),E("ngModelChange",function(o){return P(n.race.baseMana,o)||(n.race.baseMana=o),o}),s()()()(),a(48,"div",1)(49,"h3"),l(50,"Attributes & Per-Level Gains"),s(),a(51,"div",16)(52,"div",17)(53,"label"),l(54,"Strength"),s(),a(55,"input",13),E("ngModelChange",function(o){return P(n.race.baseStrength,o)||(n.race.baseStrength=o),o}),s(),a(56,"span"),l(57,"+"),s(),a(58,"input",13),E("ngModelChange",function(o){return P(n.race.strengthPerLevel,o)||(n.race.strengthPerLevel=o),o}),s(),a(59,"span"),l(60,"/lvl"),s()(),a(61,"div",17)(62,"label"),l(63,"Dexterity"),s(),a(64,"input",13),E("ngModelChange",function(o){return P(n.race.baseDexterity,o)||(n.race.baseDexterity=o),o}),s(),a(65,"span"),l(66,"+"),s(),a(67,"input",13),E("ngModelChange",function(o){return P(n.race.dexterityPerLevel,o)||(n.race.dexterityPerLevel=o),o}),s(),a(68,"span"),l(69,"/lvl"),s()(),a(70,"div",17)(71,"label"),l(72,"Speed"),s(),a(73,"input",13),E("ngModelChange",function(o){return P(n.race.baseSpeed,o)||(n.race.baseSpeed=o),o}),s(),a(74,"span"),l(75,"+"),s(),a(76,"input",13),E("ngModelChange",function(o){return P(n.race.speedPerLevel,o)||(n.race.speedPerLevel=o),o}),s(),a(77,"span"),l(78,"/lvl"),s()(),a(79,"div",17)(80,"label"),l(81,"Intelligence"),s(),a(82,"input",13),E("ngModelChange",function(o){return P(n.race.baseIntelligence,o)||(n.race.baseIntelligence=o),o}),s(),a(83,"span"),l(84,"+"),s(),a(85,"input",13),E("ngModelChange",function(o){return P(n.race.intelligencePerLevel,o)||(n.race.intelligencePerLevel=o),o}),s(),a(86,"span"),l(87,"/lvl"),s()(),a(88,"div",17)(89,"label"),l(90,"Constitution"),s(),a(91,"input",13),E("ngModelChange",function(o){return P(n.race.baseConstitution,o)||(n.race.baseConstitution=o),o}),s(),a(92,"span"),l(93,"+"),s(),a(94,"input",13),E("ngModelChange",function(o){return P(n.race.constitutionPerLevel,o)||(n.race.constitutionPerLevel=o),o}),s(),a(95,"span"),l(96,"/lvl"),s()(),a(97,"div",17)(98,"label"),l(99,"Chill"),s(),a(100,"input",13),E("ngModelChange",function(o){return P(n.race.baseChill,o)||(n.race.baseChill=o),o}),s(),a(101,"span"),l(102,"+"),s(),a(103,"input",13),E("ngModelChange",function(o){return P(n.race.chillPerLevel,o)||(n.race.chillPerLevel=o),o}),s(),a(104,"span"),l(105,"/lvl"),s()()()(),a(106,"div",1)(107,"h3"),l(108,"Racial Skills"),s(),f(109,Vo,3,0,"div",18),a(110,"div",19)(111,"h4"),l(112,"Add Skill"),s(),a(113,"div",2)(114,"div",20)(115,"label"),l(116,"Level"),s(),a(117,"input",21),E("ngModelChange",function(o){return P(n.newSkillLevelRequired,o)||(n.newSkillLevelRequired=o),o}),s()(),a(118,"div",3)(119,"label"),l(120,"Name"),s(),a(121,"input",22),E("ngModelChange",function(o){return P(n.newSkill.name,o)||(n.newSkill.name=o),o}),s()(),a(122,"div",20)(123,"label"),l(124,"Type"),s(),a(125,"select",23),E("ngModelChange",function(o){return P(n.newSkill.type,o)||(n.newSkill.type=o),o}),a(126,"option",24),l(127,"Passive"),s(),a(128,"option",25),l(129,"Active"),s()()()(),a(130,"div",3)(131,"label"),l(132,"Description"),s(),a(133,"textarea",26),E("ngModelChange",function(o){return P(n.newSkill.description,o)||(n.newSkill.description=o),o}),s()(),a(134,"button",27),g("click",function(){return n.addSkillToRace()}),l(135,"+ Add Skill"),s()()(),a(136,"div",28)(137,"button",29),g("click",function(){return n.onSave()}),l(138),s(),a(139,"button",30),g("click",function(){return n.onCancel()}),l(140,"Cancel"),s(),f(141,Fo,2,1,"button",31),s()()),e&2&&(c(2),M(n.isCreate?"Create New Race":"Edit Race"),c(8),k("ngModel",n.race.name),c(4),k("ngModel",n.race.ageRange),c(5),C(n.pendingImagePreview?19:n.race.baseImage?20:-1),c(6),k("ngModel",n.race.lore),c(10),k("ngModel",n.race.baseHealth),c(6),k("ngModel",n.race.baseEnergy),c(6),k("ngModel",n.race.baseMana),c(8),k("ngModel",n.race.baseStrength),c(3),k("ngModel",n.race.strengthPerLevel),c(6),k("ngModel",n.race.baseDexterity),c(3),k("ngModel",n.race.dexterityPerLevel),c(6),k("ngModel",n.race.baseSpeed),c(3),k("ngModel",n.race.speedPerLevel),c(6),k("ngModel",n.race.baseIntelligence),c(3),k("ngModel",n.race.intelligencePerLevel),c(6),k("ngModel",n.race.baseConstitution),c(3),k("ngModel",n.race.constitutionPerLevel),c(6),k("ngModel",n.race.baseChill),c(3),k("ngModel",n.race.chillPerLevel),c(6),C(n.race.skills.length>0?109:-1),c(8),k("ngModel",n.newSkillLevelRequired),c(4),k("ngModel",n.newSkill.name),c(4),k("ngModel",n.newSkill.type),c(8),k("ngModel",n.newSkill.description),c(4),b("disabled",n.saving),c(),D(" ",n.saving?"Saving...":"Save Race"," "),c(),b("disabled",n.saving),c(2),C(n.isCreate?-1:141))},dependencies:[A,q,ze,We,Y,oe,Be,G,Pe,U,Ee],styles:[".edit-screen[_ngcontent-%COMP%]{max-width:1100px;margin:0 auto}h2[_ngcontent-%COMP%]{margin:0 0 2rem;color:var(--accent, #4a9eff);font-size:2.5rem}h3[_ngcontent-%COMP%]{margin:2rem 0 1.25rem;color:var(--text, #fff);font-size:1.5rem}h4[_ngcontent-%COMP%]{margin:1.25rem 0 .75rem;color:var(--text-muted, #888);font-size:1.2rem}.form-section[_ngcontent-%COMP%]{background:var(--bg-secondary);border-radius:16px;padding:2rem;margin-bottom:2rem}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.form-row[_ngcontent-%COMP%]{display:flex;gap:1.5rem;margin-bottom:1.5rem}.form-field[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.75rem}.form-field.small[_ngcontent-%COMP%]{flex:0 0 120px}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--text-muted)}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:1rem;color:var(--text);font-size:1.1rem}.form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:140px}.image-upload[_ngcontent-%COMP%]{display:flex;align-items:center;gap:2rem}.preview-image[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:16px;object-fit:cover}.resources-edit-grid[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.resource-edit-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.25rem;border-radius:12px;flex:1}.resource-edit-row.health[_ngcontent-%COMP%]{background:#ef444426;border:2px solid #ef4444}.resource-edit-row.energy[_ngcontent-%COMP%]{background:#22c55e26;border:2px solid #22c55e}.resource-edit-row.mana[_ngcontent-%COMP%]{background:#3b82f626;border:2px solid #3b82f6}.resource-edit-row[_ngcontent-%COMP%]   .resource-icon[_ngcontent-%COMP%]{font-size:2rem}.resource-edit-row.health[_ngcontent-%COMP%]   .resource-icon[_ngcontent-%COMP%]{color:#ef4444}.resource-edit-row.energy[_ngcontent-%COMP%]   .resource-icon[_ngcontent-%COMP%]{color:#22c55e}.resource-edit-row.mana[_ngcontent-%COMP%]   .resource-icon[_ngcontent-%COMP%]{color:#3b82f6}.resource-edit-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--text-muted);flex:1}.resource-edit-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:90px;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:.75rem;color:var(--text);text-align:center;font-size:1.3rem;font-weight:600}.stats-edit-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:1.25rem}.stat-edit-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;background:var(--bg);border-radius:10px}.stat-edit-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{flex:0 0 100px;font-size:1.05rem;color:var(--text-muted)}.stat-edit-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:65px;background:var(--bg-secondary);border:1px solid var(--border);border-radius:8px;padding:.65rem;color:#fff;text-align:center;font-size:1.1rem;font-weight:600}.stat-edit-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1rem}.skills-edit-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-bottom:2rem}.skill-edit-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.25rem;padding:1rem 1.5rem;background:var(--bg);border-radius:10px}.skill-level[_ngcontent-%COMP%]{background:var(--accent);color:#fff;padding:.4rem .75rem;border-radius:6px;font-size:1rem;font-weight:600}.skill-name[_ngcontent-%COMP%]{flex:1;color:var(--text);font-size:1.15rem}.skill-type[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1rem}.btn-remove[_ngcontent-%COMP%]{background:none;border:none;color:#ef4444;font-size:1.75rem;cursor:pointer}.add-skill-form[_ngcontent-%COMP%]{background:var(--bg);border-radius:12px;padding:1.75rem}.actions[_ngcontent-%COMP%]{display:flex;gap:1.25rem;margin-top:2.5rem}.btn[_ngcontent-%COMP%]{padding:1rem 2.5rem;border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:1.1rem}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:var(--accent);color:#fff}.btn-secondary[_ngcontent-%COMP%]{background:var(--bg);color:var(--text);border:1px solid var(--border)}.btn-danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff;margin-left:auto}@media(max-width:800px){.resources-edit-grid[_ngcontent-%COMP%]{flex-direction:column}.stats-edit-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]})};var Nt=class r{constructor(t){this.http=t}racesSubject=new Ye([]);races$=this.racesSubject.asObservable();loaded=!1;async loadRaces(){let t=await at(this.http.get("/api/races"));return this.racesSubject.next(t||[]),this.loaded=!0,t||[]}async getRaces(){return this.loaded?this.racesSubject.value:this.loadRaces()}async getRace(t){return(await this.getRaces()).find(n=>n.id===t)||null}async saveRace(t){let e=await at(this.http.post("/api/races",t)),n=this.racesSubject.value,i=n.findIndex(o=>o.id===t.id);return i>=0?n[i]=e.race:n.push(e.race),this.racesSubject.next([...n]),e.race}async deleteRace(t){let e=await at(this.http.delete(`/api/races/${t}`));if(e.success){let n=this.racesSubject.value.filter(i=>i.id!==t);this.racesSubject.next(n)}return e.success}generateId(){return"race_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async uploadRaceImage(t,e){let n=new FormData;n.append("image",e);let i=await at(this.http.post(`/api/races/${t}/image`,n)),o=this.racesSubject.value,p=o.find(h=>h.id===t);return p&&(p.baseImage=i.imageUrl,this.racesSubject.next([...o])),i.imageUrl}static \u0275fac=function(e){return new(e||r)(st(kt))};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})};var No=(r,t)=>t.id;function Bo(r,t){r&1&&(a(0,"h1"),l(1,"Select Race"),s())}function zo(r,t){if(r&1){let e=y();a(0,"button",8),g("click",function(){m(e);let i=d();return u(i.cancelEdit())}),l(1,"\u2190 Cancel"),s()}}function Wo(r,t){r&1&&(a(0,"div",5),l(1,"Loading races..."),s())}function Ho(r,t){if(r&1){let e=y();a(0,"div",9)(1,"span"),l(2,"Currently selected: "),a(3,"strong"),l(4),s()(),a(5,"button",16),g("click",function(){m(e);let i=d(2);return u(i.clearRace())}),l(6,"Clear Selection"),s()()}if(r&2){let e=d(2);c(4),M(e.selectedRace.name)}}function qo(r,t){if(r&1){let e=y();a(0,"app-race-card",17),g("select",function(i){m(e);let o=d(2);return u(o.selectRace(i))})("edit",function(i){m(e);let o=d(2);return u(o.startEdit(i))}),s()}if(r&2){let e=t.$implicit,n=d(2);b("race",e)("isSelected",n.isCurrentRace(e))}}function jo(r,t){if(r&1){let e=y();a(0,"div",6),f(1,Ho,7,1,"div",9),a(2,"p",10),l(3,"Click to select a race. Double-click to edit."),s(),a(4,"div",11),I(5,qo,1,2,"app-race-card",12,No),a(7,"div",13),g("click",function(){m(e);let i=d();return u(i.startCreate())}),a(8,"div",14),l(9,"+"),s(),a(10,"div",15),l(11,"Create New Race"),s()()()()}if(r&2){let e=d();c(),C(e.selectedRace?1:-1),c(4),V(e.races)}}function $o(r,t){if(r&1){let e=y();a(0,"app-race-form",18),g("save",function(){m(e);let i=d();return u(i.saveRace())})("cancel",function(){m(e);let i=d();return u(i.cancelEdit())})("delete",function(){m(e);let i=d();return u(i.deleteRace())})("imageSelect",function(i){m(e);let o=d();return u(o.onImageSelect(i))}),s()}if(r&2){let e=d();b("race",e.editingRace)("isCreate",e.viewMode==="create")("saving",e.saving)("pendingImagePreview",e.pendingImagePreview)}}var Bt=class r{constructor(t,e){this.raceService=t;this.cd=e}sheet;patch=new v;close=new v;races=[];viewMode="select";selectedRace=null;editingRace=kn();pendingImageFile=null;pendingImagePreview="";loading=!0;saving=!1;async ngOnInit(){this.loading=!0,this.cd.detectChanges(),this.races=await this.raceService.loadRaces(),this.loading=!1,this.cd.detectChanges(),this.sheet.raceId&&(this.selectedRace=this.races.find(t=>t.id===this.sheet.raceId)||null)}selectRace(t){this.selectedRace=t,this.patch.emit({path:"raceId",value:t.id}),this.patch.emit({path:"race",value:t.name}),this.patch.emit({path:"strength.base",value:t.baseStrength}),this.patch.emit({path:"dexterity.base",value:t.baseDexterity}),this.patch.emit({path:"speed.base",value:t.baseSpeed}),this.patch.emit({path:"intelligence.base",value:t.baseIntelligence}),this.patch.emit({path:"constitution.base",value:t.baseConstitution}),this.patch.emit({path:"chill.base",value:t.baseChill}),this.patch.emit({path:"strength.gain",value:t.strengthPerLevel}),this.patch.emit({path:"dexterity.gain",value:t.dexterityPerLevel}),this.patch.emit({path:"speed.gain",value:t.speedPerLevel}),this.patch.emit({path:"intelligence.gain",value:t.intelligencePerLevel}),this.patch.emit({path:"constitution.gain",value:t.constitutionPerLevel}),this.patch.emit({path:"chill.gain",value:t.chillPerLevel}),this.patch.emit({path:"statuses.0.statusBase",value:t.baseHealth}),this.patch.emit({path:"statuses.1.statusBase",value:t.baseEnergy}),this.patch.emit({path:"statuses.2.statusBase",value:t.baseMana})}clearRace(){this.patch.emit({path:"raceId",value:""}),this.patch.emit({path:"race",value:""}),this.selectedRace=null}startCreate(){this.editingRace=kn(),this.editingRace.id=this.raceService.generateId(),this.pendingImageFile=null,this.pendingImagePreview="",this.viewMode="create"}startEdit(t){this.editingRace=JSON.parse(JSON.stringify(t)),this.pendingImageFile=null,this.pendingImagePreview="",this.viewMode="edit"}async saveRace(){if(!(!this.editingRace.name.trim()||this.saving)){this.saving=!0,this.cd.detectChanges();try{await this.raceService.saveRace(this.editingRace),this.pendingImageFile&&(await this.raceService.uploadRaceImage(this.editingRace.id,this.pendingImageFile),this.pendingImageFile=null,this.pendingImagePreview=""),this.races=await this.raceService.loadRaces(),this.viewMode="select"}finally{this.saving=!1,this.cd.detectChanges()}}}async deleteRace(){this.editingRace&&confirm(`Are you sure you want to delete "${this.editingRace.name}"?`)&&(await this.raceService.deleteRace(this.editingRace.id),this.races=await this.raceService.loadRaces(),this.selectedRace?.id===this.editingRace.id&&(this.selectedRace=null,this.patch.emit({path:"raceId",value:""}),this.patch.emit({path:"race",value:""})),this.viewMode="select")}cancelEdit(){this.viewMode="select"}onImageSelect(t){let e=t.target;if(e.files&&e.files[0]){let n=e.files[0];this.pendingImageFile=n;let i=new FileReader;i.onload=()=>{this.pendingImagePreview=i.result,this.cd.detectChanges()},i.readAsDataURL(n)}}onClose(){this.close.emit()}isCurrentRace(t){return this.sheet.raceId===t.id}static \u0275fac=function(e){return new(e||r)(K(Nt),K(ie))};static \u0275cmp=F({type:r,selectors:[["app-race-selector"]],inputs:{sheet:"sheet"},outputs:{patch:"patch",close:"close"},decls:10,vars:4,consts:[[1,"race-selector-overlay"],[1,"race-selector-container"],[1,"header"],[1,"back-button"],[1,"close-button",3,"click"],[1,"loading"],[1,"selection-screen"],[3,"race","isCreate","saving","pendingImagePreview"],[1,"back-button",3,"click"],[1,"current-race"],[1,"hint"],[1,"race-list"],[3,"race","isSelected"],[1,"create-card",3,"click"],[1,"icon"],[1,"text"],[1,"btn","btn-small","btn-danger",3,"click"],[3,"select","edit","race","isSelected"],[3,"save","cancel","delete","imageSelect","race","isCreate","saving","pendingImagePreview"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),f(3,Bo,2,0,"h1")(4,zo,2,0,"button",3),a(5,"button",4),g("click",function(){return n.onClose()}),l(6,"\xD7"),s()(),f(7,Wo,2,0,"div",5),f(8,jo,12,1,"div",6),f(9,$o,1,4,"app-race-form",7),s()()),e&2&&(c(3),C(n.viewMode==="select"?3:4),c(4),C(n.loading?7:-1),c(),C(!n.loading&&n.viewMode==="select"?8:-1),c(),C(!n.loading&&(n.viewMode==="create"||n.viewMode==="edit")?9:-1))},dependencies:[A,Lt,At],styles:[".race-selector-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--bg, #0f0f1a);z-index:1000;overflow-y:auto}.race-selector-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border, #333)}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:var(--accent, #4a9eff);font-size:2rem}.close-button[_ngcontent-%COMP%], .back-button[_ngcontent-%COMP%]{background:none;border:1px solid var(--border, #333);color:var(--text-muted, #888);cursor:pointer;border-radius:8px}.close-button[_ngcontent-%COMP%]{font-size:1.5rem;width:40px;height:40px;display:flex;align-items:center;justify-content:center}.back-button[_ngcontent-%COMP%]{color:var(--accent, #4a9eff);padding:.5rem 1rem}.loading[_ngcontent-%COMP%]{text-align:center;padding:5rem;color:var(--text-muted, #888)}.current-race[_ngcontent-%COMP%]{background:#4a9eff1a;border:1px solid var(--accent);border-radius:8px;padding:1rem;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}.hint[_ngcontent-%COMP%]{color:var(--text-muted, #888);font-size:.9rem;margin:0 0 1.5rem}.race-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.create-card[_ngcontent-%COMP%]{background:var(--bg-secondary);border:2px dashed var(--border);border-radius:12px;padding:2rem;cursor:pointer;text-align:center}.create-card[_ngcontent-%COMP%]:hover{border-color:var(--accent)}.create-card[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:3rem;color:var(--accent)}.create-card[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1.1rem;margin-top:.5rem}.btn[_ngcontent-%COMP%]{padding:.875rem 2rem;border:none;border-radius:8px;cursor:pointer;font-weight:500}.btn-small[_ngcontent-%COMP%]{padding:.35rem 1rem;border-radius:6px}.btn-danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff}"]})};function Yo(r,t){if(r&1){let e=y();a(0,"app-race-selector",17),g("patch",function(i){m(e);let o=d();return u(o.onRacePatch(i))})("close",function(){m(e);let i=d();return u(i.closeRaceSelector())}),s()}if(r&2){let e=d();b("sheet",e.sheet)}}var zt=class r{sheet;characterId;patch=new v;showRaceSelector=!1;updateField(t,e){this.patch.emit({path:t,value:e})}openRaceSelector(){this.showRaceSelector=!0}closeRaceSelector(){this.showRaceSelector=!1}onRacePatch(t){this.patch.emit(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-character"]],inputs:{sheet:"sheet",characterId:"characterId"},outputs:{patch:"patch"},decls:33,vars:9,consts:[[1,"character"],[1,"field"],["for","name"],["id","name","type","text","placeholder","Name",3,"ngModelChange","ngModel"],[1,"row"],[1,"col"],[1,"race-button",3,"click"],["for","age"],["id","age","type","text","placeholder","24",3,"ngModelChange","ngModel"],["for","alignment"],["id","alignment","type","text","placeholder","Ganz net eigentlich",3,"ngModelChange","ngModel"],["for","size"],["id","size","type","text","placeholder","1.8M",3,"ngModelChange","ngModel"],[3,"baseImage","sheet","charId"],["for","player"],["id","player","type","text","placeholder","...",3,"ngModelChange","ngModel"],[3,"sheet"],[3,"patch","close","sheet"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"app-card")(2,"h2"),l(3,"Character"),s(),a(4,"div",1)(5,"label",2),l(6,"Name"),s(),a(7,"input",3),g("ngModelChange",function(o){return n.updateField("name",o)}),s()(),a(8,"div",4)(9,"div",5)(10,"label"),l(11,"Rasse"),s(),a(12,"button",6),g("click",function(){return n.openRaceSelector()}),l(13),s()(),a(14,"div",5)(15,"label",7),l(16,"Alter"),s(),a(17,"input",8),g("ngModelChange",function(o){return n.patch.emit({path:"age",value:o})}),s()()(),a(18,"div",4)(19,"div",5)(20,"label",9),l(21,"Gesinnung"),s(),a(22,"input",10),g("ngModelChange",function(o){return n.patch.emit({path:"alignment",value:o})}),s()(),a(23,"div",5)(24,"label",11),l(25,"Gr\xF6\xDFe"),s(),a(26,"input",12),g("ngModelChange",function(o){return n.patch.emit({path:"size",value:o})}),s()()(),a(27,"app-portrait",13),g("baseImage",function(o){return n.updateField("portrait",o)}),s(),a(28,"div",1)(29,"label",14),l(30,"Extra Info"),s(),a(31,"input",15),g("ngModelChange",function(o){return n.patch.emit({path:"extrainfo",value:o})}),s()()()(),f(32,Yo,1,1,"app-race-selector",16)),e&2&&(c(7),b("ngModel",n.sheet.name),c(6),D(" ",n.sheet.race||"Rasse w\xE4hlen..."," "),c(4),b("ngModel",n.sheet.age),c(5),b("ngModel",n.sheet.alignment),c(4),b("ngModel",n.sheet.size),c(),b("sheet",n.sheet)("charId",n.characterId),c(4),b("ngModel",n.sheet.extrainfo),c(),C(n.showRaceSelector?32:-1))},dependencies:[Q,Ft,q,Y,G,U,A,Bt],styles:[".character[_ngcontent-%COMP%]{padding:0;font-family:sans-serif}h2[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]{margin-bottom:.75rem}.row[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-bottom:.75rem}.col[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}label[_ngcontent-%COMP%]{margin-bottom:.3rem;font-weight:500;color:var(--text)}input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--border);border-radius:6px;width:100%;box-sizing:border-box;font-size:1rem;background:var(--bg);color:var(--text)}input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px #6b46c133}.race-button[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--border);border-radius:6px;width:100%;box-sizing:border-box;font-size:1rem;background:var(--bg);color:var(--text);cursor:pointer;text-align:left;transition:border-color .2s,box-shadow .2s}.race-button[_ngcontent-%COMP%]:hover{border-color:var(--accent)}.race-button[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px #6b46c133}"]})};var Wt=class r{sheet;patch=new v;openSkillTree=new v;updateField(t,e){this.patch.emit({path:t,value:e})}get availableTalentPoints(){let t=this.sheet.level||1,e=this.sheet.talentPointsBonus||0,n=(this.sheet.learnedSkillIds||[]).length;return t+e-n}get totalTalentPoints(){return(this.sheet.level||1)+(this.sheet.talentPointsBonus||0)}get spentTalentPoints(){return(this.sheet.learnedSkillIds||[]).length}adjustBonusPoints(t){let e=this.sheet.talentPointsBonus||0,n=Math.max(0,e+t);this.updateField("talentPointsBonus",n)}onOpenSkillTree(){this.openSkillTree.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-levelclass"]],inputs:{sheet:"sheet"},outputs:{patch:"patch",openSkillTree:"openSkillTree"},decls:54,vars:8,consts:[[1,"character"],[1,"row"],[1,"col"],["for","primary"],["id","primary","type","text","placeholder","K\xE4mpfer",3,"ngModelChange","ngModel"],["for","secondary"],["id","secondary","type","text","placeholder","Techniker",3,"ngModelChange","ngModel"],["for","level"],["id","level","type","number","placeholder","1",3,"ngModelChange","ngModel"],["for","learned"],["id","learned","type","text","placeholder","K\xE4mpfer/Techniker/Magier",3,"ngModelChange","ngModel"],[1,"talent-section"],[1,"talent-header"],[1,"skill-tree-btn",3,"click"],[1,"talent-info"],[1,"talent-stat"],[1,"talent-label"],[1,"talent-value","available"],[1,"talent-value","spent"],[1,"talent-value","total"],[1,"bonus-adjust"],[1,"bonus-label"],[1,"bonus-controls"],[1,"adjust-btn",3,"click"],[1,"bonus-value"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"app-card")(2,"h2"),l(3,"Klassen"),s(),a(4,"div",1)(5,"div",2)(6,"label",3),l(7,"Prim\xE4r"),s(),a(8,"input",4),E("ngModelChange",function(o){return P(n.sheet.primary_class,o)||(n.sheet.primary_class=o),o}),g("ngModelChange",function(o){return n.updateField("primary_class",o)}),s()(),a(9,"div",2)(10,"label",5),l(11,"Sekund\xE4r"),s(),a(12,"input",6),E("ngModelChange",function(o){return P(n.sheet.secondary_class,o)||(n.sheet.secondary_class=o),o}),g("ngModelChange",function(o){return n.updateField("secondary_class",o)}),s()(),a(13,"div",2)(14,"label",7),l(15,"Level"),s(),a(16,"input",8),E("ngModelChange",function(o){return P(n.sheet.level,o)||(n.sheet.level=o),o}),g("ngModelChange",function(o){return n.updateField("level",o)}),s()()(),a(17,"div",1)(18,"div",2)(19,"label",9),l(20,"Verinnerlicht"),s(),a(21,"input",10),E("ngModelChange",function(o){return P(n.sheet.learned_classes,o)||(n.sheet.learned_classes=o),o}),g("ngModelChange",function(o){return n.updateField("learned_classes",o)}),s()()(),a(22,"div",11)(23,"div",12)(24,"h3"),l(25,"Talentpunkte"),s(),a(26,"button",13),g("click",function(){return n.onOpenSkillTree()}),l(27," Talentbaum \xF6ffnen "),s()(),a(28,"div",14)(29,"div",15)(30,"span",16),l(31,"Verf\xFCgbar:"),s(),a(32,"span",17),l(33),s()(),a(34,"div",15)(35,"span",16),l(36,"Ausgegeben:"),s(),a(37,"span",18),l(38),s()(),a(39,"div",15)(40,"span",16),l(41,"Gesamt:"),s(),a(42,"span",19),l(43),s()()(),a(44,"div",20)(45,"span",21),l(46,"Bonus-Punkte (GM):"),s(),a(47,"div",22)(48,"button",23),g("click",function(){return n.adjustBonusPoints(-1)}),l(49,"-"),s(),a(50,"span",24),l(51),s(),a(52,"button",23),g("click",function(){return n.adjustBonusPoints(1)}),l(53,"+"),s()()()()()()),e&2&&(c(8),k("ngModel",n.sheet.primary_class),c(4),k("ngModel",n.sheet.secondary_class),c(4),k("ngModel",n.sheet.level),c(5),k("ngModel",n.sheet.learned_classes),c(12),M(n.availableTalentPoints),c(5),M(n.spentTalentPoints),c(5),M(n.totalTalentPoints),c(8),M(n.sheet.talentPointsBonus||0))},dependencies:[Q,A,q,Y,oe,G,U],styles:[".character[_ngcontent-%COMP%]{padding:0;font-family:sans-serif}h2[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]{margin-bottom:.75rem}.row[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-bottom:.75rem}.col[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}label[_ngcontent-%COMP%]{margin-bottom:.3rem;font-weight:500;color:var(--text)}input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid var(--border);border-radius:6px;width:100%;box-sizing:border-box;font-size:1rem;background:var(--bg);color:var(--text)}input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px #6b46c133}.talent-section[_ngcontent-%COMP%]{margin-top:1rem;padding-top:.75rem;border-top:1px solid var(--border)}.talent-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}.talent-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--accent);font-size:1rem}.skill-tree-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--accent);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:.9rem;transition:all .2s}.skill-tree-btn[_ngcontent-%COMP%]:hover{background:var(--accentdark);transform:translateY(-1px)}.talent-info[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:.75rem}.talent-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.talent-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-muted);margin-bottom:.25rem}.talent-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.talent-value.available[_ngcontent-%COMP%]{color:var(--accent)}.talent-value.spent[_ngcontent-%COMP%]{color:#f59e0b}.talent-value.total[_ngcontent-%COMP%]{color:var(--text)}.bonus-adjust[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.5rem;background:var(--bg);border-radius:6px}.bonus-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-muted)}.bonus-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.adjust-btn[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:4px;background:var(--card);border:1px solid var(--border);color:var(--text);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.adjust-btn[_ngcontent-%COMP%]:hover{background:var(--accent);border-color:var(--accent);color:#fff}.bonus-value[_ngcontent-%COMP%]{min-width:30px;text-align:center;font-weight:600}"]})};var Ht=class r{constructor(t){this.cd=t}sheet;name;current;color;base;bonus;formula;getStatusKey(){switch(this.formula){case"LIFE":return"life";case"ENERGY":return"energy";case"MANA":return"mana";default:return null}}get effectBonus(){let t=this.getStatusKey();if(!t)return 0;let e=0;if(this.sheet.skills){for(let n of this.sheet.skills)if(n.statModifiers){for(let i of n.statModifiers)if(i.stat===t){let o=n.level||1;e+=i.amount*o}}}if(this.sheet.equipment){for(let n of this.sheet.equipment)if(n.statModifiers)for(let i of n.statModifiers)i.stat===t&&(e+=i.amount)}return e}get effectSources(){let t=this.getStatusKey();if(!t)return[];let e=[];if(this.sheet.skills){for(let n of this.sheet.skills)if(n.statModifiers){for(let i of n.statModifiers)if(i.stat===t){let o=n.level||1,p=i.amount*o,h=p>=0?"+":"";e.push(`${n.name}: ${h}${p}`)}}}if(this.sheet.equipment){for(let n of this.sheet.equipment)if(n.statModifiers){for(let i of n.statModifiers)if(i.stat===t){let o=i.amount>=0?"+":"";e.push(`${n.name}: ${o}${i.amount}`)}}}return e}get statusMax(){var t=this.base+this.bonus+this.effectBonus;switch(this.formula){case"LIFE":return t+this.sheet.constitution.current*5;case"ENERGY":return t+this.sheet.dexterity.current*5;case"MANA":return t+this.sheet.intelligence.current*5;default:return t}}get barClass(){switch(this.formula){case"LIFE":return"health";case"ENERGY":return"energy";case"MANA":return"mana";default:return""}}patch=new v;updateBase(t,e){this.base=e,this.patch.emit({path:t,value:e}),this.cd.detectChanges()}updateCurrent(t,e){this.current=e,this.patch.emit({path:t,value:e}),this.cd.detectChanges()}updateBonus(t,e){this.bonus=e,this.patch.emit({path:t,value:e}),this.cd.detectChanges()}static \u0275fac=function(e){return new(e||r)(K(ie))};static \u0275cmp=F({type:r,selectors:[["app-currentstat"]],inputs:{sheet:"sheet",name:"name",current:"current",color:"color",base:"base",bonus:"bonus",formula:"formula"},outputs:{patch:"patch"},decls:27,vars:12,consts:[[1,"stat-card"],[1,"stat-header"],[1,"stat-row"],[1,"stat-bar-wrapper"],[1,"stat-bar-fill"],[1,"stat-max"],[1,"stat-inputs"],[1,"stat-input-group"],["type","number",3,"ngModelChange","ngModel"],[1,"effect-label",3,"title"],[1,"effect-value",3,"title"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1),l(2),s(),a(3,"div",2)(4,"div",3),W(5,"div",4),s(),a(6,"span",5),l(7),s()(),a(8,"div",6)(9,"div",7)(10,"label"),l(11,"Aktuell"),s(),a(12,"input",8),E("ngModelChange",function(o){return P(n.current,o)||(n.current=o),o}),g("ngModelChange",function(o){return n.updateCurrent("statusCurrent",o)}),s()()(),a(13,"div",6)(14,"div",7)(15,"label"),l(16,"Basis"),s(),a(17,"input",8),E("ngModelChange",function(o){return P(n.base,o)||(n.base=o),o}),g("ngModelChange",function(o){return n.updateBase("statusBase",o)}),s()(),a(18,"div",7)(19,"label"),l(20,"Bonus"),s(),a(21,"input",8),E("ngModelChange",function(o){return P(n.bonus,o)||(n.bonus=o),o}),g("ngModelChange",function(o){return n.updateBonus("statusBonus",o)}),s()(),a(22,"div",7)(23,"label",9),l(24,"Effekt"),s(),a(25,"div",10),l(26),s()()()()),e&2&&(c(2),M(n.name),c(3),le(n.barClass),z("width",n.current/n.statusMax*100,"%"),c(2),D("/ ",n.statusMax),c(5),k("ngModel",n.current),c(5),k("ngModel",n.base),c(4),k("ngModel",n.bonus),c(2),b("title",n.effectSources.join(`
`)),c(2),b("title",n.effectSources.join(`
`)),c(),M(n.effectBonus))},dependencies:[A,q,Y,oe,G,U],styles:[".stat-card[_ngcontent-%COMP%]{width:240px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;box-shadow:0 1px 2px #0000000d}.stat-header[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin-bottom:12px}.stat-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.stat-bar-wrapper[_ngcontent-%COMP%]{flex:1;height:14px;background:#0009;border-radius:6px;overflow:hidden;border:1px solid rgba(0,0,0,.4)}.stat-bar-fill[_ngcontent-%COMP%]{height:100%;background:var(--accent);border-radius:6px;transition:width .3s ease}.stat-bar-fill.health[_ngcontent-%COMP%]{background:var(--health-color);box-shadow:0 0 30px var(--health-color),0 0 60px var(--health-color),0 0 90px var(--health-color),inset 0 0 15px var(--health-color);filter:brightness(1.3)}.stat-bar-fill.energy[_ngcontent-%COMP%]{background:var(--energy-color);box-shadow:0 0 30px var(--energy-color),0 0 60px var(--energy-color),0 0 90px var(--energy-color),inset 0 0 15px var(--energy-color);filter:brightness(1.3)}.stat-bar-fill.mana[_ngcontent-%COMP%]{background:var(--mana-color);box-shadow:0 0 30px var(--mana-color),0 0 60px var(--mana-color),0 0 90px var(--mana-color),inset 0 0 15px var(--mana-color);filter:brightness(1.3)}.stat-max[_ngcontent-%COMP%]{font-size:14px;color:var(--muted)}.stat-inputs[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:12px;justify-content:flex-start}.stat-input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.stat-input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;color:var(--muted);margin-bottom:4px}.stat-input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:64px;height:30px;padding:0 6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:14px;text-align:center}.stat-input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px #6b46c126}.effect-label[_ngcontent-%COMP%]{cursor:help;text-decoration:underline dotted}.effect-value[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:64px;height:30px;padding:0 6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--accent);font-weight:600;font-size:14px;cursor:help}"]})};var Go=(r,t)=>t.statusName;function Uo(r,t){if(r&1){let e=y();a(0,"app-currentstat",3),g("patch",function(i){let o=m(e).$index,p=d();return u(p.updateField("statuses."+o,i))}),l(1,">"),s()}if(r&2){let e=t.$implicit,n=d();b("sheet",n.sheet)("name",e.statusName)("current",e.statusCurrent)("color",e.statusColor)("base",e.statusBase)("bonus",e.statusBonus)("formula",e.formulaType)}}var qt=class r{sheet;patch=new v;updateField(t,e){e.path=t+"."+e.path,console.log("PATCHING "+e.path),this.patch.emit(e)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-currentstats"]],inputs:{sheet:"sheet"},outputs:{patch:"patch"},decls:5,vars:0,consts:[[1,"box"],[1,"currentstat-row"],[3,"sheet","name","current","color","base","bonus","formula"],[3,"patch","sheet","name","current","color","base","bonus","formula"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"app-card")(2,"div",1),I(3,Uo,2,7,"app-currentstat",2,Go),s()()()),e&2&&(c(3),V(n.sheet.statuses))},dependencies:[Ht,Q,q],styles:[".currentstat-row[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:nowrap;overflow-x:auto}"]})};var jt=class r{constructor(t,e){this.api=t;this.socket=e;this.socket.patches$.subscribe(n=>{let i=this.sheetSubject.value;i&&n.characterId===this.characterId&&(this.applyJsonPatch(i,n.patch),this.sheetSubject.next(ee({},i)))})}sheetSubject=new Ye(null);sheet$=this.sheetSubject.asObservable();characterId;get sheetValue(){return this.sheetSubject.value}async save(){let t=this.sheetSubject.value;if(!t){console.warn("No character sheet loaded, cannot save.");return}if(!this.characterId){console.error("No characterId set, cannot save.");return}try{await this.api.saveCharacter(this.characterId,t)}catch(e){console.error("Failed to save character:",e)}}async load(t){this.characterId=t;let e=await this.api.loadCharacter(t);e?this.sheetSubject.next(e):(e=bi(),this.sheetSubject.next(e),this.save()),this.socket.connect(),this.socket.joinCharacter(t)}applyPatch(t){let e=this.sheetSubject.value;e&&(this.applyJsonPatch(e,t),this.sheetSubject.next(ee({},e))),this.socket.sendPatch(this.characterId,t)}applyJsonPatch(t,e){let n=e.path.split("."),i=t;for(let h=0;h<n.length-1;h++){let _=n[h],x=parseInt(_,10);!isNaN(x)&&Array.isArray(i)?i=i[x]:i=i[_]??={}}let o=n[n.length-1],p=parseInt(o,10);!isNaN(p)&&Array.isArray(i)?i[p]=e.value:i[o]=e.value}static \u0275fac=function(e){return new(e||r)(st(Et),st(Ot))};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})};var Pn;function Xo(){if(Pn==null){let r=typeof document<"u"?document.head:null;Pn=!!(r&&(r.createShadowRoot||r.attachShadow))}return Pn}function $t(r){if(Xo()){let t=r.getRootNode?r.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function gt(r){return r.composedPath?r.composedPath()[0]:r.target}function Ri(r){return r.buttons===0||r.detail===0}function Ii(r){let t=r.touches&&r.touches[0]||r.changedTouches&&r.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}function Yt(r,t=0){return Jo(r)?Number(r):arguments.length===2?t:0}function Jo(r){return!isNaN(parseFloat(r))&&!isNaN(Number(r))}function Me(r){return r instanceof Ae?r.nativeElement:r}var Gt=new WeakMap,Vi=(()=>{class r{_appRef;_injector=L(lt);_environmentInjector=L(Qn);load(e){let n=this._appRef=this._appRef||this._injector.get(Sn),i=Gt.get(n);i||(i={loaders:new Set,refs:[]},Gt.set(n,i),n.onDestroy(()=>{Gt.get(n)?.refs.forEach(o=>o.destroy()),Gt.delete(n)})),i.loaders.has(e)||(i.loaders.add(e),i.refs.push(li(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(n){return new(n||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var En;try{En=typeof Intl<"u"&&Intl.v8BreakIterator}catch{En=!1}var On=(()=>{class r{_platformId=L(ti);isBrowser=this._platformId?hi(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||En)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(n){return new(n||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Ko=new ke("cdk-dir-doc",{providedIn:"root",factory:()=>L(qe)}),Zo=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function Qo(r){let t=r?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?Zo.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var Dn=(()=>{class r{get value(){return this.valueSignal()}valueSignal=B("ltr");change=new v;constructor(){let e=L(Ko,{optional:!0});if(e){let n=e.body?e.body.dir:null,i=e.documentElement?e.documentElement.dir:null;this.valueSignal.set(Qo(n||i||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var er=20,Fi=(()=>{class r{_ngZone=L(we);_platform=L(On);_renderer=L(Xe).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new X;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let n=this.scrollContainers.get(e);n&&(n.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=er){return this._platform.isBrowser?new rt(n=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let i=e>0?this._scrolled.pipe(bn(e)).subscribe(n):this._scrolled.subscribe(n);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Gn()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,n)=>this.deregister(n)),this._scrolled.complete()}ancestorScrolled(e,n){let i=this.getAncestorScrollContainers(e);return this.scrolled(n).pipe(Jn(o=>!o||i.indexOf(o)>-1))}getAncestorScrollContainers(e){let n=[];return this.scrollContainers.forEach((i,o)=>{this._scrollableContainsElement(o,e)&&n.push(o)}),n}_scrollableContainsElement(e,n){let i=Me(n),o=e.getElementRef().nativeElement;do if(i==o)return!0;while(i=i.parentElement);return!1}static \u0275fac=function(n){return new(n||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var tr=20,Li=(()=>{class r{_platform=L(On);_listeners;_viewportSize;_change=new X;_document=L(qe);constructor(){let e=L(we),n=L(Xe).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let i=o=>this._change.next(o);this._listeners=[n.listen("window","resize",i),n.listen("window","orientationchange",i)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:n,height:i}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+i,right:e.left+n,height:i,width:n}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,n=this._getWindow(),i=e.documentElement,o=i.getBoundingClientRect(),p=-o.top||e.body.scrollTop||n.scrollY||i.scrollTop||0,h=-o.left||e.body.scrollLeft||n.scrollX||i.scrollLeft||0;return{top:p,left:h}}change(e=tr){return e>0?this._change.pipe(bn(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(n){return new(n||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Ai=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=St({type:r});static \u0275inj=wt({})}return r})();var Tn={},Ut=class r{_appId=L(ei);static _infix=`a${Math.floor(Math.random()*1e5).toString()}`;getId(t,e=!1){return this._appId!=="ng"&&(t+=this._appId),Tn.hasOwnProperty(t)||(Tn[t]=0),`${t}${e?r._infix+"-":""}${Tn[t]++}`}static \u0275fac=function(e){return new(e||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})};function Ni(r){return Array.isArray(r)?r:[r]}function Vn(r){let t=r.cloneNode(!0),e=t.querySelectorAll("[id]"),n=r.nodeName.toLowerCase();t.removeAttribute("id");for(let i=0;i<e.length;i++)e[i].removeAttribute("id");return n==="canvas"?Wi(r,t):(n==="input"||n==="select"||n==="textarea")&&zi(r,t),Bi("canvas",r,t,Wi),Bi("input, textarea, select",r,t,zi),t}function Bi(r,t,e,n){let i=t.querySelectorAll(r);if(i.length){let o=e.querySelectorAll(r);for(let p=0;p<i.length;p++)n(i[p],o[p])}}var nr=0;function zi(r,t){t.type!=="file"&&(t.value=r.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${nr++}`)}function Wi(r,t){let e=t.getContext("2d");if(e)try{e.drawImage(r,0,0)}catch{}}function Wn(r){let t=r.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function Fn(r,t,e){let{top:n,bottom:i,left:o,right:p}=r;return e>=n&&e<=i&&t>=o&&t<=p}function ir(r,t){let e=t.left<r.left,n=t.left+t.width>r.right,i=t.top<r.top,o=t.top+t.height>r.bottom;return e||n||i||o}function ft(r,t,e){r.top+=t,r.bottom=r.top+r.height,r.left+=e,r.right=r.left+r.width}function Hi(r,t,e,n){let{top:i,right:o,bottom:p,left:h,width:_,height:x}=r,O=_*t,R=x*t;return n>i-R&&n<p+R&&e>h-O&&e<o+O}var Xt=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:Wn(e)})})}handleScroll(t){let e=gt(t),n=this.positions.get(e);if(!n)return null;let i=n.scrollPosition,o,p;if(e===this._document){let x=this.getViewportScrollPosition();o=x.top,p=x.left}else o=e.scrollTop,p=e.scrollLeft;let h=i.top-o,_=i.left-p;return this.positions.forEach((x,O)=>{x.clientRect&&e!==O&&e.contains(O)&&ft(x.clientRect,h,_)}),i.top=o,i.left=p,{top:h,left:_}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function eo(r,t){let e=r.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let n=t.createElement("div");return e.forEach(i=>n.appendChild(i)),n}function Hn(r,t,e){for(let n in t)if(t.hasOwnProperty(n)){let i=t[n];i?r.setProperty(n,i,e?.has(n)?"important":""):r.removeProperty(n)}return r}function tt(r,t){let e=t?"":"none";Hn(r.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function qi(r,t,e){Hn(r.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function Jt(r,t){return t&&t!="none"?r+" "+t:r}function ji(r,t){r.style.width=`${t.width}px`,r.style.height=`${t.height}px`,r.style.transform=Ct(t.left,t.top)}function Ct(r,t){return`translate3d(${Math.round(r)}px, ${Math.round(t)}px, 0)`}function $i(r){let t=r.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(r)*t}function or(r){let t=getComputedStyle(r),e=Rn(t,"transition-property"),n=e.find(h=>h==="transform"||h==="all");if(!n)return 0;let i=e.indexOf(n),o=Rn(t,"transition-duration"),p=Rn(t,"transition-delay");return $i(o[i])+$i(p[i])}function Rn(r,t){return r.getPropertyValue(t).split(",").map(n=>n.trim())}var rr=new Set(["position"]),Ln=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,n,i,o,p,h,_,x,O){this._document=t,this._rootElement=e,this._direction=n,this._initialDomRect=i,this._previewTemplate=o,this._previewClass=p,this._pickupPositionOnPage=h,this._initialTransform=_,this._zIndex=x,this._renderer=O}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),Yi(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return or(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,n=t?t.template:null,i;if(n&&t){let o=t.matchSize?this._initialDomRect:null,p=t.viewContainer.createEmbeddedView(n,t.context);p.detectChanges(),i=eo(p,this._document),this._previewEmbeddedView=p,t.matchSize?ji(i,o):i.style.transform=Ct(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else i=Vn(this._rootElement),ji(i,this._initialDomRect),this._initialTransform&&(i.style.transform=this._initialTransform);return Hn(i.style,{"pointer-events":"none",margin:Yi(i)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},rr),tt(i,!1),i.classList.add("cdk-drag-preview"),i.setAttribute("popover","manual"),i.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(o=>i.classList.add(o)):i.classList.add(e)),i}};function Yi(r){return"showPopover"in r}var ar={passive:!0},Gi={passive:!1},sr={passive:!1,capture:!0},lr=800,Ui="cdk-drag-placeholder",Xi=new Set(["position"]),An=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_marker;_anchor=null;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=B(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new X;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=He.EMPTY;_pointerUpSubscription=He.EMPTY;_scrollSubscription=He.EMPTY;_resizeSubscription=He.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis=null;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>tt(e,t)))}_disabled=!1;beforeStarted=new X;started=new X;released=new X;ended=new X;entered=new X;exited=new X;dropped=new X;moved=this._moveEvents;data;constrainPosition;constructor(t,e,n,i,o,p,h){this._config=e,this._document=n,this._ngZone=i,this._viewportRuler=o,this._dragDropRegistry=p,this._renderer=h,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new Xt(n),p.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(n=>Me(n)),this._handles.forEach(n=>tt(n,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(n=>{this._handles.indexOf(n)>-1&&e.add(n)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=Me(t);if(e!==this._rootElement){this._removeRootElementListeners();let n=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[n.listen(e,"mousedown",this._pointerDown,Gi),n.listen(e,"touchstart",this._pointerDown,ar),n.listen(e,"dragstart",this._nativeDragStart,Gi)]),this._initialTransform=void 0,this._rootElement=e}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Me(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._marker?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._marker=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&ir(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let t=this._boundaryElement.getBoundingClientRect(),e=this._rootElement.getBoundingClientRect(),n=0,i=0;e.left<t.left?n=t.left-e.left:e.right>t.right&&(n=t.right-e.right),e.top<t.top?i=t.top-e.top:e.bottom>t.bottom&&(i=t.bottom-e.bottom);let o=this._activeTransform.x,p=this._activeTransform.y,h=o+n,_=p+i;this._rootElement.style.transform=Ct(h,_),this._activeTransform={x:h,y:_},this._passiveTransform={x:h,y:_}}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),tt(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),tt(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._anchor?.remove(),this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._anchor=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let i=Math.abs(e.x-this._pickupPositionOnPage.x),o=Math.abs(e.y-this._pickupPositionOnPage.y);if(i+o>=this._config.dragStartThreshold){let h=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),_=this._dropContainer;if(!h){this._endDragSequence(t);return}(!_||!_.isDragging()&&!_.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let n=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(n),this._dropContainer)this._updateActiveDropContainer(n,e);else{let i=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,o=this._activeTransform;o.x=n.x-i.x+this._passiveTransform.x,o.y=n.y-i.y+this._passiveTransform.y,this._applyRootElementTransform(o.x,o.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:n,event:t,distance:this._getDragDistance(n),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){ht(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),n=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(e,"selectstart",cr,sr)}),n){let i=this._rootElement,o=i.parentNode,p=this._placeholder=this._createPlaceholderElement(),h=this._marker=this._marker||this._document.createComment("");o.insertBefore(h,i),this._initialTransform=i.style.transform||"",this._preview=new Ln(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(o,e)),qi(i,!1,Xi),this._document.body.appendChild(o.replaceChild(p,i)),this.started.next({source:this,event:t}),n.start(),this._initialContainer=n,this._initialIndex=n.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(n?n.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let n=this.isDragging(),i=ht(e),o=!i&&e.button!==0,p=this._rootElement,h=gt(e),_=!i&&this._lastTouchEventTime&&this._lastTouchEventTime+lr>Date.now(),x=i?Ii(e):Ri(e);if(h&&h.draggable&&e.type==="mousedown"&&e.preventDefault(),n||o||_||x)return;if(this._handles.length){let N=p.style;this._rootElementTapHighlight=N.webkitTapHighlightColor||"",N.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(N=>this._updateOnScroll(N)),this._boundaryElement&&(this._boundaryRect=Wn(this._boundaryElement));let O=this._previewTemplate;this._pickupPositionInElement=O&&O.template&&!O.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let R=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:R.x,y:R.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){qi(this._rootElement,!0,Xi),this._marker.parentNode.replaceChild(this._rootElement,this._marker),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,n=e.getItemIndex(this),i=this._getPointerPositionOnPage(t),o=this._getDragDistance(i),p=e._isOverContainer(i.x,i.y);this.ended.next({source:this,distance:o,dropPoint:i,event:t}),this.dropped.next({item:this,currentIndex:n,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:p,distance:o,dropPoint:i,event:t}),e.drop(this,n,this._initialIndex,this._initialContainer,p,o,i,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:n,y:i}){let o=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!o&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(o=this._initialContainer),o&&o!==this._dropContainer&&this._ngZone.run(()=>{let p=this._dropContainer.getItemIndex(this),h=this._dropContainer.getItemAtIndex(p+1)?.getVisibleElement()||null;this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._conditionallyInsertAnchor(o,this._dropContainer,h),this._dropContainer=o,this._dropContainer.enter(this,t,e,o===this._initialContainer&&o.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:o,currentIndex:o.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(n,i),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(n=>{let i=h=>{(!h||this._preview&&gt(h)===this._preview.element&&h.propertyName==="transform")&&(p(),n(),clearTimeout(o))},o=setTimeout(i,e*1.5),p=this._preview.addEventListener("transitionend",i)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,n;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),n=eo(this._placeholderRef,this._document)):n=Vn(this._rootElement),n.style.pointerEvents="none",n.classList.add(Ui),n}_getPointerPositionInElement(t,e,n){let i=e===this._rootElement?null:e,o=i?i.getBoundingClientRect():t,p=ht(n)?n.targetTouches[0]:n,h=this._getViewportScrollPosition(),_=p.pageX-o.left-h.left,x=p.pageY-o.top-h.top;return{x:o.left-t.left+_,y:o.top-t.top+x}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),n=ht(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,i=n.pageX-e.left,o=n.pageY-e.top;if(this._ownerSVGElement){let p=this._ownerSVGElement.getScreenCTM();if(p){let h=this._ownerSVGElement.createSVGPoint();return h.x=i,h.y=o,h.matrixTransform(p.inverse())}}return{x:i,y:o}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:n,y:i}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?i=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(n=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:o,y:p}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,h=this._boundaryRect,{width:_,height:x}=this._getPreviewRect(),O=h.top+p,R=h.bottom-(x-p),N=h.left+o,j=h.right-(_-o);n=Ji(n,N,j),i=Ji(i,O,R)}return{x:n,y:i}}_updatePointerDirectionDelta(t){let{x:e,y:n}=t,i=this._pointerDirectionDelta,o=this._pointerPositionAtLastDirectionChange,p=Math.abs(e-o.x),h=Math.abs(n-o.y);return p>this._config.pointerDirectionChangeThreshold&&(i.x=e>o.x?1:-1,o.x=e),h>this._config.pointerDirectionChangeThreshold&&(i.y=n>o.y?1:-1,o.y=n),i}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,tt(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let n=1/this.scale,i=Ct(t*n,e*n),o=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=o.transform&&o.transform!="none"?o.transform:""),o.transform=Jt(i,this._initialTransform)}_applyPreviewTransform(t,e){let n=this._previewTemplate?.template?void 0:this._initialTransform,i=Ct(t,e);this._preview.setTransform(Jt(i,n))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let n=this._rootElement.getBoundingClientRect(),i=this._boundaryElement.getBoundingClientRect();if(i.width===0&&i.height===0||n.width===0&&n.height===0)return;let o=i.left-n.left,p=n.right-i.right,h=i.top-n.top,_=n.bottom-i.bottom;i.width>n.width?(o>0&&(t+=o),p>0&&(t-=p)):t=0,i.height>n.height?(h>0&&(e+=h),_>0&&(e-=_)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:ht(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let n=gt(t);this._boundaryRect&&n!==this._boundaryElement&&n.contains(this._boundaryElement)&&ft(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=$t(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let n=this._previewContainer||"global";if(n==="parent")return t;if(n==="global"){let i=this._document;return e||i.fullscreenElement||i.webkitFullscreenElement||i.mozFullScreenElement||i.msFullscreenElement||i.body}return Me(n)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}_conditionallyInsertAnchor(t,e,n){if(t===this._initialContainer)this._anchor?.remove(),this._anchor=null;else if(e===this._initialContainer&&e.hasAnchor){let i=this._anchor??=Vn(this._placeholder);i.classList.remove(Ui),i.classList.add("cdk-drag-anchor"),i.style.transform="",n?n.before(i):Me(e.element).appendChild(i)}}};function Ji(r,t,e){return Math.max(t,Math.min(e,r))}function ht(r){return r.type[0]==="t"}function cr(r){r.preventDefault()}function be(r,t,e){let n=Ki(t,r.length-1),i=Ki(e,r.length-1);if(n===i)return;let o=r[n],p=i<n?-1:1;for(let h=n;h!==i;h+=p)r[h]=r[h+p];r[i]=o}function Ki(r,t){return Math.max(0,Math.min(t,r))}var Kt=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,n,i){let o=this._itemPositions,p=this._getItemIndexFromPointerPosition(t,e,n,i);if(p===-1&&o.length>0)return null;let h=this.orientation==="horizontal",_=o.findIndex(J=>J.drag===t),x=o[p],O=o[_].clientRect,R=x.clientRect,N=_>p?1:-1,j=this._getItemOffsetPx(O,R,N),ne=this._getSiblingOffsetPx(_,o,N),pe=o.slice();return be(o,_,p),o.forEach((J,ye)=>{if(pe[ye]===J)return;let Ve=J.drag===t,Fe=Ve?j:ne,it=Ve?t.getPlaceholderElement():J.drag.getRootElement();J.offset+=Fe;let Le=Math.round(J.offset*(1/J.drag.scale));h?(it.style.transform=Jt(`translate3d(${Le}px, 0, 0)`,J.initialTransform),ft(J.clientRect,0,Fe)):(it.style.transform=Jt(`translate3d(0, ${Le}px, 0)`,J.initialTransform),ft(J.clientRect,Fe,0))}),this._previousSwap.overlaps=Fn(R,e,n),this._previousSwap.drag=x.drag,this._previousSwap.delta=h?i.x:i.y,{previousIndex:_,currentIndex:p}}enter(t,e,n,i){let o=i==null||i<0?this._getItemIndexFromPointerPosition(t,e,n):i,p=this._activeDraggables,h=p.indexOf(t),_=t.getPlaceholderElement(),x=p[o];if(x===t&&(x=p[o+1]),!x&&(o==null||o===-1||o<p.length-1)&&this._shouldEnterAsFirstChild(e,n)&&(x=p[0]),h>-1&&p.splice(h,1),x&&!this._dragDropRegistry.isDragging(x)){let O=x.getRootElement();O.parentElement.insertBefore(_,O),p.splice(o,0,t)}else this._element.appendChild(_),p.push(t);_.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let n=this._itemPositions.find(i=>i.drag===t)?.initialTransform;e.style.transform=n||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return this._getVisualItemPositions().findIndex(e=>e.drag===t)}getItemAtIndex(t){return this._getVisualItemPositions()[t]?.drag||null}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:n})=>{ft(n,t,e)}),this._itemPositions.forEach(({drag:n})=>{this._dragDropRegistry.isDragging(n)&&n._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let n=e.getVisibleElement();return{drag:e,offset:0,initialTransform:n.style.transform||"",clientRect:Wn(n)}}).sort((e,n)=>t?e.clientRect.left-n.clientRect.left:e.clientRect.top-n.clientRect.top)}_getVisualItemPositions(){return this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions}_getItemOffsetPx(t,e,n){let i=this.orientation==="horizontal",o=i?e.left-t.left:e.top-t.top;return n===-1&&(o+=i?e.width-t.width:e.height-t.height),o}_getSiblingOffsetPx(t,e,n){let i=this.orientation==="horizontal",o=e[t].clientRect,p=e[t+n*-1],h=o[i?"width":"height"]*n;if(p){let _=i?"left":"top",x=i?"right":"bottom";n===-1?h-=p.clientRect[_]-o[x]:h+=o[_]-p.clientRect[x]}return h}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let n=this._itemPositions,i=this.orientation==="horizontal";if(n[0].drag!==this._activeDraggables[0]){let p=n[n.length-1].clientRect;return i?t>=p.right:e>=p.bottom}else{let p=n[0].clientRect;return i?t<=p.left:e<=p.top}}_getItemIndexFromPointerPosition(t,e,n,i){let o=this.orientation==="horizontal",p=this._itemPositions.findIndex(({drag:h,clientRect:_})=>{if(h===t)return!1;if(i){let x=o?i.x:i.y;if(h===this._previousSwap.drag&&this._previousSwap.overlaps&&x===this._previousSwap.delta)return!1}return o?e>=Math.floor(_.left)&&e<Math.floor(_.right):n>=Math.floor(_.top)&&n<Math.floor(_.bottom)});return p===-1||!this._sortPredicate(p,t)?-1:p}},Nn=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let n=0;n<e.length;n++){let i=e[n];this._relatedNodes.push([i,i.nextSibling])}this.withItems(t)}sort(t,e,n,i){let o=this._getItemIndexFromPointerPosition(t,e,n),p=this._previousSwap;if(o===-1||this._activeItems[o]===t)return null;let h=this._activeItems[o];if(p.drag===h&&p.overlaps&&p.deltaX===i.x&&p.deltaY===i.y)return null;let _=this.getItemIndex(t),x=t.getPlaceholderElement(),O=h.getRootElement();o>_?O.after(x):O.before(x),be(this._activeItems,_,o);let R=this._getRootNode().elementFromPoint(e,n);return p.deltaX=i.x,p.deltaY=i.y,p.drag=h,p.overlaps=O===R||O.contains(R),{previousIndex:_,currentIndex:o}}enter(t,e,n,i){let o=this._activeItems.indexOf(t);o>-1&&this._activeItems.splice(o,1);let p=i==null||i<0?this._getItemIndexFromPointerPosition(t,e,n):i;p===-1&&(p=this._getClosestItemIndexToPointer(t,e,n));let h=this._activeItems[p];h&&!this._dragDropRegistry.isDragging(h)?(this._activeItems.splice(p,0,t),h.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let n=this._relatedNodes.length-1;n>-1;n--){let[i,o]=this._relatedNodes[n];i.parentNode===t&&i.nextSibling!==o&&(o===null?t.appendChild(i):o.parentNode===t&&t.insertBefore(i,o))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}getItemAtIndex(t){return this._activeItems[t]||null}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,n){let i=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(n)),o=i?this._activeItems.findIndex(p=>{let h=p.getRootElement();return i===h||h.contains(i)}):-1;return o===-1||!this._sortPredicate(o,t)?-1:o}_getRootNode(){return this._rootNode||(this._rootNode=$t(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,n){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let i=1/0,o=-1;for(let p=0;p<this._activeItems.length;p++){let h=this._activeItems[p];if(h!==t){let{x:_,y:x}=h.getRootElement().getBoundingClientRect(),O=Math.hypot(e-_,n-x);O<i&&(i=O,o=p)}}return o}},Zi=.05,to=.05,Ce=(function(r){return r[r.NONE=0]="NONE",r[r.UP=1]="UP",r[r.DOWN=2]="DOWN",r})(Ce||{}),de=(function(r){return r[r.NONE=0]="NONE",r[r.LEFT=1]="LEFT",r[r.RIGHT=2]="RIGHT",r})(de||{}),Bn=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis=null;autoScrollDisabled=!1;autoScrollStep=2;hasAnchor=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new X;entered=new X;exited=new X;dropped=new X;sorted=new X;receivingStarted=new X;receivingStopped=new X;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=He.EMPTY;_verticalScrollDirection=Ce.NONE;_horizontalScrollDirection=de.NONE;_scrollNode;_stopScrollTimers=new X;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,n,i,o){this._dragDropRegistry=e,this._ngZone=i,this._viewportRuler=o;let p=this.element=Me(t);this._document=n,this.withOrientation("vertical").withElementContainer(p),e.registerDropContainer(this),this._parentPositions=new Xt(n)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,n,i){this._draggingStarted(),i==null&&this.sortingDisabled&&(i=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,n,i),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,n,i,o,p,h,_={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:n,container:this,previousContainer:i,isPointerOverContainer:o,distance:p,dropPoint:h,event:_})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(n=>n._withDropContainer(this)),this.isDragging()&&(e.filter(i=>i.isDragging()).every(i=>t.indexOf(i)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof Kt&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new Nn(this._document,this._dragDropRegistry);else{let e=new Kt(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,n)=>this.sortPredicate(e,n,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=Me(this.element),n=this._scrollableElements.indexOf(this._container),i=this._scrollableElements.indexOf(t);return n>-1&&this._scrollableElements.splice(n,1),i>-1&&this._scrollableElements.splice(i,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}getItemAtIndex(t){return this._isDragging?this._sortStrategy.getItemAtIndex(t):this._draggables[t]||null}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,n,i){if(this.sortingDisabled||!this._domRect||!Hi(this._domRect,Zi,e,n))return;let o=this._sortStrategy.sort(t,e,n,i);o&&this.sorted.next({previousIndex:o.previousIndex,currentIndex:o.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let n,i=Ce.NONE,o=de.NONE;if(this._parentPositions.positions.forEach((p,h)=>{h===this._document||!p.clientRect||n||Hi(p.clientRect,Zi,t,e)&&([i,o]=dr(h,p.clientRect,this._direction,t,e),(i||o)&&(n=h))}),!i&&!o){let{width:p,height:h}=this._viewportRuler.getViewportSize(),_={width:p,height:h,top:0,right:p,bottom:h,left:0};i=no(_,e),o=io(_,t),n=window}n&&(i!==this._verticalScrollDirection||o!==this._horizontalScrollDirection||n!==this._scrollNode)&&(this._verticalScrollDirection=i,this._horizontalScrollDirection=o,this._scrollNode=n,(i||o)&&n?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),Xn(0,Cn).pipe(Ge(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===Ce.UP?t.scrollBy(0,-e):this._verticalScrollDirection===Ce.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===de.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===de.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&Fn(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,n){return this._siblings.find(i=>i._canReceive(t,e,n))}_canReceive(t,e,n){if(!this._domRect||!Fn(this._domRect,e,n)||!this.enterPredicate(t,this))return!1;let i=this._getShadowRoot().elementFromPoint(e,n);return i?i===this._container||this._container.contains(i):!1}_startReceiving(t,e){let n=this._activeSiblings;!n.has(t)&&e.every(i=>this.enterPredicate(i,this)||this._draggables.indexOf(i)>-1)&&(n.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=$t(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function no(r,t){let{top:e,bottom:n,height:i}=r,o=i*to;return t>=e-o&&t<=e+o?Ce.UP:t>=n-o&&t<=n+o?Ce.DOWN:Ce.NONE}function io(r,t){let{left:e,right:n,width:i}=r,o=i*to;return t>=e-o&&t<=e+o?de.LEFT:t>=n-o&&t<=n+o?de.RIGHT:de.NONE}function dr(r,t,e,n,i){let o=no(t,i),p=io(t,n),h=Ce.NONE,_=de.NONE;if(o){let x=r.scrollTop;o===Ce.UP?x>0&&(h=Ce.UP):r.scrollHeight-x>r.clientHeight&&(h=Ce.DOWN)}if(p){let x=r.scrollLeft;e==="rtl"?p===de.RIGHT?x<0&&(_=de.RIGHT):r.scrollWidth+x>r.clientWidth&&(_=de.LEFT):p===de.LEFT?x>0&&(_=de.LEFT):r.scrollWidth-x>r.clientWidth&&(_=de.RIGHT)}return[h,_]}var _t={capture:!0},In={passive:!1,capture:!0},pr=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275cmp=F({type:r,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(n,i){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return r})(),oo=(()=>{class r{_ngZone=L(we);_document=L(qe);_styleLoader=L(Vi);_renderer=L(Xe).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new X;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=B([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new X;pointerUp=new X;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,In)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,n){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(pr),this._activeDragInstances.update(i=>[...i,e]),this._activeDragInstances().length===1)){let i=n.type.startsWith("touch"),o=h=>this.pointerUp.next(h),p=[["scroll",h=>this._scroll.next(h),_t],["selectstart",this._preventDefaultWhileDragging,In]];i?p.push(["touchend",o,_t],["touchcancel",o,_t]):p.push(["mouseup",o,_t]),i||p.push(["mousemove",h=>this.pointerMove.next(h),In]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=p.map(([h,_,x])=>this._renderer.listen(this._document,h,_,x))})}}stopDragging(e){this._activeDragInstances.update(n=>{let i=n.indexOf(e);return i>-1?(n.splice(i,1),[...n]):n}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let n=[this._scroll];return e&&e!==this._document&&n.push(new rt(i=>this._ngZone.runOutsideAngular(()=>{let o=this._renderer.listen(e,"scroll",p=>{this._activeDragInstances().length&&i.next(p)},_t);return()=>{o()}}))),vt(...n)}registerDirectiveNode(e,n){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,n)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(n){return new(n||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),mr={dragStartThreshold:5,pointerDirectionChangeThreshold:5},qn=(()=>{class r{_document=L(qe);_ngZone=L(we);_viewportRuler=L(Li);_dragDropRegistry=L(oo);_renderer=L(Xe).createRenderer(null,null);constructor(){}createDrag(e,n=mr){return new An(e,n,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new Bn(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=ae({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),zn=new ke("CDK_DRAG_PARENT");var ur=new ke("CdkDragHandle");var ro=new ke("CDK_DRAG_CONFIG"),ao=new ke("CdkDropList"),xe=(()=>{class r{element=L(Ae);dropContainer=L(ao,{optional:!0,skipSelf:!0});_ngZone=L(we);_viewContainerRef=L(wn);_dir=L(Dn,{optional:!0});_changeDetectorRef=L(ie);_selfHandle=L(ur,{optional:!0,self:!0});_parentDrag=L(zn,{optional:!0,skipSelf:!0});_dragDropRegistry=L(oo);_destroyed=new X;_handles=new Ye([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis=null;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new v;released=new v;ended=new v;entered=new v;exited=new v;dropped=new v;moved=new rt(e=>{let n=this._dragRef.moved.pipe(Un(i=>({source:this,pointerPosition:i.pointerPosition,event:i.event,delta:i.delta,distance:i.distance}))).subscribe(e);return()=>{n.unsubscribe()}});_injector=L(lt);constructor(){let e=this.dropContainer,n=L(ro,{optional:!0}),i=L(qn);this._dragRef=i.createDrag(this.element,{dragStartThreshold:n&&n.dragStartThreshold!=null?n.dragStartThreshold:5,pointerDirectionChangeThreshold:n&&n.pointerDirectionChangeThreshold!=null?n.pointerDirectionChangeThreshold:5,zIndex:n?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),n&&this._assignDefaults(n),e&&(e.addItem(this),e._dropListRef.beforeStarted.pipe(Ge(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){vn(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let n=e.rootElementSelector,i=e.freeDragPosition;n&&!n.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,i&&!i.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let n=this._handles.getValue();n.push(e),this._handles.next(n)}_removeHandle(e){let n=this._handles.getValue(),i=n.indexOf(e);i>-1&&(n.splice(i,1),this._handles.next(n))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,n=e;this.rootElementSelector&&(n=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(n||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Me(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let n=this._dir,i=this.dragStartDelay,o=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,p=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof i=="object"&&i?i:Yt(i),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(o).withPreviewTemplate(p).withPreviewContainer(this.previewContainer||"global"),n&&e.withDirection(n.value)}}),e.beforeStarted.pipe(Kn(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let n=this.element.nativeElement.parentElement;for(;n;){let i=this._dragDropRegistry.getDragDirectiveForNode(n);if(i){e.withParent(i._dragRef);break}n=n.parentElement}})}_handleEvents(e){e.started.subscribe(n=>{this.started.emit({source:this,event:n.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(n=>{this.released.emit({source:this,event:n.event})}),e.ended.subscribe(n=>{this.ended.emit({source:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:n.container.data,item:this,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:n.container.data,item:this})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,isPointerOverContainer:n.isPointerOverContainer,item:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event})})}_assignDefaults(e){let{lockAxis:n,dragStartDelay:i,constrainPosition:o,previewClass:p,boundaryElement:h,draggingDisabled:_,rootElementSelector:x,previewContainer:O}=e;this.disabled=_??!1,this.dragStartDelay=i||0,this.lockAxis=n||null,o&&(this.constrainPosition=o),p&&(this.previewClass=p),h&&(this.boundaryElement=h),x&&(this.rootElementSelector=x),O&&(this.previewContainer=O)}_setupHandlesListener(){this._handles.pipe(Zn(e=>{let n=e.map(i=>i.element);this._selfHandle&&this.rootElementSelector&&n.push(this.element),this._dragRef.withHandles(n)}),xn(e=>vt(...e.map(n=>n._stateChanges.pipe(yt(n))))),Ge(this._destroyed)).subscribe(e=>{let n=this._dragRef,i=e.element.nativeElement;e.disabled?n.disableHandle(i):n.enableHandle(i)})}static \u0275fac=function(n){return new(n||r)};static \u0275dir=dt({type:r,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,i){n&2&&T("cdk-drag-disabled",i.disabled)("cdk-drag-dragging",i._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",$e],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",si]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[mt([{provide:zn,useExisting:r}]),ct]})}return r})(),Qi=new ke("CdkDropListGroup");var ve=(()=>{class r{element=L(Ae);_changeDetectorRef=L(ie);_scrollDispatcher=L(Fi);_dir=L(Dn,{optional:!0});_group=L(Qi,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new X;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=L(Ut).getId("cdk-drop-list-");lockAxis=null;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;hasAnchor;dropped=new v;entered=new v;exited=new v;sorted=new v;_unsortedItems=new Set;constructor(){let e=L(qn),n=L(ro,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,n&&this._assignDefaults(n),this._dropListRef.enterPredicate=(i,o)=>this.enterPredicate(i.data,o.data),this._dropListRef.sortPredicate=(i,o,p)=>this.sortPredicate(i,o.data,p.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),r._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),e._dragRef._withDropContainer(this._dropListRef),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(n=>n._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let n=this._latestSortedRefs.indexOf(e._dragRef);n>-1&&(this._latestSortedRefs.splice(n,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,n)=>e._dragRef.getVisibleElement().compareDocumentPosition(n._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=r._dropLists.indexOf(this);e>-1&&r._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(yt(this._dir.value),Ge(this._destroyed)).subscribe(n=>e.withDirection(n)),e.beforeStarted.subscribe(()=>{let n=Ni(this.connectedTo).map(i=>{if(typeof i=="string"){let o=r._dropLists.find(p=>p.id===i);return o}return i});if(this._group&&this._group._items.forEach(i=>{n.indexOf(i)===-1&&n.push(i)}),!this._scrollableParentsResolved){let i=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(o=>o.getElementRef().nativeElement);this._dropListRef.withScrollableParents(i),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let i=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(i)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=Yt(this.autoScrollStep,2),e.hasAnchor=this.hasAnchor,e.connectedTo(n.filter(i=>i&&i!==this).map(i=>i._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(n=>n._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:this,item:n.item.data,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:this,item:n.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(n=>{this.sorted.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,container:this,item:n.item.data})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,item:n.item.data,isPointerOverContainer:n.isPointerOverContainer,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),vt(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:n,draggingDisabled:i,sortingDisabled:o,listAutoScrollDisabled:p,listOrientation:h}=e;this.disabled=i??!1,this.sortingDisabled=o??!1,this.autoScrollDisabled=p??!1,this.orientation=h||"vertical",this.lockAxis=n||null}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(n){return new(n||r)};static \u0275dir=dt({type:r,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(n,i){n&2&&(he("id",i.id),T("cdk-drop-list-disabled",i.disabled)("cdk-drop-list-dragging",i._dropListRef.isDragging())("cdk-drop-list-receiving",i._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",$e],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",$e],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",$e],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"],hasAnchor:[2,"cdkDropListHasAnchor","hasAnchor",$e]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[mt([{provide:Qi,useValue:void 0},{provide:ao,useExisting:r}])]})}return r})();var gr=new ke("CdkDragPlaceholder"),Oe=(()=>{class r{templateRef=L(yn);_drag=L(zn,{optional:!0});data;constructor(){this._drag?._setPlaceholderTemplate(this)}ngOnDestroy(){this._drag?._resetPlaceholderTemplate(this)}static \u0275fac=function(n){return new(n||r)};static \u0275dir=dt({type:r,selectors:[["ng-template","cdkDragPlaceholder",""]],inputs:{data:"data"},features:[mt([{provide:gr,useExisting:r}])]})}return r})();var me=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=St({type:r});static \u0275inj=wt({providers:[qn],imports:[Ai]})}return r})();var hr=()=>["inventoryList"],so=()=>[],_r=(r,t)=>t.name;function fr(r,t){if(r&1&&(a(0,"span",4),l(1),s()),r&2){let e=d();c(),D("(Effective: ",e.effectiveSpeed,")")}}function Cr(r,t){if(r&1&&W(0,"div",11),r&2){let e=d(2);z("height",e.placeholderHeight)("width",e.placeholderWidth)}}function br(r,t){if(r&1){let e=y();a(0,"div",8),g("cdkDragStarted",function(i){m(e);let o=d();return u(o.onDragStarted(i))}),a(1,"app-item",9),g("patch",function(i){let o=m(e).$index,p=d();return u(p.updateItem(o,i))})("delete",function(){let i=m(e).$index,o=d();return u(o.deleteItem(i))})("editingChange",function(i){let o=m(e).$index,p=d();return u(p.onEditingChange(o,i))}),s(),ge(2,Cr,1,4,"div",10),s()}if(r&2){let e=t.$implicit,n=t.$index,i=d();b("cdkDragDisabled",i.isItemEditing(n)),c(),b("item",e)("sheet",i.sheet)("index",n)("isEditing",i.isItemEditing(n))}}function xr(r,t){r&1&&(a(0,"p",7),l(1,"No equipment. Drag items from inventory here."),s())}var Zt=class r{sheet;patch=new v;editingItems=new Set;placeholderHeight="90px";placeholderWidth="100%";ngOnInit(){this.sheet.equipment||(this.sheet.equipment=[])}get armorWeight(){return this.sheet.equipment?.reduce((t,e)=>t+(e.weight||0),0)||0}get totalArmorDebuff(){return this.sheet.equipment?.reduce((t,e)=>t+(e.armorDebuff||0),0)||0}get effectiveSpeed(){let t=this.sheet.speed?.current||0;return Math.max(0,t-this.totalArmorDebuff)}deleteItem(t){let e=this.sheet.equipment[t];this.sheet.equipment=this.sheet.equipment.filter((o,p)=>p!==t);let n=this.sheet.trash||[];n.push({type:"equipment",data:e,deletedAt:Date.now()});let i=new Set;this.editingItems.forEach(o=>{o<t?i.add(o):o>t&&i.add(o-1)}),this.editingItems=i,this.patch.emit({path:"equipment",value:this.sheet.equipment}),this.patch.emit({path:"trash",value:n})}updateItem(t,e){let n=e.path.split(".");n.length===1?this.sheet.equipment[t][e.path]=e.value:n[0]==="requirements"&&(this.sheet.equipment[t].requirements||(this.sheet.equipment[t].requirements={}),this.sheet.equipment[t].requirements[n[1]]=e.value),this.sheet.equipment=[...this.sheet.equipment],this.patch.emit({path:`equipment.${t}.${e.path}`,value:e.value})}onDragStarted(t){let n=t.source.element.nativeElement.getBoundingClientRect();this.placeholderHeight=`${n.height}px`,this.placeholderWidth=`${n.width}px`}onDrop(t){if(t.previousContainer===t.container){let e=t.previousIndex,n=t.currentIndex;if(e===n)return;let i=[...this.sheet.equipment];be(i,e,n),this.sheet.equipment=i,this.patch.emit({path:"equipment",value:i})}else{let e=t.previousContainer.data[t.previousIndex];this.sheet.inventory=this.sheet.inventory.filter((i,o)=>o!==t.previousIndex);let n=[...this.sheet.equipment];n.splice(t.currentIndex,0,e),this.sheet.equipment=n,this.patch.emit({path:"inventory",value:this.sheet.inventory}),this.patch.emit({path:"equipment",value:this.sheet.equipment})}}onEditingChange(t,e){e?this.editingItems.add(t):this.editingItems.delete(t)}isItemEditing(t){return this.editingItems.has(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-equipment"]],inputs:{sheet:"sheet"},outputs:{patch:"patch"},decls:15,vars:11,consts:[[1,"equipment-header"],[1,"equipment-stats"],[1,"armor-weight"],[1,"armor-debuff"],[1,"effective-speed"],["cdkDropList","","id","equipmentList",1,"equipment-list",3,"cdkDropListDropped","cdkDropListData","cdkDropListConnectedTo"],["cdkDrag","",3,"cdkDragDisabled"],[1,"empty-message"],["cdkDrag","",3,"cdkDragStarted","cdkDragDisabled"],[3,"patch","delete","editingChange","item","sheet","index","isEditing"],["class","drag-placeholder-wrapper",3,"height","width",4,"cdkDragPlaceholder"],[1,"drag-placeholder-wrapper"]],template:function(e,n){e&1&&(a(0,"app-card")(1,"div",0)(2,"div")(3,"h2"),l(4,"Equipment / Armor"),s(),a(5,"div",1)(6,"span",2),l(7),s(),a(8,"span",3),l(9),f(10,fr,2,1,"span",4),s()()()(),a(11,"div",5),g("cdkDropListDropped",function(o){return n.onDrop(o)}),I(12,br,3,5,"div",6,_r),f(14,xr,2,0,"p",7),s()()),e&2&&(c(7),D("Weight: ",n.armorWeight," kg"),c(),T("has-debuff",n.totalArmorDebuff>0),c(),D(" Speed Penalty: -",n.totalArmorDebuff," "),c(),C(n.totalArmorDebuff>0?10:-1),c(),b("cdkDropListData",n.sheet.equipment)("cdkDropListConnectedTo",Z(8,hr)),c(),V(n.sheet.equipment||Z(9,so)),c(2),C((n.sheet.equipment||Z(10,so)).length===0?14:-1))},dependencies:[A,Rt,Q,me,ve,xe,Oe],styles:["[_nghost-%COMP%]{display:block;height:100%}app-card[_ngcontent-%COMP%]{display:block;height:100%}.equipment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.equipment-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .25rem}.equipment-stats[_ngcontent-%COMP%]{display:flex;gap:1.5rem;flex-wrap:wrap}.armor-weight[_ngcontent-%COMP%], .armor-debuff[_ngcontent-%COMP%]{color:var(--muted);font-size:.9rem;font-weight:600}.armor-debuff.has-debuff[_ngcontent-%COMP%]{color:#f97316}.effective-speed[_ngcontent-%COMP%]{color:var(--text-muted);font-size:.85rem;margin-left:.25rem}.equipment-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;min-height:910px;max-height:910px;overflow-y:auto;flex:1;padding:.5rem;border:2px dashed var(--border);border-radius:6px;background:var(--bg)}.equipment-list.cdk-drop-list-dragging[_ngcontent-%COMP%]{background:var(--card);border-color:var(--accent)}.empty-message[_ngcontent-%COMP%]{text-align:center;color:var(--muted);padding:2rem;font-style:italic;margin:0}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;box-shadow:0 5px 15px #0000004d;opacity:.8}.drag-placeholder-wrapper[_ngcontent-%COMP%]{background:var(--bg);border:2px dashed var(--border);border-radius:6px;box-sizing:border-box}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var vr=(r,t)=>t.id;function yr(r,t){r&1&&(a(0,"p",5),l(1,"No loot available"),s())}function wr(r,t){if(r&1&&(a(0,"span",13),l(1),s()),r&2){let e=d(2).$implicit;c(),D("",e.data.platinum," Platinum")}}function Sr(r,t){if(r&1&&(a(0,"span",13),l(1),s()),r&2){let e=d(2).$implicit;c(),D("",e.data.gold," Gold")}}function Mr(r,t){if(r&1&&(a(0,"span",13),l(1),s()),r&2){let e=d(2).$implicit;c(),D("",e.data.silver," Silver")}}function kr(r,t){if(r&1&&(a(0,"span",13),l(1),s()),r&2){let e=d(2).$implicit;c(),D("",e.data.copper," Copper")}}function Pr(r,t){if(r&1&&(a(0,"h3"),l(1,"Currency Reward"),s(),a(2,"div",12),f(3,wr,2,1,"span",13),f(4,Sr,2,1,"span",13),f(5,Mr,2,1,"span",13),f(6,kr,2,1,"span",13),s()),r&2){let e=d().$implicit;c(3),C(e.data.platinum>0?3:-1),c(),C(e.data.gold>0?4:-1),c(),C(e.data.silver>0?5:-1),c(),C(e.data.copper>0?6:-1)}}function Er(r,t){if(r&1&&(a(0,"div",14)(1,"span"),l(2),s()()),r&2){let e=d(2).$implicit;c(2),D("Weight: ",e.data.weight)}}function Or(r,t){if(r&1&&(a(0,"h3"),l(1),s(),a(2,"p"),l(3),s(),f(4,Er,3,1,"div",14)),r&2){let e=d().$implicit;c(),M(e.data.name),c(2),M(e.data.description),c(),C(e.type==="item"?4:-1)}}function Dr(r,t){if(r&1){let e=y();a(0,"div",6)(1,"div",9),l(2),s(),a(3,"div",10),f(4,Pr,7,4)(5,Or,5,3),s(),a(6,"button",11),g("click",function(){let i=m(e).$implicit,o=d();return u(o.onClaim(i))}),l(7),s()()}if(r&2){let e=t.$implicit,n=d();c(),le(e.type),c(),D(" ",e.type," "),c(2),C(e.type==="currency"?4:5),c(3),D(" ",n.isBattleLoot?"Take":"Accept"," ")}}var Qt=class r{loot=[];isBattleLoot=!1;claimItem=new v;close=new v;onClaim(t){this.claimItem.emit(t)}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-loot-popup"]],inputs:{loot:"loot",isBattleLoot:"isBattleLoot"},outputs:{claimItem:"claimItem",close:"close"},decls:15,vars:2,consts:[[1,"popup-overlay",3,"click"],[1,"popup-content",3,"click"],[1,"popup-header"],[1,"close-btn",3,"click"],[1,"loot-list"],[1,"no-loot"],[1,"loot-item-card"],[1,"popup-footer"],[1,"close-footer-btn",3,"click"],[1,"loot-type-badge"],[1,"loot-details"],[1,"claim-btn",3,"click"],[1,"currency-display"],[1,"currency-amount"],[1,"item-stats"]],template:function(e,n){e&1&&(a(0,"div",0),g("click",function(){return n.onClose()}),a(1,"div",1),g("click",function(o){return o.stopPropagation()}),a(2,"app-card")(3,"div",2)(4,"h2"),l(5),s(),a(6,"button",3),g("click",function(){return n.onClose()}),l(7,"\xD7"),s()(),a(8,"div",4),f(9,yr,2,0,"p",5),I(10,Dr,8,5,"div",6,vr),s(),a(12,"div",7)(13,"button",8),g("click",function(){return n.onClose()}),l(14,"Close"),s()()()()()),e&2&&(c(5),M(n.isBattleLoot?"Battle Loot!":"You found loot!"),c(4),C(n.loot.length===0?9:-1),c(),V(n.loot))},dependencies:[A,Q],styles:[".popup-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .2s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.popup-content[_ngcontent-%COMP%]{max-width:600px;max-height:80vh;width:90%;animation:_ngcontent-%COMP%_slideUp .3s ease-out;overflow-y:auto}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}.popup-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;border-bottom:2px solid var(--accent);padding-bottom:.5rem}.popup-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--accent)}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:2rem;color:var(--text-muted);cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:color .2s}.close-btn[_ngcontent-%COMP%]:hover{color:var(--text)}.loot-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;max-height:50vh;overflow-y:auto;padding:.5rem 0}.loot-item-card[_ngcontent-%COMP%]{display:flex;gap:1rem;padding:1rem;background:var(--card);border-radius:8px;border:2px solid var(--border);transition:border-color .2s,transform .2s}.loot-item-card[_ngcontent-%COMP%]:hover{border-color:#4caf50;transform:translateY(-2px)}.loot-type-badge[_ngcontent-%COMP%]{background:#2196f3;color:#fff;padding:.5rem .75rem;border-radius:4px;font-size:.75rem;font-weight:600;text-transform:uppercase;align-self:flex-start}.loot-type-badge.item[_ngcontent-%COMP%]{background:#ff9800}.loot-type-badge.rune[_ngcontent-%COMP%]{background:#9c27b0}.loot-type-badge.spell[_ngcontent-%COMP%]{background:#2196f3}.loot-type-badge.currency[_ngcontent-%COMP%]{background:#ffc107;color:var(--text)}.loot-details[_ngcontent-%COMP%]{flex:1}.loot-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text)}.loot-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--text-muted);font-size:.9rem}.item-stats[_ngcontent-%COMP%]{font-size:.85rem;color:#888}.claimed-info[_ngcontent-%COMP%]{font-size:.8rem;color:var(--text-muted);background:#f0f0f0;padding:.25rem .5rem;border-radius:3px;display:inline-block;margin-top:.5rem}.claim-btn[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-weight:600;align-self:center;transition:background .2s}.claim-btn[_ngcontent-%COMP%]:hover{background:var(--accentdark)}.no-loot[_ngcontent-%COMP%]{text-align:center;color:var(--text-muted);font-style:italic;padding:2rem}.popup-footer[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border)}.close-footer-btn[_ngcontent-%COMP%]{padding:.5rem 2rem;background:var(--border);color:var(--text);border:1px solid var(--border);border-radius:4px;cursor:pointer;font-weight:600;transition:background .2s}.close-footer-btn[_ngcontent-%COMP%]:hover{background:#4b5563}.currency-display[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}.currency-amount[_ngcontent-%COMP%]{background:linear-gradient(135deg,gold,orange);color:var(--text);padding:.5rem 1rem;border-radius:6px;font-weight:600;font-size:.95rem;box-shadow:0 2px 4px #ffc1074d;border:1px solid rgba(255,165,0,.3)}"]})};var Rr=()=>["equipmentList"],lo=()=>[];function Ir(r,t){if(r&1&&(a(0,"span",30),l(1),s()),r&2){let e=d();le(e.encumbranceClass),c(),M(e.speedPenaltyText)}}function Vr(r,t){if(r&1&&W(0,"div",34),r&2){let e=d(2);z("height",e.placeholderHeight)("width",e.placeholderWidth)}}function Fr(r,t){if(r&1){let e=y();a(0,"div",31),g("cdkDragStarted",function(i){m(e);let o=d();return u(o.onDragStarted(i))}),a(1,"app-item",32),g("patch",function(i){let o=m(e).$index,p=d();return u(p.updateItem(o,i))})("delete",function(){let i=m(e).$index,o=d();return u(o.deleteItem(i))})("editingChange",function(i){let o=m(e).$index,p=d();return u(p.onEditingChange(o,i))}),s(),ge(2,Vr,1,4,"div",33),s()}if(r&2){let e=t.$implicit,n=t.$index,i=d();b("cdkDragDisabled",i.isItemEditing(n)),c(),b("item",e)("sheet",i.sheet)("index",n)("isEditing",i.isItemEditing(n))}}function Lr(r,t){r&1&&(a(0,"p",13),l(1,"No items yet. Click + to add one."),s())}function Ar(r,t){if(r&1){let e=y();a(0,"div",35),g("click",function(){m(e);let i=d();return u(i.closeCreateDialog())}),a(1,"div",36),g("click",function(i){return m(e),u(i.stopPropagation())}),a(2,"h3"),l(3,"Add New Item"),s(),a(4,"app-item-creator",37),g("create",function(i){m(e);let o=d();return u(o.createItem(i))})("cancel",function(){m(e);let i=d();return u(i.closeCreateDialog())}),s()()()}}function Nr(r,t){if(r&1){let e=y();a(0,"div",29)(1,"div",36),g("click",function(i){return m(e),u(i.stopPropagation())}),a(2,"h3"),l(3,"Carry Capacity Settings"),s(),a(4,"div",38)(5,"div",39)(6,"label"),l(7,"Formula: (Strength \xD7 Multiplier) + Bonus"),s()(),a(8,"div",39)(9,"label",40),l(10,"Multiplier"),s(),a(11,"input",41),g("ngModelChange",function(i){m(e);let o=d();return u(o.updateCapacitySetting("carryCapacityMultiplier",i))}),s()(),a(12,"div",39)(13,"label",42),l(14,"Bonus (kg)"),s(),a(15,"input",43),g("ngModelChange",function(i){m(e);let o=d();return u(o.updateCapacitySetting("carryCapacityBonus",i))}),s()(),a(16,"div",44)(17,"label"),l(18,"Current Capacity:"),s(),a(19,"span",45),l(20),s()(),a(21,"button",46),g("click",function(){m(e);let i=d();return u(i.closeSettingsDialog())}),l(22,"Close"),s()()()()}if(r&2){let e=d();c(11),b("ngModel",e.sheet.carryCapacityMultiplier),c(4),b("ngModel",e.sheet.carryCapacityBonus),c(5),D("",e.maxCapacity," kg")}}var en=class r{sheet;patch=new v;Math=Math;showCreateDialog=!1;showSettingsDialog=!1;editingItems=new Set;placeholderHeight="90px";placeholderWidth="100%";ngOnInit(){this.sheet.inventory||(this.sheet.inventory=[]),this.sheet.carryCapacityMultiplier===void 0&&(this.sheet.carryCapacityMultiplier=10),this.sheet.carryCapacityBonus===void 0&&(this.sheet.carryCapacityBonus=0)}openCreateDialog(){this.showCreateDialog=!0}closeCreateDialog(){this.showCreateDialog=!1}openSettingsDialog(){this.showSettingsDialog=!0}closeSettingsDialog(){this.showSettingsDialog=!1}get totalWeight(){let t=this.sheet.inventory?.reduce((n,i)=>n+(i.weight||0),0)||0,e=this.getCurrencyWeight();return Math.floor(t+e)}getCurrencyWeight(){return this.sheet.currency?((this.sheet.currency.copper||0)+(this.sheet.currency.silver||0)+(this.sheet.currency.gold||0)+(this.sheet.currency.platinum||0))*.009:0}get maxCapacity(){let t=this.sheet.strength?.current*8||10;return Math.floor(t*this.sheet.carryCapacityMultiplier+this.sheet.carryCapacityBonus)}get encumbrancePercentage(){return this.totalWeight/this.maxCapacity*100}get encumbranceColor(){let t=this.encumbrancePercentage;return t<80?"#22c55e":t<100?"#eab308":"#ef4444"}get encumbranceClass(){let t=this.encumbrancePercentage;return t<80?"normal":t<100?"heavy":"overencumbered"}get speedPenaltyText(){let t=this.encumbrancePercentage;return t<80?"":t<100?"Half Speed":"Speed = 0"}updateCapacitySetting(t,e){this.sheet[t]=e,this.patch.emit({path:t,value:Number(e)})}updateCurrency(t,e){this.sheet.currency||(this.sheet.currency={copper:0,silver:0,gold:0,platinum:0}),this.sheet.currency[t]=Number(e)||0,this.patch.emit({path:`currency.${t}`,value:Number(e)||0})}getCurrencyTotalValue(){return this.sheet.currency?(this.sheet.currency.copper||0)*.01+(this.sheet.currency.silver||0)*.1+(this.sheet.currency.gold||0)+(this.sheet.currency.platinum||0)*10:0}createItem(t){this.sheet.inventory=[...this.sheet.inventory,t],this.patch.emit({path:"inventory",value:this.sheet.inventory}),this.closeCreateDialog()}deleteItem(t){let e=this.sheet.inventory[t];this.sheet.inventory=this.sheet.inventory.filter((o,p)=>p!==t);let n=this.sheet.trash||[];n.push({type:"item",data:e,deletedAt:Date.now()});let i=new Set;this.editingItems.forEach(o=>{o<t?i.add(o):o>t&&i.add(o-1)}),this.editingItems=i,this.patch.emit({path:"inventory",value:this.sheet.inventory}),this.patch.emit({path:"trash",value:n})}updateItem(t,e){let n=e.path.split(".");n.length===1?this.sheet.inventory[t][e.path]=e.value:n[0]==="requirements"&&(this.sheet.inventory[t].requirements||(this.sheet.inventory[t].requirements={}),this.sheet.inventory[t].requirements[n[1]]=e.value),this.sheet.inventory=[...this.sheet.inventory],this.patch.emit({path:`inventory.${t}.${e.path}`,value:e.value})}onDragStarted(t){let n=t.source.element.nativeElement.getBoundingClientRect();this.placeholderHeight=`${n.height}px`,this.placeholderWidth=`${n.width}px`}onDrop(t){if(t.previousContainer===t.container){let e=t.previousIndex,n=t.currentIndex;if(e===n)return;let i=[...this.sheet.inventory];be(i,e,n),this.sheet.inventory=i,this.patch.emit({path:"inventory",value:i})}else{let e=t.previousContainer.data[t.previousIndex];this.sheet.equipment=this.sheet.equipment.filter((i,o)=>o!==t.previousIndex);let n=[...this.sheet.inventory];n.splice(t.currentIndex,0,e),this.sheet.inventory=n,this.patch.emit({path:"equipment",value:this.sheet.equipment}),this.patch.emit({path:"inventory",value:this.sheet.inventory})}}onEditingChange(t,e){let n=new Set(this.editingItems);e?n.add(t):n.delete(t),this.editingItems=n}isItemEditing(t){return this.editingItems.has(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-inventory"]],inputs:{sheet:"sheet"},outputs:{patch:"patch"},decls:49,vars:35,consts:[[1,"inventory-header"],[1,"weight-info"],[1,"weight-row"],[1,"weight-display"],[1,"speed-penalty",3,"class"],[1,"currency-weight-label"],[1,"weight-bar"],[1,"weight-fill"],[1,"header-buttons"],["title","Carry Capacity Settings",1,"settings-btn",3,"click"],[1,"add-btn",3,"click"],["cdkDropList","","id","inventoryList",1,"inventory-list",3,"cdkDropListDropped","cdkDropListData","cdkDropListConnectedTo"],["cdkDrag","",3,"cdkDragDisabled"],[1,"empty-message"],[1,"currency-section"],[1,"currency-grid"],[1,"coin-input","copper"],["for","copper"],["id","copper","type","number","min","0","step","1",3,"ngModelChange","ngModel"],[1,"coin-input","silver"],["for","silver"],["id","silver","type","number","min","0","step","1",3,"ngModelChange","ngModel"],[1,"coin-input","gold"],["for","gold"],["id","gold","type","number","min","0","step","1",3,"ngModelChange","ngModel"],[1,"coin-input","platinum"],["for","platinum"],["id","platinum","type","number","min","0","step","1",3,"ngModelChange","ngModel"],[1,"currency-total"],[1,"dialog-overlay"],[1,"speed-penalty"],["cdkDrag","",3,"cdkDragStarted","cdkDragDisabled"],[3,"patch","delete","editingChange","item","sheet","index","isEditing"],["class","drag-placeholder-wrapper",3,"height","width",4,"cdkDragPlaceholder"],[1,"drag-placeholder-wrapper"],[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],[3,"create","cancel"],[1,"settings-form"],[1,"field"],["for","multiplier"],["id","multiplier","type","number","step","0.5","min","0",3,"ngModelChange","ngModel"],["for","bonus"],["id","bonus","type","number","step","1",3,"ngModelChange","ngModel"],[1,"field","preview"],[1,"capacity-preview"],[1,"close-btn",3,"click"]],template:function(e,n){e&1&&(a(0,"app-card")(1,"div",0)(2,"div")(3,"h2"),l(4,"Inventory"),s(),a(5,"div",1)(6,"div",2)(7,"span",3),l(8),s(),f(9,Ir,2,3,"span",4),s(),a(10,"span",5),l(11),re(12,"number"),s(),a(13,"div",6),W(14,"div",7),s()()(),a(15,"div",8)(16,"button",9),g("click",function(){return n.openSettingsDialog()}),l(17," \u2699\uFE0F "),s(),a(18,"button",10),g("click",function(){return n.openCreateDialog()}),l(19,"+ Add Item"),s()()(),a(20,"div",11),g("cdkDropListDropped",function(o){return n.onDrop(o)}),I(21,Fr,3,5,"div",12,ue),f(23,Lr,2,0,"p",13),s(),a(24,"div",14)(25,"h3"),l(26,"Currency"),s(),a(27,"div",15)(28,"div",16)(29,"label",17),l(30,"Copper"),s(),a(31,"input",18),g("ngModelChange",function(o){return n.updateCurrency("copper",o)}),s()(),a(32,"div",19)(33,"label",20),l(34,"Silver"),s(),a(35,"input",21),g("ngModelChange",function(o){return n.updateCurrency("silver",o)}),s()(),a(36,"div",22)(37,"label",23),l(38,"Gold"),s(),a(39,"input",24),g("ngModelChange",function(o){return n.updateCurrency("gold",o)}),s()(),a(40,"div",25)(41,"label",26),l(42,"Platinum"),s(),a(43,"input",27),g("ngModelChange",function(o){return n.updateCurrency("platinum",o)}),s()()(),a(44,"div",28),l(45),re(46,"number"),s()(),f(47,Ar,5,0,"div",29),f(48,Nr,23,3,"div",29),s()),e&2&&(c(7),le(n.encumbranceClass),z("color",n.encumbranceColor),c(),se(" ",n.totalWeight," / ",n.maxCapacity," kg "),c(),C(n.speedPenaltyText?9:-1),c(2),D("Currency: ",ut(12,26,n.getCurrencyWeight(),"1.2-2")," kg"),c(2),le(n.encumbranceClass),c(),le(n.encumbranceClass),z("width",n.Math.min(n.encumbrancePercentage,100),"%")("background-color",n.encumbranceColor),c(6),b("cdkDropListData",n.sheet.inventory)("cdkDropListConnectedTo",Z(32,Rr)),c(),V(n.sheet.inventory||Z(33,lo)),c(2),C((n.sheet.inventory||Z(34,lo)).length===0?23:-1),c(8),b("ngModel",(n.sheet.currency==null?null:n.sheet.currency.copper)||0),c(4),b("ngModel",(n.sheet.currency==null?null:n.sheet.currency.silver)||0),c(4),b("ngModel",(n.sheet.currency==null?null:n.sheet.currency.gold)||0),c(4),b("ngModel",(n.sheet.currency==null?null:n.sheet.currency.platinum)||0),c(2),D(" Total: ",ut(46,29,n.getCurrencyTotalValue(),"1.2-2")," gp "),c(2),C(n.showCreateDialog?47:-1),c(),C(n.showSettingsDialog?48:-1))},dependencies:[A,Rt,Q,Si,me,ve,xe,Oe,q,Y,oe,G,Pe,U,gi],styles:["[_nghost-%COMP%]{display:block;padding:1rem}.inventory-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;gap:1rem}.inventory-header[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{flex:1}.inventory-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem}.weight-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.weight-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.weight-display[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;transition:color .3s}.speed-penalty[_ngcontent-%COMP%]{font-size:.85rem;font-weight:700;padding:.2rem .5rem;border-radius:4px}.speed-penalty.heavy[_ngcontent-%COMP%]{background:#eab30833;color:#eab308;border:1px solid #eab308}.speed-penalty.overencumbered[_ngcontent-%COMP%]{background:#ef444433;color:#ef4444;border:1px solid #ef4444;animation:_ngcontent-%COMP%_blink .5s infinite}@keyframes _ngcontent-%COMP%_blink{0%,to{opacity:1}50%{opacity:.3}}.weight-bar[_ngcontent-%COMP%]{width:200px;height:10px;background:var(--bg);border-radius:5px;overflow:hidden;border:1px solid var(--border);transition:all .3s}.weight-bar.overencumbered[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 8px #ef444480;animation:_ngcontent-%COMP%_bar-blink .5s infinite}@keyframes _ngcontent-%COMP%_bar-blink{0%,to{box-shadow:0 0 8px #ef444480}50%{box-shadow:0 0 15px #ef4444e6}}.weight-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s,background-color .3s;border-radius:5px}.weight-fill.overencumbered[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fill-pulse .5s infinite}@keyframes _ngcontent-%COMP%_fill-pulse{0%,to{opacity:1}50%{opacity:.7}}.header-buttons[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-shrink:0}.settings-btn[_ngcontent-%COMP%]{padding:.5rem .75rem;background-color:var(--muted);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;transition:background-color .2s}.settings-btn[_ngcontent-%COMP%]:hover{background-color:var(--text)}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background-color:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:.9rem;transition:background-color .2s;white-space:nowrap}.add-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.inventory-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;min-height:100px}.empty-message[_ngcontent-%COMP%]{text-align:center;color:var(--muted);padding:2rem;font-style:italic}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.dialog-content[_ngcontent-%COMP%]{background:var(--card);padding:2rem;border-radius:8px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}.dialog-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.settings-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.settings-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.settings-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem;color:var(--text)}.settings-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.6rem;border:1px solid var(--border);border-radius:4px;font-size:.95rem}.settings-form[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent)}.settings-form[_ngcontent-%COMP%]   .field.preview[_ngcontent-%COMP%]{flex-direction:row;align-items:center;gap:1rem;padding:1rem;background:var(--bg);border-radius:4px}.capacity-preview[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:var(--accent)}.close-btn[_ngcontent-%COMP%]{padding:.75rem;background-color:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:.95rem;font-weight:500;transition:background-color .2s}.close-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;box-shadow:0 5px 15px #0000004d;opacity:.8}.drag-placeholder-wrapper[_ngcontent-%COMP%]{background:var(--bg);border:2px dashed var(--border);border-radius:6px;box-sizing:border-box}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.currency-weight-label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--muted)}.currency-section[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:2px solid var(--border)}.currency-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--text);font-size:1.2rem}.currency-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem;margin-bottom:1rem}.coin-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.coin-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;font-size:.85rem;color:var(--text)}.coin-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.4rem;border:2px solid var(--border);border-radius:4px;font-size:.9rem;font-weight:600;text-align:center;transition:border-color .2s;width:100%;box-sizing:border-box;color:var(--text);background:var(--bg)}.coin-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.coin-input.copper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-color:#cd7f32}.coin-input.copper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#b87333;box-shadow:0 0 0 3px #cd7f321a}.coin-input.silver[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-color:silver}.coin-input.silver[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#a8a8a8;box-shadow:0 0 0 3px #c0c0c01a}.coin-input.gold[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-color:gold}.coin-input.gold[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#fc0;box-shadow:0 0 0 3px #ffd70033}.coin-input.platinum[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-color:#e5e4e2}.coin-input.platinum[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#d3d3d3;box-shadow:0 0 0 3px #e5e4e233}.currency-total[_ngcontent-%COMP%]{color:var(--muted);font-weight:600;font-size:.95rem;text-align:center;padding:.5rem;background:var(--bg);border-radius:4px}"]})};var Br=["canvas"];function zr(r,t){if(r&1){let e=y();a(0,"button",44),g("click",function(){let i=m(e).$implicit,o=d(3);return u(o.selectColor(i))}),s()}if(r&2){let e=t.$implicit,n=d(3);z("background",e)("border-color",e==="#ffffff"?"#666":e),T("active",n.strokeColor===e),b("title",e)}}function Wr(r,t){if(r&1){let e=y();a(0,"div",28)(1,"div",39),I(2,zr,1,7,"button",40,te),a(4,"label",41)(5,"input",42),g("input",function(i){m(e);let o=d(2);return u(o.onColorInput(i))}),s(),W(6,"span",43),s()()()}if(r&2){let e=d(2);c(2),V(e.presetColors),c(3),b("value",e.strokeColor),c(),z("background",e.strokeColor)}}function Hr(r,t){if(r&1){let e=y();a(0,"button",48),g("click",function(){let i=m(e).$implicit,o=d(3);return u(o.selectEraserSize(i))}),W(1,"span",49),s()}if(r&2){let e=t.$implicit,n=d(3);T("active",n.eraserSize===e),b("title",e+"px"),c(),z("width",n.Math.min(e,24),"px")("height",n.Math.min(e,24),"px")}}function qr(r,t){if(r&1&&(a(0,"div",28)(1,"span",45),l(2,"Eraser Size:"),s(),a(3,"div",46),I(4,Hr,2,7,"button",47,te),s()()),r&2){let e=d(2);c(4),V(e.eraserSizes)}}function jr(r,t){if(r&1){let e=y();a(0,"div",1)(1,"div",20)(2,"h3"),l(3),s(),a(4,"button",21),g("click",function(){m(e);let i=d();return u(i.closeFullscreenDrawing())}),l(5,"\u2715 Close"),s()(),a(6,"div",22)(7,"div",23)(8,"div",24)(9,"button",25),g("click",function(){m(e);let i=d();return u(i.setDrawMode())}),a(10,"span",26),l(11,"\u270F\uFE0F"),s()(),a(12,"button",27),g("click",function(){m(e);let i=d();return u(i.toggleEraser())}),a(13,"span",26),l(14,"\u{1F9F9}"),s()()(),f(15,Wr,7,3,"div",28),f(16,qr,6,0,"div",28),a(17,"div",29)(18,"button",30),g("click",function(){m(e);let i=d();return u(i.undo())}),a(19,"span",26),l(20,"\u21B6"),s(),l(21," Undo "),s(),a(22,"button",31),g("click",function(){m(e);let i=d();return u(i.clearCanvas())}),a(23,"span",26),l(24,"\u{1F5D1}\uFE0F"),s(),l(25," Clear "),s()()(),a(26,"div",32)(27,"button",33),g("click",function(){m(e);let i=d();return u(i.expandTop())}),l(28,"\u25B2"),s(),a(29,"button",34),g("click",function(){m(e);let i=d();return u(i.expandLeft())}),l(30,"\u25C4"),s(),a(31,"button",35),g("click",function(){m(e);let i=d();return u(i.expandRight())}),l(32,"\u25BA"),s(),a(33,"button",36),g("click",function(){m(e);let i=d();return u(i.expandBottom())}),l(34,"\u25BC"),s(),a(35,"div",37)(36,"canvas",38,0),g("pointerdown",function(i){m(e);let o=d();return u(o.startDrawing(i))})("pointermove",function(i){m(e);let o=d();return u(o.draw(i))})("pointerup",function(){m(e);let i=d();return u(i.stopDrawing())})("pointerleave",function(){m(e);let i=d();return u(i.stopDrawing())})("pointercancel",function(){m(e);let i=d();return u(i.stopDrawing())}),s()()()()()}if(r&2){let e=d();c(3),D("\u2728 ",e.newSpell.drawing?"Edit":"Create"," Spell Drawing"),c(6),T("active",!e.isErasing()),c(3),T("active",e.isErasing()),c(3),C(e.isErasing()?-1:15),c(),C(e.isErasing()?16:-1),c(19),T("panning",e.isPanning()),c(),he("width",e.canvasWidth())("height",e.canvasHeight())}}function $r(r,t){if(r&1&&(a(0,"div",50),W(1,"img",52),re(2,"imageUrl"),s()),r&2){let e=d(2);c(),b("src",ce(2,1,e.newSpell.drawing),Se)}}function Yr(r,t){if(r&1){let e=y();a(0,"div",3)(1,"label"),l(2,"Draw Spell Symbol"),s(),f(3,$r,3,3,"div",50),a(4,"button",51),g("click",function(){m(e);let i=d();return u(i.openFullscreenDrawing())}),l(5),s()()}if(r&2){let e=d();c(3),C(e.newSpell.drawing?3:-1),c(2),D(" \u{1F4DD} ",e.newSpell.drawing?"Edit":"Create"," Drawing in Fullscreen ")}}function Gr(r,t){if(r&1&&(a(0,"option",56),l(1),s()),r&2){let e=t.$implicit;b("value",e),c(),M(e)}}function Ur(r,t){if(r&1){let e=y();a(0,"div",3)(1,"label",53),l(2,"Bound Item *"),s(),a(3,"select",54),E("ngModelChange",function(i){m(e);let o=d();return P(o.newSpell.binding.itemName,i)||(o.newSpell.binding.itemName=i),u(i)}),a(4,"option",55),l(5,"Select an item..."),s(),I(6,Gr,2,2,"option",56,te),s()(),a(8,"div",57)(9,"div",3)(10,"label",58),l(11,"Current Durability"),s(),a(12,"input",59),E("ngModelChange",function(i){m(e);let o=d();return P(o.newSpell.binding.durability,i)||(o.newSpell.binding.durability=i),u(i)}),s()(),a(13,"div",3)(14,"label",60),l(15,"Max Durability"),s(),a(16,"input",61),E("ngModelChange",function(i){m(e);let o=d();return P(o.newSpell.binding.maxDurability,i)||(o.newSpell.binding.maxDurability=i),u(i)}),s()()()}if(r&2){let e=d();c(3),k("ngModel",e.newSpell.binding.itemName),c(3),V(e.availableItems),c(6),k("ngModel",e.newSpell.binding.durability),c(4),k("ngModel",e.newSpell.binding.maxDurability)}}function Xr(r,t){if(r&1){let e=y();a(0,"button",62),g("click",function(){let i=m(e).$implicit,o=d();return u(o.toggleTag(i))}),l(1),s()}if(r&2){let e=t.$implicit,n=d();T("selected",n.hasTag(e)),c(),D(" ",e," ")}}var tn=class r{constructor(t,e){this.cd=t;this.imageService=e}canvasRef;sheet;create=new v;cancel=new v;newSpell={name:"",description:"",drawing:void 0,tags:[],binding:{type:"learned"},strokeColor:"#673ab7"};strokeColor="#673ab7";tagOptions=Mi;hasDrawing=!1;canvasWidth=B(600);canvasHeight=B(300);isErasing=B(!1);isPanning=B(!1);isFullscreenDrawing=B(!1);presetColors=["#ff0000","#ff6600","#ffcc00","#00ff00","#00ffff","#0066ff","#6600ff","#ff00ff","#ffffff","#000000"];eraserSizes=[10,20,30,40];eraserSize=20;Math=Math;ctx;isDrawing=!1;lastX=0;lastY=0;expandAmount=200;undoHistory=[];maxUndoSteps=20;panStartX=0;panStartY=0;ngOnInit(){document.addEventListener("keydown",this.handleKeyDown.bind(this))}ngOnDestroy(){document.removeEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(t){(t.ctrlKey||t.metaKey)&&t.key==="z"&&this.hasDrawing&&this.isDrawing===!1&&(t.preventDefault(),this.undo())}canvasInitialized=!1;ngAfterViewInit(){this.tryInitCanvas()}ngAfterViewChecked(){this.tryInitCanvas()}tryInitCanvas(){this.hasDrawing&&this.canvasRef&&!this.canvasInitialized?(this.initCanvas(),this.canvasInitialized=!0):this.hasDrawing||(this.canvasInitialized=!1)}toggleDrawing(){this.hasDrawing=!this.hasDrawing,this.canvasInitialized=!1,this.hasDrawing?setTimeout(()=>this.openFullscreenDrawing(),0):this.newSpell.drawing=void 0}openFullscreenDrawing(){this.hasDrawing&&(this.isFullscreenDrawing.set(!0),this.canvasInitialized=!1,this.cd.detectChanges(),setTimeout(()=>{this.canvasRef&&(this.initCanvas(),this.newSpell.drawing&&this.loadDrawing(this.newSpell.drawing),this.cd.detectChanges())},0))}async closeFullscreenDrawing(){if(this.hasDrawing&&this.canvasRef){let e=this.canvasRef.nativeElement.toDataURL("image/png"),n=await this.imageService.uploadImage(e);this.newSpell.drawing=n}else this.hasDrawing||(this.newSpell.drawing=void 0);this.isFullscreenDrawing.set(!1)}loadDrawing(t){if(!this.ctx)return;let e=new Image;e.onload=()=>{this.ctx&&(this.ctx.clearRect(0,0,this.canvasWidth(),this.canvasHeight()),this.ctx.drawImage(e,0,0))};let n=this.imageService.getImageUrl(t);n&&(e.src=n)}initCanvas(){if(!this.canvasRef)return;let t=this.canvasRef.nativeElement;this.ctx=t.getContext("2d"),this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.clearCanvas(),this.saveToHistory()}updateStrokeColor(t){this.strokeColor=t,this.newSpell.strokeColor=t,this.ctx&&(this.ctx.strokeStyle=t,this.ctx.shadowColor=t)}get availableItems(){return[...this.sheet.inventory||[],...this.sheet.equipment||[]].map(e=>e.name)}startDrawing(t){if(this.canvasRef){if(t.button===1){t.preventDefault(),this.isPanning.set(!0);let e=this.canvasRef.nativeElement.parentElement;e&&(this.panStartX=t.clientX+e.scrollLeft,this.panStartY=t.clientY+e.scrollTop);return}if(t.button===0){this.isDrawing=!0;let e=this.canvasRef.nativeElement.getBoundingClientRect();this.lastX=t.clientX-e.left,this.lastY=t.clientY-e.top,this.saveToHistory()}}}draw(t){if(!this.canvasRef)return;if(this.isPanning()){let p=this.canvasRef.nativeElement.parentElement;p&&(p.scrollLeft=this.panStartX-t.clientX,p.scrollTop=this.panStartY-t.clientY);return}if(!this.isDrawing||!this.ctx)return;let e=this.canvasRef.nativeElement.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;this.isErasing()?(this.ctx.globalCompositeOperation="destination-out",this.ctx.lineWidth=this.eraserSize,this.ctx.shadowBlur=0):(this.ctx.globalCompositeOperation="source-over",this.ctx.lineWidth=2),(this.isErasing()?[0]:[30,20,10,5]).forEach(p=>{this.ctx.shadowBlur=p,this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(n,i),this.ctx.stroke()}),this.lastX=n,this.lastY=i}stopDrawing(){this.isDrawing=!1,this.isPanning.set(!1)}expandLeft(){this.expandCanvas("left")}expandRight(){this.expandCanvas("right")}expandTop(){this.expandCanvas("top")}expandBottom(){this.expandCanvas("bottom")}expandCanvas(t){let e=this.canvasRef?.nativeElement;if(!e||!this.ctx)return;let n=document.createElement("canvas");n.width=e.width,n.height=e.height;let i=n.getContext("2d");if(!i)return;i.drawImage(e,0,0);let o=this.canvasWidth(),p=this.canvasHeight(),h=0,_=0;switch(t){case"left":o+=this.expandAmount,h=this.expandAmount;break;case"right":o+=this.expandAmount;break;case"top":p+=this.expandAmount,_=this.expandAmount;break;case"bottom":p+=this.expandAmount;break}this.canvasWidth.set(o),this.canvasHeight.set(p),requestAnimationFrame(()=>{this.ctx&&e&&(this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,e.width,e.height),this.ctx.drawImage(n,h,_),this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.ctx.globalCompositeOperation=this.isErasing()?"destination-out":"source-over",this.saveToHistory())})}clearCanvas(){!this.canvasRef||!this.ctx||(this.canvasWidth.set(600),this.canvasHeight.set(300),this.undoHistory=[],setTimeout(()=>{if(!this.ctx||!this.canvasRef)return;let t=this.canvasRef.nativeElement;this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.saveToHistory()},0))}toggleTag(t){this.newSpell.tags.indexOf(t)>-1?this.newSpell.tags=this.newSpell.tags.filter(n=>n!==t):this.newSpell.tags=[...this.newSpell.tags,t]}hasTag(t){return this.newSpell.tags.includes(t)}async createSpell(){if(!this.newSpell.name.trim()){alert("Spell name is required");return}if(this.newSpell.binding.type==="item"&&!this.newSpell.binding.itemName){alert("Please select an item for item-bound spell");return}if(this.hasDrawing&&this.canvasRef){let e=this.canvasRef.nativeElement.toDataURL("image/png");this.newSpell.drawing=await this.imageService.uploadImage(e)}this.create.emit(ee({},this.newSpell)),this.newSpell={name:"",description:"",drawing:void 0,tags:[],binding:{type:"learned"}},this.hasDrawing=!1,this.canvasRef&&this.clearCanvas()}cancelCreate(){this.cancel.emit()}handleTouch(t){if(t.preventDefault(),!this.canvasRef)return;let e=t.touches[0],n=this.canvasRef.nativeElement.getBoundingClientRect();this.isDrawing=!0,this.lastX=e.clientX-n.left,this.lastY=e.clientY-n.top}handleTouchMove(t){if(t.preventDefault(),!this.isDrawing||!this.ctx||!this.canvasRef)return;let e=t.touches[0],n=this.canvasRef.nativeElement.getBoundingClientRect(),i=e.clientX-n.left,o=e.clientY-n.top;this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(i,o),this.ctx.stroke(),this.lastX=i,this.lastY=o}toggleEraser(){this.isErasing.set(!this.isErasing())}setDrawMode(){this.isErasing.set(!1)}selectColor(t){this.strokeColor=t,this.ctx&&(this.ctx.strokeStyle=t,this.ctx.shadowColor=t)}onColorInput(t){let e=t.target;this.selectColor(e.value)}selectEraserSize(t){this.eraserSize=t}saveToHistory(){if(!this.canvasRef||!this.ctx)return;let t=this.canvasRef.nativeElement,e=this.ctx.getImageData(0,0,t.width,t.height);this.undoHistory.push(e),this.undoHistory.length>this.maxUndoSteps&&this.undoHistory.shift()}undo(){if(!this.canvasRef||!this.ctx||this.undoHistory.length<2)return;this.undoHistory.pop();let t=this.undoHistory[this.undoHistory.length-1];if(t){let e=this.canvasRef.nativeElement;this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,e.width,e.height),this.ctx.putImageData(t,0,0),this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.lineJoin="round"}}static \u0275fac=function(e){return new(e||r)(K(ie),K(et))};static \u0275cmp=F({type:r,selectors:[["app-spell-creator"]],viewQuery:function(e,n){if(e&1&&Te(Br,5),e&2){let i;Re(i=Ie())&&(n.canvasRef=i.first)}},inputs:{sheet:"sheet"},outputs:{create:"create",cancel:"cancel"},decls:38,vars:8,consts:[["canvas",""],[1,"fullscreen-overlay"],[1,"creator-form",3,"ngSubmit"],[1,"field"],["for","name"],["id","name","type","text","name","name","placeholder","Enter spell name","required","",3,"ngModelChange","ngModel"],[1,"field","checkbox-field"],[1,"checkbox-label"],["type","checkbox","name","hasDrawing",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description","rows","4","placeholder","Describe the spell's effect...",3,"ngModelChange","ngModel"],[1,"binding-type-selector"],[1,"radio-label"],["type","radio","name","bindingType","value","learned",3,"ngModelChange","ngModel"],["type","radio","name","bindingType","value","item",3,"ngModelChange","ngModel"],[1,"tag-selector"],["type","button",1,"tag-option",3,"selected"],[1,"button-group"],["type","submit",1,"create-btn"],["type","button",1,"cancel-btn",3,"click"],[1,"fullscreen-header"],["type","button",1,"close-fullscreen-btn",3,"click"],[1,"fullscreen-content"],[1,"drawing-toolbar"],[1,"toolbar-section","tools"],["type","button","title","Draw Mode",1,"toolbar-btn",3,"click"],[1,"btn-icon"],["type","button","title","Eraser Mode",1,"toolbar-btn",3,"click"],[1,"toolbar-section","brush-settings"],[1,"toolbar-section","actions"],["type","button","title","Undo (Ctrl+Z)",1,"action-btn",3,"click"],["type","button","title","Clear Drawing",1,"action-btn","clear",3,"click"],[1,"canvas-area"],["type","button","title","Expand Top",1,"expand-btn","expand-top",3,"click"],["type","button","title","Expand Left",1,"expand-btn","expand-left",3,"click"],["type","button","title","Expand Right",1,"expand-btn","expand-right",3,"click"],["type","button","title","Expand Bottom",1,"expand-btn","expand-bottom",3,"click"],[1,"fullscreen-canvas-wrapper"],[3,"pointerdown","pointermove","pointerup","pointerleave","pointercancel"],[1,"color-picker"],["type","button",1,"color-swatch",3,"active","background","border-color","title"],["title","Custom Color",1,"custom-color"],["type","color",3,"input","value"],[1,"custom-color-preview"],["type","button",1,"color-swatch",3,"click","title"],[1,"setting-label"],[1,"size-picker"],["type","button",1,"size-btn",3,"active","title"],["type","button",1,"size-btn",3,"click","title"],[1,"size-dot"],[1,"drawing-preview"],["type","button",1,"edit-drawing-btn",3,"click"],["alt","Spell drawing",3,"src"],["for","itemName"],["id","itemName","name","itemName",3,"ngModelChange","ngModel"],["value",""],[3,"value"],[1,"durability-fields"],["for","durability"],["id","durability","type","number","min","0","name","durability","placeholder","10",3,"ngModelChange","ngModel"],["for","maxDurability"],["id","maxDurability","type","number","min","1","name","maxDurability","placeholder","10",3,"ngModelChange","ngModel"],["type","button",1,"tag-option",3,"click"]],template:function(e,n){e&1&&(f(0,jr,38,11,"div",1),a(1,"form",2),g("ngSubmit",function(){return n.createSpell()}),a(2,"div",3)(3,"label",4),l(4,"Spell Name *"),s(),a(5,"input",5),E("ngModelChange",function(o){return P(n.newSpell.name,o)||(n.newSpell.name=o),o}),s()(),a(6,"div",6)(7,"label",7)(8,"input",8),E("ngModelChange",function(o){return P(n.hasDrawing,o)||(n.hasDrawing=o),o}),s(),a(9,"span"),l(10,"Add spell symbol drawing"),s()()(),f(11,Yr,6,2,"div",3),a(12,"div",3)(13,"label",9),l(14,"Description"),s(),a(15,"textarea",10),E("ngModelChange",function(o){return P(n.newSpell.description,o)||(n.newSpell.description=o),o}),s()(),a(16,"div",3)(17,"label"),l(18,"Binding Type"),s(),a(19,"div",11)(20,"label",12)(21,"input",13),E("ngModelChange",function(o){return P(n.newSpell.binding.type,o)||(n.newSpell.binding.type=o),o}),s(),l(22," Learned "),s(),a(23,"label",12)(24,"input",14),E("ngModelChange",function(o){return P(n.newSpell.binding.type,o)||(n.newSpell.binding.type=o),o}),s(),l(25," Item-Bound "),s()()(),f(26,Ur,17,3),a(27,"div",3)(28,"label"),l(29,"Tags"),s(),a(30,"div",15),I(31,Xr,2,3,"button",16,te),s()(),a(33,"div",17)(34,"button",18),l(35,"Create"),s(),a(36,"button",19),g("click",function(){return n.cancelCreate()}),l(37,"Cancel"),s()()()),e&2&&(C(n.hasDrawing&&n.isFullscreenDrawing()?0:-1),c(5),k("ngModel",n.newSpell.name),c(3),k("ngModel",n.hasDrawing),c(3),C(n.hasDrawing?11:-1),c(4),k("ngModel",n.newSpell.description),c(6),k("ngModel",n.newSpell.binding.type),c(3),k("ngModel",n.newSpell.binding.type),c(2),C(n.newSpell.binding.type==="item"?26:-1),c(5),V(n.tagOptions))},dependencies:[A,q,Ze,ze,We,Y,oe,Pt,Be,fi,G,Je,Qe,Pe,U,Ke,Ee],styles:[".creator-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem}.field[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:auto;margin-right:.5rem}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.6rem;border:1px solid var(--border);border-radius:4px;font-family:inherit;font-size:.95rem}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent)}.field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.canvas-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.drawing-toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;gap:1rem;padding:.5rem 1rem;background:var(--card);border:1px solid var(--border);border-radius:8px;margin-bottom:.5rem}.toolbar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.toolbar-section.tools[_ngcontent-%COMP%]{background:var(--bg);padding:.25rem;border-radius:8px}.toolbar-btn[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:8px;background:transparent;border:1px solid transparent;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.toolbar-btn[_ngcontent-%COMP%]:hover{background:var(--border)}.toolbar-btn.active[_ngcontent-%COMP%]{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 0 10px #8b5cf666}.btn-icon[_ngcontent-%COMP%]{font-size:1.4rem}.brush-settings[_ngcontent-%COMP%]{background:var(--bg);padding:.5rem;border-radius:8px;gap:1rem}.setting-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text);font-weight:500}.color-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.color-swatch[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;border:2px solid transparent;cursor:pointer;transition:all .2s}.color-swatch[_ngcontent-%COMP%]:hover{transform:scale(1.15)}.color-swatch.active[_ngcontent-%COMP%]{border-color:#fff;box-shadow:0 0 0 2px var(--accent);transform:scale(1.1)}.custom-color[_ngcontent-%COMP%]{position:relative;width:28px;height:28px;cursor:pointer}.custom-color[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}.custom-color-preview[_ngcontent-%COMP%]{display:block;width:100%;height:100%;border-radius:50%;border:2px dashed var(--border);background:conic-gradient(red,#ff0,#0f0,#0ff,#00f,#f0f,red)}.size-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.size-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;background:transparent;border:1px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.size-btn[_ngcontent-%COMP%]:hover{background:var(--border)}.size-btn.active[_ngcontent-%COMP%]{background:var(--accent);border-color:var(--accent)}.size-dot[_ngcontent-%COMP%]{border-radius:50%;background:var(--text);max-width:24px;max-height:24px}.size-btn.active[_ngcontent-%COMP%]   .size-dot[_ngcontent-%COMP%]{background:#fff}.toolbar-section.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.action-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg);border:1px solid var(--border);border-radius:6px;cursor:pointer;font-size:.9rem;color:var(--text);transition:all .2s;display:flex;align-items:center;gap:.25rem}.action-btn[_ngcontent-%COMP%]:hover{background:var(--border)}.action-btn.clear[_ngcontent-%COMP%]:hover{background:#f44;color:#fff;border-color:#f44}.canvas-area[_ngcontent-%COMP%]{position:relative;display:inline-block;margin:1rem 0;padding:25px}.expand-btn[_ngcontent-%COMP%]{position:absolute;background:var(--card);border:2px solid var(--border);border-radius:6px;cursor:pointer;font-size:1.2rem;transition:all .2s;color:var(--text);z-index:10;padding:.4rem;display:flex;align-items:center;justify-content:center;min-width:36px;min-height:36px}.expand-btn[_ngcontent-%COMP%]:hover{background:var(--accent);color:#fff;border-color:var(--accent);transform:scale(1.1)}.canvas-container[_ngcontent-%COMP%]{border:2px solid var(--border);border-radius:8px;display:inline-block;background:#000;cursor:crosshair;box-shadow:0 2px 4px #0000001a;touch-action:none;overflow:auto;max-width:100%;max-height:70vh}.canvas-container.panning[_ngcontent-%COMP%]{cursor:grab}.canvas-container.panning[_ngcontent-%COMP%]:active{cursor:grabbing}canvas[_ngcontent-%COMP%]{display:block;touch-action:none}.binding-type-selector[_ngcontent-%COMP%]{display:flex;gap:1rem}.radio-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;font-weight:400}.radio-label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{width:auto;cursor:pointer}.durability-fields[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.tag-selector[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.tag-option[_ngcontent-%COMP%]{padding:.4rem .8rem;background:#f5f5f5;border:1px solid var(--border);border-radius:4px;cursor:pointer;font-size:.85rem;transition:all .2s}.tag-option[_ngcontent-%COMP%]:hover{background:#e0e0e0}.tag-option.selected[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2;border-color:#90caf9}.field[_ngcontent-%COMP%]   .color-picker[_ngcontent-%COMP%]{width:100%;height:48px;border:2px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s}.field[_ngcontent-%COMP%]   .color-picker[_ngcontent-%COMP%]:hover{border-color:var(--accent);box-shadow:0 0 8px #8b5cf64d}.button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.75rem;border:none;border-radius:4px;cursor:pointer;font-size:.95rem;font-weight:500;transition:all .2s}.create-btn[_ngcontent-%COMP%]{background-color:var(--accent);color:#fff}.create-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.cancel-btn[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.fullscreen-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000f2;z-index:10000;display:flex;flex-direction:column}.fullscreen-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:#ffffff1a;border-bottom:1px solid rgba(255,255,255,.2)}.fullscreen-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:1.5rem}.close-fullscreen-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:#ff5252;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:600;transition:all .2s}.close-fullscreen-btn[_ngcontent-%COMP%]:hover{background:#ff1744;transform:translateY(-1px);box-shadow:0 4px 8px #ff525266}.fullscreen-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:2rem;overflow:auto;width:100%}.canvas-area[_ngcontent-%COMP%]{position:relative;display:inline-block;margin:0 auto;padding:25px}.expand-btn.expand-top[_ngcontent-%COMP%]{top:-20px;left:50%;transform:translate(-50%)}.expand-btn.expand-bottom[_ngcontent-%COMP%]{bottom:-20px;left:50%;transform:translate(-50%)}.expand-btn.expand-left[_ngcontent-%COMP%]{left:-20px;top:50%;transform:translateY(-50%)}.expand-btn.expand-right[_ngcontent-%COMP%]{right:-20px;top:50%;transform:translateY(-50%)}.expand-btn.expand-top[_ngcontent-%COMP%]:hover, .expand-btn.expand-bottom[_ngcontent-%COMP%]:hover{transform:translate(-50%) scale(1.1)}.expand-btn.expand-left[_ngcontent-%COMP%]:hover, .expand-btn.expand-right[_ngcontent-%COMP%]:hover{transform:translateY(-50%) scale(1.1)}.fullscreen-canvas-wrapper[_ngcontent-%COMP%]{background:#000;border:2px solid rgba(255,255,255,.3);border-radius:8px;overflow:auto;max-width:95vw;max-height:calc(95vh - 150px);box-shadow:0 8px 32px #0009}.fullscreen-canvas-wrapper[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block;cursor:crosshair;touch-action:none}.fullscreen-canvas-wrapper.panning[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{cursor:grab}.fullscreen-canvas-wrapper.panning[_ngcontent-%COMP%]:active   canvas[_ngcontent-%COMP%]{cursor:grabbing}.drawing-preview[_ngcontent-%COMP%]{margin-bottom:1rem;border:2px solid var(--border);border-radius:8px;padding:1rem;background:#000;max-width:300px}.drawing-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;display:block}.edit-drawing-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:600;transition:all .2s}.edit-drawing-btn[_ngcontent-%COMP%]:hover{background:var(--accentdark);transform:translateY(-1px);box-shadow:0 4px 8px #8b5cf64d}.checkbox-field[_ngcontent-%COMP%]{margin-bottom:.5rem}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;font-weight:400!important;font-size:.95rem}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;margin:0}.checkbox-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"]})};var co=()=>[];function Jr(r,t){if(r&1&&W(0,"div",18),r&2){let e=d(2);z("height",e.placeholderHeight)("width",e.placeholderWidth)}}function Kr(r,t){if(r&1){let e=y();a(0,"div",15),g("cdkDragStarted",function(i){m(e);let o=d();return u(o.onDragStarted(i))}),a(1,"app-spell",16),g("patch",function(i){let o=m(e).$index,p=d();return u(p.updateSpell(o,i))})("delete",function(){let i=m(e).$index,o=d();return u(o.deleteSpell(i))})("editingChange",function(i){let o=m(e).$index,p=d();return u(p.onEditingChange(o,i))}),s(),ge(2,Jr,1,4,"div",17),s()}if(r&2){let e=t.$implicit,n=t.$index,i=d();b("cdkDragDisabled",i.isSpellEditing(n)),c(),b("spell",e)("sheet",i.sheet)("index",n)("isEditing",i.isSpellEditing(n))}}function Zr(r,t){r&1&&(a(0,"p",13),l(1,"No spells yet. Click + to add one."),s())}function Qr(r,t){if(r&1){let e=y();a(0,"div",19),g("click",function(){m(e);let i=d();return u(i.closeCreateDialog())}),a(1,"div",20),g("click",function(i){return m(e),u(i.stopPropagation())}),a(2,"h3"),l(3,"Create New Spell"),s(),a(4,"app-spell-creator",21),g("create",function(i){m(e);let o=d();return u(o.createSpell(i))})("cancel",function(){m(e);let i=d();return u(i.closeCreateDialog())}),s()()()}if(r&2){let e=d();c(4),b("sheet",e.sheet)}}var nn=class r{constructor(t){this.cd=t}sheet;editingSpells;patch=new v;editingChange=new v;showCreateDialog=!1;placeholderHeight="90px";placeholderWidth="100%";ngOnInit(){this.sheet.spells||(this.sheet.spells=[]),this.sheet.fokusMultiplier===void 0&&(this.sheet.fokusMultiplier=1),this.sheet.fokusBonus===void 0&&(this.sheet.fokusBonus=0)}get fokusValue(){let t=this.sheet.intelligence?.current||10;return Math.floor((t+this.sheet.fokusBonus)*this.sheet.fokusMultiplier)}openCreateDialog(){this.showCreateDialog=!0}closeCreateDialog(){this.showCreateDialog=!1}updateFokusSetting(t,e){this.sheet[t]=Number(e),this.cd.detectChanges(),this.patch.emit({path:t,value:Number(e)})}createSpell(t){this.sheet.spells=[...this.sheet.spells,t],this.patch.emit({path:"spells",value:this.sheet.spells}),this.closeCreateDialog()}deleteSpell(t){let e=this.sheet.spells[t];this.sheet.spells=this.sheet.spells.filter((i,o)=>o!==t);let n=this.sheet.trash||[];n.push({type:"spell",data:e,deletedAt:Date.now()}),this.patch.emit({path:"spells",value:this.sheet.spells}),this.patch.emit({path:"trash",value:n})}updateSpell(t,e){let n=e.path.split(".");n.length===1?this.sheet.spells[t][e.path]=e.value:n[0]==="binding"&&(this.sheet.spells[t].binding||(this.sheet.spells[t].binding={type:"learned"}),this.sheet.spells[t].binding[n[1]]=e.value),this.sheet.spells=[...this.sheet.spells],this.patch.emit({path:`spells.${t}.${e.path}`,value:e.value})}onDragStarted(t){let n=t.source.element.nativeElement.getBoundingClientRect();this.placeholderHeight=`${n.height}px`,this.placeholderWidth=`${n.width}px`}onDrop(t){let e=t.previousIndex,n=t.currentIndex;if(e===n)return;let i=[...this.sheet.spells];be(i,e,n),this.sheet.spells=i,this.patch.emit({path:"spells",value:i})}onEditingChange(t,e){this.editingChange.emit({index:t,isEditing:e})}isSpellEditing(t){return this.editingSpells.has(t)}static \u0275fac=function(e){return new(e||r)(K(ie))};static \u0275cmp=F({type:r,selectors:[["app-spells"]],inputs:{sheet:"sheet",editingSpells:"editingSpells"},outputs:{patch:"patch",editingChange:"editingChange"},decls:28,vars:7,consts:[[1,"spells-header"],[1,"header-left"],[1,"fokus-container"],[1,"fokus-display"],[1,"fokus-label"],[1,"fokus-value"],[1,"fokus-inputs"],[1,"fokus-input-group"],["type","number","step","1",3,"ngModelChange","ngModel"],["type","number","step","0.1","min","0",3,"ngModelChange","ngModel"],[1,"add-btn",3,"click"],["cdkDropList","",1,"spells-list",3,"cdkDropListDropped"],["cdkDrag","",3,"cdkDragDisabled"],[1,"empty-message"],[1,"dialog-overlay"],["cdkDrag","",3,"cdkDragStarted","cdkDragDisabled"],[3,"patch","delete","editingChange","spell","sheet","index","isEditing"],["class","drag-placeholder-wrapper",3,"height","width",4,"cdkDragPlaceholder"],[1,"drag-placeholder-wrapper"],[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],[3,"create","cancel","sheet"]],template:function(e,n){e&1&&(a(0,"app-card")(1,"div",0)(2,"div",1)(3,"h2"),l(4,"Spells"),s(),a(5,"div",2)(6,"div",3)(7,"span",4),l(8,"Fokus:"),s(),a(9,"span",5),l(10),s()(),a(11,"div",6)(12,"div",6)(13,"div",7)(14,"label"),l(15,"+"),s(),a(16,"input",8),g("ngModelChange",function(o){return n.updateFokusSetting("fokusBonus",o)}),s()(),a(17,"div",7)(18,"label"),l(19,"\xD7"),s(),a(20,"input",9),g("ngModelChange",function(o){return n.updateFokusSetting("fokusMultiplier",o)}),s()()()()()(),a(21,"button",10),g("click",function(){return n.openCreateDialog()}),l(22,"+ Add Spell"),s()(),a(23,"div",11),g("cdkDropListDropped",function(o){return n.onDrop(o)}),I(24,Kr,3,5,"div",12,ue),f(26,Zr,2,0,"p",13),s(),f(27,Qr,5,1,"div",14),s()),e&2&&(c(10),M(n.fokusValue),c(6),b("ngModel",n.sheet.fokusBonus),c(4),b("ngModel",n.sheet.fokusMultiplier),c(4),V(n.sheet.spells||Z(5,co)),c(2),C((n.sheet.spells||Z(6,co)).length===0?26:-1),c(),C(n.showCreateDialog?27:-1))},dependencies:[A,ki,Q,tn,me,ve,xe,Oe,q,Y,oe,G,Pe,U],styles:["[_nghost-%COMP%]{display:block;padding:1rem}.spells-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;gap:1rem}.header-left[_ngcontent-%COMP%]{flex:1}.spells-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem}.fokus-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.fokus-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.fokus-label[_ngcontent-%COMP%]{font-size:.95rem;color:#666;font-weight:500}.fokus-value[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#673ab7;min-width:40px}.fokus-inputs[_ngcontent-%COMP%]{display:flex;gap:.5rem}.fokus-input-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.fokus-input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#666}.fokus-input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:60px;padding:.3rem .5rem;border:1px solid var(--border);border-radius:4px;font-size:.85rem;text-align:center}.fokus-input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#673ab7}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background-color:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:.9rem;transition:background-color .2s;white-space:nowrap;align-self:flex-start}.add-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.spells-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;min-height:100px}.empty-message[_ngcontent-%COMP%]{text-align:center;color:#666;padding:2rem;font-style:italic}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.dialog-content[_ngcontent-%COMP%]{background:var(--card);padding:2rem;border-radius:8px;max-width:700px;width:90%;max-height:90vh;overflow-y:auto}.dialog-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;box-shadow:0 5px 15px #0000004d;opacity:.8}.drag-placeholder-wrapper[_ngcontent-%COMP%]{background:#f5f5f5;border:2px dashed #ccc;border-radius:6px;box-sizing:border-box}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var ea=["canvas"];function ta(r,t){if(r&1){let e=y();a(0,"button",39),g("click",function(){let i=m(e).$implicit,o=d(3);return u(o.selectColor(i))}),s()}if(r&2){let e=t.$implicit,n=d(3);z("background",e)("border-color",e==="#ffffff"?"#666":e),T("active",n.strokeColor===e),b("title",e)}}function na(r,t){if(r&1){let e=y();a(0,"div",23)(1,"div",34),I(2,ta,1,7,"button",35,te),a(4,"label",36)(5,"input",37),g("input",function(i){m(e);let o=d(2);return u(o.onColorInput(i))}),s(),W(6,"span",38),s()()()}if(r&2){let e=d(2);c(2),V(e.presetColors),c(3),b("value",e.strokeColor),c(),z("background",e.strokeColor)}}function ia(r,t){if(r&1){let e=y();a(0,"button",43),g("click",function(){let i=m(e).$implicit,o=d(3);return u(o.selectEraserSize(i))}),W(1,"span",44),s()}if(r&2){let e=t.$implicit,n=d(3);T("active",n.eraserSize===e),b("title",e+"px"),c(),z("width",n.Math.min(e,24),"px")("height",n.Math.min(e,24),"px")}}function oa(r,t){if(r&1&&(a(0,"div",23)(1,"span",40),l(2,"Eraser Size:"),s(),a(3,"div",41),I(4,ia,2,7,"button",42,te),s()()),r&2){let e=d(2);c(4),V(e.eraserSizes)}}function ra(r,t){if(r&1){let e=y();a(0,"div",1)(1,"div",15)(2,"h3"),l(3),s(),a(4,"button",16),g("click",function(){m(e);let i=d();return u(i.closeFullscreenDrawing())}),l(5,"\u2715 Close"),s()(),a(6,"div",17)(7,"div",18)(8,"div",19)(9,"button",20),g("click",function(){m(e);let i=d();return u(i.setDrawMode())}),a(10,"span",21),l(11,"\u270F\uFE0F"),s()(),a(12,"button",22),g("click",function(){m(e);let i=d();return u(i.toggleEraser())}),a(13,"span",21),l(14,"\u{1F9F9}"),s()()(),f(15,na,7,3,"div",23),f(16,oa,6,0,"div",23),a(17,"div",24)(18,"button",25),g("click",function(){m(e);let i=d();return u(i.undo())}),a(19,"span",21),l(20,"\u21B6"),s(),l(21," Undo "),s(),a(22,"button",26),g("click",function(){m(e);let i=d();return u(i.clearCanvas())}),a(23,"span",21),l(24,"\u{1F5D1}\uFE0F"),s(),l(25," Clear "),s()()(),a(26,"div",27)(27,"button",28),g("click",function(){m(e);let i=d();return u(i.expandTop())}),l(28,"\u25B2"),s(),a(29,"button",29),g("click",function(){m(e);let i=d();return u(i.expandLeft())}),l(30,"\u25C4"),s(),a(31,"button",30),g("click",function(){m(e);let i=d();return u(i.expandRight())}),l(32,"\u25BA"),s(),a(33,"button",31),g("click",function(){m(e);let i=d();return u(i.expandBottom())}),l(34,"\u25BC"),s(),a(35,"div",32)(36,"canvas",33,0),g("pointerdown",function(i){m(e);let o=d();return u(o.startDrawing(i))})("pointermove",function(i){m(e);let o=d();return u(o.draw(i))})("pointerup",function(){m(e);let i=d();return u(i.stopDrawing())})("pointerleave",function(){m(e);let i=d();return u(i.stopDrawing())})("pointercancel",function(){m(e);let i=d();return u(i.stopDrawing())}),s()()()()()}if(r&2){let e=d();c(3),D("\u2728 ",e.newRune.drawing?"Edit":"Create"," Rune Drawing"),c(6),T("active",!e.isErasing()),c(3),T("active",e.isErasing()),c(3),C(e.isErasing()?-1:15),c(),C(e.isErasing()?16:-1),c(19),T("panning",e.isPanning()),c(),he("width",e.canvasWidth())("height",e.canvasHeight())}}function aa(r,t){if(r&1&&(a(0,"div",6),W(1,"img",45),re(2,"imageUrl"),s()),r&2){let e=d();c(),b("src",ce(2,1,e.newRune.drawing),Se)}}function sa(r,t){if(r&1){let e=y();a(0,"button",46),g("click",function(){let i=m(e).$implicit,o=d();return u(o.toggleTag(i))}),l(1),s()}if(r&2){let e=t.$implicit,n=d();T("selected",n.hasTag(e)),c(),D(" ",e," ")}}var on=class r{constructor(t,e){this.imageService=t;this.cd=e}canvasRef;create=new v;cancel=new v;newRune={name:"",description:"",drawing:"",tags:[],strokeColor:"#8b5cf6"};strokeColor="#8b5cf6";tagOptions=Pi;hasDrawing=!1;canvasWidth=B(400);canvasHeight=B(400);isErasing=B(!1);isPanning=B(!1);isFullscreenDrawing=B(!1);presetColors=["#ff0000","#ff6600","#ffcc00","#00ff00","#00ffff","#0066ff","#6600ff","#ff00ff","#ffffff","#000000"];eraserSizes=[10,20,30,40];eraserSize=20;Math=Math;ctx;isDrawing=!1;lastX=0;lastY=0;expandAmount=200;undoHistory=[];maxUndoSteps=20;panStartX=0;panStartY=0;ngOnInit(){document.addEventListener("keydown",this.handleKeyDown.bind(this))}ngOnDestroy(){document.removeEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(t){(t.ctrlKey||t.metaKey)&&t.key==="z"&&this.isDrawing===!1&&(t.preventDefault(),this.undo())}canvasInitialized=!1;ngAfterViewInit(){this.tryInitCanvas()}ngAfterViewChecked(){this.tryInitCanvas()}tryInitCanvas(){this.hasDrawing&&this.canvasRef&&!this.canvasInitialized?(this.initCanvas(),this.canvasInitialized=!0):this.hasDrawing||(this.canvasInitialized=!1)}toggleDrawing(){this.hasDrawing=!this.hasDrawing,this.canvasInitialized=!1,this.hasDrawing?setTimeout(()=>this.openFullscreenDrawing(),0):this.newRune.drawing=""}openFullscreenDrawing(){this.hasDrawing&&(this.isFullscreenDrawing.set(!0),this.canvasInitialized=!1,this.cd.detectChanges(),setTimeout(()=>{this.canvasRef&&(this.initCanvas(),this.newRune.drawing&&this.loadDrawing(this.newRune.drawing),this.cd.detectChanges())},0))}async closeFullscreenDrawing(){if(this.hasDrawing&&this.canvasRef){let e=this.canvasRef.nativeElement.toDataURL("image/png"),n=await this.imageService.uploadImage(e);this.newRune.drawing=n}else this.hasDrawing||(this.newRune.drawing="");this.isFullscreenDrawing.set(!1)}loadDrawing(t){if(!this.ctx)return;let e=new Image;e.onload=()=>{this.ctx&&(this.ctx.clearRect(0,0,this.canvasWidth(),this.canvasHeight()),this.ctx.drawImage(e,0,0))};let n=this.imageService.getImageUrl(t);n&&(e.src=n)}initCanvas(){if(!this.canvasRef)return;let t=this.canvasRef.nativeElement;this.ctx=t.getContext("2d"),this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.clearCanvas(),this.saveToHistory()}updateStrokeColor(t){this.strokeColor=t,this.newRune.strokeColor=t,this.ctx&&(this.ctx.strokeStyle=t,this.ctx.shadowColor=t)}startDrawing(t){if(t.button===1){t.preventDefault();let e=this.canvasRef.nativeElement.parentElement;e&&(this.isPanning.set(!0),this.panStartX=e.scrollLeft+t.clientX,this.panStartY=e.scrollTop+t.clientY);return}if(t.button===0){this.isDrawing=!0;let e=this.canvasRef.nativeElement.getBoundingClientRect();this.lastX=t.clientX-e.left,this.lastY=t.clientY-e.top,this.saveToHistory()}}draw(t){if(this.isPanning()){let p=this.canvasRef.nativeElement.parentElement;p&&(p.scrollLeft=this.panStartX-t.clientX,p.scrollTop=this.panStartY-t.clientY);return}if(!this.isDrawing)return;let e=this.canvasRef.nativeElement.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;this.isErasing()?(this.ctx.globalCompositeOperation="destination-out",this.ctx.lineWidth=this.eraserSize,this.ctx.shadowBlur=0):(this.ctx.globalCompositeOperation="source-over",this.ctx.lineWidth=2),(this.isErasing()?[0]:[30,20,10,5]).forEach(p=>{this.ctx.shadowBlur=p,this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(n,i),this.ctx.stroke()}),this.lastX=n,this.lastY=i}stopDrawing(){this.isDrawing=!1,this.isPanning.set(!1)}clearCanvas(){this.canvasWidth.set(400),this.canvasHeight.set(400),requestAnimationFrame(()=>{let t=this.canvasRef.nativeElement;this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.ctx.lineWidth=2,this.undoHistory=[],this.saveToHistory()})}toggleEraser(){this.isErasing.set(!this.isErasing())}setDrawMode(){this.isErasing.set(!1)}selectColor(t){this.strokeColor=t,this.newRune.strokeColor=t,this.ctx&&(this.ctx.strokeStyle=t,this.ctx.shadowColor=t)}onColorInput(t){let e=t.target;this.selectColor(e.value)}selectEraserSize(t){this.eraserSize=t}expandLeft(){this.expandCanvas("left")}expandRight(){this.expandCanvas("right")}expandTop(){this.expandCanvas("top")}expandBottom(){this.expandCanvas("bottom")}expandCanvas(t){let e=this.canvasRef.nativeElement,n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width,n.height=e.height,i.drawImage(e,0,0);let o=this.canvasWidth(),p=this.canvasHeight(),h=o,_=p,x=0,O=0;switch(t){case"left":h=o+this.expandAmount,x=this.expandAmount;break;case"right":h=o+this.expandAmount;break;case"top":_=p+this.expandAmount,O=this.expandAmount;break;case"bottom":_=p+this.expandAmount;break}this.canvasWidth.set(h),this.canvasHeight.set(_),requestAnimationFrame(()=>{let R=this.canvasRef.nativeElement;this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,R.width,R.height),this.ctx.drawImage(n,x,O),this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.ctx.lineWidth=2})}saveToHistory(){let t=this.canvasRef.nativeElement,e=this.ctx.getImageData(0,0,t.width,t.height);this.undoHistory.push(e),this.undoHistory.length>this.maxUndoSteps&&this.undoHistory.shift()}undo(){if(this.undoHistory.length<2)return;this.undoHistory.pop();let t=this.undoHistory[this.undoHistory.length-1];t&&(this.ctx.putImageData(t,0,0),this.ctx.strokeStyle=this.strokeColor,this.ctx.shadowColor=this.strokeColor,this.ctx.shadowBlur=20,this.ctx.lineWidth=2)}toggleTag(t){this.newRune.tags.indexOf(t)>-1?this.newRune.tags=this.newRune.tags.filter(n=>n!==t):this.newRune.tags=[...this.newRune.tags,t]}hasTag(t){return this.newRune.tags.includes(t)}async createRune(){if(!this.newRune.name.trim()){alert("Rune name is required");return}let e=this.canvasRef.nativeElement.toDataURL("image/png");this.newRune.drawing=await this.imageService.uploadImage(e),this.create.emit(ee({},this.newRune)),this.newRune={name:"",description:"",drawing:"",tags:[]},this.clearCanvas()}cancelCreate(){this.cancel.emit()}static \u0275fac=function(e){return new(e||r)(K(et),K(ie))};static \u0275cmp=F({type:r,selectors:[["app-rune-creator"]],viewQuery:function(e,n){if(e&1&&Te(ea,5),e&2){let i;Re(i=Ie())&&(n.canvasRef=i.first)}},outputs:{create:"create",cancel:"cancel"},decls:27,vars:5,consts:[["canvas",""],[1,"fullscreen-overlay"],[1,"creator-form",3,"ngSubmit"],[1,"field"],["for","name"],["id","name","type","text","name","name","placeholder","Enter rune name","required","",3,"ngModelChange","ngModel"],[1,"drawing-preview"],["type","button",1,"edit-drawing-btn",3,"click"],["for","description"],["id","description","name","description","rows","4","placeholder","Describe the rune's power...",3,"ngModelChange","ngModel"],[1,"tag-selector"],["type","button",1,"tag-option",3,"selected"],[1,"button-group"],["type","submit",1,"create-btn"],["type","button",1,"cancel-btn",3,"click"],[1,"fullscreen-header"],["type","button",1,"close-fullscreen-btn",3,"click"],[1,"fullscreen-content"],[1,"drawing-toolbar"],[1,"toolbar-section","tools"],["type","button","title","Draw Mode",1,"toolbar-btn",3,"click"],[1,"btn-icon"],["type","button","title","Eraser Mode",1,"toolbar-btn",3,"click"],[1,"toolbar-section","brush-settings"],[1,"toolbar-section","actions"],["type","button","title","Undo (Ctrl+Z)",1,"action-btn",3,"click"],["type","button","title","Clear Drawing",1,"action-btn","clear",3,"click"],[1,"canvas-area"],["type","button","title","Expand Top",1,"expand-btn","expand-top",3,"click"],["type","button","title","Expand Left",1,"expand-btn","expand-left",3,"click"],["type","button","title","Expand Right",1,"expand-btn","expand-right",3,"click"],["type","button","title","Expand Bottom",1,"expand-btn","expand-bottom",3,"click"],[1,"fullscreen-canvas-wrapper"],[3,"pointerdown","pointermove","pointerup","pointerleave","pointercancel"],[1,"color-picker"],["type","button",1,"color-swatch",3,"active","background","border-color","title"],["title","Custom Color",1,"custom-color"],["type","color",3,"input","value"],[1,"custom-color-preview"],["type","button",1,"color-swatch",3,"click","title"],[1,"setting-label"],[1,"size-picker"],["type","button",1,"size-btn",3,"active","title"],["type","button",1,"size-btn",3,"click","title"],[1,"size-dot"],["alt","Rune drawing",3,"src"],["type","button",1,"tag-option",3,"click"]],template:function(e,n){e&1&&(f(0,ra,38,11,"div",1),a(1,"form",2),g("ngSubmit",function(){return n.createRune()}),a(2,"div",3)(3,"label",4),l(4,"Rune Name *"),s(),a(5,"input",5),E("ngModelChange",function(o){return P(n.newRune.name,o)||(n.newRune.name=o),o}),s()(),a(6,"div",3)(7,"label"),l(8,"Draw Rune"),s(),f(9,aa,3,3,"div",6),a(10,"button",7),g("click",function(){return n.openFullscreenDrawing()}),l(11),s()(),a(12,"div",3)(13,"label",8),l(14,"Description"),s(),a(15,"textarea",9),E("ngModelChange",function(o){return P(n.newRune.description,o)||(n.newRune.description=o),o}),s()(),a(16,"div",3)(17,"label"),l(18,"Tags"),s(),a(19,"div",10),I(20,sa,2,3,"button",11,te),s()(),a(22,"div",12)(23,"button",13),l(24,"Create"),s(),a(25,"button",14),g("click",function(){return n.cancelCreate()}),l(26,"Cancel"),s()()()),e&2&&(C(n.hasDrawing&&n.isFullscreenDrawing()?0:-1),c(5),k("ngModel",n.newRune.name),c(4),C(n.newRune.drawing?9:-1),c(2),D(" \u{1F4DD} ",n.newRune.drawing?"Edit":"Create"," Drawing in Fullscreen "),c(4),k("ngModel",n.newRune.description),c(5),V(n.tagOptions))},dependencies:[A,q,Ze,Y,G,Je,Qe,U,Ke,Ee],styles:[".creator-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:.6rem;border:1px solid var(--border);border-radius:4px;font-family:inherit;font-size:.95rem}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent)}.field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.drawing-toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap;gap:1rem;padding:.5rem 1rem;background:var(--card);border:1px solid var(--border);border-radius:8px;margin-bottom:.5rem}.toolbar-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.toolbar-section.tools[_ngcontent-%COMP%]{background:var(--bg);padding:.25rem;border-radius:8px}.toolbar-btn[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:8px;background:transparent;border:1px solid transparent;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.toolbar-btn[_ngcontent-%COMP%]:hover{background:var(--border)}.toolbar-btn.active[_ngcontent-%COMP%]{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 0 10px #8b5cf666}.btn-icon[_ngcontent-%COMP%]{font-size:1.4rem}.brush-settings[_ngcontent-%COMP%]{background:var(--bg);padding:.5rem;border-radius:8px;gap:1rem}.setting-label[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text);font-weight:500}.color-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.color-swatch[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:50%;border:2px solid transparent;cursor:pointer;transition:all .2s}.color-swatch[_ngcontent-%COMP%]:hover{transform:scale(1.15)}.color-swatch.active[_ngcontent-%COMP%]{border-color:#fff;box-shadow:0 0 0 2px var(--accent);transform:scale(1.1)}.custom-color[_ngcontent-%COMP%]{position:relative;width:28px;height:28px;cursor:pointer}.custom-color[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}.custom-color-preview[_ngcontent-%COMP%]{display:block;width:100%;height:100%;border-radius:50%;border:2px dashed var(--border);background:conic-gradient(red,#ff0,#0f0,#0ff,#00f,#f0f,red)}.size-picker[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.size-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;background:transparent;border:1px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.size-btn[_ngcontent-%COMP%]:hover{background:var(--border)}.size-btn.active[_ngcontent-%COMP%]{background:var(--accent);border-color:var(--accent)}.size-dot[_ngcontent-%COMP%]{border-radius:50%;background:var(--text);max-width:24px;max-height:24px}.size-btn.active[_ngcontent-%COMP%]   .size-dot[_ngcontent-%COMP%]{background:#fff}.toolbar-section.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.action-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--bg);border:1px solid var(--border);border-radius:6px;cursor:pointer;font-size:.9rem;color:var(--text);transition:all .2s;display:flex;align-items:center;gap:.25rem}.action-btn[_ngcontent-%COMP%]:hover{background:var(--border)}.action-btn.clear[_ngcontent-%COMP%]:hover{background:#f44;color:#fff;border-color:#f44}.canvas-area[_ngcontent-%COMP%]{position:relative;display:inline-block;margin:1rem 0;padding:25px}.expand-btn[_ngcontent-%COMP%]{position:absolute;background:var(--card);border:2px solid var(--border);border-radius:6px;cursor:pointer;font-size:1.2rem;transition:all .2s;color:var(--text);z-index:10;padding:.4rem;display:flex;align-items:center;justify-content:center;min-width:36px;min-height:36px}.expand-btn[_ngcontent-%COMP%]:hover{background:var(--accent);color:#fff;border-color:var(--accent);transform:scale(1.1)}.expand-btn.expand-top[_ngcontent-%COMP%]{top:-20px;left:50%;transform:translate(-50%)}.expand-btn.expand-bottom[_ngcontent-%COMP%]{bottom:-20px;left:50%;transform:translate(-50%)}.expand-btn.expand-left[_ngcontent-%COMP%]{left:-20px;top:50%;transform:translateY(-50%)}.expand-btn.expand-right[_ngcontent-%COMP%]{right:-20px;top:50%;transform:translateY(-50%)}.expand-btn.expand-top[_ngcontent-%COMP%]:hover, .expand-btn.expand-bottom[_ngcontent-%COMP%]:hover{transform:translate(-50%) scale(1.1)}.expand-btn.expand-left[_ngcontent-%COMP%]:hover, .expand-btn.expand-right[_ngcontent-%COMP%]:hover{transform:translateY(-50%) scale(1.1)}.canvas-container[_ngcontent-%COMP%]{border:2px solid var(--border);background:#000;display:inline-block;border-radius:8px;overflow:auto;max-width:100%;max-height:70vh;box-shadow:0 2px 4px #0000001a;touch-action:none}.canvas-container.panning[_ngcontent-%COMP%]{cursor:grab}.canvas-container.panning[_ngcontent-%COMP%]:active{cursor:grabbing}canvas[_ngcontent-%COMP%]{display:block;cursor:crosshair;background:#000;touch-action:none}.canvas-container[_ngcontent-%COMP%]{border:2px solid var(--border);border-radius:4px;display:inline-block;background:var(--card);cursor:crosshair}canvas[_ngcontent-%COMP%]{display:block;touch-action:none}.clear-btn[_ngcontent-%COMP%]{margin-top:.5rem;padding:.4rem .8rem;background:#f5f5f5;border:1px solid var(--border);border-radius:4px;cursor:pointer;font-size:.85rem;transition:all .2s}.clear-btn[_ngcontent-%COMP%]:hover{background:#e0e0e0}.tag-selector[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.tag-option[_ngcontent-%COMP%]{padding:.4rem .8rem;background:#f5f5f5;border:1px solid var(--border);border-radius:4px;cursor:pointer;font-size:.85rem;transition:all .2s}.tag-option[_ngcontent-%COMP%]:hover{background:#e0e0e0}.tag-option.selected[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2;border-color:#90caf9}.color-picker[_ngcontent-%COMP%]{width:100%;height:48px;border:2px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s}.color-picker[_ngcontent-%COMP%]:hover{border-color:var(--accent);box-shadow:0 0 8px #8b5cf64d}.button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.75rem;border:none;border-radius:4px;cursor:pointer;font-size:.95rem;font-weight:500;transition:all .2s}.create-btn[_ngcontent-%COMP%]{background-color:var(--accent);color:#fff}.create-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.cancel-btn[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.fullscreen-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000f2;z-index:10000;display:flex;flex-direction:column}.fullscreen-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:#ffffff1a;border-bottom:1px solid rgba(255,255,255,.2)}.fullscreen-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:1.5rem}.close-fullscreen-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:#ff5252;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:600;transition:all .2s}.close-fullscreen-btn[_ngcontent-%COMP%]:hover{background:#ff1744;transform:translateY(-1px);box-shadow:0 4px 8px #ff525266}.fullscreen-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;padding:2rem;overflow:auto;width:100%}.fullscreen-canvas-wrapper[_ngcontent-%COMP%]{background:#000;border:2px solid rgba(255,255,255,.3);border-radius:8px;overflow:auto;max-width:95vw;max-height:calc(95vh - 150px);box-shadow:0 8px 32px #0009}.fullscreen-canvas-wrapper[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:block;cursor:crosshair;touch-action:none}.fullscreen-canvas-wrapper.panning[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{cursor:grab}.fullscreen-canvas-wrapper.panning[_ngcontent-%COMP%]:active   canvas[_ngcontent-%COMP%]{cursor:grabbing}.drawing-preview[_ngcontent-%COMP%]{margin-bottom:1rem;border:2px solid var(--border);border-radius:8px;padding:1rem;background:#000;max-width:300px}.drawing-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;display:block}.edit-drawing-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:1rem;font-weight:600;transition:all .2s}.edit-drawing-btn[_ngcontent-%COMP%]:hover{background:var(--accentdark);transform:translateY(-1px);box-shadow:0 4px 8px #8b5cf64d}.checkbox-field[_ngcontent-%COMP%]{margin-bottom:.5rem}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;font-weight:400!important;font-size:.95rem}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;margin:0}.checkbox-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"]})};var po=()=>[];function la(r,t){if(r&1&&W(0,"div",9),r&2){let e=d(2);z("height",e.placeholderHeight)("width",e.placeholderWidth)}}function ca(r,t){if(r&1){let e=y();a(0,"div",6),g("cdkDragStarted",function(i){m(e);let o=d();return u(o.onDragStarted(i))}),a(1,"app-rune",7),g("patch",function(i){let o=m(e).$index,p=d();return u(p.updateRune(o,i))})("delete",function(){let i=m(e).$index,o=d();return u(o.deleteRune(i))})("editingChange",function(i){let o=m(e).$index,p=d();return u(p.onEditingChange(o,i))}),s(),ge(2,la,1,4,"div",8),s()}if(r&2){let e=t.$implicit,n=t.$index,i=d();b("cdkDragDisabled",i.isRuneEditing(n)),c(),b("rune",e)("index",n)("isEditing",i.isRuneEditing(n))}}function da(r,t){r&1&&(a(0,"p",4),l(1,"No runes yet. Click + to add one."),s())}function pa(r,t){if(r&1){let e=y();a(0,"div",10),g("click",function(){m(e);let i=d();return u(i.closeCreateDialog())}),a(1,"div",11),g("click",function(i){return m(e),u(i.stopPropagation())}),a(2,"h3"),l(3,"Create New Rune"),s(),a(4,"app-rune-creator",12),g("create",function(i){m(e);let o=d();return u(o.createRune(i))})("cancel",function(){m(e);let i=d();return u(i.closeCreateDialog())}),s()()()}}var rn=class r{sheet;editingRunes;patch=new v;editingChange=new v;showCreateDialog=!1;placeholderHeight="90px";placeholderWidth="100%";ngOnInit(){this.sheet.runes||(this.sheet.runes=[])}openCreateDialog(){this.showCreateDialog=!0}closeCreateDialog(){this.showCreateDialog=!1}createRune(t){this.sheet.runes=[...this.sheet.runes,t],this.patch.emit({path:"runes",value:this.sheet.runes}),this.closeCreateDialog()}deleteRune(t){this.sheet.runes=this.sheet.runes.filter((e,n)=>n!==t),this.patch.emit({path:"runes",value:this.sheet.runes})}updateRune(t,e){let n=e.path;this.sheet.runes[t][n]=e.value,this.sheet.runes=[...this.sheet.runes],this.patch.emit({path:`runes.${t}.${e.path}`,value:e.value})}onDragStarted(t){let n=t.source.element.nativeElement.getBoundingClientRect();this.placeholderHeight=`${n.height}px`,this.placeholderWidth=`${n.width}px`}onDrop(t){let e=t.previousIndex,n=t.currentIndex;if(e===n)return;let i=[...this.sheet.runes];be(i,e,n),this.sheet.runes=i,this.patch.emit({path:"runes",value:i})}onEditingChange(t,e){this.editingChange.emit({index:t,isEditing:e})}isRuneEditing(t){return this.editingRunes?this.editingRunes.has(t):!1}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-runes"]],inputs:{sheet:"sheet",editingRunes:"editingRunes"},outputs:{patch:"patch",editingChange:"editingChange"},decls:11,vars:4,consts:[[1,"runes-header"],[1,"add-btn",3,"click"],["cdkDropList","",1,"runes-list",3,"cdkDropListDropped"],["cdkDrag","",3,"cdkDragDisabled"],[1,"empty-message"],[1,"dialog-overlay"],["cdkDrag","",3,"cdkDragStarted","cdkDragDisabled"],[3,"patch","delete","editingChange","rune","index","isEditing"],["class","drag-placeholder-wrapper",3,"height","width",4,"cdkDragPlaceholder"],[1,"drag-placeholder-wrapper"],[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],[3,"create","cancel"]],template:function(e,n){e&1&&(a(0,"app-card")(1,"div",0)(2,"h2"),l(3,"Runes"),s(),a(4,"button",1),g("click",function(){return n.openCreateDialog()}),l(5,"+ Add Rune"),s()(),a(6,"div",2),g("cdkDropListDropped",function(o){return n.onDrop(o)}),I(7,ca,3,4,"div",3,ue),f(9,da,2,0,"p",4),s(),f(10,pa,5,0,"div",5),s()),e&2&&(c(7),V(n.sheet.runes||Z(2,po)),c(2),C((n.sheet.runes||Z(3,po)).length===0?9:-1),c(),C(n.showCreateDialog?10:-1))},dependencies:[A,Ei,Q,on,me,ve,xe,Oe],styles:["[_nghost-%COMP%]{display:block;padding:1rem}.runes-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.runes-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background-color:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:.9rem;transition:background-color .2s;white-space:nowrap}.add-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.runes-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;min-height:100px}.empty-message[_ngcontent-%COMP%]{text-align:center;color:var(--muted);padding:2rem;font-style:italic}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.dialog-content[_ngcontent-%COMP%]{background:var(--card);padding:2rem;border-radius:8px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}.dialog-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;box-shadow:0 5px 15px #0000004d;opacity:.8}.drag-placeholder-wrapper[_ngcontent-%COMP%]{background:var(--bg);border:2px dashed var(--border);border-radius:6px;box-sizing:border-box}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var an=class r{create=new v;cancel=new v;newSkill={name:"",class:"",description:"",type:"active",enlightened:!1,statModifiers:[]};tempModifiers={strength:0,dexterity:0,speed:0,intelligence:0,constitution:0,chill:0,mana:0,life:0,energy:0};createSkill(){if(!this.newSkill.name.trim()){alert("Skill name is required");return}let t=[];Object.entries(this.tempModifiers).forEach(([n,i])=>{i!==0&&t.push({stat:n,amount:i})});let e=De(ee({},this.newSkill),{statModifiers:t.length>0?t:void 0});this.create.emit(e),this.newSkill={name:"",class:"",description:"",type:"active",enlightened:!1,statModifiers:[]},this.tempModifiers={strength:0,dexterity:0,speed:0,intelligence:0,constitution:0,chill:0,mana:0,life:0,energy:0}}cancelCreate(){this.cancel.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-skill-creator"]],outputs:{create:"create",cancel:"cancel"},decls:74,vars:14,consts:[[1,"creator-form",3,"ngSubmit"],[1,"field"],["for","name"],["id","name","type","text","name","name","placeholder","Enter skill name","required","",3,"ngModelChange","ngModel"],["for","class"],["id","class","type","text","name","class","placeholder","e.g., Warrior, Mage",3,"ngModelChange","ngModel"],["for","type"],["id","type","name","type",3,"ngModelChange","ngModel"],["value","active"],["value","passive"],["value","dice_bonus"],["value","stat_bonus"],[1,"field","checkbox-field"],["type","checkbox","name","enlightened",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description","rows","4","placeholder","Describe the skill...",3,"ngModelChange","ngModel"],[1,"requirements-section"],[1,"requirements-grid"],[1,"req-field"],["type","number","name","modStrength","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modDexterity","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modSpeed","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modIntelligence","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modConstitution","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modChill","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modMana","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modLife","placeholder","0",3,"ngModelChange","ngModel"],["type","number","name","modEnergy","placeholder","0",3,"ngModelChange","ngModel"],[1,"button-group"],["type","submit",1,"create-btn"],["type","button",1,"cancel-btn",3,"click"]],template:function(e,n){e&1&&(a(0,"form",0),g("ngSubmit",function(){return n.createSkill()}),a(1,"div",1)(2,"label",2),l(3,"Skill Name *"),s(),a(4,"input",3),E("ngModelChange",function(o){return P(n.newSkill.name,o)||(n.newSkill.name=o),o}),s()(),a(5,"div",1)(6,"label",4),l(7,"Class"),s(),a(8,"input",5),E("ngModelChange",function(o){return P(n.newSkill.class,o)||(n.newSkill.class=o),o}),s()(),a(9,"div",1)(10,"label",6),l(11,"Type"),s(),a(12,"select",7),E("ngModelChange",function(o){return P(n.newSkill.type,o)||(n.newSkill.type=o),o}),a(13,"option",8),l(14,"Active"),s(),a(15,"option",9),l(16,"Passive"),s(),a(17,"option",10),l(18,"Dice Bonus"),s(),a(19,"option",11),l(20,"Stat Bonus"),s()()(),a(21,"div",12)(22,"label")(23,"input",13),E("ngModelChange",function(o){return P(n.newSkill.enlightened,o)||(n.newSkill.enlightened=o),o}),s(),l(24," Enlightened "),s()(),a(25,"div",1)(26,"label",14),l(27,"Description"),s(),a(28,"textarea",15),E("ngModelChange",function(o){return P(n.newSkill.description,o)||(n.newSkill.description=o),o}),s()(),a(29,"div",16)(30,"label"),l(31,"Stat Modifiers (Boni/Mali)"),s(),a(32,"div",17)(33,"div",18)(34,"label"),l(35,"STR"),s(),a(36,"input",19),E("ngModelChange",function(o){return P(n.tempModifiers.strength,o)||(n.tempModifiers.strength=o),o}),s()(),a(37,"div",18)(38,"label"),l(39,"DEX"),s(),a(40,"input",20),E("ngModelChange",function(o){return P(n.tempModifiers.dexterity,o)||(n.tempModifiers.dexterity=o),o}),s()(),a(41,"div",18)(42,"label"),l(43,"SPD"),s(),a(44,"input",21),E("ngModelChange",function(o){return P(n.tempModifiers.speed,o)||(n.tempModifiers.speed=o),o}),s()(),a(45,"div",18)(46,"label"),l(47,"INT"),s(),a(48,"input",22),E("ngModelChange",function(o){return P(n.tempModifiers.intelligence,o)||(n.tempModifiers.intelligence=o),o}),s()(),a(49,"div",18)(50,"label"),l(51,"CON"),s(),a(52,"input",23),E("ngModelChange",function(o){return P(n.tempModifiers.constitution,o)||(n.tempModifiers.constitution=o),o}),s()(),a(53,"div",18)(54,"label"),l(55,"CHL"),s(),a(56,"input",24),E("ngModelChange",function(o){return P(n.tempModifiers.chill,o)||(n.tempModifiers.chill=o),o}),s()(),a(57,"div",18)(58,"label"),l(59,"MANA"),s(),a(60,"input",25),E("ngModelChange",function(o){return P(n.tempModifiers.mana,o)||(n.tempModifiers.mana=o),o}),s()(),a(61,"div",18)(62,"label"),l(63,"LEBEN"),s(),a(64,"input",26),E("ngModelChange",function(o){return P(n.tempModifiers.life,o)||(n.tempModifiers.life=o),o}),s()(),a(65,"div",18)(66,"label"),l(67,"AUSD"),s(),a(68,"input",27),E("ngModelChange",function(o){return P(n.tempModifiers.energy,o)||(n.tempModifiers.energy=o),o}),s()()()(),a(69,"div",28)(70,"button",29),l(71,"Create"),s(),a(72,"button",30),g("click",function(){return n.cancelCreate()}),l(73,"Cancel"),s()()()),e&2&&(c(4),k("ngModel",n.newSkill.name),c(4),k("ngModel",n.newSkill.class),c(4),k("ngModel",n.newSkill.type),c(11),k("ngModel",n.newSkill.enlightened),c(5),k("ngModel",n.newSkill.description),c(8),k("ngModel",n.tempModifiers.strength),c(4),k("ngModel",n.tempModifiers.dexterity),c(4),k("ngModel",n.tempModifiers.speed),c(4),k("ngModel",n.tempModifiers.intelligence),c(4),k("ngModel",n.tempModifiers.constitution),c(4),k("ngModel",n.tempModifiers.chill),c(4),k("ngModel",n.tempModifiers.mana),c(4),k("ngModel",n.tempModifiers.life),c(4),k("ngModel",n.tempModifiers.energy))},dependencies:[A,q,Ze,ze,We,Y,oe,Pt,Be,G,Je,Qe,U,Ke],styles:[".creator-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.6rem;border:1px solid var(--border);border-radius:4px;font-family:inherit;font-size:.95rem}.field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4caf50}.field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.checkbox-field[_ngcontent-%COMP%]{flex-direction:row;align-items:center}.checkbox-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer}.checkbox-field[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:auto;cursor:pointer}.button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.5rem}.button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.75rem;border:none;border-radius:4px;cursor:pointer;font-size:.95rem;font-weight:500;transition:all .2s}.create-btn[_ngcontent-%COMP%]{background-color:var(--accent);color:#fff}.create-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.cancel-btn[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333}.cancel-btn[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}"]})};var ma=()=>[],ua=(r,t)=>t.name+t.class;function ga(r,t){if(r&1&&W(0,"div",9),r&2){let e=d(2);z("height",e.placeholderHeight)("width",e.placeholderWidth)}}function ha(r,t){if(r&1){let e=y();a(0,"div",6),g("cdkDragStarted",function(i){m(e);let o=d();return u(o.onDragStarted(i))}),a(1,"app-skill",7),g("patch",function(i){let o=m(e).$implicit,p=d();return u(p.updateSkill(p.getOriginalIndex(o),i))})("delete",function(){let i=m(e).$implicit,o=d();return u(o.deleteSkill(o.getOriginalIndex(i)))})("editingChange",function(i){let o=m(e).$implicit,p=d();return u(p.onEditingChange(p.getOriginalIndex(o),i))}),s(),ge(2,ga,1,4,"div",8),s()}if(r&2){let e=t.$implicit,n=d();b("cdkDragDisabled",n.isSkillEditing(n.getOriginalIndex(e))),c(),b("skill",e)("sheet",n.sheet)("index",n.getOriginalIndex(e))("isEditing",n.isSkillEditing(n.getOriginalIndex(e)))}}function _a(r,t){r&1&&(a(0,"p",4),l(1,"No skills yet. Click + to add one."),s())}function fa(r,t){if(r&1){let e=y();a(0,"div",10),g("click",function(){m(e);let i=d();return u(i.closeCreateDialog())}),a(1,"div",11),g("click",function(i){return m(e),u(i.stopPropagation())}),a(2,"h3"),l(3,"Create New Skill"),s(),a(4,"app-skill-creator",12),g("create",function(i){m(e);let o=d();return u(o.createSkill(i))})("cancel",function(){m(e);let i=d();return u(i.closeCreateDialog())}),s()()()}}var sn=class r{sheet;editingSkills;patch=new v;editingChange=new v;showCreateDialog=!1;placeholderHeight="90px";placeholderWidth="100%";ngOnInit(){this.sheet.skills||(this.sheet.skills=[])}get sortedSkills(){let t={dice_bonus:0,active:1,passive:2,stat_bonus:3};return[...this.sheet.skills].sort((e,n)=>{let i=t[e.type]??4,o=t[n.type]??4;return i-o})}openCreateDialog(){this.showCreateDialog=!0}closeCreateDialog(){this.showCreateDialog=!1}createSkill(t){this.sheet.skills=[...this.sheet.skills,t],this.patch.emit({path:"skills",value:this.sheet.skills}),this.closeCreateDialog()}deleteSkill(t){let e=this.sheet.skills[t];this.sheet.skills=this.sheet.skills.filter((i,o)=>o!==t);let n=this.sheet.trash||[];n.push({type:"skill",data:e,deletedAt:Date.now()}),this.patch.emit({path:"skills",value:this.sheet.skills}),this.patch.emit({path:"trash",value:n})}updateSkill(t,e){let n=e.path;this.sheet.skills[t][n]=e.value,this.sheet.skills=[...this.sheet.skills],this.patch.emit({path:`skills.${t}.${e.path}`,value:e.value})}onDragStarted(t){let n=t.source.element.nativeElement.getBoundingClientRect();this.placeholderHeight=`${n.height}px`,this.placeholderWidth=`${n.width}px`}onDrop(t){let e=t.previousIndex,n=t.currentIndex;if(e===n)return;let i=[...this.sheet.skills];be(i,e,n),this.sheet.skills=i,this.patch.emit({path:"skills",value:i})}onEditingChange(t,e){this.editingChange.emit({index:t,isEditing:e})}isSkillEditing(t){return this.editingSkills.has(t)}getOriginalIndex(t){return this.sheet.skills.indexOf(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-skills"]],inputs:{sheet:"sheet",editingSkills:"editingSkills"},outputs:{patch:"patch",editingChange:"editingChange"},decls:11,vars:3,consts:[[1,"skills-header"],[1,"add-btn",3,"click"],["cdkDropList","",1,"skills-list",3,"cdkDropListDropped"],["cdkDrag","",3,"cdkDragDisabled"],[1,"empty-message"],[1,"dialog-overlay"],["cdkDrag","",3,"cdkDragStarted","cdkDragDisabled"],[3,"patch","delete","editingChange","skill","sheet","index","isEditing"],["class","drag-placeholder-wrapper",3,"height","width",4,"cdkDragPlaceholder"],[1,"drag-placeholder-wrapper"],[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],[3,"create","cancel"]],template:function(e,n){e&1&&(a(0,"app-card")(1,"div",0)(2,"h2"),l(3,"Skills"),s(),a(4,"button",1),g("click",function(){return n.openCreateDialog()}),l(5,"+ Add Skill"),s()(),a(6,"div",2),g("cdkDropListDropped",function(o){return n.onDrop(o)}),I(7,ha,3,5,"div",3,ua),f(9,_a,2,0,"p",4),s(),f(10,fa,5,0,"div",5),s()),e&2&&(c(7),V(n.sortedSkills),c(2),C((n.sheet.skills||Z(2,ma)).length===0?9:-1),c(),C(n.showCreateDialog?10:-1))},dependencies:[A,Oi,Q,an,me,ve,xe,Oe],styles:["[_nghost-%COMP%]{display:block;padding:1rem}.skills-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.skills-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.add-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background-color:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:.9rem;transition:background-color .2s;white-space:nowrap}.add-btn[_ngcontent-%COMP%]:hover{background-color:var(--accentdark)}.skills-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;min-height:100px}.empty-message[_ngcontent-%COMP%]{text-align:center;color:var(--muted);padding:2rem;font-style:italic}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.dialog-content[_ngcontent-%COMP%]{background:var(--card);padding:2rem;border-radius:8px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}.dialog-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;box-shadow:0 5px 15px #0000004d;opacity:.8}.drag-placeholder-wrapper[_ngcontent-%COMP%]{background:var(--bg);border:2px dashed var(--border);border-radius:6px;box-sizing:border-box}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};var bt=()=>[];function Ca(r,t){if(r&1){let e=y();a(0,"app-inventory",9),g("patch",function(i){m(e);let o=d();return u(o.onPatch(i))}),s()}if(r&2){let e=d();b("sheet",e.sheet)}}function ba(r,t){if(r&1){let e=y();a(0,"app-spells",10),g("patch",function(i){m(e);let o=d();return u(o.onPatch(i))})("editingChange",function(i){m(e);let o=d();return u(o.onSpellEditingChange(i))}),s()}if(r&2){let e=d();b("sheet",e.sheet)("editingSpells",e.editingSpells)}}function xa(r,t){if(r&1){let e=y();a(0,"app-runes",11),g("patch",function(i){m(e);let o=d();return u(o.onPatch(i))})("editingChange",function(i){m(e);let o=d();return u(o.onRuneEditingChange(i))}),s()}if(r&2){let e=d();b("sheet",e.sheet)("editingRunes",e.editingRunes)}}function va(r,t){if(r&1){let e=y();a(0,"app-skills",12),g("patch",function(i){m(e);let o=d();return u(o.onPatch(i))})("editingChange",function(i){m(e);let o=d();return u(o.onSkillEditingChange(i))}),s()}if(r&2){let e=d();b("sheet",e.sheet)("editingSkills",e.editingSkills)}}var ln=class r{sheet;editingRunes=new Set;editingSpells=new Set;editingSkills=new Set;patch=new v;runeEditingChange=new v;spellEditingChange=new v;skillEditingChange=new v;openTrash=new v;activeTab="inventory";setActiveTab(t){this.activeTab=t}onRuneEditingChange(t){this.runeEditingChange.emit(t)}onSpellEditingChange(t){this.spellEditingChange.emit(t)}onSkillEditingChange(t){this.skillEditingChange.emit(t)}onPatch(t){this.patch.emit(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-character-tabs"]],inputs:{sheet:"sheet",editingRunes:"editingRunes",editingSpells:"editingSpells",editingSkills:"editingSkills"},outputs:{patch:"patch",runeEditingChange:"runeEditingChange",spellEditingChange:"spellEditingChange",skillEditingChange:"skillEditingChange",openTrash:"openTrash"},decls:17,vars:22,consts:[[1,"character-tabs-container"],[1,"tabs-header"],[1,"tab-button",3,"click"],["title","Open Trash",1,"trash-button",3,"click"],[1,"tab-content"],[3,"sheet"],[3,"sheet","editingSpells"],[3,"sheet","editingRunes"],[3,"sheet","editingSkills"],[3,"patch","sheet"],[3,"patch","editingChange","sheet","editingSpells"],[3,"patch","editingChange","sheet","editingRunes"],[3,"patch","editingChange","sheet","editingSkills"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return n.setActiveTab("inventory")}),l(3),s(),a(4,"button",2),g("click",function(){return n.setActiveTab("spells")}),l(5),s(),a(6,"button",2),g("click",function(){return n.setActiveTab("runes")}),l(7),s(),a(8,"button",2),g("click",function(){return n.setActiveTab("skills")}),l(9),s(),a(10,"button",3),g("click",function(){return n.openTrash.emit()}),l(11," \u{1F5D1}\uFE0F "),s()(),a(12,"div",4),f(13,Ca,1,1,"app-inventory",5),f(14,ba,1,2,"app-spells",6),f(15,xa,1,2,"app-runes",7),f(16,va,1,2,"app-skills",8),s()()),e&2&&(c(2),T("active",n.activeTab==="inventory"),c(),D(" Inventory (",(n.sheet.inventory||Z(17,bt)).length,") "),c(),T("active",n.activeTab==="spells"),c(),D(" Spells (",(n.sheet.spells||Z(18,bt)).length,") "),c(),T("active",n.activeTab==="runes"),c(),D(" Runes (",(n.sheet.runes||Z(19,bt)).length,") "),c(),T("active",n.activeTab==="skills"),c(),D(" Skills (",(n.sheet.skills||Z(20,bt)).length,") "),c(),he("data-count",(n.sheet.trash||Z(21,bt)).length),c(3),C(n.activeTab==="inventory"?13:-1),c(),C(n.activeTab==="spells"?14:-1),c(),C(n.activeTab==="runes"?15:-1),c(),C(n.activeTab==="skills"?16:-1))},dependencies:[A,q,en,nn,rn,sn],styles:['.character-tabs-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;min-height:1050px;max-height:1050px;background:var(--card);border:1px solid var(--border);border-radius:10px;overflow:hidden}.tabs-header[_ngcontent-%COMP%]{display:flex;background:var(--bg);border-bottom:2px solid var(--border);position:relative}.tab-button[_ngcontent-%COMP%]{flex:1;padding:1rem;background:transparent;border:none;border-bottom:3px solid transparent;cursor:pointer;font-weight:600;font-size:14px;color:var(--muted);transition:all .2s}.tab-button[_ngcontent-%COMP%]:hover{background:#6b46c10d;color:var(--accent)}.tab-button.active[_ngcontent-%COMP%]{color:var(--accent);border-bottom-color:var(--accent);background:var(--card)}.trash-button[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:transparent;border:none;cursor:pointer;font-size:1.5rem;transition:all .2s;position:relative;border-left:1px solid var(--border)}.trash-button[_ngcontent-%COMP%]:hover{background:#6b46c10d}.trash-button[_ngcontent-%COMP%]:after{content:attr(data-count);position:absolute;top:8px;right:8px;background:#d32f2f;color:#fff;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;border:2px solid var(--bg)}.trash-button[data-count="0"][_ngcontent-%COMP%]:after{display:none}.tab-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:0;height:100%;min-height:910px;max-height:910px}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--bg)}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}.tab-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:var(--muted)}']})};function ya(r,t){r&1&&(S(0,"div",1),l(1,"P"),w())}function wa(r,t){r&1&&(S(0,"div",2),l(1,"S"),w())}function Sa(r,t){if(r&1&&(S(0,"span",5),l(1),w()),r&2){let e=d();c(),se("",e.learnedCount,"/",e.totalCount)}}function Ma(r,t){if(r&1&&(Ue(),S(0,"svg",6),je(1,"circle",7)(2,"circle",8),w()),r&2){let e=d();c(2),z("stroke",e.tierColor)("stroke-dasharray","289")("stroke-dashoffset",289-289*e.progress/100)}}var mo={1:"#22c55e",2:"#eab308",3:"#ef4444",4:"#a855f7",5:"#3b82f6"},cn=class r{className="";x=0;y=0;tier=1;learnedCount=0;totalCount=0;isSelected=!1;isAccessible=!1;canLearn=!0;editMode=!1;isPrimary=!1;isSecondary=!1;onPath=null;select=new v;dragStart=new v;setPrimary=new v;setSecondary=new v;onClick(){this.editMode||this.select.emit()}onMouseDown(t){this.editMode&&this.dragStart.emit(t)}get progress(){return this.totalCount===0?0:this.learnedCount/this.totalCount*100}get isComplete(){return this.totalCount>0&&this.learnedCount>=this.totalCount}get tierClass(){return`tier-${this.tier}`}get tierColor(){return mo[this.tier]||mo[5]}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-class-node"]],inputs:{className:"className",x:"x",y:"y",tier:"tier",learnedCount:"learnedCount",totalCount:"totalCount",isSelected:"isSelected",isAccessible:"isAccessible",canLearn:"canLearn",editMode:"editMode",isPrimary:"isPrimary",isSecondary:"isSecondary",onPath:"onPath"},outputs:{select:"select",dragStart:"dragStart",setPrimary:"setPrimary",setSecondary:"setSecondary"},decls:8,vars:31,consts:[[1,"class-node",3,"click","mousedown"],[1,"class-badge","primary"],[1,"class-badge","secondary"],[1,"node-content"],[1,"class-name"],[1,"skill-count"],["viewBox","0 0 100 100",1,"progress-ring"],["cx","50","cy","50","r","46","fill","none","stroke-width","4",1,"progress-bg"],["cx","50","cy","50","r","46","fill","none","stroke-width","4",1,"progress-fill"]],template:function(e,n){e&1&&(S(0,"div",0),_e("click",function(){return n.onClick()})("mousedown",function(o){return n.onMouseDown(o)}),f(1,ya,2,0,"div",1),f(2,wa,2,0,"div",2),S(3,"div",3)(4,"span",4),l(5),w(),f(6,Sa,2,2,"span",5),w(),f(7,Ma,3,6,":svg:svg",6),w()),e&2&&(le(n.tierClass),z("left",n.x,"px")("top",n.y,"px")("border-color",n.tierColor),T("selected",n.isSelected)("accessible",n.isAccessible)("complete",n.isComplete)("locked",!n.canLearn)("edit-mode",n.editMode)("is-primary",n.isPrimary)("is-secondary",n.isSecondary)("on-primary-path",n.onPath==="primary")("on-secondary-path",n.onPath==="secondary"),c(),C(n.isPrimary?1:-1),c(),C(n.isSecondary?2:-1),c(3),M(n.className),c(),C(n.totalCount>0?6:-1),c(),C(n.totalCount>0?7:-1))},dependencies:[A],styles:[".class-node[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%,-50%);width:70px;height:70px;border-radius:50%;background:var(--card);border:3px solid var(--border);cursor:pointer;transition:none;display:flex;align-items:center;justify-content:center;z-index:1;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges;transform-origin:center}.class-node[_ngcontent-%COMP%]:hover{transform:translate(-50%,-50%);box-shadow:0 0 15px #60a5fa66,0 0 30px #60a5fa33;filter:brightness(1.15)}.class-node.selected[_ngcontent-%COMP%]{background:var(--accentdark);box-shadow:0 0 20px #60a5fa99,0 0 40px #60a5fa4d;border-color:#60a5fa}.class-node.complete[_ngcontent-%COMP%]{box-shadow:0 0 15px #22c55e4d}.class-node.locked[_ngcontent-%COMP%]{opacity:.5;filter:grayscale(60%) brightness(.7)}.class-node.locked[_ngcontent-%COMP%]:hover{opacity:.7;filter:grayscale(40%) brightness(.8)}.class-node.tier-1[_ngcontent-%COMP%]{width:80px;height:80px;background:linear-gradient(135deg,var(--card) 0%,#2d3748 100%)}.class-node.tier-2[_ngcontent-%COMP%]{width:70px;height:70px}.class-node.tier-3[_ngcontent-%COMP%]{width:65px;height:65px}.class-node.tier-4[_ngcontent-%COMP%], .class-node.tier-5[_ngcontent-%COMP%], .class-node.tier-6[_ngcontent-%COMP%]{width:60px;height:60px}.node-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:.25rem;z-index:2;position:relative;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}.class-name[_ngcontent-%COMP%]{font-size:.6rem;font-weight:600;color:var(--text);line-height:1.1;max-width:55px;overflow:hidden;text-overflow:ellipsis;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility}.tier-1[_ngcontent-%COMP%]   .class-name[_ngcontent-%COMP%]{font-size:.7rem;max-width:65px}.skill-count[_ngcontent-%COMP%]{font-size:.55rem;color:var(--text-muted);margin-top:2px}.class-node.complete[_ngcontent-%COMP%]   .skill-count[_ngcontent-%COMP%]{color:#22c55e}.progress-ring[_ngcontent-%COMP%]{position:absolute;top:-3px;left:-3px;width:calc(100% + 6px);height:calc(100% + 6px);pointer-events:none;transform:rotate(-90deg)}.progress-bg[_ngcontent-%COMP%]{stroke:var(--border);opacity:.3}.progress-fill[_ngcontent-%COMP%]{stroke-linecap:round;transition:stroke-dashoffset .3s ease}.class-node.edit-mode[_ngcontent-%COMP%]{cursor:grab;border-style:dashed}.class-node.edit-mode[_ngcontent-%COMP%]:hover{box-shadow:0 0 20px #3b82f680}.class-node.edit-mode[_ngcontent-%COMP%]:active{cursor:grabbing}.class-node.is-primary[_ngcontent-%COMP%]{box-shadow:0 0 30px #eab308cc,0 0 60px #eab30880,0 0 90px #eab3084d}.class-node.is-secondary[_ngcontent-%COMP%]{box-shadow:0 0 30px #60a5facc,0 0 60px #60a5fa80,0 0 90px #60a5fa4d}.class-node.on-primary-path[_ngcontent-%COMP%]:not(.is-primary){box-shadow:0 0 20px #eab30880,0 0 40px #eab3084d}.class-node.on-secondary-path[_ngcontent-%COMP%]:not(.is-secondary){box-shadow:0 0 20px #60a5fa80,0 0 40px #60a5fa4d}.class-badge[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:700;z-index:10}.class-badge.primary[_ngcontent-%COMP%]{background:#eab308;color:#000;box-shadow:0 0 8px #eab30899}.class-badge.secondary[_ngcontent-%COMP%]{background:#60a5fa;color:#fff;box-shadow:0 0 8px #60a5fa99}"]})};var ka=(r,t)=>t.id;function Pa(r,t){r&1&&l(0," Prim\xE4rklasse ")}function Ea(r,t){r&1&&l(0," Als Prim\xE4rklasse setzen ")}function Oa(r,t){r&1&&l(0," Sekund\xE4rklasse ")}function Da(r,t){r&1&&l(0," Als Sekund\xE4rklasse setzen ")}function Ta(r,t){if(r&1&&(S(0,"div",7),l(1),w()),r&2){let e=d();c(),D(" ",e.getLockedReason()," ")}}function Ra(r,t){r&1&&(S(0,"div",8)(1,"p"),l(2,"Keine Skills f\xFCr diese Klasse definiert."),w()())}function Ia(r,t){if(r&1&&(S(0,"span",15),l(1),w()),r&2){let e=d().$implicit,n=d(2);c(),D("[Stufe ",n.getSkillLevel(e),"]")}}function Va(r,t){r&1&&(S(0,"span",17),l(1,"\u2728"),w())}function Fa(r,t){r&1&&(S(0,"span",18),l(1,"\u221E"),w())}function La(r,t){if(r&1){let e=y();S(0,"button",30),_e("click",function(){m(e);let i=d(3).$implicit,o=d(2);return u(o.onLearn(i))}),l(1," + "),w()}}function Aa(r,t){if(r&1){let e=y();S(0,"span",27),l(1),w(),f(2,La,2,0,"button",28),S(3,"button",29),_e("click",function(){m(e);let i=d(2).$implicit,o=d(2);return u(o.onUnlearn(i))}),l(4," \u2212 "),w()}if(r&2){let e=d(2).$implicit,n=d(2);c(),D("Stufe ",n.getSkillLevel(e)),c(),C(n.canLearn(e)?2:-1)}}function Na(r,t){if(r&1){let e=y();S(0,"span",27),l(1,"Gelernt"),w(),S(2,"button",31),_e("click",function(){m(e);let i=d(2).$implicit,o=d(2);return u(o.onUnlearn(i))}),l(3," \u2715 "),w()}}function Ba(r,t){if(r&1&&(S(0,"div",19),f(1,Aa,5,2)(2,Na,4,0),w()),r&2){let e=d().$implicit;c(),C(e.infiniteLevel?1:2)}}function za(r,t){if(r&1){let e=y();S(0,"button",32),_e("click",function(){m(e);let i=d().$implicit,o=d(2);return u(o.onLearn(i))}),l(1," Lernen (1 Punkt) "),w()}}function Wa(r,t){r&1&&l(0," Gesperrt ")}function Ha(r,t){r&1&&l(0," Keine Punkte ")}function qa(r,t){r&1&&l(0," Voraussetzung fehlt ")}function ja(r,t){if(r&1&&(S(0,"span",21),f(1,Wa,1,0)(2,Ha,1,0)(3,qa,1,0),w()),r&2){let e=d().$implicit,n=d(2);c(),C(n.canLearnFromClass?n.availablePoints<=0?2:e.requiresSkill?3:-1:1)}}function $a(r,t){if(r&1&&(S(0,"div",23),l(1),w()),r&2){let e=d().$implicit,n=d(2);c(),D(" ",n.getStatBonusDisplay(e)," ")}}function Ya(r,t){if(r&1&&(S(0,"div",25),l(1),w()),r&2){let e=d().$implicit,n=d(2);c(),D(" Kosten: ",n.getCostDisplay(e)," ")}}function Ga(r,t){if(r&1&&(S(0,"div",26),l(1),w()),r&2){let e=d().$implicit;c(),D(" Ben\xF6tigt: ",e.requiresSkill," ")}}function Ua(r,t){if(r&1&&(S(0,"div",11)(1,"div",12)(2,"div",13)(3,"span",14),l(4),w(),f(5,Ia,2,1,"span",15),S(6,"span",16),l(7),w(),f(8,Va,2,0,"span",17),f(9,Fa,2,0,"span",18),w(),f(10,Ba,3,1,"div",19)(11,za,2,0,"button",20)(12,ja,4,1,"span",21),w(),S(13,"div",22),f(14,$a,2,1,"div",23),S(15,"p",24),l(16),w(),f(17,Ya,2,1,"div",25),f(18,Ga,2,1,"div",26),w()()),r&2){let e=t.$implicit,n=d(2);T("type-dice-bonus",e.type==="dice_bonus")("type-active",e.type==="active")("type-passive",e.type==="passive")("type-stat-bonus",e.type==="stat_bonus")("learned",n.isLearned(e))("can-learn",n.canLearn(e))("enlightened",e.enlightened)("infinite-level",e.infiniteLevel),c(4),M(e.name),c(),C(e.infiniteLevel&&n.isLearned(e)?5:-1),c(),le(n.getTypeClass(e.type)),c(),D(" ",n.getTypeLabel(e.type)," "),c(),C(e.enlightened?8:-1),c(),C(e.infiniteLevel?9:-1),c(),C(n.isLearned(e)?10:n.canLearn(e)?11:12),c(4),C(e.type==="stat_bonus"&&e.statBonus?14:-1),c(2),M(e.description),c(),C(e.cost&&e.cost.amount>0?17:-1),c(),C(e.requiresSkill?18:-1)}}function Xa(r,t){if(r&1&&(S(0,"div",9),I(1,Ua,19,28,"div",10,ka),w()),r&2){let e=d();c(),V(e.skills)}}var dn=class r{className="";set skills(t){this._skills=this.sortSkills(t)}get skills(){return this._skills}_skills=[];learnedSkillIds=[];availablePoints=0;canLearnFromClass=!0;isPrimaryClass=!1;isSecondaryClass=!1;isTier1Class=!1;learnSkill=new v;unlearnSkill=new v;close=new v;setPrimary=new v;setSecondary=new v;sortSkills(t){let e={dice_bonus:0,active:1,passive:2,stat_bonus:3};return[...t].sort((n,i)=>{let o=e[n.type]??4,p=e[i.type]??4;return o-p})}onSetPrimary(){this.hasLearnedSkill()&&this.setPrimary.emit()}onSetSecondary(){this.hasLearnedSkill()&&this.setSecondary.emit()}hasLearnedSkill(){return this.skills.some(t=>this.isLearned(t))}isLearned(t){return this.learnedSkillIds.includes(t.id)}getSkillLevel(t){return this.learnedSkillIds.filter(e=>e===t.id).length}canLearn(t){if(t.infiniteLevel){if(this.availablePoints<=0||!this.canLearnFromClass)return!1;if(t.requiresSkill){let e=Array.isArray(t.requiresSkill)?t.requiresSkill:[t.requiresSkill];for(let n of e)if(!this.learnedSkillIds.includes(n))return!1}return!0}if(this.isLearned(t)||this.availablePoints<=0||!this.canLearnFromClass)return!1;if(t.requiresSkill){let e=Array.isArray(t.requiresSkill)?t.requiresSkill:[t.requiresSkill];for(let n of e)if(!this.learnedSkillIds.includes(n))return!1}return!0}onLearn(t){this.canLearn(t)&&this.learnSkill.emit(t)}onUnlearn(t){this.isLearned(t)&&this.unlearnSkill.emit(t)}onClose(){this.close.emit()}getTypeLabel(t){switch(t){case"dice_bonus":return"Dice";case"active":return"Aktiv";case"passive":return"Passiv";case"stat_bonus":return"Bonus";default:return t}}getTypeClass(t){return`type-${t.replace("_","-")}`}getCostDisplay(t){if(!t.cost)return"";let e={mana:"Mana",energy:"Ausdauer",life:"Leben"},n=`${t.cost.amount} ${e[t.cost.type]||t.cost.type}`;return t.cost.perRound&&(n+=" pro Runde"),t.bonusAction&&(n+=" (Bonusaktion)"),n}getStatBonusDisplay(t){if(!t.statBonus)return"";let n={intelligence:"Intelligenz",strength:"St\xE4rke",dexterity:"Geschicklichkeit",speed:"Tempo",constitution:"Konstitution",chill:"Chill",mana:"Mana",life:"Leben",energy:"Ausdauer",focus:"Fokus",maxCastValue:"Max. Castwert",spellRadius:"Zauberradius"}[t.statBonus.stat]||t.statBonus.stat;return`${t.statBonus.amount>=0?"+":""}${t.statBonus.amount} ${n}`}getLockedReason(){return this.canLearnFromClass?"":"Ben\xF6tigt 3 Skills von einer Vorg\xE4ngerklasse"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-skill-detail"]],inputs:{className:"className",skills:"skills",learnedSkillIds:"learnedSkillIds",availablePoints:"availablePoints",canLearnFromClass:"canLearnFromClass",isPrimaryClass:"isPrimaryClass",isSecondaryClass:"isSecondaryClass",isTier1Class:"isTier1Class"},outputs:{learnSkill:"learnSkill",unlearnSkill:"unlearnSkill",close:"close",setPrimary:"setPrimary",setSecondary:"setSecondary"},decls:17,vars:13,consts:[[1,"skill-detail-panel"],[1,"panel-header"],[1,"close-btn",3,"click"],[1,"panel-content"],[1,"class-selection"],[1,"class-select-btn","primary",3,"click","disabled","title"],[1,"class-select-btn","secondary",3,"click","disabled","title"],[1,"locked-notice"],[1,"empty-state"],[1,"skills-list"],[1,"skill-item",3,"type-dice-bonus","type-active","type-passive","type-stat-bonus","learned","can-learn","enlightened","infinite-level"],[1,"skill-item"],[1,"skill-header"],[1,"skill-title"],[1,"skill-name"],[1,"skill-level"],[1,"skill-type"],["title","Verinnerlichter Skill",1,"enlightened-badge"],["title","Unendlich steigerbar",1,"infinite-badge"],[1,"learned-actions"],[1,"learn-btn"],[1,"locked-badge"],[1,"skill-body"],[1,"stat-bonus"],[1,"skill-description"],[1,"skill-cost"],[1,"skill-requirement"],[1,"learned-badge"],["title","Weiter steigern",1,"learn-btn","small"],["title","Stufe senken",1,"unlearn-btn",3,"click"],["title","Weiter steigern",1,"learn-btn","small",3,"click"],["title","Verlernen",1,"unlearn-btn",3,"click"],[1,"learn-btn",3,"click"]],template:function(e,n){e&1&&(S(0,"div",0)(1,"div",1)(2,"h3"),l(3),w(),S(4,"button",2),_e("click",function(){return n.onClose()}),l(5,"\xD7"),w()(),S(6,"div",3)(7,"div",4)(8,"button",5),_e("click",function(){return n.onSetPrimary()}),f(9,Pa,1,0)(10,Ea,1,0),w(),S(11,"button",6),_e("click",function(){return n.onSetSecondary()}),f(12,Oa,1,0)(13,Da,1,0),w()(),f(14,Ta,2,1,"div",7),f(15,Ra,3,0,"div",8)(16,Xa,3,0,"div",9),w()()),e&2&&(c(3),M(n.className),c(5),T("active",n.isPrimaryClass),pt("disabled",!n.hasLearnedSkill())("title",n.hasLearnedSkill()?"":"Du musst mindestens einen Skill aus dieser Klasse lernen"),c(),C(n.isPrimaryClass?9:10),c(2),T("active",n.isSecondaryClass),pt("disabled",!n.hasLearnedSkill())("title",n.hasLearnedSkill()?"":"Du musst mindestens einen Skill aus dieser Klasse lernen"),c(),C(n.isSecondaryClass?12:13),c(2),C(n.canLearnFromClass?-1:14),c(),C(n.skills.length===0?15:16))},dependencies:[A],styles:[".skill-detail-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.panel-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;border-bottom:1px solid var(--border);background:var(--bg)}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--accent);font-size:1.1rem}.close-btn[_ngcontent-%COMP%]{width:26px;height:26px;border-radius:50%;background:transparent;border:1px solid var(--border);color:var(--text-muted);font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:var(--border);color:var(--text)}.panel-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:.75rem}.locked-notice[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#64646433;border-radius:4px;margin-bottom:.75rem;font-size:.8rem;color:var(--text-muted);text-align:center}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--text-muted)}.skills-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.skill-item[_ngcontent-%COMP%]{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:.6rem;transition:all .2s;border-left:4px solid var(--border)}.skill-item.type-dice-bonus[_ngcontent-%COMP%]{border-left-color:#22c55e;background:linear-gradient(90deg,rgba(34,197,94,.08) 0%,var(--bg) 100%)}.skill-item.type-active[_ngcontent-%COMP%]{border-left-color:#eab308;background:linear-gradient(90deg,rgba(234,179,8,.08) 0%,var(--bg) 100%)}.skill-item.type-passive[_ngcontent-%COMP%]{border-left-color:#9b59b6;background:linear-gradient(90deg,rgba(155,89,182,.08) 0%,var(--bg) 100%)}.skill-item.type-stat-bonus[_ngcontent-%COMP%]{border-left-color:#3b82f6;background:linear-gradient(90deg,rgba(59,130,246,.08) 0%,var(--bg) 100%)}.skill-item[_ngcontent-%COMP%]:hover{border-color:var(--accent);transform:translate(2px)}.skill-item.learned[_ngcontent-%COMP%]{border-color:#22c55e;border-width:2px;background:#22c55e26}.skill-item.can-learn[_ngcontent-%COMP%]{border-color:var(--accent)}.skill-item.enlightened[_ngcontent-%COMP%], .skill-item.learned.enlightened[_ngcontent-%COMP%]{border-left:3px solid #f59e0b}.skill-item.infinite-level[_ngcontent-%COMP%]{border-right:3px solid #3b82f6}.skill-item.learned.infinite-level[_ngcontent-%COMP%]{border-right:3px solid #3b82f6;background:#3b82f61a}.skill-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:.4rem;gap:.5rem}.skill-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;flex-wrap:wrap}.skill-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text);font-size:.9rem}.skill-type[_ngcontent-%COMP%]{font-size:.7rem;padding:3px 7px;border-radius:3px;text-transform:uppercase;font-weight:700}.skill-type.type-dice-bonus[_ngcontent-%COMP%]{background:#22c55e;color:#fff}.skill-type.type-active[_ngcontent-%COMP%]{background:#eab308;color:#fff}.skill-type.type-passive[_ngcontent-%COMP%]{background:#9b59b6;color:#fff}.skill-type.type-stat-bonus[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.enlightened-badge[_ngcontent-%COMP%]{font-size:.8rem}.infinite-badge[_ngcontent-%COMP%]{font-size:.8rem;color:#3b82f6;font-weight:700}.skill-level[_ngcontent-%COMP%]{font-size:.75rem;color:#3b82f6;font-weight:600}.learned-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem}.learned-badge[_ngcontent-%COMP%]{font-size:.7rem;padding:3px 6px;background:#22c55e;color:#fff;border-radius:3px;font-weight:600}.unlearn-btn[_ngcontent-%COMP%]{width:22px;height:22px;border-radius:50%;background:transparent;border:1px solid #ef4444;color:#ef4444;font-size:.8rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.unlearn-btn[_ngcontent-%COMP%]:hover{background:#ef4444;color:#fff}.locked-badge[_ngcontent-%COMP%]{font-size:.65rem;color:var(--text-muted)}.learn-btn[_ngcontent-%COMP%]{padding:3px 10px;background:var(--accent);color:#fff;border:none;border-radius:4px;font-size:.7rem;cursor:pointer;transition:all .2s;white-space:nowrap}.learn-btn.small[_ngcontent-%COMP%]{padding:2px 6px;font-size:.8rem;min-width:22px}.learn-btn[_ngcontent-%COMP%]:hover{background:var(--accentdark);transform:scale(1.05)}.skill-body[_ngcontent-%COMP%]{font-size:.8rem}.stat-bonus[_ngcontent-%COMP%]{font-weight:600;color:#3b82f6;margin-bottom:.2rem}.skill-description[_ngcontent-%COMP%]{margin:0;color:var(--text-muted);line-height:1.3}.skill-cost[_ngcontent-%COMP%]{margin-top:.4rem;font-size:.75rem;color:#f59e0b}.skill-requirement[_ngcontent-%COMP%]{margin-top:.2rem;font-size:.7rem;color:var(--text-muted);font-style:italic}.class-selection[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:.75rem}.class-select-btn[_ngcontent-%COMP%]{flex:1;padding:.5rem;border-radius:6px;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .2s;border:2px solid transparent}.class-select-btn.primary[_ngcontent-%COMP%]{background:#eab30826;border-color:#eab3084d;color:#eab308}.class-select-btn.primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#eab30840;border-color:#eab308}.class-select-btn.primary.active[_ngcontent-%COMP%]{background:#eab308;border-color:#eab308;color:#000;box-shadow:0 0 12px #eab30880}.class-select-btn.secondary[_ngcontent-%COMP%]{background:#60a5fa26;border-color:#60a5fa4d;color:#60a5fa}.class-select-btn.secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#60a5fa40;border-color:#60a5fa}.class-select-btn.secondary.active[_ngcontent-%COMP%]{background:#60a5fa;border-color:#60a5fa;color:#fff;box-shadow:0 0 12px #60a5fa80}.class-select-btn[_ngcontent-%COMP%]:disabled{cursor:default}"]})};var Ja=["treeContainer"],Ka=()=>[],Za=(r,t)=>t.from+"-"+t.to,Qa=(r,t)=>t.name;function es(r,t){if(r&1){let e=y();a(0,"button",20),g("click",function(){m(e);let i=d();return u(i.resetLayout())}),l(1," Reset "),s(),a(2,"button",21),g("click",function(){m(e);let i=d();return u(i.exportLayout())}),l(3," Export "),s()}}function ts(r,t){if(r&1&&(Ue(),W(0,"path",23)),r&2){let e=d().$implicit,n=d();z("stroke",n.getConnectionPathColor(e)),T("accessible",n.isClassAccessible(e.from)||n.isClassAccessible(e.to))("on-class-path",n.isConnectionOnClassPath(e))("on-primary-path",n.isConnectionOnPrimaryPath(e))("on-secondary-path",n.isConnectionOnSecondaryPath(e))("next-class",n.isNextClassLine(e)),he("d",t)}}function ns(r,t){if(r&1&&f(0,ts,1,13,":svg:path",22),r&2){let e,n=t.$implicit,i=d();C((e=i.getConnectionPath(n))?0:-1,e)}}function is(r,t){if(r&1&&(Ue(),W(0,"circle",25)),r&2){let e=d(),n=e.$implicit,i=e.$index,o=d();le("tier-ring tier-"+i),he("cx",o.centerX)("cy",o.centerY)("r",n)}}function os(r,t){if(r&1&&f(0,is,1,5,":svg:circle",24),r&2){let e=t.$index;C(e>0?0:-1)}}function rs(r,t){if(r&1){let e=y();a(0,"app-class-node",26),g("select",function(){let i=m(e).$implicit,o=d();return u(o.selectClass(i.name))})("dragStart",function(i){let o=m(e).$implicit,p=d();return u(p.startNodeDrag(o.name,i))})("setPrimary",function(){let i=m(e).$implicit,o=d();return u(o.setPrimaryClass(i.name))})("setSecondary",function(){let i=m(e).$implicit,o=d();return u(o.setSecondaryClass(i.name))}),s()}if(r&2){let e=t.$implicit,n=d();b("className",e.name)("x",e.x)("y",e.y)("tier",e.tier)("learnedCount",n.getLearnedCountForClass(e.name))("totalCount",n.getTotalSkillsForClass(e.name))("isSelected",n.selectedClass===e.name)("isAccessible",n.isClassAccessible(e.name))("canLearn",n.canLearnFromClass(e.name))("editMode",n.editMode)("isPrimary",n.isPrimaryClass(e.name))("isSecondary",n.isSecondaryClass(e.name))("onPath",n.isClassOnPath(e.name))}}function as(r,t){if(r&1){let e=y();a(0,"div",19)(1,"app-skill-detail",27),g("learnSkill",function(i){m(e);let o=d();return u(o.learnSkill(i))})("unlearnSkill",function(i){m(e);let o=d();return u(o.unlearnSkill(i))})("setPrimary",function(){m(e);let i=d();return u(i.setPrimaryClass(i.selectedClass))})("setSecondary",function(){m(e);let i=d();return u(i.setSecondaryClass(i.selectedClass))})("close",function(){m(e);let i=d();return u(i.selectedClass=null)}),s()()}if(r&2){let e=d();c(),b("className",e.selectedClass)("skills",e.getSkillsForSelectedClass())("learnedSkillIds",e.sheet.learnedSkillIds||Z(8,Ka))("availablePoints",e.getAvailableTalentPoints())("canLearnFromClass",e.canLearnFromClass(e.selectedClass))("isPrimaryClass",e.isPrimaryClass(e.selectedClass))("isSecondaryClass",e.isSecondaryClass(e.selectedClass))("isTier1Class",e.isClassTier1(e.selectedClass))}}var uo={1:"#22c55e",2:"#eab308",3:"#ef4444",4:"#a855f7",5:"#3b82f6"},pn=class r{constructor(t){this.http=t}treeContainer;sheet;patch=new v;close=new v;selectedClass=null;classPositions=[];connections=[];scale=.8;panX=0;panY=0;isPanning=!1;lastMouseX=0;lastMouseY=0;isDraggingNode=!1;draggedClassName=null;editMode=!1;centerX=600;centerY=600;tierRadii=[0,100,200,320,440,560];classHierarchy=new Map;classParents=new Map;classTiers=new Map;classManualAngles=new Map;ngOnInit(){this.loadClassDefinitions()}ngAfterViewInit(){setTimeout(()=>{this.centerView()},100)}loadClassDefinitions(){this.parseClassDefinitions(),this.loadSavedAngles(),this.buildLayout(),setTimeout(()=>this.centerView(),0)}loadSavedAngles(){try{let t=localStorage.getItem("skill-tree-layout");if(t){let e=JSON.parse(t),n=Object.keys(e).length;n>0&&(console.log(`Loading ${n} saved class positions from localStorage`),Object.entries(e).forEach(([i,o])=>{this.classManualAngles.set(i,o)}))}}catch(t){console.error("Failed to load saved layout",t)}}saveAngles(){try{let t={};this.classManualAngles.forEach((n,i)=>{t[i]=n});let e=JSON.stringify(t);localStorage.setItem("skill-tree-layout",e),console.log(`Saved ${Object.keys(t).length} class positions to localStorage`)}catch(t){console.error("Failed to save layout",t)}}parseClassDefinitions(){this.classHierarchy.clear(),this.classParents.clear(),this.classTiers.clear(),this.classManualAngles.clear();for(let[t,e]of Object.entries(vi)){this.classTiers.set(t,e.tier),this.classManualAngles.set(t,e.angle);let n=e.children.map(i=>i.className);this.classHierarchy.set(t,n),e.children.forEach(i=>{this.classManualAngles.set(i.className,i.angle);let o=this.classParents.get(i.className)||[];o.push(t),this.classParents.set(i.className,o)})}}buildLayout(){this.classPositions=[],this.connections=[];let t=new Map;this.classTiers.forEach((p,h)=>{t.has(p)||t.set(p,[]),t.get(p).push(h)});let e=new Map,n=new Set,i=p=>{for(;p>180;)p-=360;for(;p<-180;)p+=360;return p},o=p=>{let h=this.classParents.get(p)||[];if(h.length===0)return 0;let _=0,x=0;return h.forEach(O=>{let R=e.get(O);if(R!==void 0){let N=R*(Math.PI/180);_+=Math.sin(N),x+=Math.cos(N)}}),Math.atan2(_,x)*(180/Math.PI)};for(let p=1;p<=5;p++){let h=(t.get(p)||[]).filter(R=>!n.has(R));if(h.length===0)continue;let _=this.tierRadii[p]||this.tierRadii[this.tierRadii.length-1],x=[],O=[];if(h.forEach(R=>{let N=this.classManualAngles.get(R);N!==void 0?x.push({cls:R,angle:N}):O.push(R)}),x.forEach(({cls:R,angle:N})=>{e.set(R,i(N));let j=N*(Math.PI/180);this.classPositions.push({name:R,x:this.centerX+Math.cos(j)*_,y:this.centerY-Math.sin(j)*_,tier:p,parents:this.classParents.get(R)||[]}),n.add(R)}),O.length>0){let R=O.map(j=>({cls:j,targetAngle:o(j)})).sort((j,ne)=>i(j.targetAngle)-i(ne.targetAngle)),N=x.map(j=>i(j.angle)).sort((j,ne)=>j-ne);if(N.length===0){let j=360/R.length;R.forEach((ne,pe)=>{let J=-180+pe*j+j/2;e.set(ne.cls,i(J));let ye=J*(Math.PI/180);this.classPositions.push({name:ne.cls,x:this.centerX+Math.cos(ye)*_,y:this.centerY-Math.sin(ye)*_,tier:p,parents:this.classParents.get(ne.cls)||[]}),n.add(ne.cls)})}else{let j=360/(R.length+N.length),ne=0;for(let pe=0;pe<R.length;pe++){let J,ye=0;do J=-180+ne*j+j/2,ne++,ye++;while(N.some(Fe=>Math.abs(i(J-Fe))<15)&&ye<360);e.set(R[pe].cls,i(J));let Ve=J*(Math.PI/180);this.classPositions.push({name:R[pe].cls,x:this.centerX+Math.cos(Ve)*_,y:this.centerY-Math.sin(Ve)*_,tier:p,parents:this.classParents.get(R[pe].cls)||[]}),n.add(R[pe].cls)}}}}this.classHierarchy.forEach((p,h)=>{p.forEach(_=>{let x=this.classPositions.some(R=>R.name===h),O=this.classPositions.some(R=>R.name===_);x&&O&&(this.connections.some(N=>N.from===h&&N.to===_)||this.connections.push({from:h,to:_}))})})}getConnectionLine(t){let e=this.classPositions.find(i=>i.name===t.from),n=this.classPositions.find(i=>i.name===t.to);return!e||!n?null:{x1:e.x,y1:e.y,x2:n.x,y2:n.y}}getConnectionPath(t){let e=this.classPositions.find(i=>i.name===t.from),n=this.classPositions.find(i=>i.name===t.to);return!e||!n?null:`M ${e.x} ${e.y} L ${n.x} ${n.y}`}onWheel(t){t.preventDefault();let e=t.deltaY>0?.9:1.1,n=Math.max(.3,Math.min(3,this.scale*e)),i=this.treeContainer?.nativeElement.getBoundingClientRect();if(i){let o=t.clientX-i.left,p=t.clientY-i.top;this.panX=o-(o-this.panX)*(n/this.scale),this.panY=p-(p-this.panY)*(n/this.scale)}this.scale=n}onMouseDown(t){this.isDraggingNode||(t.button===1||t.target.classList.contains("tree-inner"))&&(this.isPanning=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,t.preventDefault())}onMouseMove(t){if(this.isDraggingNode&&this.draggedClassName){this.handleNodeDrag(t);return}if(this.isPanning){let e=t.clientX-this.lastMouseX,n=t.clientY-this.lastMouseY;this.panX+=e,this.panY+=n,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY}}onMouseUp(){this.isPanning=!1,this.isDraggingNode&&(this.isDraggingNode=!1,this.draggedClassName=null)}onMouseLeave(){this.isPanning=!1,this.isDraggingNode&&(this.isDraggingNode=!1,this.draggedClassName=null)}startNodeDrag(t,e){this.editMode&&(e.stopPropagation(),e.preventDefault(),this.isDraggingNode=!0,this.draggedClassName=t)}handleNodeDrag(t){if(!this.draggedClassName)return;let e=this.classPositions.find(R=>R.name===this.draggedClassName);if(!e)return;let n=this.treeContainer?.nativeElement.getBoundingClientRect();if(!n)return;let i=(t.clientX-n.left-this.panX)/this.scale,o=(t.clientY-n.top-this.panY)/this.scale,p=i-this.centerX,h=this.centerY-o,_=Math.atan2(h,p)*(180/Math.PI),x=this.tierRadii[e.tier]||this.tierRadii[this.tierRadii.length-1],O=_*(Math.PI/180);e.x=this.centerX+Math.cos(O)*x,e.y=this.centerY-Math.sin(O)*x,this.classManualAngles.set(this.draggedClassName,_),this.saveAngles()}toggleEditMode(){this.editMode=!this.editMode}resetLayout(){localStorage.removeItem("skill-tree-layout"),this.parseClassDefinitions(),this.buildLayout()}exportLayout(){let t=[];for(let p=1;p<=5;p++)t.push(`# Tier ${p}`),Array.from(this.classTiers.entries()).filter(([_,x])=>x===p).map(([_,x])=>_).forEach(_=>{let x=this.classManualAngles.get(_),O=this.classHierarchy.get(_)||[],R=_;if(x!==void 0&&(R+=`@${Math.round(x)}`),R+=":",O.length>0){let N=O.map(j=>{let ne=this.classManualAngles.get(j);return ne!==void 0?`${j}@${Math.round(ne)}`:j});R+=" "+N.join(", ")}t.push(R)}),t.push("");let e=t.join(`
`),n=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download="class-definitions.txt",o.click(),URL.revokeObjectURL(i)}centerView(){let t=this.treeContainer?.nativeElement;if(t){let e=t.getBoundingClientRect();this.panX=e.width/2-this.centerX*this.scale,this.panY=e.height/2-this.centerY*this.scale}}resetView(){this.scale=.8,this.centerView()}zoomIn(){this.scale=Math.min(3,this.scale*1.2)}zoomOut(){this.scale=Math.max(.3,this.scale/1.2)}get transformStyle(){return`translate3d(${this.panX}px, ${this.panY}px, 0) scale(${this.scale})`}selectClass(t){this.selectedClass=this.selectedClass===t?null:t}getSkillsForSelectedClass(){return this.selectedClass?Tt(this.selectedClass):[]}isSkillLearned(t){return(this.sheet.learnedSkillIds||[]).includes(t)}getLearnedCountForClass(t){return Tt(t).filter(n=>this.isSkillLearned(n.id)).length}getTotalSkillsForClass(t){return Tt(t).length}getAvailableTalentPoints(){let t=this.sheet.level||1,e=this.sheet.talentPointsBonus||0,n=(this.sheet.learnedSkillIds||[]).length;return t+e-n}canLearnFromClass(t){let e=this.classPositions.find(i=>i.name===t);if(!e||e.tier===1)return!0;let n=this.classParents.get(t)||[];for(let i of n)if(this.getLearnedCountForClass(i)>=3)return!0;return!1}canLearnSkill(t){if(t.infiniteLevel){if(this.getAvailableTalentPoints()<=0)return!1}else if(this.isSkillLearned(t.id)||this.getAvailableTalentPoints()<=0)return!1;if(t.requiresSkill){let e=Array.isArray(t.requiresSkill)?t.requiresSkill:[t.requiresSkill];for(let n of e)if(!this.isSkillLearned(n))return!1}return!!this.canLearnFromClass(t.class)}learnSkill(t){if(this.canLearnSkill(t))if(t.infiniteLevel){let e=(this.sheet.skills||[]).findIndex(i=>i.skillId===t.id);if(e>=0){let o=(this.sheet.skills[e].level||1)+1;this.patch.emit({path:`skills.${e}.level`,value:o});let p=this.getInfiniteLevelDescription(t,o);if(this.patch.emit({path:`skills.${e}.description`,value:p}),t.statBonus){let h=[{stat:t.statBonus.stat,amount:t.statBonus.amount*o}];this.patch.emit({path:`skills.${e}.statModifiers`,value:h})}}else{let i=t.statBonus?[{stat:t.statBonus.stat,amount:t.statBonus.amount}]:void 0,o={name:t.name,class:t.class,description:this.getInfiniteLevelDescription(t,1),type:t.type,enlightened:t.enlightened??!1,level:1,skillId:t.id,statModifiers:i},p=[...this.sheet.skills||[],o];this.patch.emit({path:"skills",value:p})}let n=[...this.sheet.learnedSkillIds||[],t.id];this.patch.emit({path:"learnedSkillIds",value:n})}else{let e=[...this.sheet.learnedSkillIds||[],t.id];this.patch.emit({path:"learnedSkillIds",value:e});let n=t.statBonus?[{stat:t.statBonus.stat,amount:t.statBonus.amount}]:void 0,i={name:t.name,class:t.class,description:t.description,type:t.type,enlightened:t.enlightened??!1,skillId:t.id,statModifiers:n},o=[...this.sheet.skills||[],i];this.patch.emit({path:"skills",value:o})}}getInfiniteLevelDescription(t,e){return`${t.description} [Stufe ${e}]`}unlearnSkill(t){if(this.isSkillLearned(t.id))if(t.infiniteLevel){let e=(this.sheet.skills||[]).findIndex(o=>o.skillId===t.id);if(e>=0){let p=this.sheet.skills[e].level||1;if(p>1){let h=p-1;this.patch.emit({path:`skills.${e}.level`,value:h});let _=this.getInfiniteLevelDescription(t,h);if(this.patch.emit({path:`skills.${e}.description`,value:_}),t.statBonus){let x=[{stat:t.statBonus.stat,amount:t.statBonus.amount*h}];this.patch.emit({path:`skills.${e}.statModifiers`,value:x})}}else{let h=(this.sheet.skills||[]).filter((_,x)=>x!==e);this.patch.emit({path:"skills",value:h})}}let n=[...this.sheet.learnedSkillIds||[]],i=n.lastIndexOf(t.id);i>=0&&(n.splice(i,1),this.patch.emit({path:"learnedSkillIds",value:n}))}else{let e=(this.sheet.learnedSkillIds||[]).filter(i=>i!==t.id);this.patch.emit({path:"learnedSkillIds",value:e});let n=(this.sheet.skills||[]).filter(i=>i.skillId!==t.id);this.patch.emit({path:"skills",value:n})}}isClassAccessible(t){let e=[this.sheet.primary_class?.toLowerCase(),this.sheet.secondary_class?.toLowerCase()].filter(Boolean),n=t.toLowerCase();if(e.includes(n))return!0;for(let i of e)if((this.classParents.get(t)||[]).some(p=>p.toLowerCase()===i))return!0;return!1}isPrimaryClass(t){return this.sheet.primary_class?.toLowerCase()===t.toLowerCase()}isSecondaryClass(t){return this.sheet.secondary_class?.toLowerCase()===t.toLowerCase()}setPrimaryClass(t){this.patch.emit({path:"primary_class",value:t})}setSecondaryClass(t){this.patch.emit({path:"secondary_class",value:t})}getPathToClass(t){let e=new Set,n=new Set,i=o=>{if(n.has(o))return;n.add(o),e.add(o);let p=this.classParents.get(o)||[];for(let h of p)i(h)};return i(t),e}isConnectionOnClassPath(t){let e=this.sheet.primary_class?this.getPathToClass(this.sheet.primary_class):new Set,n=this.sheet.secondary_class?this.getPathToClass(this.sheet.secondary_class):new Set,i=e.has(t.from),o=e.has(t.to),p=n.has(t.from),h=n.has(t.to);return i&&o||p&&h}isNextClassLine(t){let e=this.sheet.primary_class?.toLowerCase()===t.from.toLowerCase(),n=this.sheet.secondary_class?.toLowerCase()===t.from.toLowerCase(),i=this.sheet.primary_class?.toLowerCase()===t.to.toLowerCase(),o=this.sheet.secondary_class?.toLowerCase()===t.to.toLowerCase();return(e||n)&&!i&&!o}isConnectionOnPrimaryPath(t){let e=this.sheet.primary_class?this.getPathToClass(this.sheet.primary_class):new Set;return e.has(t.from)&&e.has(t.to)}isConnectionOnSecondaryPath(t){let e=this.sheet.secondary_class?this.getPathToClass(this.sheet.secondary_class):new Set;return e.has(t.from)&&e.has(t.to)}getConnectionPathColor(t){let e=this.sheet.primary_class?this.getPathToClass(this.sheet.primary_class):new Set,n=this.sheet.secondary_class?this.getPathToClass(this.sheet.secondary_class):new Set,i=e.has(t.from),o=e.has(t.to),p=n.has(t.from),h=n.has(t.to);return i&&o?"#eab308":p&&h?"#60a5fa":null}isClassOnPath(t){let e=this.sheet.primary_class?this.getPathToClass(this.sheet.primary_class):new Set,n=this.sheet.secondary_class?this.getPathToClass(this.sheet.secondary_class):new Set;return e.has(t)?"primary":n.has(t)?"secondary":null}isClassTier1(t){return this.classTiers.get(t)===1}getTierColor(t){return uo[t]||uo[5]}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||r)(K(kt))};static \u0275cmp=F({type:r,selectors:[["app-skill-tree"]],viewQuery:function(e,n){if(e&1&&Te(Ja,5),e&2){let i;Re(i=Ie())&&(n.treeContainer=i.first)}},inputs:{sheet:"sheet"},outputs:{patch:"patch",close:"close"},decls:35,vars:9,consts:[["treeContainer",""],[1,"skill-tree-fullscreen"],[1,"modal-header"],[1,"header-controls"],[1,"talent-points"],[1,"points-label"],[1,"points-value"],[1,"zoom-controls"],["title","Verkleinern",1,"zoom-btn",3,"click"],["title","Zur\xFCcksetzen",1,"zoom-btn",3,"click"],["title","Vergr\xF6\xDFern",1,"zoom-btn",3,"click"],[1,"edit-controls"],["title","Layout bearbeiten",1,"edit-btn",3,"click"],[1,"close-btn",3,"click"],[1,"modal-content"],[1,"tree-container",3,"wheel","mousedown","mousemove","mouseup","mouseleave"],[1,"tree-inner"],[1,"tree-svg"],[3,"className","x","y","tier","learnedCount","totalCount","isSelected","isAccessible","canLearn","editMode","isPrimary","isSecondary","onPath"],[1,"skill-panel"],["title","Layout zur\xFCcksetzen",1,"reset-btn",3,"click"],["title","Layout exportieren",1,"export-btn",3,"click"],["fill","none",1,"connection-line",3,"accessible","on-class-path","on-primary-path","on-secondary-path","next-class","stroke"],["fill","none",1,"connection-line"],["fill","none",1,"tier-ring",3,"class"],["fill","none",1,"tier-ring"],[3,"select","dragStart","setPrimary","setSecondary","className","x","y","tier","learnedCount","totalCount","isSelected","isAccessible","canLearn","editMode","isPrimary","isSecondary","onPath"],[3,"learnSkill","unlearnSkill","setPrimary","setSecondary","close","className","skills","learnedSkillIds","availablePoints","canLearnFromClass","isPrimaryClass","isSecondaryClass","isTier1Class"]],template:function(e,n){if(e&1){let i=y();a(0,"div",1)(1,"div",2)(2,"h2"),l(3,"Talentbaum"),s(),a(4,"div",3)(5,"div",4)(6,"span",5),l(7,"Talentpunkte:"),s(),a(8,"span",6),l(9),s()(),a(10,"div",7)(11,"button",8),g("click",function(){return m(i),u(n.zoomOut())}),l(12,"-"),s(),a(13,"button",9),g("click",function(){return m(i),u(n.resetView())}),l(14,"\u27F2"),s(),a(15,"button",10),g("click",function(){return m(i),u(n.zoomIn())}),l(16,"+"),s()(),a(17,"div",11)(18,"button",12),g("click",function(){return m(i),u(n.toggleEditMode())}),l(19),s(),f(20,es,4,0),s(),a(21,"button",13),g("click",function(){return m(i),u(n.onClose())}),l(22,"\xD7"),s()()(),a(23,"div",14)(24,"div",15,0),g("wheel",function(p){return m(i),u(n.onWheel(p))})("mousedown",function(p){return m(i),u(n.onMouseDown(p))})("mousemove",function(p){return m(i),u(n.onMouseMove(p))})("mouseup",function(){return m(i),u(n.onMouseUp())})("mouseleave",function(){return m(i),u(n.onMouseLeave())}),a(26,"div",16),Ue(),a(27,"svg",17),I(28,ns,1,1,null,null,Za),I(30,os,1,1,null,null,te),s(),I(32,rs,1,13,"app-class-node",18,Qa),s()(),f(34,as,2,9,"div",19),s()()}e&2&&(c(9),M(n.getAvailableTalentPoints()),c(9),T("active",n.editMode),c(),D(" ",n.editMode?"Fertig":"Layout"," "),c(),C(n.editMode?20:-1),c(6),z("transform",n.transformStyle),c(),he("viewBox","0 0 1200 1200"),c(),V(n.connections),c(2),V(n.tierRadii),c(2),V(n.classPositions),c(2),C(n.selectedClass?34:-1))},dependencies:[A,cn,dn],styles:[".skill-tree-fullscreen[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;z-index:1000}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.75rem 1.25rem;border-bottom:1px solid var(--border);background:var(--card);flex-shrink:0}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--accent);font-size:1.25rem}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-left:auto}.talent-points[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.4rem .8rem;background:var(--bg);border-radius:20px}.points-label[_ngcontent-%COMP%]{color:var(--text-muted);font-size:.85rem}.points-value[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700;color:var(--accent)}.zoom-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem;background:var(--bg);border-radius:6px;padding:.25rem}.zoom-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:4px;background:transparent;border:1px solid var(--border);color:var(--text);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.zoom-btn[_ngcontent-%COMP%]:hover{background:var(--border);color:var(--accent)}.close-btn[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:transparent;border:1px solid var(--border);color:var(--text);font-size:1.8rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;line-height:0;padding:0;font-family:Arial,sans-serif}.close-btn[_ngcontent-%COMP%]:hover{background:var(--accent);border-color:var(--accent);color:#fff}.edit-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.edit-btn[_ngcontent-%COMP%], .export-btn[_ngcontent-%COMP%], .reset-btn[_ngcontent-%COMP%]{padding:.4rem .8rem;border-radius:6px;background:var(--bg);border:1px solid var(--border);color:var(--text);font-size:.85rem;cursor:pointer;transition:all .2s}.edit-btn[_ngcontent-%COMP%]:hover, .export-btn[_ngcontent-%COMP%]:hover, .reset-btn[_ngcontent-%COMP%]:hover{background:var(--border);color:var(--accent)}.edit-btn.active[_ngcontent-%COMP%]{background:var(--accent);border-color:var(--accent);color:#fff}.reset-btn[_ngcontent-%COMP%]{background:#6b7280;border-color:#6b7280;color:#fff}.reset-btn[_ngcontent-%COMP%]:hover{background:#4b5563;border-color:#4b5563;color:#fff}.export-btn[_ngcontent-%COMP%]{background:#3b82f6;border-color:#3b82f6;color:#fff}.export-btn[_ngcontent-%COMP%]:hover{background:#2563eb;border-color:#2563eb;color:#fff}.modal-content[_ngcontent-%COMP%]{flex:1;display:flex;overflow:hidden;min-height:0}.tree-container[_ngcontent-%COMP%]{flex:1;position:relative;overflow:hidden;cursor:grab;background:var(--bg);transform:translateZ(0);will-change:contents}.tree-container[_ngcontent-%COMP%]:active{cursor:grabbing}.tree-inner[_ngcontent-%COMP%]{position:absolute;width:1200px;height:1200px;transform-origin:0 0;will-change:transform;transform:translateZ(0);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;image-rendering:-webkit-optimize-contrast;image-rendering:crisp-edges}.tree-svg[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.connection-line[_ngcontent-%COMP%]{stroke:var(--border);stroke-width:2;opacity:.6}.connection-line.accessible[_ngcontent-%COMP%]{stroke:var(--border);opacity:.9;stroke-width:2.5}.connection-line.on-class-path[_ngcontent-%COMP%]{stroke-width:3;opacity:1;stroke-dasharray:none}.connection-line.on-primary-path[_ngcontent-%COMP%]{filter:drop-shadow(0 0 4px #eab308) drop-shadow(0 0 8px #eab308) drop-shadow(0 0 12px #eab308)}.connection-line.on-secondary-path[_ngcontent-%COMP%]{filter:drop-shadow(0 0 4px #60a5fa) drop-shadow(0 0 8px #60a5fa) drop-shadow(0 0 12px #60a5fa)}.connection-line.next-class[_ngcontent-%COMP%]{stroke-width:2.5;opacity:.9;stroke-dasharray:8 4}.tier-ring[_ngcontent-%COMP%]{stroke:var(--border);stroke-width:1;opacity:.15;stroke-dasharray:8 4}.tier-ring.tier-1[_ngcontent-%COMP%]{stroke:#22c55e;opacity:.25}.tier-ring.tier-2[_ngcontent-%COMP%]{stroke:#eab308;opacity:.25}.tier-ring.tier-3[_ngcontent-%COMP%]{stroke:#ef4444;opacity:.25}.tier-ring.tier-4[_ngcontent-%COMP%]{stroke:#a855f7;opacity:.25}.tier-ring.tier-5[_ngcontent-%COMP%]{stroke:#3b82f6;opacity:.25}.skill-panel[_ngcontent-%COMP%]{width:380px;min-width:380px;border-left:1px solid var(--border);background:var(--card);overflow-y:auto;animation:_ngcontent-%COMP%_slideIn .2s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(20px);opacity:0}to{transform:translate(0);opacity:1}}"]})};var ss=["editor"],mn=class r{sheet;patch=new v;editorElement;isInitialized=!1;ngAfterViewInit(){if(this.editorElement){let t=this.sheet.backstory||"<p><br></p>";this.editorElement.nativeElement.innerHTML=t,this.isInitialized=!0}}formatText(t){let e=this.editorElement?.nativeElement;e&&(e.focus(),t==="h1"||t==="h2"||t==="h3"||t==="p"?this.setBlockFormat(t):t==="bold"?document.execCommand("bold",!1):t==="italic"&&document.execCommand("italic",!1),this.cleanupFormatting())}setBlockFormat(t){let e=window.getSelection();if(!e||e.rangeCount===0)return;let n=e.anchorNode;if(!n)return;let i=null;for(n.nodeType===Node.TEXT_NODE?i=n.parentElement:i=n;i&&!["P","H1","H2","H3","DIV"].includes(i.tagName);)i=i.parentElement;if(!i||!this.editorElement.nativeElement.contains(i))return;let o=document.createElement(t);o.innerHTML=i.innerHTML;let p=i.textContent||"";o.textContent=p,i.parentNode?.replaceChild(o,i);let h=document.createRange(),_=window.getSelection();h.selectNodeContents(o),h.collapse(!1),_?.removeAllRanges(),_?.addRange(h)}setTextColor(t){let e=this.editorElement?.nativeElement;if(!e)return;e.focus();let n=window.getSelection();if(!n||n.rangeCount===0)return;let i;if(t==="white")i="#ffffff";else if(t==="purple")i=getComputedStyle(e).getPropertyValue("--accent").trim()||"#a259ff";else if(t==="gray")i=getComputedStyle(e).getPropertyValue("--text-muted").trim()||"#999999";else return;let o=n.getRangeAt(0);if(o.collapsed)return;let p=document.createElement("span");p.style.color=i;try{o.surroundContents(p)}catch{document.execCommand("foreColor",!1,i)}this.cleanupFormatting()}insertHR(){let t=this.editorElement?.nativeElement;if(!t)return;t.focus();let e=getComputedStyle(t).getPropertyValue("--text-muted").trim()||"#999999";document.execCommand("insertHTML",!1,`<hr style="border: none; border-top: 2px solid ${e}; margin: 1.5rem 0;"><p><br></p>`),this.cleanupFormatting()}onPaste(t){t.preventDefault();let e=t.clipboardData?.getData("text/plain")||"";document.execCommand("insertText",!1,e)}onContentChange(){this.isInitialized&&this.saveContent()}onBlur(){this.isInitialized&&this.saveContent()}cleanupFormatting(){let t=this.editorElement?.nativeElement;if(!t)return;t.querySelectorAll("span:empty").forEach(o=>o.remove()),t.querySelectorAll("span").forEach(o=>{if(!o.hasAttribute("style")||!o.style.cssText){let p=o.parentNode;for(;o.firstChild;)p?.insertBefore(o.firstChild,o);o.remove()}}),Array.from(t.childNodes).forEach(o=>{if(o.nodeType===Node.TEXT_NODE&&o.textContent?.trim()){let p=document.createElement("p");p.textContent=o.textContent,o.parentNode?.replaceChild(p,o)}})}saveContent(){let t=this.editorElement?.nativeElement;if(!t)return;this.cleanupFormatting();let e=t.innerHTML;(e==="<p><br></p>"||e==="<br>"||e==="")&&(e=""),this.patch.emit({path:"backstory",value:e})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-backstory"]],viewQuery:function(e,n){if(e&1&&Te(ss,5),e&2){let i;Re(i=Ie())&&(n.editorElement=i.first)}},inputs:{sheet:"sheet"},outputs:{patch:"patch"},decls:39,vars:0,consts:[["editor",""],[1,"backstory-header"],[1,"editor-toolbar"],[1,"toolbar-section"],["title","Heading 1",1,"toolbar-btn",3,"click"],["title","Heading 2",1,"toolbar-btn",3,"click"],["title","Heading 3",1,"toolbar-btn",3,"click"],["title","Normal Text",1,"toolbar-btn",3,"click"],[1,"toolbar-divider"],["title","Bold",1,"toolbar-btn",3,"click"],["title","Italic",1,"toolbar-btn",3,"click"],["title","White Text",1,"toolbar-btn","color-white",3,"click"],[2,"color","white"],["title","Purple Text",1,"toolbar-btn","color-purple",3,"click"],[2,"color","var(--accent)"],["title","Gray Text",1,"toolbar-btn","color-gray",3,"click"],[2,"color","var(--text-muted)"],["title","Horizontal Line",1,"toolbar-btn",3,"click"],["contenteditable","true","placeholder","Write your character's backstory here...",1,"rich-text-editor",3,"input","blur","paste"]],template:function(e,n){if(e&1){let i=y();a(0,"app-card")(1,"div",1)(2,"h2"),l(3,"Hintergrundgeschichte"),s()(),a(4,"div",2)(5,"div",3)(6,"button",4),g("click",function(){return m(i),u(n.formatText("h1"))}),l(7," H1 "),s(),a(8,"button",5),g("click",function(){return m(i),u(n.formatText("h2"))}),l(9," H2 "),s(),a(10,"button",6),g("click",function(){return m(i),u(n.formatText("h3"))}),l(11," H3 "),s(),a(12,"button",7),g("click",function(){return m(i),u(n.formatText("p"))}),l(13," P "),s()(),W(14,"div",8),a(15,"div",3)(16,"button",9),g("click",function(){return m(i),u(n.formatText("bold"))}),a(17,"strong"),l(18,"B"),s()(),a(19,"button",10),g("click",function(){return m(i),u(n.formatText("italic"))}),a(20,"em"),l(21,"I"),s()()(),W(22,"div",8),a(23,"div",3)(24,"button",11),g("click",function(){return m(i),u(n.setTextColor("white"))}),a(25,"span",12),l(26,"\u25CF"),s()(),a(27,"button",13),g("click",function(){return m(i),u(n.setTextColor("purple"))}),a(28,"span",14),l(29,"\u25CF"),s()(),a(30,"button",15),g("click",function(){return m(i),u(n.setTextColor("gray"))}),a(31,"span",16),l(32,"\u25CF"),s()()(),W(33,"div",8),a(34,"div",3)(35,"button",17),g("click",function(){return m(i),u(n.insertHR())}),l(36," \u2015 "),s()()(),a(37,"div",18,0),g("input",function(){return m(i),u(n.onContentChange())})("blur",function(){return m(i),u(n.onBlur())})("paste",function(p){return m(i),u(n.onPaste(p))}),s()()}},dependencies:[A,Q],styles:[".backstory-header[_ngcontent-%COMP%]{margin-bottom:1rem}.backstory-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:var(--text);font-size:1.5rem;font-weight:700}.editor-toolbar[_ngcontent-%COMP%]{display:flex;gap:.5rem;padding:.75rem;background:var(--bg);border:1px solid var(--border);border-radius:8px;flex-wrap:wrap;align-items:center;margin-bottom:.75rem}.toolbar-section[_ngcontent-%COMP%]{display:flex;gap:.25rem}.toolbar-divider[_ngcontent-%COMP%]{width:1px;height:24px;background:var(--border);margin:0 .25rem}.toolbar-btn[_ngcontent-%COMP%]{padding:.4rem .75rem;background:var(--card);border:1px solid var(--border);border-radius:4px;cursor:pointer;font-size:.9rem;color:var(--text);transition:all .15s;min-width:36px;display:flex;align-items:center;justify-content:center}.toolbar-btn[_ngcontent-%COMP%]:hover{background:var(--accent);color:#fff;border-color:var(--accent)}.toolbar-btn[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .toolbar-btn[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{color:inherit}.rich-text-editor[_ngcontent-%COMP%]{width:100%;min-height:400px;padding:1.5rem;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text-muted);font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;font-size:.95rem;line-height:1.8;word-wrap:break-word;overflow-wrap:break-word;max-width:100%;overflow-y:auto}.rich-text-editor[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px #6b46c126}.rich-text-editor[_ngcontent-%COMP%]:empty:before{content:attr(placeholder);color:var(--text-muted);font-style:italic}.rich-text-editor[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:var(--text);margin:1.5rem 0 .75rem;font-size:2rem;font-weight:700;border-bottom:2px solid var(--accent);padding-bottom:.5rem}.rich-text-editor[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]:first-child{margin-top:0}.rich-text-editor[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--text);margin:1.25rem 0 .6rem;font-size:1.5rem;font-weight:700;border-bottom:1px solid var(--border);padding-bottom:.4rem}.rich-text-editor[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]:first-child{margin-top:0}.rich-text-editor[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--text);margin:1rem 0 .5rem;font-size:1.2rem;font-weight:600}.rich-text-editor[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]:first-child{margin-top:0}.rich-text-editor[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.75rem 0}.rich-text-editor[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;border-top:2px solid var(--text-muted);margin:1.5rem 0}.rich-text-editor[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .rich-text-editor[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{color:var(--accent);font-weight:600}.rich-text-editor[_ngcontent-%COMP%]   em[_ngcontent-%COMP%], .rich-text-editor[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-style:italic;color:var(--text-muted)}"]})};var jn=(r,t)=>t.name,go=(r,t)=>t.id;function ls(r,t){if(r&1){let e=y();a(0,"button",40),g("click",function(){let i=m(e).$implicit,o=d();return u(o.selectDice(i))}),l(1),s()}if(r&2){let e=t.$implicit,n=d();T("selected",n.selectedDiceType()===e),c(),D(" d",e," ")}}function cs(r,t){if(r&1&&(a(0,"span"),l(1),s()),r&2){let e=d();T("negative",e.totalBonus()<0),c(),se(" ",e.totalBonus()>0?"+":"","",e.totalBonus()," ")}}function ds(r,t){if(r&1&&(a(0,"span",46),l(1),s()),r&2){let e=t.$implicit;T("negative",e.value<0),c(),Mt(" ",e.name,": ",e.value>0?"+":"","",e.value," ")}}function ps(r,t){if(r&1&&(a(0,"div",41)(1,"div",42),l(2),s(),a(3,"div",43)(4,"span",44),l(5),s(),I(6,ds,2,5,"span",45,jn),s()()),r&2){let e=t,n=d();T("secret",e.isSecret)("animate",n.isAnimating()),c(2),M(e.result),c(3),D("[",e.rolls.join("+"),"]"),c(),V(e.bonuses)}}function ms(r,t){if(r&1){let e=y();a(0,"button",47),g("click",function(){let i=m(e).$implicit,o=d();return u(o.toggleBonus(i.name))}),a(1,"span",48),l(2),s(),a(3,"span",49),l(4),s()()}if(r&2){let e=t.$implicit,n=d();T("selected",n.isBonusSelected(e.name)),c(2),M(e.name),c(),T("negative",e.value<0),c(),se(" ",e.value>0?"+":"","",e.value," ")}}function us(r,t){if(r&1){let e=y();a(0,"input",54),g("input",function(i){m(e);let o=d(2);return u(o.skillFilter.set(i.target.value))}),s()}if(r&2){let e=d(2);b("value",e.skillFilter())}}function gs(r,t){if(r&1&&(a(0,"span",56),l(1),s()),r&2){let e=d().$implicit;c(),M(e.context)}}function hs(r,t){if(r&1){let e=y();a(0,"button",55),g("click",function(){let i=m(e).$implicit,o=d(2);return u(o.toggleBonus(i.name))}),a(1,"span",48),l(2),s(),a(3,"span",49),l(4),s(),f(5,gs,2,1,"span",56),s()}if(r&2){let e=t.$implicit,n=d(2);T("selected",n.isBonusSelected(e.name)),b("title",e.context||""),c(2),M(e.name),c(2),D("+",e.value),c(),C(e.context?5:-1)}}function _s(r,t){if(r&1&&(a(0,"div",31)(1,"div",50)(2,"h4"),l(3,"W\xFCrfelboni (Skills)"),s(),f(4,us,1,1,"input",51),s(),a(5,"div",52),I(6,hs,6,6,"button",53,jn),s()()),r&2){let e=d();c(4),C(e.availableDiceBonuses().length>4?4:-1),c(2),V(e.filteredDiceBonuses())}}function fs(r,t){if(r&1&&(a(0,"div",34)(1,"span",57),l(2,"Ausgew\xE4hlt:"),s(),a(3,"span",58),l(4),s()()),r&2){let e=d();c(4),se("",e.totalBonus()>0?"+":"","",e.totalBonus())}}function Cs(r,t){r&1&&(a(0,"p",59),l(1,"Keine gespeicherten Konfigurationen"),s())}function bs(r,t){if(r&1){let e=y();a(0,"div",60)(1,"button",61),g("click",function(){let i=m(e).$implicit,o=d(3);return u(o.loadConfiguration(i))}),a(2,"span",62),l(3),s(),a(4,"span",63),l(5),s()(),a(6,"button",64),g("click",function(){let i=m(e).$implicit,o=d(3);return u(o.deleteConfiguration(i.id))}),l(7,"\xD7"),s()()}if(r&2){let e=t.$implicit;c(3),M(e.name),c(2),se("",e.diceCount,"d",e.diceType)}}function xs(r,t){if(r&1&&I(0,bs,8,3,"div",60,go),r&2){let e=d(2);V(e.savedConfigs())}}function vs(r,t){if(r&1&&(a(0,"div",37),f(1,Cs,2,0,"p",59)(2,xs,2,0),s()),r&2){let e=d();c(),C(e.savedConfigs().length===0?1:2)}}function ys(r,t){if(r&1){let e=y();a(0,"button",66),g("click",function(){let i=m(e).$implicit,o=d(2);return u(o.repeatRoll(i))}),a(1,"span",67),l(2),s(),a(3,"span",68),l(4),s(),a(5,"span",69),l(6),s()()}if(r&2){let e=t.$implicit,n=d(2);c(2),se("",e.diceCount,"d",e.diceType),c(2),D("= ",e.result),c(2),M(n.getTimeAgo(e.timestamp))}}function ws(r,t){if(r&1&&(a(0,"div",39),I(1,ys,7,4,"button",65,go),s()),r&2){let e=d();c(),V(e.rollHistory().rolls.slice(0,8))}}var un=class r{sheet;close=new v;worldSocket=L(Dt);diceRollSub;selectedDiceType=B(20);diceCount=B(1);selectedBonuses=B(new Set);manualBonus=B(0);isSecretRoll=B(!1);isRolling=B(!1);isAnimating=B(!1);lastRoll=B(null);receivedRolls=B([]);rollHistory=B({rolls:[]});savedConfigs=B([]);showSavedList=B(!0);showHistoryList=B(!0);newConfigName="";skillFilter=B("");Math=Math;rollSound=null;diceTypes=[4,6,8,10,12,20,100];diceFormula=Ne(()=>{let t=this.diceCount(),e=this.selectedDiceType(),n=this.totalBonus(),i=`${t}d${e}`;return n!==0&&(i+=n>0?`+${n}`:`${n}`),i});availableDiceBonuses=Ne(()=>{if(!this.sheet)return[];let t=[];return(this.sheet.skills||[]).forEach(n=>{if(n.type==="dice_bonus"){let p=yi.find(_=>_.name===n.name)?.description||n.description||"",h=p.match(/\+(\d+)/);if(h){let _=p.match(/\+\d+\s*(.+)/),x=n.level||1;t.push({name:n.name,value:parseInt(h[1])*x,source:"skill",context:_?_[1]:void 0})}}}),t});filteredDiceBonuses=Ne(()=>{let t=this.skillFilter().toLowerCase().trim(),e=this.availableDiceBonuses();return t&&(e=e.filter(n=>n.name.toLowerCase().includes(t)||n.context&&n.context.toLowerCase().includes(t))),e.sort((n,i)=>n.name.localeCompare(i.name))});calculateStatEffectBonus(t){let e=0;if(this.sheet.skills){for(let n of this.sheet.skills)if(n.statModifiers){for(let i of n.statModifiers)if(i.stat===t){let o=n.level||1;e+=i.amount*o}}}if(this.sheet.equipment){for(let n of this.sheet.equipment)if(n.statModifiers)for(let i of n.statModifiers)i.stat===t&&(e+=i.amount)}return e}calculateStatCurrent(t,e){if(!t)return 0;let n=t.base||0,i=t.bonus||0,o=t.gain||0,p=this.calculateStatEffectBonus(e);return n+i+p+o*this.sheet.level|0}calculateStatDiceBonus(t,e){return-5+this.calculateStatCurrent(t,e)/2|0}statBonuses=Ne(()=>this.sheet?[{name:"St\xE4rke",value:this.calculateStatDiceBonus(this.sheet.strength,"strength"),source:"stat"},{name:"Geschicklichkeit",value:this.calculateStatDiceBonus(this.sheet.dexterity,"dexterity"),source:"stat"},{name:"Konstitution",value:this.calculateStatDiceBonus(this.sheet.constitution,"constitution"),source:"stat"},{name:"Intelligenz",value:this.calculateStatDiceBonus(this.sheet.intelligence,"intelligence"),source:"stat"},{name:"Charisma",value:this.calculateStatDiceBonus(this.sheet.chill,"chill"),source:"stat"},{name:"Geschwindigkeit",value:this.calculateStatDiceBonus(this.sheet.speed,"speed"),source:"stat"}].filter(e=>e.value!==0):[]);totalBonus=Ne(()=>{let t=this.manualBonus(),e=[...this.availableDiceBonuses(),...this.statBonuses()];return this.selectedBonuses().forEach(n=>{let i=e.find(o=>o.name===n);i&&(t+=i.value)}),t});ngOnInit(){this.loadRollHistory(),this.loadSavedConfigs(),this.initRollSound(),this.loadSyncedActionRolls(),document.body.style.overflow="hidden",this.sheet.worldName&&(this.diceRollSub=this.worldSocket.diceRoll$.subscribe(t=>{t.characterId!==this.sheet.id&&(t.isSecret||this.receivedRolls.update(e=>[t,...e.slice(0,4)]))}))}loadSyncedActionRolls(){let t=localStorage.getItem("action-roll-results");if(t)try{let e=JSON.parse(t);e&&e.length>0&&(e.forEach(n=>{let i={id:n.id,characterName:this.sheet.name,diceType:parseInt(n.formula.split("d")[1])||20,diceCount:parseInt(n.formula.split("d")[0])||1,bonuses:[],result:n.total,rolls:n.rolls,timestamp:new Date};this.rollHistory.update(o=>({rolls:[i,...o.rolls.slice(0,9)]}))}),localStorage.removeItem("action-roll-results"))}catch(e){console.error("Failed to load synced action rolls:",e)}}ngOnDestroy(){this.diceRollSub?.unsubscribe(),document.body.style.overflow=""}initRollSound(){this.rollSound=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleVQIj6PLwZ14MQ+E1uvl0pZlAQBfnNPq7LqBT+7uubvV8ei/Nx1u0fbuqXkmAKzw//+rZTofrdnt/5Z3LyKWy+/+tX0vH4fG7f/Hi0osaMjq/7eYPyZYsuT/1aNREV657/z/l2wdB1qf2er9qnwyDl+XyvKvhT4UUInB7rKKRxVGbJ/Xx5dOICdOXoO2s2orCBYrVHOhsGszCgAJGEBniqhiOwobJy9EYoOUZEoqKjQaHSw+VGmBbkguNjwsGRQhNERZbmtSQUxNQy0eDRQjN05mZU5DSkI9Ly0hERUiMEhebVZAPz02Li8oIiMiLDZIVk1BP0E8NjM0Li4sJiorNEFMRDs+QDs3NDUyNDEvMjY8Q0M9PD8+Ozg3NjY2NzQ4PEA+Ozw+Pjo5ODg5ODk6Ozw8Ozs8PDw7Ozs7PDw8PD08PD09PT4+Pj4+Pz8/Pz9AQEBAQEBAQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFB")}playRollSound(){this.rollSound&&(this.rollSound.currentTime=0,this.rollSound.volume=.3,this.rollSound.play().catch(()=>{}))}parseDiceFormula(t){let e=t.match(/^(\d+)?d(\d+)([+-]\d+)?$/i);if(e){let n=e[1]?parseInt(e[1]):1,i=parseInt(e[2]),o=e[3]?parseInt(e[3]):0;(this.diceTypes.includes(i)||i>0)&&(this.diceCount.set(Math.min(20,Math.max(1,n))),this.selectedDiceType.set(i),this.manualBonus.set(o))}}selectDice(t){this.selectedDiceType.set(t)}saveConfiguration(){if(!this.newConfigName.trim())return;let t={id:`config-${Date.now()}`,name:this.newConfigName.trim(),diceType:this.selectedDiceType(),diceCount:this.diceCount(),bonusNames:Array.from(this.selectedBonuses()),manualBonus:this.manualBonus()};this.savedConfigs.update(e=>[...e,t]),this.saveSavedConfigs(),this.newConfigName=""}loadConfiguration(t){this.selectedDiceType.set(t.diceType),this.diceCount.set(t.diceCount),this.manualBonus.set(t.manualBonus),this.selectedBonuses.set(new Set(t.bonusNames))}deleteConfiguration(t){this.savedConfigs.update(e=>e.filter(n=>n.id!==t)),this.saveSavedConfigs()}loadSavedConfigs(){try{let t=localStorage.getItem(`dice-configs-${this.sheet.name}`);t&&this.savedConfigs.set(JSON.parse(t))}catch(t){console.error("Failed to load saved configs",t)}}saveSavedConfigs(){try{localStorage.setItem(`dice-configs-${this.sheet.name}`,JSON.stringify(this.savedConfigs()))}catch(t){console.error("Failed to save configs",t)}}toggleBonus(t){let e=new Set(this.selectedBonuses());e.has(t)?e.delete(t):e.add(t),this.selectedBonuses.set(e)}isBonusSelected(t){return this.selectedBonuses().has(t)}async roll(){if(this.isRolling())return;this.isRolling.set(!0),this.isAnimating.set(!1),this.playRollSound(),await this.animateRoll();let t=[],e=this.selectedDiceType(),n=this.diceCount();for(let x=0;x<n;x++)t.push(Math.floor(Math.random()*e)+1);let o=t.reduce((x,O)=>x+O,0)+this.totalBonus(),p=[...this.availableDiceBonuses(),...this.statBonuses()],h=[];this.selectedBonuses().forEach(x=>{let O=p.find(R=>R.name===x);O&&h.push(O)}),this.manualBonus()!==0&&h.push({name:"Manuell",value:this.manualBonus(),source:"manual"});let _={id:`${Date.now()}-${Math.random()}`,characterName:this.sheet.name,diceType:e,diceCount:n,bonuses:h,result:o,rolls:t,timestamp:new Date,isSecret:this.isSecretRoll()};if(this.lastRoll.set(_),this.isRolling.set(!1),this.isAnimating.set(!0),setTimeout(()=>this.isAnimating.set(!1),600),this.addToHistory(_),this.sheet.worldName){let x={id:_.id,worldName:this.sheet.worldName,characterName:_.characterName,characterId:this.sheet.id||"",diceType:_.diceType,diceCount:_.diceCount,bonuses:_.bonuses,result:_.result,rolls:_.rolls,timestamp:_.timestamp,isSecret:_.isSecret||!1};this.worldSocket.sendDiceRoll(x)}}async animateRoll(){return new Promise(t=>setTimeout(t,500))}repeatRoll(t){this.selectedDiceType.set(t.diceType),this.diceCount.set(t.diceCount);let e=new Set,n=0;t.bonuses.forEach(i=>{i.source==="manual"?n=i.value:e.add(i.name)}),this.selectedBonuses.set(e),this.manualBonus.set(n),this.roll()}addToHistory(t){let e=this.rollHistory(),n=e.rolls.findIndex(i=>i.diceType===t.diceType&&i.diceCount===t.diceCount&&JSON.stringify(i.bonuses)===JSON.stringify(t.bonuses));n>=0?e.rolls[n]=t:(e.rolls.unshift(t),e.rolls.length>10&&(e.rolls=e.rolls.slice(0,10))),this.rollHistory.set({rolls:[...e.rolls]}),this.saveRollHistory()}loadRollHistory(){try{let t=localStorage.getItem(`dice-history-${this.sheet.name}`);if(t){let e=JSON.parse(t);e.rolls.forEach(n=>n.timestamp=new Date(n.timestamp)),this.rollHistory.set(e)}}catch(t){console.error("Failed to load roll history",t)}}saveRollHistory(){try{localStorage.setItem(`dice-history-${this.sheet.name}`,JSON.stringify(this.rollHistory()))}catch(t){console.error("Failed to save roll history",t)}}getRollLabel(t){let e=t.bonuses.length>0?` +${t.bonuses.reduce((n,i)=>n+i.value,0)}`:"";return`${t.diceCount}d${t.diceType}${e}`}getTimeAgo(t){let e=Math.floor((new Date().getTime()-new Date(t).getTime())/1e3);return e<60?"Gerade eben":e<3600?`vor ${Math.floor(e/60)}m`:e<86400?`vor ${Math.floor(e/3600)}h`:`vor ${Math.floor(e/86400)}d`}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-dice-roller"]],inputs:{sheet:"sheet"},outputs:{close:"close"},decls:74,vars:26,consts:[[1,"dice-roller-overlay"],[1,"dice-roller-fullscreen"],[1,"dialog-header"],[1,"header-controls"],[1,"secret-toggle"],["type","checkbox",3,"change","checked"],[1,"secret-label"],[1,"close-btn",3,"click"],[1,"dialog-body"],[1,"panel","roll-panel"],[1,"panel-header"],[1,"dice-input-section"],["type","text","placeholder","z.B. 2d6+3 oder 1d20",1,"dice-formula-input",3,"input","value"],[1,"dice-type-grid"],[1,"dice-type-btn",3,"selected"],[1,"dice-controls"],[1,"control-group"],[1,"number-control"],[3,"click"],["type","number","min","1","max","20",3,"input","value"],["type","number",1,"bonus-input",3,"input","value"],[1,"roll-summary"],[1,"formula-display"],[3,"negative"],[1,"roll-btn",3,"click","disabled"],[1,"roll-text"],[1,"result-display",3,"secret","animate"],[1,"save-config-section"],["type","text","placeholder","Konfiguration speichern...",1,"config-name-input",3,"ngModelChange","ngModel"],[1,"save-config-btn",3,"click","disabled"],[1,"panel","bonus-panel"],[1,"bonus-section"],[1,"bonus-grid"],[1,"bonus-chip","stat",3,"selected"],[1,"selected-summary"],[1,"panel","config-panel"],[1,"toggle-list-btn",3,"click"],[1,"saved-configs"],[1,"history-section"],[1,"history-list"],[1,"dice-type-btn",3,"click"],[1,"result-display"],[1,"result-number"],[1,"result-breakdown"],[1,"dice-rolls"],[1,"bonus-pill",3,"negative"],[1,"bonus-pill"],[1,"bonus-chip","stat",3,"click"],[1,"chip-name"],[1,"chip-value"],[1,"section-header-row"],["type","text","placeholder","Filter...",1,"skill-filter-input",3,"value"],[1,"bonus-grid","scrollable"],[1,"bonus-chip","skill",3,"selected","title"],["type","text","placeholder","Filter...",1,"skill-filter-input",3,"input","value"],[1,"bonus-chip","skill",3,"click","title"],[1,"chip-context"],[1,"summary-label"],[1,"summary-value"],[1,"empty-hint"],[1,"config-item"],[1,"config-btn",3,"click"],[1,"config-name"],[1,"config-formula"],[1,"config-delete",3,"click"],[1,"history-item"],[1,"history-item",3,"click"],[1,"history-formula"],[1,"history-result"],[1,"history-time"]],template:function(e,n){if(e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),l(4,"\u{1F3B2} W\xFCrfel Werfen"),s(),a(5,"div",3)(6,"label",4)(7,"input",5),g("change",function(o){return n.isSecretRoll.set(o.target.checked)}),s(),a(8,"span",6),l(9,"\u{1F92B} Geheim"),s()(),a(10,"button",7),g("click",function(){return n.onClose()}),l(11,"\xD7"),s()()(),a(12,"div",8)(13,"div",9)(14,"div",10)(15,"h3"),l(16,"W\xFCrfeln"),s()(),a(17,"div",11)(18,"input",12),g("input",function(o){return n.parseDiceFormula(o.target.value)}),s()(),a(19,"div",13),I(20,ls,2,3,"button",14,te),s(),a(22,"div",15)(23,"div",16)(24,"label"),l(25,"Anzahl"),s(),a(26,"div",17)(27,"button",18),g("click",function(){return n.diceCount.set(n.Math.max(1,n.diceCount()-1))}),l(28,"-"),s(),a(29,"input",19),g("input",function(o){return n.diceCount.set(+o.target.value)}),s(),a(30,"button",18),g("click",function(){return n.diceCount.set(n.Math.min(20,n.diceCount()+1))}),l(31,"+"),s()()(),a(32,"div",16)(33,"label"),l(34,"\xB1Bonus"),s(),a(35,"input",20),g("input",function(o){return n.manualBonus.set(+o.target.value)}),s()()(),a(36,"div",21)(37,"span",22),l(38),f(39,cs,2,4,"span",23),s()(),a(40,"button",24),g("click",function(){return n.roll()}),a(41,"span",25),l(42),s()(),f(43,ps,8,6,"div",26),a(44,"div",27)(45,"input",28),E("ngModelChange",function(o){return P(n.newConfigName,o)||(n.newConfigName=o),o}),s(),a(46,"button",29),g("click",function(){return n.saveConfiguration()}),l(47,"\u{1F4BE}"),s()()(),a(48,"div",30)(49,"div",10)(50,"h3"),l(51,"Boni"),s()(),a(52,"div",31)(53,"h4"),l(54,"Attribute"),s(),a(55,"div",32),I(56,ms,5,7,"button",33,jn),s()(),f(58,_s,8,1,"div",31),f(59,fs,5,2,"div",34),s(),a(60,"div",35)(61,"div",10)(62,"h3"),l(63,"Gespeichert"),s(),a(64,"button",36),g("click",function(){return n.showSavedList.set(!n.showSavedList())}),l(65),s()(),f(66,vs,3,1,"div",37),a(67,"div",38)(68,"div",10)(69,"h4"),l(70,"Verlauf"),s(),a(71,"button",36),g("click",function(){return n.showHistoryList.set(!n.showHistoryList())}),l(72),s()(),f(73,ws,3,0,"div",39),s()()()()()),e&2){let i;c(),T("secret-mode",n.isSecretRoll()),c(5),T("active",n.isSecretRoll()),c(),b("checked",n.isSecretRoll()),c(11),b("value",n.diceFormula()),c(2),V(n.diceTypes),c(9),b("value",n.diceCount()),c(6),b("value",n.manualBonus()),c(3),se(" ",n.diceCount(),"d",n.selectedDiceType()," "),c(),C(n.totalBonus()!==0?39:-1),c(),T("rolling",n.isRolling())("secret",n.isSecretRoll()),b("disabled",n.isRolling()),c(2),M(n.isRolling()?"\u{1F3B2}...":"\u{1F3B2} W\xFCrfeln"),c(),C((i=n.lastRoll())?43:-1,i),c(2),k("ngModel",n.newConfigName),c(),b("disabled",!n.newConfigName),c(10),V(n.statBonuses()),c(2),C(n.availableDiceBonuses().length>0?58:-1),c(),C(n.selectedBonuses().size>0?59:-1),c(6),D(" ",n.showSavedList()?"\u25BC":"\u25B6"," "),c(),C(n.showSavedList()?66:-1),c(6),D(" ",n.showHistoryList()?"\u25BC":"\u25B6"," "),c(),C(n.showHistoryList()?73:-1)}},dependencies:[A,q,Y,G,U],styles:[".dice-roller-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000d9;display:flex;align-items:center;justify-content:center;z-index:2000;animation:_ngcontent-%COMP%_fadeIn .2s ease-out;overflow:hidden;overscroll-behavior:contain}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.dice-roller-fullscreen[_ngcontent-%COMP%]{background:#1a1a1a;border:2px solid #22c55e;border-radius:16px;width:95vw;height:85vh;max-width:1200px;max-height:800px;display:flex;flex-direction:column;box-shadow:0 20px 60px #22c55e66;animation:_ngcontent-%COMP%_slideIn .3s ease-out;overflow:hidden}.dice-roller-fullscreen.secret-mode[_ngcontent-%COMP%]{border-color:#1e40af;box-shadow:0 20px 60px #1e40af66}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:linear-gradient(135deg,#22c55e,#16a34a);flex-shrink:0}.dice-roller-fullscreen.secret-mode[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e40af,#1e3a8a)}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:22px;font-weight:700}.header-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.secret-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;padding:8px 16px;background:#ffffff26;border-radius:20px;transition:all .2s}.secret-toggle[_ngcontent-%COMP%]:hover{background:#ffffff40}.secret-toggle.active[_ngcontent-%COMP%]{background:#ffffff4d}.secret-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.secret-label[_ngcontent-%COMP%]{color:#fff;font-size:14px;font-weight:500}.close-btn[_ngcontent-%COMP%]{background:#fff3;border:none;color:#fff;font-size:28px;width:40px;height:40px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d;transform:scale(1.1)}.dialog-body[_ngcontent-%COMP%]{display:flex;flex:1;overflow:hidden;gap:0}.panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;overflow-y:auto;overflow-x:hidden}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid #333}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#22c55e;font-size:16px;font-weight:600}.dice-roller-fullscreen.secret-mode[_ngcontent-%COMP%]   .panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#60a5fa}.roll-panel[_ngcontent-%COMP%]{flex:1.2;background:#222;border-right:1px solid #333}.dice-input-section[_ngcontent-%COMP%]{margin-bottom:16px}.dice-formula-input[_ngcontent-%COMP%]{width:100%;background:#1a1a1a;border:2px solid #444;border-radius:8px;color:#fff;font-size:18px;padding:12px 16px;text-align:center;font-family:monospace}.dice-formula-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#22c55e}.dice-type-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(60px,1fr));gap:8px;margin-bottom:16px}.dice-type-btn[_ngcontent-%COMP%]{background:#2a2a2a;border:2px solid #444;border-radius:8px;color:#888;font-size:16px;font-weight:700;padding:12px 8px;cursor:pointer;transition:all .2s}.dice-type-btn[_ngcontent-%COMP%]:hover{background:#333;border-color:#22c55e;color:#fff}.dice-type-btn.selected[_ngcontent-%COMP%]{background:#22c55e;border-color:#22c55e;color:#fff}.dice-controls[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}.control-group[_ngcontent-%COMP%]{flex:1}.control-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#888;font-size:12px;margin-bottom:6px}.number-control[_ngcontent-%COMP%]{display:flex;align-items:center;background:#1a1a1a;border:1px solid #444;border-radius:8px;overflow:hidden}.number-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#333;border:none;color:#fff;width:36px;height:36px;cursor:pointer;font-size:18px}.number-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#444}.number-control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;background:transparent;border:none;color:#fff;font-size:16px;text-align:center;width:50px}.bonus-input[_ngcontent-%COMP%]{width:100%;background:#1a1a1a;border:1px solid #444;border-radius:8px;color:#fff;font-size:16px;padding:8px 12px;text-align:center}.roll-summary[_ngcontent-%COMP%]{text-align:center;margin-bottom:16px}.formula-display[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#fff;font-family:monospace}.formula-display[_ngcontent-%COMP%]   .negative[_ngcontent-%COMP%]{color:#ef4444}.roll-btn[_ngcontent-%COMP%]{width:100%;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;border-radius:12px;color:#fff;font-size:20px;font-weight:700;padding:16px 24px;cursor:pointer;transition:all .2s}.roll-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 20px #22c55e66}.roll-btn.rolling[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_shake .3s infinite}.roll-btn.secret[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e40af,#1e3a8a)}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}25%{transform:translate(-4px) rotate(-2deg)}75%{transform:translate(4px) rotate(2deg)}}.result-display[_ngcontent-%COMP%]{margin-top:20px;padding:24px;background:linear-gradient(135deg,#1a3a1a,#1a2a1a);border:2px solid #22c55e;border-radius:12px;text-align:center}.result-display.secret[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1a2a4a,#1a1a3a);border-color:#1e40af}.result-display.animate[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_resultPop .5s ease-out}@keyframes _ngcontent-%COMP%_resultPop{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.1)}to{transform:scale(1);opacity:1}}.result-number[_ngcontent-%COMP%]{font-size:64px;font-weight:700;color:#22c55e;line-height:1}.result-display.secret[_ngcontent-%COMP%]   .result-number[_ngcontent-%COMP%]{color:#60a5fa}.result-breakdown[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-wrap:wrap;justify-content:center;gap:8px}.dice-rolls[_ngcontent-%COMP%]{color:#888;font-family:monospace;font-size:14px}.bonus-pill[_ngcontent-%COMP%]{background:#333;color:#22c55e;padding:4px 10px;border-radius:12px;font-size:12px}.bonus-pill.negative[_ngcontent-%COMP%]{color:#ef4444}.save-config-section[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:20px}.config-name-input[_ngcontent-%COMP%]{flex:1;background:#1a1a1a;border:1px solid #444;border-radius:8px;color:#fff;padding:10px 14px;font-size:14px}.save-config-btn[_ngcontent-%COMP%]{background:#22c55e;border:none;border-radius:8px;color:#fff;width:44px;height:44px;cursor:pointer;font-size:18px}.save-config-btn[_ngcontent-%COMP%]:disabled{background:#333;cursor:not-allowed}.bonus-panel[_ngcontent-%COMP%]{flex:1;background:#1e1e1e;border-right:1px solid #333}.bonus-section[_ngcontent-%COMP%]{margin-bottom:20px}.section-header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.section-header-row[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#888;font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}.skill-filter-input[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #444;border-radius:4px;color:#fff;padding:4px 8px;font-size:12px;width:100px}.skill-filter-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#22c55e}.bonus-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#888;font-size:13px;font-weight:600;margin:0 0 10px;text-transform:uppercase;letter-spacing:.5px}.bonus-grid[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.bonus-grid.scrollable[_ngcontent-%COMP%]{max-height:180px;overflow-y:auto;overflow-x:hidden;padding-right:4px}.bonus-grid.scrollable[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.bonus-grid.scrollable[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1a1a1a;border-radius:3px}.bonus-grid.scrollable[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#444;border-radius:3px}.bonus-grid.scrollable[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.bonus-chip[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;background:#2a2a2a;border:2px solid #444;border-radius:8px;padding:10px 14px;cursor:pointer;transition:all .2s;min-width:90px}.bonus-chip[_ngcontent-%COMP%]:hover{border-color:#666;background:#333}.bonus-chip.selected[_ngcontent-%COMP%]{border-color:#22c55e;background:#22c55e26}.bonus-chip.stat.selected[_ngcontent-%COMP%]{border-color:#a855f7;background:#a855f726}.bonus-chip.skill.selected[_ngcontent-%COMP%]{border-color:#f59e0b;background:#f59e0b26}.chip-name[_ngcontent-%COMP%]{color:#ccc;font-size:11px;text-align:center}.chip-value[_ngcontent-%COMP%]{color:#22c55e;font-size:16px;font-weight:700}.chip-value.negative[_ngcontent-%COMP%]{color:#ef4444}.chip-context[_ngcontent-%COMP%]{color:#666;font-size:9px;text-align:center;margin-top:4px}.selected-summary[_ngcontent-%COMP%]{background:#2a2a2a;border-radius:8px;padding:12px;display:flex;justify-content:space-between;align-items:center}.summary-label[_ngcontent-%COMP%]{color:#888;font-size:14px}.summary-value[_ngcontent-%COMP%]{color:#22c55e;font-size:20px;font-weight:700}.config-panel[_ngcontent-%COMP%]{flex:.8;background:#1a1a1a}.toggle-list-btn[_ngcontent-%COMP%]{background:#333;border:none;color:#888;width:28px;height:28px;border-radius:4px;cursor:pointer;font-size:10px}.saved-configs[_ngcontent-%COMP%]{margin-bottom:20px}.empty-hint[_ngcontent-%COMP%]{color:#666;font-size:12px;font-style:italic}.config-item[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:8px}.config-btn[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:space-between;align-items:center;background:#2a2a2a;border:1px solid #444;border-radius:6px;padding:10px 12px;cursor:pointer;transition:all .2s}.config-btn[_ngcontent-%COMP%]:hover{background:#333;border-color:#22c55e}.config-name[_ngcontent-%COMP%]{color:#fff;font-size:13px}.config-formula[_ngcontent-%COMP%]{color:#888;font-size:12px;font-family:monospace}.config-delete[_ngcontent-%COMP%]{background:#333;border:none;color:#888;width:32px;height:32px;border-radius:6px;cursor:pointer;font-size:16px}.config-delete[_ngcontent-%COMP%]:hover{background:#ef4444;color:#fff}.history-section[_ngcontent-%COMP%]{margin-bottom:20px}.history-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#888;font-size:13px;font-weight:600;margin:0 0 10px}.history-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.history-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:#2a2a2a;border:1px solid #333;border-radius:6px;padding:8px 12px;cursor:pointer;transition:all .2s}.history-item[_ngcontent-%COMP%]:hover{background:#333;border-color:#22c55e}.history-formula[_ngcontent-%COMP%]{color:#fff;font-family:monospace;font-size:13px}.history-result[_ngcontent-%COMP%]{color:#22c55e;font-weight:700;font-size:13px}.history-time[_ngcontent-%COMP%]{color:#666;font-size:11px}.received-section[_ngcontent-%COMP%]{margin-top:auto}.received-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#888;font-size:13px;font-weight:600;margin:0 0 10px}.received-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.received-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#2a2a2a;border:1px solid #333;border-radius:6px;padding:8px 12px;animation:_ngcontent-%COMP%_slideInRight .3s ease-out}@keyframes _ngcontent-%COMP%_slideInRight{0%{transform:translate(20px);opacity:0}to{transform:translate(0);opacity:1}}.received-item[_ngcontent-%COMP%]   .player-name[_ngcontent-%COMP%]{color:#22c55e;font-weight:600;font-size:12px}.received-item[_ngcontent-%COMP%]   .roll-info[_ngcontent-%COMP%]{color:#888;font-size:12px}.received-item[_ngcontent-%COMP%]   .roll-result[_ngcontent-%COMP%]{color:#fff;font-weight:700;font-size:14px;margin-left:auto}@media(max-width:1000px){.dialog-body[_ngcontent-%COMP%]{flex-direction:column}.panel[_ngcontent-%COMP%]{border-right:none!important;border-bottom:1px solid #333}.roll-panel[_ngcontent-%COMP%], .bonus-panel[_ngcontent-%COMP%], .config-panel[_ngcontent-%COMP%]{flex:none;max-height:40vh}}"]})};function ho(){return{id:`macro-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:"Neue Aktion",description:"",icon:"\u26A1",color:"#f59e0b",conditions:[],consequences:[],referencedSkillNames:[],isValid:!0,order:0,createdAt:new Date,modifiedAt:new Date}}function _o(){return{id:`cond-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"resource",resource:"health",operator:">",value:0,valueType:"fixed"}}function fo(){return{id:`cons-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"dice_roll",diceType:20,diceCount:1,bonuses:[]}}function gn(r,t){let e=[];for(let n of r.referencedSkillNames)t.includes(n)||e.push(n);return e}var Ss=(r,t)=>t.formulaType,Co=(r,t)=>t.id,Ms=(r,t)=>t.resource;function ks(r,t){if(r&1&&(S(0,"div",4)(1,"div",5)(2,"span",6),l(3),w(),S(4,"span"),l(5),w()(),S(6,"div",7),je(7,"div",8),S(8,"span",9),l(9),w()()()),r&2){let e=d().$implicit,n=d();c(3),M(n.getResourceIcon(e.formulaType)),c(2),M(e.statusName),c(2),z("width",n.getResourcePercent(e),"%"),T("health",e.formulaType==="LIFE")("energy",e.formulaType==="ENERGY")("mana",e.formulaType==="MANA"),c(2),se("",e.statusCurrent," / ",n.getStatusMax(e))}}function Ps(r,t){if(r&1&&f(0,ks,10,12,"div",4),r&2){let e=t.$implicit;C(e.formulaType==="LIFE"||e.formulaType==="ENERGY"||e.formulaType==="MANA"?0:-1)}}function Es(r,t){if(r&1&&(S(0,"div",16)(1,"span",18),l(2),w(),S(3,"span",19),l(4),w(),S(5,"span",20),l(6),w()()),r&2){let e=t.$implicit;c(),z("color",e.color),c(),M(e.name),c(2),M(e.formula),c(),z("color",e.color),c(),M(e.total)}}function Os(r,t){if(r&1&&(S(0,"div",21)(1,"span",18),l(2),w(),S(3,"span",20),l(4),w()()),r&2){let e=t.$implicit;T("negative",e.amount<0)("positive",e.amount>0),c(2),M(e.resource),c(),T("negative",e.amount<0)("positive",e.amount>0),c(),se(" ",e.amount>0?"+":"","",e.amount," ")}}function Ds(r,t){if(r&1&&(S(0,"div",12)(1,"div",13)(2,"span",14),l(3),w(),S(4,"span",15),l(5),w()(),I(6,Es,7,7,"div",16,Co),I(8,Os,5,11,"div",17,Ms),w()),r&2){let e=t.$implicit;z("border-left-color",e.actionColor),T("animate",e.isNew),c(3),M(e.actionIcon),c(),z("color",e.actionColor),c(),M(e.actionName),c(),V(e.rolls),c(2),V(e.resourceChanges)}}function Ts(r,t){if(r&1&&(S(0,"div",3)(1,"h4"),l(2,"\u{1F3B2} Aktionsverlauf"),w(),S(3,"div",10),I(4,Ds,10,8,"div",11,Co),w()()),r&2){let e=d();c(4),V(e.actionHistory)}}var hn=class r{sheet;actionHistory=[];getResourceIcon(t){switch(t){case"LIFE":return"\u2764\uFE0F";case"ENERGY":return"\u26A1";case"MANA":return"\u2728";default:return"\u{1F4CA}"}}getResourcePercent(t){let e=this.getStatusMax(t);return e>0?t.statusCurrent/e*100:0}getStatusMax(t){return t.statusBase+t.statusBonus}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-resource-panel"]],inputs:{sheet:"sheet",actionHistory:"actionHistory"},decls:8,vars:1,consts:[[1,"resource-panel"],[1,"panel-header"],[1,"resource-bars"],[1,"action-history-section"],[1,"resource-bar-container"],[1,"resource-label"],[1,"resource-icon"],[1,"resource-bar"],[1,"resource-fill"],[1,"resource-text"],[1,"execution-list"],[1,"execution-group",3,"animate","border-left-color"],[1,"execution-group"],[1,"execution-header"],[1,"execution-icon"],[1,"execution-name"],[1,"compact-result","roll"],[1,"compact-result","resource",3,"negative","positive"],[1,"compact-label"],[1,"compact-formula"],[1,"compact-value"],[1,"compact-result","resource"]],template:function(e,n){e&1&&(S(0,"div",0)(1,"div",1)(2,"h3"),l(3,"Ressourcen"),w()(),S(4,"div",2),I(5,Ps,1,1,null,null,Ss),w(),f(7,Ts,6,0,"div",3),w()),e&2&&(c(5),V(n.sheet.statuses),c(2),C(n.actionHistory.length>0?7:-1))},dependencies:[A],styles:[".resource-panel[_ngcontent-%COMP%]{width:240px;flex-shrink:0;border-right:1px solid #333;background:#1e1e1e;overflow-y:auto;display:flex;flex-direction:column}.panel-header[_ngcontent-%COMP%]{padding:16px 20px;border-bottom:1px solid #333;background:#222}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#f59e0b;font-size:1.1rem;font-weight:500}.resource-bars[_ngcontent-%COMP%]{padding:12px;display:flex;flex-direction:column;gap:12px}.resource-bar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.resource-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#ccc;font-size:.9rem}.resource-icon[_ngcontent-%COMP%]{font-size:1.1rem}.resource-bar[_ngcontent-%COMP%]{height:24px;background:#0009;border-radius:12px;position:relative;overflow:hidden;border:1px solid rgba(0,0,0,.4)}.resource-fill[_ngcontent-%COMP%]{height:100%;border-radius:12px;transition:width .3s ease}.resource-fill.health[_ngcontent-%COMP%]{background:#ef4444;box-shadow:0 0 30px #ef4444,0 0 60px #ef4444,0 0 90px #ef4444,inset 0 0 15px #ef4444;filter:brightness(1.3)}.resource-fill.energy[_ngcontent-%COMP%]{background:#22c55e;box-shadow:0 0 30px #22c55e,0 0 60px #22c55e,0 0 90px #22c55e,inset 0 0 15px #22c55e;filter:brightness(1.3)}.resource-fill.mana[_ngcontent-%COMP%]{background:#3b82f6;box-shadow:0 0 30px #3b82f6,0 0 60px #3b82f6,0 0 90px #3b82f6,inset 0 0 15px #3b82f6;filter:brightness(1.3)}.resource-text[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:.75rem;font-weight:600;text-shadow:0 1px 2px rgba(0,0,0,.8)}.action-history-section[_ngcontent-%COMP%]{padding:12px;border-top:1px solid #333;max-height:calc(100vh - 400px);overflow-y:auto;flex:1}.action-history-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;color:#f59e0b;font-size:.9rem;font-weight:600;position:sticky;top:0;background:#1e1e1e;padding:4px 0;z-index:1}.execution-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.execution-group[_ngcontent-%COMP%]{background:#252525;border-radius:8px;padding:8px 10px;border-left:3px solid #f59e0b;transition:all .3s ease}.execution-group.animate[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_executionSlide .4s ease}@keyframes _ngcontent-%COMP%_executionSlide{0%{transform:translateY(-10px);opacity:0}to{transform:translateY(0);opacity:1}}.execution-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-bottom:6px;padding-bottom:4px;border-bottom:1px solid #333}.execution-icon[_ngcontent-%COMP%]{font-size:1rem;flex-shrink:0}.execution-name[_ngcontent-%COMP%]{font-weight:700;font-size:.85rem;color:#f59e0b;text-shadow:0 0 8px currentColor}.compact-result[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;padding:4px 6px;background:#0000004d;border-radius:5px;margin-top:4px;font-size:.8rem}.compact-result.roll[_ngcontent-%COMP%]{border-left:2px solid rgba(245,158,11,.5)}.compact-result.resource.negative[_ngcontent-%COMP%]{border-left:2px solid rgba(239,68,68,.5);background:#ef444414}.compact-result.resource.positive[_ngcontent-%COMP%]{border-left:2px solid rgba(34,197,94,.5);background:#22c55e14}.compact-label[_ngcontent-%COMP%]{font-weight:600;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.8),0 0 6px currentColor}.compact-formula[_ngcontent-%COMP%]{color:#999;font-family:Courier New,monospace;font-size:.75rem;margin-left:auto}.compact-value[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.9),0 0 8px currentColor;min-width:35px;text-align:right}.compact-value.negative[_ngcontent-%COMP%]{color:#ff6b6b;text-shadow:0 1px 3px rgba(0,0,0,.9),0 0 10px rgba(239,68,68,.6)}.compact-value.positive[_ngcontent-%COMP%]{color:#51cf66;text-shadow:0 1px 3px rgba(0,0,0,.9),0 0 10px rgba(34,197,94,.6)}"]})};var bo=(r,t)=>t.id;function Rs(r,t){r&1&&(a(0,"div",0)(1,"span",2),l(2,"\u26A1"),s(),a(3,"p"),l(4,"Keine Aktionen konfiguriert"),s(),a(5,"p",3),l(6,"Erstelle eine Aktion, um komplexe W\xFCrfe zu automatisieren"),s()())}function Is(r,t){if(r&1&&W(0,"div",9),r&2){let e=d(2);z("grid-column",e.previewGridX+1)("grid-row",e.previewGridY+1)}}function Vs(r,t){if(r&1&&(a(0,"span",14),l(1,"\u26A0\uFE0F"),s()),r&2){let e=d().$implicit,n=d(2);b("title","Fehlende Skills: "+n.getMissingSkills(e).join(", "))}}function Fs(r,t){if(r&1&&(a(0,"p",15),l(1),s()),r&2){let e=d().$implicit;c(),M(e.description)}}function Ls(r,t){if(r&1&&(a(0,"span",22),l(1),s()),r&2){let e=t.$implicit,n=d(3);le(e.type),c(),M(n.getConsequenceLabel(e))}}function As(r,t){if(r&1){let e=y();a(0,"div",10),g("cdkDragStarted",function(){let i=m(e).$implicit,o=d(2);return u(o.onDragStart(i))})("cdkDragEnded",function(){m(e);let i=d(2);return u(i.onDragEnd())}),a(1,"div",11)(2,"span",12),l(3),s(),a(4,"span",13),l(5),s(),f(6,Vs,2,1,"span",14),s(),f(7,Fs,2,1,"p",15),a(8,"div",16),I(9,Ls,2,3,"span",17,bo),s(),a(11,"div",18)(12,"button",19),g("click",function(){let i=m(e).$implicit,o=d(2);return u(o.runMacro.emit(i))})("mousedown",function(i){return m(e),u(i.stopPropagation())})("touchstart",function(i){return m(e),u(i.stopPropagation())}),l(13," \u25B6 Ausf\xFChren "),s(),a(14,"button",20),g("click",function(){let i=m(e).$implicit,o=d(2);return u(o.editMacro.emit(i))})("mousedown",function(i){return m(e),u(i.stopPropagation())})("touchstart",function(i){return m(e),u(i.stopPropagation())}),l(15,"\u270F\uFE0F"),s(),a(16,"button",21),g("click",function(){let i=m(e).$implicit,o=d(2);return u(o.deleteMacro.emit(i.id))})("mousedown",function(i){return m(e),u(i.stopPropagation())})("touchstart",function(i){return m(e),u(i.stopPropagation())}),l(17,"\u{1F5D1}\uFE0F"),s()()()}if(r&2){let e=t.$implicit,n=d(2);z("border-left-color",e.color)("grid-column",n.getGridPosition(e).x+1)("grid-row",n.getGridPosition(e).y+1),T("invalid",!e.isValid)("disabled",!n.areConditionsMet(e))("dragging",(n.draggedMacro==null?null:n.draggedMacro.id)===e.id),b("cdkDragData",e),c(3),M(e.icon||"\u26A1"),c(2),M(e.name),c(),C(e.isValid?-1:6),c(),C(e.description?7:-1),c(2),V(e.consequences),c(3),b("disabled",!n.areConditionsMet(e))}}function Ns(r,t){if(r&1){let e=y();a(0,"div",4),g("cdkDropListDropped",function(i){m(e);let o=d();return u(o.onDrop(i))})("mousedown",function(i){m(e);let o=d();return u(o.onMouseDown(i))})("mousemove",function(i){m(e);let o=d();return u(o.onMouseMove(i))})("mouseup",function(){m(e);let i=d();return u(i.onMouseUp())})("mouseleave",function(){m(e);let i=d();return u(i.onMouseLeave())}),a(1,"div",5)(2,"div",6),f(3,Is,1,4,"div",7),I(4,As,18,18,"div",8,bo),s()()()}if(r&2){let e=d();T("panning",e.isPanning),b("cdkDropListSortingDisabled",!0),c(),z("transform",e.transformStyle),c(2),C(e.showDropPreview&&e.draggedMacro?3:-1),c(),V(e.macros)}}var _n=class r{constructor(t){this.elementRef=t}macros=[];sheet;gridColumns=4;runMacro=new v;editMacro=new v;deleteMacro=new v;dropMacro=new v;dragStart=new v;dragEnd=new v;draggedMacro=null;isPanning=!1;panX=0;panY=0;lastMouseX=0;lastMouseY=0;zoom=1;isDraggingMacro=!1;showDropPreview=!1;previewGridX=0;previewGridY=0;get transformStyle(){return`translate(${this.panX}px, ${this.panY}px) scale(${this.zoom})`}onDrop(t){this.dropMacro.emit({event:t,zoom:this.zoom,panX:this.panX,panY:this.panY})}onDragStart(t){this.draggedMacro=t,this.isDraggingMacro=!0,this.showDropPreview=!0,this.dragStart.emit(t)}onDragEnd(){this.draggedMacro=null,this.isDraggingMacro=!1,this.showDropPreview=!1,this.dragEnd.emit()}onDocumentMouseMove(t){if(!this.isDraggingMacro||!this.showDropPreview)return;let e=this.elementRef.nativeElement.querySelector(".macro-grid-container");if(!e)return;let n=e.getBoundingClientRect(),i=240,o=120,p=14,h=window.getComputedStyle(e),_=parseFloat(h.paddingLeft)||0,x=parseFloat(h.paddingTop)||0,O=t.clientX-n.left,R=t.clientY-n.top,N=(O-_-this.panX)/this.zoom,j=(R-x-this.panY)/this.zoom,ne=i+p,pe=o+p,J=Math.max(0,Math.floor(N/ne)),ye=Math.max(0,Math.floor(j/pe));this.previewGridX=J,this.previewGridY=ye}onWheel(t){t.preventDefault();let e=t.deltaY*-.001,n=Math.min(Math.max(.1,this.zoom+e),3),i=this.elementRef.nativeElement.querySelector(".macro-grid-container");if(!i)return;let o=i.getBoundingClientRect(),p=window.getComputedStyle(i),h=parseFloat(p.paddingLeft)||0,_=parseFloat(p.paddingTop)||0,x=t.clientX-o.left,O=t.clientY-o.top,R=(x-h-this.panX)/this.zoom,N=(O-_-this.panY)/this.zoom;this.zoom=n,this.panX=x-h-R*this.zoom,this.panY=O-_-N*this.zoom}onMouseDown(t){let e=t.target;this.isDraggingMacro||e.closest(".macro-card")||(this.isPanning=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,t.preventDefault())}onMouseMove(t){if(this.isPanning){let e=t.clientX-this.lastMouseX,n=t.clientY-this.lastMouseY;this.panX+=e,this.panY+=n,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY}}onMouseUp(){this.isPanning=!1}onMouseLeave(){this.isPanning=!1}getGridPosition(t){return t.gridX!==void 0&&t.gridY!==void 0?{x:t.gridX,y:t.gridY}:{x:0,y:0}}areConditionsMet(t){return!t.conditions||t.conditions.length===0?!0:t.conditions.every(e=>(e.type==="skill",!0))}getMissingSkills(t){return[]}getConsequenceLabel(t){switch(t.type){case"dice_roll":return"\u{1F3B2}";case"spend_resource":return"\u{1F4A7} -";case"gain_resource":return"\u{1F4A7} +";case"apply_bonus":return"\u26A1 +";default:return"?"}}static \u0275fac=function(e){return new(e||r)(K(Ae))};static \u0275cmp=F({type:r,selectors:[["app-macro-grid"]],hostBindings:function(e,n){e&1&&g("mousemove",function(o){return n.onDocumentMouseMove(o)},ii)("wheel",function(o){return n.onWheel(o)})},inputs:{macros:"macros",sheet:"sheet",gridColumns:"gridColumns"},outputs:{runMacro:"runMacro",editMacro:"editMacro",deleteMacro:"deleteMacro",dropMacro:"dropMacro",dragStart:"dragStart",dragEnd:"dragEnd"},decls:2,vars:1,consts:[[1,"empty-state"],["cdkDropList","",1,"macro-grid-container",3,"panning","cdkDropListSortingDisabled"],[1,"empty-icon"],[1,"empty-hint"],["cdkDropList","",1,"macro-grid-container",3,"cdkDropListDropped","mousedown","mousemove","mouseup","mouseleave","cdkDropListSortingDisabled"],[1,"macro-grid-wrapper"],[1,"macro-grid"],[1,"drop-preview",3,"grid-column","grid-row"],["cdkDrag","",1,"macro-card",3,"cdkDragData","invalid","disabled","dragging","border-left-color","grid-column","grid-row"],[1,"drop-preview"],["cdkDrag","",1,"macro-card",3,"cdkDragStarted","cdkDragEnded","cdkDragData"],[1,"macro-header"],[1,"macro-icon"],[1,"macro-name"],[1,"invalid-badge",3,"title"],[1,"macro-description"],[1,"macro-summary"],[1,"consequence-tag",3,"class"],[1,"macro-actions"],[1,"run-btn",3,"click","mousedown","touchstart","disabled"],[1,"edit-btn",3,"click","mousedown","touchstart"],[1,"delete-btn",3,"click","mousedown","touchstart"],[1,"consequence-tag"]],template:function(e,n){e&1&&f(0,Rs,7,0,"div",0)(1,Ns,6,6,"div",1),e&2&&C(n.macros.length===0?0:1)},dependencies:[A,me,ve,xe],styles:[".empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 40px;color:#888}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;display:block;margin-bottom:20px;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;font-size:1.1rem}.empty-hint[_ngcontent-%COMP%]{font-size:.9rem;color:#666}.macro-grid-container[_ngcontent-%COMP%]{padding:20px;overflow:hidden;flex:1;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;position:relative}.macro-grid-container.panning[_ngcontent-%COMP%], .macro-grid-container.panning[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{cursor:grabbing!important}.macro-grid-wrapper[_ngcontent-%COMP%]{position:relative;will-change:transform;transition:none;transform-origin:0 0;min-width:100%;width:max-content}.macro-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,240px);grid-auto-columns:240px;grid-template-rows:repeat(auto-fit,120px);grid-auto-rows:120px;gap:14px;min-height:600px;min-width:100%;position:relative;cursor:grab}.macro-grid[_ngcontent-%COMP%]:active:not(:has(.macro-card:hover)){cursor:grabbing}.drop-preview[_ngcontent-%COMP%]{background:#f59e0b33;border:2px dashed #f59e0b;border-radius:12px;height:120px;pointer-events:none;z-index:1;animation:_ngcontent-%COMP%_pulse-preview 1s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-preview{0%,to{opacity:.6}50%{opacity:1}}.macro-card[_ngcontent-%COMP%]{background:#252525;border-radius:12px;padding:14px;border-left:4px solid #f59e0b;cursor:default;display:flex;flex-direction:column;height:120px;min-height:120px;max-height:120px;overflow:hidden;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;will-change:transform}.macro-card[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;cursor:inherit}.macro-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 24px #0006;transition:transform .1s,box-shadow .1s}.macro-card[_ngcontent-%COMP%]:active{cursor:grabbing}.macro-card.dragging[_ngcontent-%COMP%]{opacity:.5;cursor:grabbing}.macro-card.invalid[_ngcontent-%COMP%]{border-left-color:#ef4444!important;background:#2a1f1f}.macro-card.disabled[_ngcontent-%COMP%]{opacity:.5}.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 15px 40px #0009;cursor:grabbing!important;opacity:.95;transform:rotate(2deg) scale(1.05);transition:none!important}.cdk-drag-preview[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{cursor:grabbing!important}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0;background:transparent}.cdk-drag-animating[_ngcontent-%COMP%]{transition:none!important}.macro-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:8px}.macro-icon[_ngcontent-%COMP%]{font-size:1.4rem}.macro-name[_ngcontent-%COMP%]{font-size:1.05rem;font-weight:600;color:#fff;flex:1}.invalid-badge[_ngcontent-%COMP%]{background:#ef4444;color:#fff;padding:2px 6px;border-radius:4px;font-size:.7rem;font-weight:600}.macro-description[_ngcontent-%COMP%]{color:#888;font-size:.8rem;margin:0 0 10px;line-height:1.3;max-height:2.6em;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;line-clamp:2;-webkit-box-orient:vertical}.macro-summary[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:10px;flex:1}.consequence-tag[_ngcontent-%COMP%]{background:#1e3a1e;color:#22c55e;padding:3px 8px;border-radius:5px;font-size:.75rem;white-space:nowrap}.consequence-tag.dice_roll[_ngcontent-%COMP%]{background:#1e2a3a;color:#60a5fa}.consequence-tag.spend_resource[_ngcontent-%COMP%]{background:#3a1e1e;color:#f87171}.consequence-tag.gain_resource[_ngcontent-%COMP%]{background:#1e3a1e;color:#4ade80}.consequence-tag.apply_bonus[_ngcontent-%COMP%]{background:#3a2e1e;color:#fbbf24}.macro-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}.run-btn[_ngcontent-%COMP%]{flex:1;background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;border:none;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600;font-size:.9rem;transition:all .2s;white-space:nowrap}.run-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#16a34a,#15803d);transform:translateY(-1px)}.run-btn[_ngcontent-%COMP%]:disabled{background:#333;color:#666;cursor:not-allowed}.edit-btn[_ngcontent-%COMP%], .delete-btn[_ngcontent-%COMP%]{background:#333;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-size:.95rem;transition:all .2s;flex-shrink:0}.edit-btn[_ngcontent-%COMP%]:hover{background:#4a4a4a}.delete-btn[_ngcontent-%COMP%]:hover{background:#5c2020}"]})};var Yn=(r,t)=>t.id;function Bs(r,t){if(r&1){let e=y();a(0,"div",9)(1,"h3"),l(2,"Verf\xFCgbare Aktionen"),s()(),a(3,"app-macro-grid",10),g("runMacro",function(i){m(e);let o=d();return u(o.runMacroWithResults(i))})("editMacro",function(i){m(e);let o=d();return u(o.editMacro(i))})("deleteMacro",function(i){m(e);let o=d();return u(o.deleteMacro(i))})("dropMacro",function(i){m(e);let o=d();return u(o.dropMacro(i))})("dragStart",function(i){m(e);let o=d();return u(o.onDragStart(i))})("dragEnd",function(){m(e);let i=d();return u(i.onDragEnd())}),s()}if(r&2){let e=d();c(3),b("macros",e.macros())("sheet",e.sheet)("gridColumns",e.gridColumns)}}function zs(r,t){if(r&1){let e=y();a(0,"button",30),g("click",function(){let i=m(e).$implicit,o=d();return u(o.icon=i)}),l(1),s()}if(r&2){let e=t.$implicit,n=d();T("selected",n.icon===e),c(),D(" ",e," ")}}function Ws(r,t){r&1&&(a(0,"p",26),l(1,"Keine Bedingungen - Aktion ist immer verf\xFCgbar"),s())}function Hs(r,t){if(r&1&&(a(0,"option",39),l(1),s()),r&2){let e=t.$implicit;b("value",e),c(),M(e)}}function qs(r,t){if(r&1){let e=y();a(0,"select",32),E("ngModelChange",function(i){m(e);let o=d().$implicit;return P(o.resource,i)||(o.resource=i),u(i)}),I(1,Hs,2,2,"option",39,te),s()}if(r&2){let e=d().$implicit,n=d(4);k("ngModel",e.resource),c(),V(n.resourceTypes)}}function js(r,t){if(r&1&&(a(0,"option",39),l(1),s()),r&2){let e=t.$implicit;b("value",e),c(),M(e)}}function $s(r,t){if(r&1){let e=y();a(0,"select",32),E("ngModelChange",function(i){m(e);let o=d().$implicit;return P(o.stat,i)||(o.stat=i),u(i)}),I(1,js,2,2,"option",39,te),s()}if(r&2){let e=d().$implicit,n=d(4);k("ngModel",e.stat),c(),V(n.statTypes)}}function Ys(r,t){if(r&1){let e=y();a(0,"input",40),E("ngModelChange",function(i){m(e);let o=d().$implicit;return P(o.skillName,i)||(o.skillName=i),u(i)}),s()}if(r&2){let e=d().$implicit;k("ngModel",e.skillName)}}function Gs(r,t){if(r&1&&(a(0,"option",39),l(1),s()),r&2){let e=t.$implicit;b("value",e),c(),M(e)}}function Us(r,t){if(r&1){let e=y();a(0,"input",46),E("ngModelChange",function(i){m(e);let o=d(2).$implicit;return P(o.value,i)||(o.value=i),u(i)}),s()}if(r&2){let e=d(2).$implicit;k("ngModel",e.value)}}function Xs(r,t){if(r&1&&(a(0,"option",39),l(1),s()),r&2){let e=t.$implicit;b("value",e),c(),M(e)}}function Js(r,t){if(r&1){let e=y();a(0,"select",32),E("ngModelChange",function(i){m(e);let o=d(2).$implicit;return P(o.compareToResource,i)||(o.compareToResource=i),u(i)}),I(1,Xs,2,2,"option",39,te),s()}if(r&2){let e=d(2).$implicit,n=d(4);k("ngModel",e.compareToResource),c(),V(n.resourceTypes)}}function Ks(r,t){if(r&1&&(a(0,"option",39),l(1),s()),r&2){let e=t.$implicit;b("value",e),c(),M(e)}}function Zs(r,t){if(r&1){let e=y();a(0,"select",32),E("ngModelChange",function(i){m(e);let o=d(2).$implicit;return P(o.compareToStat,i)||(o.compareToStat=i),u(i)}),I(1,Ks,2,2,"option",39,te),s()}if(r&2){let e=d(2).$implicit,n=d(4);k("ngModel",e.compareToStat),c(),V(n.statTypes)}}function Qs(r,t){if(r&1){let e=y();a(0,"select",32),E("ngModelChange",function(i){m(e);let o=d().$implicit;return P(o.operator,i)||(o.operator=i),u(i)}),I(1,Gs,2,2,"option",39,te),s(),a(3,"select",41),E("ngModelChange",function(i){m(e);let o=d().$implicit;return P(o.valueType,i)||(o.valueType=i),u(i)}),a(4,"option",42),l(5,"Fester Wert"),s(),a(6,"option",43),l(7,"Aktuelle Ressource"),s(),a(8,"option",44),l(9,"Max Ressource"),s(),a(10,"option",34),l(11,"Attribut"),s()(),f(12,Us,1,1,"input",45)(13,Js,3,1,"select",36)(14,Zs,3,1,"select",36)}if(r&2){let e=d().$implicit,n=d(4);k("ngModel",e.operator),c(),V(n.operators),c(2),k("ngModel",e.valueType),c(9),C(e.valueType==="fixed"?12:e.valueType==="currentResource"||e.valueType==="maxResource"?13:e.valueType==="stat"?14:-1)}}function el(r,t){if(r&1){let e=y();a(0,"div",31)(1,"select",32),E("ngModelChange",function(i){let o=m(e).$implicit;return P(o.type,i)||(o.type=i),u(i)}),a(2,"option",33),l(3,"Ressource"),s(),a(4,"option",34),l(5,"Attribut"),s(),a(6,"option",35),l(7,"Skill"),s()(),f(8,qs,3,1,"select",36)(9,$s,3,1,"select",36)(10,Ys,1,1,"input",37),f(11,Qs,15,3),a(12,"button",38),g("click",function(){let i=m(e).$index,o=d(4);return u(o.removeCondition(i))}),l(13,"\xD7"),s()()}if(r&2){let e=t.$implicit;c(),k("ngModel",e.type),c(7),C(e.type==="resource"?8:e.type==="stat"?9:10),c(3),C(e.type!=="skill"?11:-1)}}function tl(r,t){if(r&1&&I(0,el,14,3,"div",31,Yn),r&2){let e=d();V(e.conditions)}}function nl(r,t){r&1&&(a(0,"p",26),l(1,"Keine Aktionen definiert"),s())}function il(r,t){if(r&1&&(a(0,"option",39),l(1),s()),r&2){let e=t.$implicit;b("value",e),c(),M(e)}}function ol(r,t){if(r&1){let e=y();a(0,"div",19)(1,"label"),l(2,"Ressource"),s(),a(3,"select",63),E("ngModelChange",function(i){m(e);let o=d().$implicit;return P(o.resource,i)||(o.resource=i),u(i)}),I(4,il,2,2,"option",39,te),s()()}if(r&2){let e=d().$implicit,n=d(4);c(3),k("ngModel",e.resource),c(),V(n.resourceTypes)}}function rl(r,t){r&1&&(a(0,"span",60),l(1,"\u2713"),s())}function al(r,t){if(r&1&&(a(0,"span",61),l(1,"\u2717"),s()),r&2){let e=d().$implicit,n=d(4);b("title",ri(n.getFormulaError(e.diceFormula)))}}function sl(r,t){if(r&1&&(a(0,"div",62),l(1),s()),r&2){let e=d().$implicit,n=d(4);c(),D(" ",n.getFormulaError(e.diceFormula)," ")}}function ll(r,t){if(r&1&&(a(0,"option",39),l(1),s()),r&2){let e=t.$implicit;b("value",e.id),c(),Mt(" ",e.name," (",e.diceCount,"d",e.diceType,") ")}}function cl(r,t){if(r&1){let e=y();a(0,"div",64)(1,"span"),l(2,"ODER"),s()(),a(3,"div",19)(4,"label")(5,"span",15),l(6,"\u{1F4BE}"),s(),l(7," Gespeicherte W\xFCrfelkonfiguration "),a(8,"span",20),l(9,"W\xE4hle eine vorher gespeicherte Konfiguration"),s()(),a(10,"select",65),E("ngModelChange",function(i){m(e);let o=d().$implicit;return P(o.savedDiceConfigId,i)||(o.savedDiceConfigId=i),u(i)}),g("change",function(){m(e);let i=d().$implicit,o=d(4);return u(o.onSavedConfigSelected(i))}),a(11,"option",66),l(12,"-- Keine gespeicherte Konfiguration --"),s(),I(13,ll,2,4,"option",39,Yn),s()()}if(r&2){let e=d().$implicit,n=d(4);c(10),k("ngModel",e.savedDiceConfigId),c(3),V(n.savedDiceConfigs())}}function dl(r,t){if(r&1){let e=y();a(0,"div",47)(1,"div",48)(2,"div",14)(3,"label"),l(4,"Aktionstyp"),s(),a(5,"select",49),E("ngModelChange",function(i){let o=m(e).$implicit;return P(o.type,i)||(o.type=i),u(i)}),a(6,"option",50),l(7,"\u{1F3B2} W\xFCrfeln"),s(),a(8,"option",51),l(9,"\u{1F4C9} Ressource ausgeben"),s(),a(10,"option",52),l(11,"\u{1F4C8} Ressource erhalten"),s()()(),a(12,"button",53),g("click",function(){let i=m(e).$index,o=d(4);return u(o.removeConsequence(i))}),a(13,"span"),l(14,"\xD7"),s()()(),f(15,ol,6,1,"div",19),a(16,"div",54)(17,"div",13)(18,"div",14)(19,"label")(20,"span",15),l(21,"\u{1F3F7}\uFE0F"),s(),l(22," Anzeigename (optional) "),s(),a(23,"input",55),E("ngModelChange",function(i){let o=m(e).$implicit;return P(o.rollName,i)||(o.rollName=i),u(i)}),s()(),a(24,"div",56)(25,"label")(26,"span",15),l(27,"\u{1F3A8}"),s(),l(28," Farbe "),s(),a(29,"input",57),E("ngModelChange",function(i){let o=m(e).$implicit;return P(o.rollColor,i)||(o.rollColor=i),u(i)}),s()()(),a(30,"div",19)(31,"label")(32,"span",15),l(33,"\u{1F3B2}"),s(),l(34," W\xFCrfelformel oder fester Wert "),a(35,"span",20),l(36,"Beispiele: 1d20+3, 2d6*2, 3d10+5-2, oder einfach 10"),s()(),a(37,"div",58)(38,"input",59),E("ngModelChange",function(i){let o=m(e).$implicit;return P(o.diceFormula,i)||(o.diceFormula=i),u(i)}),g("ngModelChange",function(){let i=m(e).$implicit,o=d(4);return u(o.onFormulaChange(i))}),s(),f(39,rl,2,0,"span",60),f(40,al,2,2,"span",61),s(),f(41,sl,2,1,"div",62),s(),f(42,cl,15,1),s()()}if(r&2){let e=t.$implicit,n=d(4);c(5),k("ngModel",e.type),c(10),C(e.type==="spend_resource"||e.type==="gain_resource"?15:-1),c(8),k("ngModel",e.rollName),c(6),k("ngModel",e.rollColor),c(9),T("valid",n.isFormulaValid(e.diceFormula))("invalid",e.diceFormula&&!n.isFormulaValid(e.diceFormula)),k("ngModel",e.diceFormula),c(),C(e.diceFormula&&n.isFormulaValid(e.diceFormula)?39:-1),c(),C(e.diceFormula&&!n.isFormulaValid(e.diceFormula)?40:-1),c(),C(e.diceFormula&&!n.isFormulaValid(e.diceFormula)?41:-1),c(),C(n.savedDiceConfigs().length>0?42:-1)}}function pl(r,t){if(r&1&&I(0,dl,43,13,"div",47,Yn),r&2){let e=d();V(e.consequences)}}function ml(r,t){if(r&1){let e=y();a(0,"div",9)(1,"h3"),l(2),s()(),a(3,"div",11)(4,"div",12)(5,"h3"),l(6,"\u2699\uFE0F Grundeinstellungen"),s(),a(7,"div",13)(8,"div",14)(9,"label")(10,"span",15),l(11,"\u270F\uFE0F"),s(),l(12," Name "),s(),a(13,"input",16),E("ngModelChange",function(i){let o=m(e);return P(o.name,i)||(o.name=i),u(i)}),s()(),a(14,"div",17)(15,"label")(16,"span",15),l(17,"\u{1F3A8}"),s(),l(18," Farbe "),s(),a(19,"input",18),E("ngModelChange",function(i){let o=m(e);return P(o.color,i)||(o.color=i),u(i)}),s()()(),a(20,"div",19)(21,"label")(22,"span",15),l(23,"\u{1F4DD}"),s(),l(24," Beschreibung "),a(25,"span",20),l(26,"Optional: Was macht diese Aktion?"),s()(),a(27,"input",21),E("ngModelChange",function(i){let o=m(e);return P(o.description,i)||(o.description=i),u(i)}),s()(),a(28,"div",19)(29,"label")(30,"span",15),l(31,"\u{1F3AD}"),s(),l(32," Icon "),s(),a(33,"div",22),I(34,zs,2,3,"button",23,te),s()()(),a(36,"div",12)(37,"div",24)(38,"h4"),l(39,"\u2753 Bedingungen (Wenn...)"),s(),a(40,"button",25),g("click",function(){m(e);let i=d(2);return u(i.addCondition())}),l(41,"+ Bedingung"),s()(),f(42,Ws,2,0,"p",26)(43,tl,2,0),s(),a(44,"div",12)(45,"div",24)(46,"h4"),l(47,"\u26A1 Aktionen (Dann...)"),s(),a(48,"button",25),g("click",function(){m(e);let i=d(2);return u(i.addConsequence())}),l(49,"+ Aktion"),s()(),f(50,nl,2,0,"p",26)(51,pl,2,0),s(),a(52,"div",27)(53,"button",28),g("click",function(){m(e);let i=d(2);return u(i.closeEditor())}),l(54,"Abbrechen"),s(),a(55,"button",29),g("click",function(){m(e);let i=d(2);return u(i.saveMacro())}),l(56,"Speichern"),s()()()}if(r&2){let e=t,n=d(2);c(2),M(n.isNewMacro()?"Neue Aktion":"Aktion bearbeiten"),c(11),k("ngModel",e.name),c(6),k("ngModel",e.color),c(8),k("ngModel",e.description),c(7),V(n.availableIcons),c(8),C(e.conditions.length===0?42:43),c(8),C(e.consequences.length===0?50:51)}}function ul(r,t){if(r&1&&f(0,ml,57,6),r&2){let e,n=d();C((e=n.editingMacro())?0:-1,e)}}function $n(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}function xt(r){if(!r||!r.trim())return{isValid:!1,operations:[],displayFormula:"",error:"Empty formula"};let t=r.trim().replace(/\s+/g,""),e=parseFloat(t);if(!isNaN(e)&&/^-?\d+(\.\d+)?$/.test(t))return{isValid:!0,operations:[{type:"add",value:e}],displayFormula:e.toString()};let n=t.match(/^(\d+)d(\d+)(.*)$/i);if(!n)return{isValid:!1,operations:[],displayFormula:t,error:"Invalid dice format. Use format: XdY or XdY+Z"};let i=parseInt(n[1]),o=parseInt(n[2]),p=n[3]||"";if(i<1||i>100)return{isValid:!1,operations:[],displayFormula:t,error:"Dice count must be 1-100"};if(o<2||o>1e3)return{isValid:!1,operations:[],displayFormula:t,error:"Dice type must be 2-1000"};let h=[];if(p){let _=p.matchAll(/([+\-*/])(\d+(\.\d+)?)/g);for(let O of _){let R=O[1],N=parseFloat(O[2]);if(isNaN(N))return{isValid:!1,operations:[],displayFormula:t,error:"Invalid operation value"};switch(R){case"+":h.push({type:"add",value:N});break;case"-":h.push({type:"subtract",value:N});break;case"*":h.push({type:"multiply",value:N});break;case"/":if(N===0)return{isValid:!1,operations:[],displayFormula:t,error:"Cannot divide by zero"};h.push({type:"divide",value:N});break}}if(h.map(O=>(O.type==="add"?"+":O.type==="subtract"?"-":O.type==="multiply"?"*":"/")+O.value).join("")!==p)return{isValid:!1,operations:[],displayFormula:t,error:"Invalid formula syntax"}}return{isValid:!0,diceCount:i,diceType:o,operations:h,displayFormula:t}}function xo(r){if(!r.isValid)return{rolls:[],total:0,formula:""};let t=[],e=0;if(r.diceCount&&r.diceType)for(let n=0;n<r.diceCount;n++){let i=Math.floor(Math.random()*r.diceType)+1;t.push(i),e+=i}for(let n of r.operations)switch(n.type){case"add":e+=n.value;break;case"subtract":e-=n.value;break;case"multiply":e*=n.value;break;case"divide":e/=n.value;break}return e=Math.round(e*100)/100,{rolls:t,total:e,formula:r.displayFormula}}var fn=class r{sheet;close=new v;executeMacro=new v;rollPerformed=new v;resourceChanged=new v;macros=B([]);showEditor=B(!1);editingMacro=B(null);isNewMacro=B(!1);actionHistory=B([]);savedDiceConfigs=B([]);resourceTypes=["health","energy","mana","fokus"];statTypes=["strength","dexterity","speed","intelligence","constitution","chill"];operators=[">","<",">=","<=","==","!="];valueTypes=["fixed","currentResource","maxResource","stat"];diceTypes=[4,6,8,10,12,20,100];formulaTypeLife="LIFE";formulaTypeEnergy="ENERGY";formulaTypeMana="MANA";availableIcons=["\u26A1","\u2694\uFE0F","\u{1F6E1}\uFE0F","\u{1F525}","\u2744\uFE0F","\u{1F4AB}","\u{1F31F}","\u{1F4A5}","\u{1F3AF}","\u{1F5E1}\uFE0F","\u{1F3F9}","\u2728","\u{1F480}","\u2764\uFE0F","\u{1F52E}","\u{1F4D6}"];gridColumns=4;gridRows=6;draggedMacro=null;characterSkillNames=Ne(()=>this.sheet?.skills?this.sheet.skills.map(t=>t.name):[]);ngOnInit(){this.loadMacros(),this.loadSavedDiceConfigs(),document.body.style.overflow="hidden"}ngOnDestroy(){document.body.style.overflow=""}loadSavedDiceConfigs(){let t=`dice-configs-${this.sheet.name}`,e=localStorage.getItem(t);if(e)try{this.savedDiceConfigs.set(JSON.parse(e))}catch(n){console.error("Failed to load dice configs:",n)}}loadMacros(){let t=`actionMacros-${this.sheet.id}`,e=localStorage.getItem(t);if(e)try{let n=JSON.parse(e);this.macros.set(n.map(i=>De(ee({},i),{isValid:gn(i,this.characterSkillNames()).length===0})))}catch(n){console.error("Failed to load macros:",n),this.macros.set([])}}saveMacros(){let t=`actionMacros-${this.sheet.id}`;localStorage.setItem(t,JSON.stringify(this.macros()))}areConditionsMet(t){if(!t.isValid)return!1;for(let e of t.conditions)if(!this.evaluateCondition(e))return!1;return!0}evaluateCondition(t){let e=0,n=t.value;if(t.type==="resource"&&t.resource)e=this.getResourceValue(t.resource);else if(t.type==="stat"&&t.stat)e=this.getStatValue(t.stat);else if(t.type==="skill"&&t.skillName)return!!this.sheet.skills?.some(o=>o.name===t.skillName);switch(t.valueType==="fixed"?n=t.value:t.valueType==="currentResource"&&t.compareToResource?n=this.getResourceValue(t.compareToResource):t.valueType==="maxResource"&&t.compareToResource?n=this.getResourceMax(t.compareToResource):t.valueType==="stat"&&t.compareToStat&&(n=this.getStatValue(t.compareToStat)),t.operator){case">":return e>n;case"<":return e<n;case">=":return e>=n;case"<=":return e<=n;case"==":return e===n;case"!=":return e!==n;default:return!1}}getResourceValue(t){if(!this.sheet?.statuses)return 0;let n={health:"LIFE",energy:"ENERGY",mana:"MANA"}[t];return n!==void 0&&this.sheet.statuses.find(o=>o.formulaType===n)?.statusCurrent||0}getResourceMax(t){if(!this.sheet?.statuses)return 0;let n={health:"LIFE",energy:"ENERGY",mana:"MANA"}[t];if(n!==void 0){let i=this.sheet.statuses.find(o=>o.formulaType===n);if(i)return(i.statusBase||0)+(i.statusBonus||0)+(i.statusEffectBonus||0)}return 0}getStatValue(t){return this.sheet[t]?.current||0}createNewMacro(){let t=ho();this.editingMacro.set(t),this.isNewMacro.set(!0),this.showEditor.set(!0)}editMacro(t){this.editingMacro.set(JSON.parse(JSON.stringify(t))),this.isNewMacro.set(!1),this.showEditor.set(!0)}saveMacro(){let t=this.editingMacro();t&&(t.modifiedAt=new Date,t.referencedSkillNames=this.extractReferencedSkills(t),t.isValid=gn(t,this.characterSkillNames()).length===0,this.isNewMacro()?(t.order=this.macros().length,this.macros.update(e=>[...e,t])):this.macros.update(e=>e.map(n=>n.id===t.id?t:n)),this.saveMacros(),this.closeEditor())}deleteMacro(t){confirm("Diese Aktion wirklich l\xF6schen?")&&(this.macros.update(e=>e.filter(n=>n.id!==t)),this.saveMacros())}closeEditor(){this.showEditor.set(!1),this.editingMacro.set(null),this.isNewMacro.set(!1)}addCondition(){let t=this.editingMacro();t&&(t.conditions.push(_o()),this.editingMacro.set(ee({},t)))}removeCondition(t){let e=this.editingMacro();e&&(e.conditions.splice(t,1),this.editingMacro.set(ee({},e)))}addConsequence(){let t=this.editingMacro();t&&(t.consequences.push(fo()),this.editingMacro.set(ee({},t)))}removeConsequence(t){let e=this.editingMacro();e&&(e.consequences.splice(t,1),this.editingMacro.set(ee({},e)))}runMacro(t){this.areConditionsMet(t)&&this.executeMacro.emit(t)}extractReferencedSkills(t){let e=new Set;for(let n of t.conditions)n.type==="skill"&&n.skillName&&e.add(n.skillName);for(let n of t.consequences)if(n.bonuses)for(let i of n.bonuses){let o=this.sheet.skills?.find(p=>p.name===i);o&&e.add(o.name)}return Array.from(e)}getMissingSkills(t){return gn(t,this.characterSkillNames())}getConditionLabel(t){if(t.type==="skill")return`Skill "${t.skillName}" vorhanden`;let e=t.resource||t.stat||"",n="";return t.valueType==="fixed"?n=t.value.toString():t.valueType==="currentResource"?n=`aktuelle ${t.compareToResource}`:t.valueType==="maxResource"?n=`max ${t.compareToResource}`:t.valueType==="stat"&&(n=t.compareToStat||""),`${e} ${t.operator} ${n}`}getConsequenceLabel(t){switch(t.type){case"dice_roll":return`W\xFCrfle ${t.diceCount}d${t.diceType}`;case"spend_resource":return`Ausgeben: ${t.amount} ${t.resource}`;case"gain_resource":return`Erhalten: ${t.amount} ${t.resource}`;case"apply_bonus":return`+${t.bonusValue} ${t.bonusName}`;default:return"Unbekannt"}}getStatuses(){return this.sheet?.statuses||[]}getResourceIcon(t){switch(t){case"LIFE":return"\u2764\uFE0F";case"ENERGY":return"\u26A1";case"MANA":return"\u{1F52E}";default:return"\u{1F4CA}"}}getResourcePercent(t){let e=this.getStatusMax(t);return e===0?0:Math.min(100,Math.max(0,t.statusCurrent/e*100))}getStatusMax(t){return(t.statusBase||0)+(t.statusBonus||0)+(t.statusEffectBonus||0)}getResourceName(t){switch(t.formulaType){case"LIFE":return"Leben";case"ENERGY":return"Energie";case"MANA":return"Mana";default:return"Ressource"}}parseAndValidateFormula(t){let e=t.diceFormula?.trim()||"";return xt(e)}isFormulaValid(t){return!t||!t.trim()?!1:xt(t).isValid}getFormulaError(t){return!t||!t.trim()?"":xt(t).error||""}clearFormula(t){t.savedDiceConfigId&&(t.diceFormula="")}onFormulaChange(t){t.diceFormula&&t.savedDiceConfigId&&(t.savedDiceConfigId="")}onSavedConfigSelected(t){t.savedDiceConfigId&&(t.diceFormula="")}rollDiceFromFormula(t){if(t.diceFormula){let e=xt(t.diceFormula);if(e.isValid)return xo(e)}return{rolls:[],total:0,formula:""}}runMacroWithResults(t){if(!this.areConditionsMet(t))return;let e=[],n=[];for(let o of t.consequences){let p=null;if(o.diceFormula){let h=xt(o.diceFormula);h.isValid&&(p=xo(h))}else if(o.savedDiceConfigId){let h=this.savedDiceConfigs().find(_=>_.id===o.savedDiceConfigId);if(h){let _=[];for(let O=0;O<h.diceCount;O++)_.push(Math.floor(Math.random()*h.diceType)+1);let x=_.reduce((O,R)=>O+R,0)+h.manualBonus;p={rolls:_,total:x,formula:`${h.diceCount}d${h.diceType}${h.manualBonus>0?"+"+h.manualBonus:""}`}}}if(o.type==="dice_roll")p&&e.push({id:$n(),formula:p.formula,rolls:p.rolls,total:p.total,isNew:!0,name:o.rollName||"Wurf",color:o.rollColor||"#f59e0b"});else if(o.type==="spend_resource"||o.type==="gain_resource"){let h=p?p.total:0,_=o.type==="spend_resource"?-h:h;n.push({resource:o.resource||"unknown",amount:_,isNew:!0}),p&&p.rolls.length>0&&e.push({id:$n(),formula:p.formula,rolls:p.rolls,total:p.total,isNew:!0,name:o.rollName||(o.type==="spend_resource"?"Kosten":"Gewinn"),color:o.rollColor||(o.type==="spend_resource"?"#ef4444":"#22c55e")})}}let i={id:$n(),actionName:t.name,actionIcon:t.icon||"\u26A1",actionColor:t.color||"#f59e0b",timestamp:new Date,rolls:e,resourceChanges:n,isNew:!0};this.actionHistory.update(o=>[i,...o].slice(0,10));for(let o of n)this.resourceChanged.emit({resource:o.resource,amount:o.amount});e.length>0&&this.rollPerformed.emit(e),setTimeout(()=>{this.actionHistory.update(o=>o.map(p=>p.id===i.id?De(ee({},p),{isNew:!1}):p))},600),this.executeMacro.emit(t)}getGridPosition(t){if(t.gridX!==void 0&&t.gridY!==void 0)return{x:t.gridX,y:t.gridY};let e=this.findNextEmptyGridCell();return t.gridX=e.x,t.gridY=e.y,e}findNextEmptyGridCell(){let t=new Set;for(let e of this.macros())e.gridX!==void 0&&e.gridY!==void 0&&t.add(`${e.gridX},${e.gridY}`);for(let e=0;e<this.gridRows;e++)for(let n=0;n<this.gridColumns;n++)if(!t.has(`${n},${e}`))return{x:n,y:e};return{x:0,y:this.gridRows}}isGridCellOccupied(t,e){return this.macros().some(n=>n.gridX===t&&n.gridY===e)}onDragStart(t){this.draggedMacro=t}onDragEnd(){this.draggedMacro=null}onCellClick(t,e){this.draggedMacro&&(this.isGridCellOccupied(t,e)||(this.macros.update(n=>n.map(i=>i.id===this.draggedMacro.id?De(ee({},i),{gridX:t,gridY:e}):i)),this.saveMacros(),this.draggedMacro=null))}dropMacro(t){let e=t.event,n=e.item.data,i=e.container.element.nativeElement,o=i.getBoundingClientRect(),p=240,h=120,_=14,x=window.getComputedStyle(i),O=parseFloat(x.paddingLeft)||0,R=parseFloat(x.paddingTop)||0,N=e.dropPoint.x-o.left,j=e.dropPoint.y-o.top,ne=(N-O-t.panX)/t.zoom,pe=(j-R-t.panY)/t.zoom,J=p+_,ye=h+_,Ve=Math.max(0,Math.floor(ne/J)),Fe=Math.max(0,Math.floor(pe/ye)),it=this.macros().find(Le=>Le.gridX===Ve&&Le.gridY===Fe&&Le.id!==n.id);this.macros.update(Le=>Le.map(ot=>ot.id===n.id?De(ee({},ot),{gridX:Ve,gridY:Fe}):it&&ot.id===it.id?De(ee({},ot),{gridX:n.gridX,gridY:n.gridY}):ot)),this.saveMacros()}onClose(){this.close.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-action-macros"]],inputs:{sheet:"sheet"},outputs:{close:"close",executeMacro:"executeMacro",rollPerformed:"rollPerformed",resourceChanged:"resourceChanged"},decls:15,vars:3,consts:[[1,"action-macros-overlay"],[1,"action-macros-fullscreen"],[1,"dialog-header"],[1,"header-controls"],[1,"add-btn",3,"click"],[1,"close-btn",3,"click"],[1,"dialog-body"],[3,"sheet","actionHistory"],[1,"panel","main-panel"],[1,"panel-header"],[3,"runMacro","editMacro","deleteMacro","dropMacro","dragStart","dragEnd","macros","sheet","gridColumns"],[1,"macro-editor"],[1,"editor-section"],[1,"form-row"],[1,"form-group","flex-1"],[1,"label-icon"],["type","text","placeholder","z.B. Feuerball, Heilzauber",3,"ngModelChange","ngModel"],[1,"form-group","color-group"],["type","color",3,"ngModelChange","ngModel"],[1,"form-group"],[1,"label-hint"],["type","text","placeholder","z.B. Wirft einen m\xE4chtigen Feuerball",3,"ngModelChange","ngModel"],[1,"icon-selector"],[1,"icon-btn",3,"selected"],[1,"section-header"],[1,"add-small-btn",3,"click"],[1,"section-empty"],[1,"editor-actions"],[1,"cancel-btn",3,"click"],[1,"save-btn",3,"click"],[1,"icon-btn",3,"click"],[1,"condition-row"],[3,"ngModelChange","ngModel"],["value","resource"],["value","stat"],["value","skill"],[3,"ngModel"],["type","text","placeholder","Skill-Name",3,"ngModel"],[1,"remove-btn",3,"click"],[3,"value"],["type","text","placeholder","Skill-Name",3,"ngModelChange","ngModel"],[1,"value-type-select",3,"ngModelChange","ngModel"],["value","fixed"],["value","currentResource"],["value","maxResource"],["type","number","placeholder","Wert",3,"ngModel"],["type","number","placeholder","Wert",3,"ngModelChange","ngModel"],[1,"consequence-card"],[1,"consequence-header"],[1,"action-type-select",3,"ngModelChange","ngModel"],["value","dice_roll"],["value","spend_resource"],["value","gain_resource"],["title","Aktion entfernen",1,"remove-card-btn",3,"click"],[1,"dice-config-section"],["type","text","placeholder","z.B. Angriff, Schaden, Heilung",1,"roll-name-input",3,"ngModelChange","ngModel"],[1,"form-group","color-picker-group"],["type","color","title","Farbe f\xFCr die Anzeige",1,"color-picker",3,"ngModelChange","ngModel"],[1,"formula-input-wrapper"],["type","text","placeholder","z.B. 2d6+3",1,"formula-input",3,"ngModelChange","ngModel"],["title","Formel ist g\xFCltig",1,"validation-icon","valid"],[1,"validation-icon","invalid",3,"title"],[1,"error-message"],[1,"resource-select",3,"ngModelChange","ngModel"],[1,"or-divider"],[1,"saved-config-select",3,"ngModelChange","change","ngModel"],["value",""]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),l(4,"\u26A1 Aktionen"),s(),a(5,"div",3)(6,"button",4),g("click",function(){return n.createNewMacro()}),l(7,"+ Neue Aktion"),s(),a(8,"button",5),g("click",function(){return n.onClose()}),l(9,"\xD7"),s()()(),a(10,"div",6),W(11,"app-resource-panel",7),a(12,"div",8),f(13,Bs,4,3)(14,ul,1,1),s()()()()),e&2&&(c(11),b("sheet",n.sheet)("actionHistory",n.actionHistory()),c(2),C(n.showEditor()?14:13))},dependencies:[A,q,ze,We,Y,oe,Be,G,U,me,hn,_n],styles:['.action-macros-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000000d9;display:flex;justify-content:center;align-items:center;z-index:2001;overflow:hidden}.action-macros-fullscreen[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:16px;border:1px solid #333;width:96vw;max-width:1600px;height:94vh;display:flex;flex-direction:column;box-shadow:0 20px 60px #000000b3;overflow:hidden}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid #333;background:linear-gradient(180deg,#252525,#1e1e1e)}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#f59e0b;font-size:1.3rem;font-weight:600}.header-controls[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.add-btn[_ngcontent-%COMP%]{background:#f59e0b;color:#000;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600;font-size:.9rem;transition:all .2s}.add-btn[_ngcontent-%COMP%]:hover{background:#fbbf24;transform:translateY(-1px)}.close-btn[_ngcontent-%COMP%]{background:#ffffff1a;border:none;color:#888;font-size:1.5rem;cursor:pointer;width:42px;height:42px;border-radius:8px;display:flex;align-items:center;justify-content:center;transition:all .2s;line-height:1;padding:0;margin:0;font-family:Arial,sans-serif}.close-btn[_ngcontent-%COMP%]:hover{background:#fff3;color:#fff}.dialog-body[_ngcontent-%COMP%]{display:flex;flex:1;overflow:hidden;gap:0}.panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.panel-header[_ngcontent-%COMP%]{padding:16px 20px;border-bottom:1px solid #333;background:#222}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#f59e0b;font-size:1.1rem;font-weight:500}.main-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;overflow:hidden}.macro-editor[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;padding:20px;overflow-y:auto;overflow-x:hidden;flex:1;max-width:100%}.editor-section[_ngcontent-%COMP%]{background:#252525;border-radius:12px;padding:20px;border:1px solid #333;overflow-x:hidden;max-width:100%}.editor-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .section-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 16px;color:#f59e0b;font-size:1.05rem;font-weight:600}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .section-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0}.add-small-btn[_ngcontent-%COMP%]{background:#333;color:#888;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:.9rem;transition:all .2s}.add-small-btn[_ngcontent-%COMP%]:hover{background:#444;color:#fff}.section-empty[_ngcontent-%COMP%]{color:#666;font-size:.9rem;margin:12px 0 0;font-style:italic}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap;max-width:100%}.form-group[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:8px}.form-group.flex-1[_ngcontent-%COMP%]{flex:1}.form-group.small[_ngcontent-%COMP%]{flex:0 0 100px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#aaa;font-size:.9rem;font-weight:500;display:flex;align-items:center;gap:6px}.label-icon[_ngcontent-%COMP%]{font-size:1rem}.label-hint[_ngcontent-%COMP%]{color:#666;font-size:.8rem;font-weight:400;margin-left:8px;font-style:italic}.form-group[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;border-radius:8px;color:#fff;padding:10px 14px;font-size:.95rem;transition:border-color .2s;max-width:100%;box-sizing:border-box}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#f59e0b;outline:none}.form-group[_ngcontent-%COMP%]   input[type=color][_ngcontent-%COMP%]{background:#1e1e1e;border:1px solid #444;border-radius:8px;height:42px;cursor:pointer}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:80px}.icon-selector[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}.icon-btn[_ngcontent-%COMP%]{width:40px;height:40px;background:#1e1e1e;border:2px solid #444;border-radius:8px;font-size:1.3rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.icon-btn[_ngcontent-%COMP%]:hover{border-color:#666;background:#2a2a2a}.icon-btn.selected[_ngcontent-%COMP%]{border-color:#f59e0b;background:#f59e0b20}.color-group[_ngcontent-%COMP%]{flex:0 0 80px}.consequence-card[_ngcontent-%COMP%]{background:#1e1e1e;border-radius:12px;padding:16px;margin-top:12px;border:2px solid #333;transition:all .2s;max-width:100%;overflow-x:hidden}.consequence-card[_ngcontent-%COMP%]:hover{border-color:#444;background:#222}.consequence-header[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:flex-end;margin-bottom:16px}.action-type-select[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #555;border-radius:8px;color:#fff;padding:10px 14px;font-size:.95rem;font-weight:500;transition:all .2s}.action-type-select[_ngcontent-%COMP%]:focus{border-color:#f59e0b;outline:none}.resource-select[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #555;border-radius:8px;color:#fff;padding:10px 14px;font-size:.95rem;transition:all .2s;text-transform:capitalize}.resource-select[_ngcontent-%COMP%]:focus{border-color:#f59e0b;outline:none}.remove-card-btn[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border:none;width:36px;height:36px;border-radius:8px;cursor:pointer;font-size:1.5rem;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;line-height:1;padding:0;font-family:Arial,sans-serif}.remove-card-btn[_ngcontent-%COMP%]:hover{background:#dc2626;transform:scale(1.05)}.dice-config-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px;margin-top:12px}.roll-name-input[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #555;border-radius:8px;color:#fff;padding:10px 14px;font-size:.95rem;transition:all .2s}.roll-name-input[_ngcontent-%COMP%]:focus{border-color:#f59e0b;outline:none}.roll-name-input[_ngcontent-%COMP%]::placeholder{color:#666}.color-picker-group[_ngcontent-%COMP%]{flex:0 0 100px}.color-picker[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #555;border-radius:8px;height:44px;width:100%;cursor:pointer;padding:4px;transition:all .2s}.color-picker[_ngcontent-%COMP%]:hover{border-color:#666}.color-picker[_ngcontent-%COMP%]:focus{border-color:#f59e0b;outline:none}.formula-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.formula-input[_ngcontent-%COMP%]{background:#2a2a2a;border:2px solid #555;border-radius:8px;color:#fff;padding:10px 40px 10px 14px;font-size:.95rem;font-family:Courier New,monospace;font-weight:600;transition:all .3s ease;flex:1;max-width:100%;box-sizing:border-box}.formula-input[_ngcontent-%COMP%]::placeholder{color:#666;font-weight:400}.formula-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#666}.formula-input.valid[_ngcontent-%COMP%]{border-color:#22c55e;background:linear-gradient(90deg,#22c55e1a,#2a2a2a);box-shadow:0 0 0 3px #22c55e1a}.formula-input.invalid[_ngcontent-%COMP%]{border-color:#ef4444;background:linear-gradient(90deg,#ef44441a,#2a2a2a);box-shadow:0 0 0 3px #ef44441a}.validation-icon[_ngcontent-%COMP%]{position:absolute;right:12px;font-size:1.2rem;font-weight:700;pointer-events:none}.validation-icon.valid[_ngcontent-%COMP%]{color:#22c55e;text-shadow:0 0 8px rgba(34,197,94,.5);animation:_ngcontent-%COMP%_checkPulse .3s ease}.validation-icon.invalid[_ngcontent-%COMP%]{color:#ef4444;text-shadow:0 0 8px rgba(239,68,68,.5);animation:_ngcontent-%COMP%_shakeFeedback .3s ease}@keyframes _ngcontent-%COMP%_checkPulse{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}to{transform:scale(1);opacity:1}}@keyframes _ngcontent-%COMP%_shakeFeedback{0%,to{transform:translate(0)}25%{transform:translate(-4px)}75%{transform:translate(4px)}}.error-message[_ngcontent-%COMP%]{color:#ef4444;font-size:.85rem;margin-top:6px;padding:6px 10px;background:#ef44441a;border-radius:6px;border-left:3px solid #ef4444}.or-divider[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;margin:8px 0;color:#666;font-size:.8rem;font-weight:600}.or-divider[_ngcontent-%COMP%]:before, .or-divider[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #444}.or-divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:0 12px}.saved-config-select[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #555;border-radius:8px;color:#fff;padding:10px 14px;font-size:.95rem;transition:all .2s}.saved-config-select[_ngcontent-%COMP%]:focus{border-color:#f59e0b;outline:none}.saved-config-select[_ngcontent-%COMP%]   option[value=""][_ngcontent-%COMP%]{color:#666}.condition-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:10px;flex-wrap:wrap;padding:12px;background:#1e1e1e;border-radius:8px;border:1px solid #333;max-width:100%;overflow-x:auto}.condition-row[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .condition-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#2a2a2a;border:1px solid #555;border-radius:6px;color:#fff;padding:8px 10px;font-size:.9rem;transition:all .2s;box-sizing:border-box}.condition-row[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .condition-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#f59e0b;outline:none}.condition-row[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:120px}.condition-row[_ngcontent-%COMP%]   .value-type-select[_ngcontent-%COMP%]{min-width:150px}.condition-row[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{flex:1;min-width:140px}.condition-row[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:90px}.remove-btn[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border:none;width:32px;height:32px;border-radius:50%;cursor:pointer;font-size:1.3rem;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;line-height:1;padding:0;margin:0;font-family:Arial,sans-serif}.remove-btn[_ngcontent-%COMP%]:hover{background:#dc2626;transform:scale(1.1)}.editor-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:14px;margin-top:16px}.cancel-btn[_ngcontent-%COMP%]{background:#333;color:#888;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:.95rem;transition:all .2s}.cancel-btn[_ngcontent-%COMP%]:hover{background:#444;color:#fff}.save-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#000;border:none;padding:12px 28px;border-radius:8px;cursor:pointer;font-weight:600;font-size:.95rem;transition:all .2s}.save-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#fbbf24,#f59e0b);transform:translateY(-1px)}']})};function gl(r,t){if(r&1){let e=y();a(0,"app-loot-popup",19),g("claimItem",function(i){m(e);let o=d(2);return u(o.onClaimLoot(i))})("close",function(){m(e);let i=d(2);return u(i.onCloseLootPopup())}),s()}if(r&2){let e=d(2);b("loot",e.receivedLoot)("isBattleLoot",e.isBattleLoot)}}function hl(r,t){if(r&1){let e=y();a(0,"app-skill-tree",20),g("patch",function(i){m(e);let o=d(2);return u(o.store.applyPatch(i))})("close",function(){m(e);let i=d(2);return u(i.closeSkillTree())}),s()}if(r&2){let e=d();b("sheet",e)}}function _l(r,t){if(r&1){let e=y();a(0,"app-dice-roller",21),g("close",function(){m(e);let i=d(2);return u(i.closeDiceRoller())}),s()}if(r&2){let e=d();b("sheet",e)}}function fl(r,t){r&1&&(a(0,"span"),l(1,"\u2764\uFE0F"),s())}function Cl(r,t){r&1&&(a(0,"span"),l(1,"\u26A1"),s())}function bl(r,t){r&1&&(a(0,"span"),l(1,"\u{1F4A7}"),s())}function xl(r,t){if(r&1){let e=y();a(0,"button",43),g("click",function(){let i=m(e).$implicit,o=d(4);return u(o.useRecentSpending(i))}),f(1,fl,2,0,"span"),f(2,Cl,2,0,"span"),f(3,bl,2,0,"span"),a(4,"span",44),l(5),s()()}if(r&2){let e=t.$implicit;T("health-spending",e.type==="health")("energy-spending",e.type==="energy")("mana-spending",e.type==="mana"),b("title",ai("Change ",e.amount," ",e.type)),c(),C(e.type==="health"?1:-1),c(),C(e.type==="energy"?2:-1),c(),C(e.type==="mana"?3:-1),c(2),se("",e.amount>=0?"+":"","",e.amount)}}function vl(r,t){if(r&1&&(a(0,"div",34)(1,"h3"),l(2,"Recent Changes"),s(),a(3,"div",41),I(4,xl,6,14,"button",42,ue),s()()),r&2){let e=d(3);c(4),V(e.recentSpendings)}}function yl(r,t){if(r&1&&(a(0,"span"),l(1),re(2,"titlecase"),s()),r&2){let e=d(3);c(),se("Gain ",e.resourceAmount," ",ce(2,2,e.resourceType))}}function wl(r,t){if(r&1&&(a(0,"span"),l(1),re(2,"titlecase"),s()),r&2){let e=d(3);c(),se("Spend ",e.Math.abs(e.resourceAmount)," ",ce(2,2,e.resourceType))}}function Sl(r,t){if(r&1&&(a(0,"span"),l(1),re(2,"titlecase"),s()),r&2){let e=d(3);c(),D("Change ",ce(2,1,e.resourceType))}}function Ml(r,t){if(r&1){let e=y();a(0,"div",22),g("click",function(){m(e);let i=d(2);return u(i.closeResourcePanel())}),a(1,"div",23),g("click",function(i){return m(e),u(i.stopPropagation())}),a(2,"h2"),l(3,"Manage Resource"),s(),a(4,"div",24)(5,"button",25),g("click",function(){m(e);let i=d(2);return u(i.resourceType="health")}),a(6,"span",26),l(7,"\u2764\uFE0F"),s(),a(8,"span"),l(9,"Health"),s(),a(10,"span",27),l(11),s()(),a(12,"button",28),g("click",function(){m(e);let i=d(2);return u(i.resourceType="energy")}),a(13,"span",26),l(14,"\u26A1"),s(),a(15,"span",29),l(16,"Energy"),s(),a(17,"span",30),l(18),s()(),a(19,"button",31),g("click",function(){m(e);let i=d(2);return u(i.resourceType="mana")}),a(20,"span",26),l(21,"\u{1F4A7}"),s(),a(22,"span",32),l(23,"Mana"),s(),a(24,"span",33),l(25),s()()(),f(26,vl,6,0,"div",34),a(27,"div",35)(28,"label"),l(29,"Amount to change:"),s(),a(30,"input",36),E("ngModelChange",function(i){m(e);let o=d(2);return P(o.resourceAmount,i)||(o.resourceAmount=i),u(i)}),s(),a(31,"span",37),l(32),s()(),a(33,"div",38)(34,"button",39),g("click",function(){m(e);let i=d(2);return u(i.changeResource())}),f(35,yl,3,4,"span")(36,wl,3,4,"span")(37,Sl,3,3,"span"),s(),a(38,"button",40),g("click",function(){m(e);let i=d(2);return u(i.closeResourcePanel())}),l(39,"Cancel"),s()()()()}if(r&2){let e=d(2);c(5),T("selected",e.resourceType==="health"),c(6),M(e.getResourceCurrent("health")),c(),T("selected",e.resourceType==="energy"),c(6),M(e.getResourceCurrent("energy")),c(),T("selected",e.resourceType==="mana"),c(6),M(e.getResourceCurrent("mana")),c(),C(e.recentSpendings.length>0?26:-1),c(4),k("ngModel",e.resourceAmount),c(2),D("Current: ",e.getResourceCurrent(e.resourceType)),c(2),T("gain-btn",e.resourceAmount>0)("loss-btn",e.resourceAmount<0)("disabled",e.resourceAmount===0),b("disabled",e.resourceAmount===0),c(),C(e.resourceAmount>0?35:e.resourceAmount<0?36:37)}}function kl(r,t){if(r&1){let e=y();a(0,"app-action-macros",45),g("close",function(){m(e);let i=d(2);return u(i.closeActionMacros())})("executeMacro",function(i){m(e);let o=d(2);return u(o.handleMacroExecution(i))})("resourceChanged",function(i){m(e);let o=d(2);return u(o.handleResourceChange(i))})("rollPerformed",function(i){m(e);let o=d(2);return u(o.handleActionRoll(i))}),s()}if(r&2){let e=d();b("sheet",e)}}function Pl(r,t){r&1&&(a(0,"p",51),l(1,"Trash is empty"),s())}function El(r,t){if(r&1&&(a(0,"div",58),l(1),s()),r&2){let e=d().$implicit;c(),D(" ",e.data.description," ")}}function Ol(r,t){if(r&1){let e=y();a(0,"div",53)(1,"div",54)(2,"div",55)(3,"span",56),l(4),s(),a(5,"strong"),l(6),s()(),a(7,"div",57),l(8),re(9,"date"),s(),f(10,El,2,1,"div",58),s(),a(11,"div",48)(12,"button",59),g("click",function(){let i=m(e).$index,o=d(4);return u(o.restoreFromTrash(i))}),l(13," Restore "),s(),a(14,"button",60),g("click",function(){let i=m(e).$index,o=d(4);return u(o.permanentlyDelete(i))}),l(15," Delete Forever "),s()()()}if(r&2){let e=t.$implicit;c(4),D(" ",e.type," "),c(2),M(e.data.name||"Unnamed"),c(2),D(" Deleted: ",ut(9,4,e.deletedAt,"short")," "),c(2),C(e.data.description?10:-1)}}function Dl(r,t){if(r&1&&(a(0,"div",52),I(1,Ol,16,7,"div",53,ue),s()),r&2){let e=d(2);c(),V(e.trash)}}function Tl(r,t){if(r&1){let e=y();a(0,"div",22),g("click",function(){m(e);let i=d(2);return u(i.closeTrash())}),a(1,"div",46),g("click",function(i){return m(e),u(i.stopPropagation())}),a(2,"div",47)(3,"h2"),l(4,"\u{1F5D1}\uFE0F Trash"),s(),a(5,"div",48)(6,"button",49),g("click",function(){m(e);let i=d(2);return u(i.emptyTrash())}),l(7," Empty Trash "),s(),a(8,"button",50),g("click",function(){m(e);let i=d(2);return u(i.closeTrash())}),l(9," Close "),s()()(),f(10,Pl,2,0,"p",51)(11,Dl,3,0,"div",52),s()()}if(r&2){let e=d();c(6),b("disabled",!e.trash||e.trash.length===0),c(4),C(!e.trash||e.trash.length===0?10:11)}}function Rl(r,t){if(r&1){let e=y();a(0,"div",0)(1,"div",1)(2,"app-character",2),g("patch",function(i){m(e);let o=d();return u(o.store.applyPatch(i))}),s()(),a(3,"div",3)(4,"app-stats",4),g("patch",function(i){m(e);let o=d();return u(o.store.applyPatch(i))}),s()(),a(5,"div",5)(6,"app-levelclass",6),g("patch",function(i){m(e);let o=d();return u(o.store.applyPatch(i))})("openSkillTree",function(){m(e);let i=d();return u(i.showSkillTree=!0)}),s()(),a(7,"div",7)(8,"app-currentstats",4),g("patch",function(i){m(e);let o=d();return u(o.store.applyPatch(i))}),s()(),a(9,"div",8)(10,"app-equipment",4),g("patch",function(i){m(e);let o=d();return u(o.store.applyPatch(i))}),s()(),a(11,"div",9)(12,"app-character-tabs",10),g("patch",function(i){m(e);let o=d();return u(o.store.applyPatch(i))})("runeEditingChange",function(i){m(e);let o=d();return u(o.onRuneEditingChange(i.index,i.isEditing))})("spellEditingChange",function(i){m(e);let o=d();return u(o.onSpellEditingChange(i.index,i.isEditing))})("skillEditingChange",function(i){m(e);let o=d();return u(o.onSkillEditingChange(i.index,i.isEditing))})("openTrash",function(){m(e);let i=d();return u(i.openTrash())}),s()(),a(13,"div",11)(14,"app-backstory",4),g("patch",function(i){m(e);let o=d();return u(o.store.applyPatch(i))}),s()()(),f(15,gl,1,2,"app-loot-popup",12),f(16,hl,1,1,"app-skill-tree",13),a(17,"div",14)(18,"button",15),g("click",function(){m(e);let i=d();return u(i.toggleDiceRoller())}),l(19," \u{1F3B2} "),s(),a(20,"button",16),g("click",function(){m(e);let i=d();return u(i.toggleResourcePanel())}),l(21," \u{1F48E} "),s(),a(22,"button",17),g("click",function(){m(e);let i=d();return u(i.toggleActionMacros())}),l(23," \u26A1 "),s()(),f(24,_l,1,1,"app-dice-roller",13),f(25,Ml,40,20,"div",18),f(26,kl,1,1,"app-action-macros",13),f(27,Tl,12,2,"div",18)}if(r&2){let e=t,n=d();T("current-turn",n.isCurrentTurn)("group-turn",n.isGroupTurn),c(2),b("sheet",e)("characterId",n.store.characterId),c(2),b("sheet",e),c(2),b("sheet",e),c(2),b("sheet",e),c(2),b("sheet",e),c(2),b("sheet",e)("editingRunes",n.editingRunes)("editingSpells",n.editingSpells)("editingSkills",n.editingSkills),c(2),b("sheet",e),c(),C(n.showLootPopup?15:-1),c(),C(n.showSkillTree?16:-1),c(2),T("active",n.showDiceRoller),c(2),T("active",n.showResourcePanel),c(2),T("active",n.showActionMacros),c(2),C(n.showDiceRoller?24:-1),c(),C(n.showResourcePanel?25:-1),c(),C(n.showActionMacros?26:-1),c(),C(n.showTrash?27:-1)}}var vo=class r{store=L(jt);route=L(_i);socket=L(Ot);worldSocket=L(Dt);worldApi=L(xi);cdr=L(ie);ngZone=L(we);Math=Math;showLootPopup=!1;receivedLoot=[];isBattleLoot=!1;currentWorldName="";isCurrentTurn=!1;isGroupTurn=!1;showDiceRoller=!1;showResourcePanel=!1;showActionMacros=!1;editingRunes=new Set;editingSpells=new Set;editingSkills=new Set;handleKeyboardShortcuts(t){let e=t.target;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT"||e.isContentEditable)return;switch(t.key.toLowerCase()){case"d":this.showDiceRoller?this.showDiceRoller=!1:(this.showResourcePanel=!1,this.showActionMacros=!1,this.showDiceRoller=!0),this.cdr.detectChanges(),t.preventDefault();break;case"r":this.showResourcePanel?this.showResourcePanel=!1:(this.showDiceRoller=!1,this.showActionMacros=!1,this.showResourcePanel=!0),this.cdr.detectChanges(),t.preventDefault();break;case"a":this.showActionMacros?this.showActionMacros=!1:(this.showDiceRoller=!1,this.showResourcePanel=!1,this.showActionMacros=!0),this.cdr.detectChanges(),t.preventDefault();break;case"escape":(this.showDiceRoller||this.showResourcePanel||this.showActionMacros)&&(this.showDiceRoller=!1,this.showResourcePanel=!1,this.showActionMacros=!1,this.cdr.detectChanges(),t.preventDefault());break}}async ngOnInit(){let t=this.route.snapshot.paramMap.get("id");wi.initialize(),await this.store.load(t),this.worldSocket.connect(),this.store.sheet$.subscribe(async e=>{if(e&&e.worldName){this.currentWorldName=e.worldName,await this.worldSocket.joinWorld(e.worldName);try{let n=await this.worldApi.loadWorld(e.worldName);if(n&&n.battleParticipants&&n.battleParticipants.length>0){let i=[...n.battleParticipants].sort((_,x)=>_.nextTurnAt-x.nextTurnAt),o=i[0].nextTurnAt,p=i[0].team,h=i.filter(_=>Math.abs(_.nextTurnAt-o)<.01&&_.team===p);this.isCurrentTurn=h.some(_=>_.characterId===t),this.isGroupTurn=h.length>1&&this.isCurrentTurn,this.cdr.detectChanges()}}catch(n){console.error("Failed to check initial turn state:",n)}}}),this.socket.lootReceived$.subscribe(e=>{this.ngZone.run(()=>{this.receivedLoot=[e],this.isBattleLoot=!1,this.showLootPopup=!0,this.cdr.detectChanges()})}),this.socket.battleLootReceived$.subscribe(async e=>{await this.ngZone.run(async()=>{this.receivedLoot=e.loot,this.isBattleLoot=!0,this.currentWorldName=e.worldName,this.showLootPopup=!0,await this.worldSocket.joinWorld(e.worldName),this.cdr.detectChanges()})}),this.worldSocket.patches$.subscribe(e=>{this.ngZone.run(()=>{if(e.path==="battleLoot"&&this.showLootPopup&&this.isBattleLoot){let n=e.value,i=new Set(n.map(o=>o.id));this.receivedLoot=this.receivedLoot.filter(o=>i.has(o.id)),this.receivedLoot.length===0&&(this.showLootPopup=!1),this.cdr.detectChanges()}if(e.path==="battleParticipants"){let n=e.value;if(n&&n.length>0){let i=[...n].sort((x,O)=>x.nextTurnAt-O.nextTurnAt),o=i[0].nextTurnAt,p=i[0].team,h=i.filter(x=>Math.abs(x.nextTurnAt-o)<.01&&x.team===p),_=h.some(x=>x.characterId===t);this.isCurrentTurn=_,this.isGroupTurn=h.length>1&&_,this.cdr.detectChanges()}else this.isCurrentTurn=!1,this.isGroupTurn=!1,this.cdr.detectChanges()}})})}onRuneEditingChange(t,e){let n=new Set(this.editingRunes);e?n.add(t):n.delete(t),this.editingRunes=n}onSpellEditingChange(t,e){let n=new Set(this.editingSpells);e?n.add(t):n.delete(t),this.editingSpells=n}onSkillEditingChange(t,e){let n=new Set(this.editingSkills);e?n.add(t):n.delete(t),this.editingSkills=n}onClaimLoot(t){let e=this.store.sheetValue;if(e){switch(t.type){case"item":this.store.applyPatch({path:"inventory",value:[...e.inventory,t.data]});break;case"rune":this.store.applyPatch({path:"runes",value:[...e.runes,t.data]});break;case"spell":this.store.applyPatch({path:"spells",value:[...e.spells,t.data]});break;case"currency":let n=e.currency||{copper:0,silver:0,gold:0,platinum:0},i={copper:(n.copper||0)+(t.data.copper||0),silver:(n.silver||0)+(t.data.silver||0),gold:(n.gold||0)+(t.data.gold||0),platinum:(n.platinum||0)+(t.data.platinum||0)};this.store.applyPatch({path:"currency",value:i});break}this.receivedLoot=this.receivedLoot.filter(n=>n.id!==t.id),this.receivedLoot.length===0&&(this.showLootPopup=!1),this.cdr.detectChanges(),this.isBattleLoot&&this.currentWorldName&&this.worldSocket.claimBattleLoot(this.currentWorldName,t.id)}}onCloseLootPopup(){this.showLootPopup=!1,this.receivedLoot=[]}showSkillTree=!1;openSkillTree(){this.showSkillTree=!0}closeSkillTree(){this.showSkillTree=!1}resourceType="health";resourceAmount=0;recentSpendings=[];toggleDiceRoller(){this.showDiceRoller=!this.showDiceRoller,this.cdr.detectChanges()}toggleResourcePanel(){this.showResourcePanel||(this.loadRecentSpendings(),this.resourceType="health",this.resourceAmount=0),this.showResourcePanel=!this.showResourcePanel,this.cdr.detectChanges()}toggleActionMacros(){this.showActionMacros=!this.showActionMacros,this.cdr.detectChanges()}openDiceRoller(){this.showDiceRoller=!0}closeDiceRoller(){this.showDiceRoller=!1}closeResourcePanel(){this.showResourcePanel=!1}closeActionMacros(){this.showActionMacros=!1}handleMacroExecution(t){let e=this.store.sheetValue;if(e){for(let n of t.consequences)switch(n.type){case"dice_roll":this.showDiceRoller=!0;break;case"spend_resource":if(n.resource&&n.amount){let i=n.resource,o=e.statuses?.find(p=>i==="health"?p.formulaType==="LIFE":i==="energy"?p.formulaType==="ENERGY":i==="mana"?p.formulaType==="MANA":!1);o&&(o.statusCurrent=Math.max(0,o.statusCurrent-n.amount),this.store.applyPatch({path:"/statuses",value:e.statuses}))}break;case"gain_resource":if(n.resource&&n.amount){let i=n.resource,o=e.statuses?.find(p=>i==="health"?p.formulaType==="LIFE":i==="energy"?p.formulaType==="ENERGY":i==="mana"?p.formulaType==="MANA":!1);if(o){let p=o.statusBase+(o.statusEffectBonus||0);o.statusCurrent=Math.min(p,o.statusCurrent+n.amount),this.store.applyPatch({path:"/statuses",value:e.statuses})}}break}this.cdr.markForCheck()}}handleResourceChange(t){let e=this.store.sheetValue;if(!e||!e.statuses)return;let n=t.resource,i=e.statuses.find(o=>n==="health"?o.formulaType==="LIFE":n==="energy"?o.formulaType==="ENERGY":n==="mana"?o.formulaType==="MANA":!1);if(i){if(t.amount<0)i.statusCurrent=Math.max(0,i.statusCurrent+t.amount);else{let o=i.statusBase+(i.statusEffectBonus||0);i.statusCurrent=Math.min(o,i.statusCurrent+t.amount)}this.store.applyPatch({path:"/statuses",value:e.statuses})}this.cdr.markForCheck()}handleActionRoll(t){localStorage.setItem("action-roll-results",JSON.stringify(t)),this.cdr.markForCheck()}openUseResource(){this.loadRecentSpendings(),this.showResourcePanel=!0,this.resourceType="health",this.resourceAmount=0}closeUseResource(){this.showResourcePanel=!1}getResourceCurrent(t){let e=this.store.sheetValue;if(!e)return 0;let n=t==="health"?"LIFE":t==="energy"?"ENERGY":"MANA";return e.statuses.find(o=>o.formulaType===n)?.statusCurrent||0}canUseResource(){return this.resourceAmount>0&&this.resourceAmount<=this.getResourceCurrent(this.resourceType)}changeResource(){let t=this.store.sheetValue;if(!t||this.resourceAmount===0)return;let e=this.resourceType==="health"?"LIFE":this.resourceType==="energy"?"ENERGY":"MANA",n=t.statuses.findIndex(p=>p.formulaType===e);if(n===-1)return;let o=t.statuses[n].statusCurrent+this.resourceAmount;this.addRecentSpending(this.resourceType,this.resourceAmount),this.store.applyPatch({path:`statuses.${n}.statusCurrent`,value:o}),this.closeUseResource(),this.resourceAmount=0}useResource(){let t=this.store.sheetValue;if(!t||!this.canUseResource())return;let e=this.resourceType==="health"?"LIFE":this.resourceType==="energy"?"ENERGY":"MANA",n=t.statuses.findIndex(p=>p.formulaType===e);if(n===-1)return;let o=t.statuses[n].statusCurrent-this.resourceAmount;this.addRecentSpending(this.resourceType,-this.resourceAmount),this.store.applyPatch({path:`statuses.${n}.statusCurrent`,value:o}),this.closeUseResource(),this.resourceAmount=0}loadRecentSpendings(){let t=`recentSpendings_${this.store.characterId}`,e=localStorage.getItem(t);if(e)try{this.recentSpendings=JSON.parse(e)}catch{this.recentSpendings=[]}}addRecentSpending(t,e){if(this.recentSpendings.some(o=>o.type===t&&o.amount===e))return;this.recentSpendings.unshift({type:t,amount:e}),this.recentSpendings.length>10&&(this.recentSpendings=this.recentSpendings.slice(0,10));let i=`recentSpendings_${this.store.characterId}`;localStorage.setItem(i,JSON.stringify(this.recentSpendings))}useRecentSpending(t){this.resourceType=t.type,this.resourceAmount=t.amount}showTrash=!1;openTrash(){this.showTrash=!0}closeTrash(){this.showTrash=!1}restoreFromTrash(t){let e=this.store.sheetValue;if(!e||!e.trash)return;let n=e.trash[t],i=[...e.trash];switch(i.splice(t,1),n.type){case"item":this.store.applyPatch({path:"inventory",value:[...e.inventory,n.data]});break;case"equipment":this.store.applyPatch({path:"equipment",value:[...e.equipment,n.data]});break;case"rune":this.store.applyPatch({path:"runes",value:[...e.runes,n.data]});break;case"spell":this.store.applyPatch({path:"spells",value:[...e.spells,n.data]});break;case"skill":this.store.applyPatch({path:"skills",value:[...e.skills,n.data]});break}this.store.applyPatch({path:"trash",value:i})}permanentlyDelete(t){let e=this.store.sheetValue;if(!e||!e.trash)return;let n=[...e.trash];n.splice(t,1),this.store.applyPatch({path:"trash",value:n})}emptyTrash(){this.store.applyPatch({path:"trash",value:[]})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=F({type:r,selectors:[["app-sheet"]],hostBindings:function(e,n){e&1&&g("keydown",function(o){return n.handleKeyboardShortcuts(o)},ni)},decls:2,vars:3,consts:[[1,"character-grid"],[1,"grid-character"],[3,"patch","sheet","characterId"],[1,"grid-stats"],[3,"patch","sheet"],[1,"grid-levelclass"],[3,"patch","openSkillTree","sheet"],[1,"grid-currentstats"],[1,"grid-equipment"],[1,"grid-tabs"],[3,"patch","runeEditingChange","spellEditingChange","skillEditingChange","openTrash","sheet","editingRunes","editingSpells","editingSkills"],[1,"grid-backstory"],[3,"loot","isBattleLoot"],[3,"sheet"],[1,"sticky-actions","horizontal"],["title","W\xFCrfeln (D)",1,"action-btn","dice-btn",3,"click"],["title","Ressourcen (R)",1,"action-btn","resource-btn",3,"click"],["title","Aktionen (A)",1,"action-btn","action-macro-btn",3,"click"],[1,"dialog-overlay"],[3,"claimItem","close","loot","isBattleLoot"],[3,"patch","close","sheet"],[3,"close","sheet"],[1,"dialog-overlay",3,"click"],[1,"dialog-content","use-resource-dialog",3,"click"],[1,"resource-selector"],[1,"resource-option","health",3,"click"],[1,"resource-icon"],[1,"resource-value"],[1,"resource-option","energy",3,"click"],[2,"color","#22c55e"],[1,"resource-value",2,"color","#22c55e"],[1,"resource-option","mana",3,"click"],[2,"color","#3b82f6"],[1,"resource-value",2,"color","#3b82f6"],[1,"recent-spendings"],[1,"amount-input"],["type","number","placeholder","0 (positive to gain, negative to spend)",3,"ngModelChange","ngModel"],[1,"max-hint"],[1,"dialog-actions"],[1,"use-btn",3,"click","disabled"],[1,"cancel-btn",3,"click"],[1,"spending-buttons"],[1,"spending-btn",3,"health-spending","energy-spending","mana-spending","title"],[1,"spending-btn",3,"click","title"],[1,"spending-amount"],[3,"close","executeMacro","resourceChanged","rollPerformed","sheet"],[1,"dialog-content","trash-dialog",2,"max-width","800px","max-height","80vh","overflow-y","auto",3,"click"],[2,"display","flex","justify-content","space-between","align-items","center","margin-bottom","1rem"],[2,"display","flex","gap","0.5rem"],[2,"background","#d32f2f","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click","disabled"],[2,"background","#666","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click"],[2,"text-align","center","color","#999","padding","2rem"],[2,"display","flex","flex-direction","column","gap","0.5rem"],[2,"background","var(--card-bg)","border","1px solid var(--border-color)","border-radius","4px","padding","1rem","display","flex","justify-content","space-between","align-items","center"],[2,"flex","1"],[2,"display","flex","align-items","center","gap","0.5rem"],[2,"background","var(--accent)","color","white","padding","2px 8px","border-radius","3px","font-size","0.75rem","text-transform","uppercase"],[2,"color","#999","font-size","0.85rem","margin-top","0.25rem"],[2,"color","#ccc","font-size","0.9rem","margin-top","0.5rem","max-width","500px","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],[2,"background","#4caf50","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click"],[2,"background","#d32f2f","color","white","padding","6px 12px","border-radius","4px","cursor","pointer","border","none",3,"click"]],template:function(e,n){if(e&1&&(f(0,Rl,28,27),re(1,"async")),e&2){let i;C((i=ce(1,1,n.store.sheet$))?0:-1,i)}},dependencies:[A,q,Y,oe,G,U,Vt,zt,Wt,qt,Zt,Qt,ln,pn,mn,un,fn,pi,mi,ui],styles:['.character-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(450px,570px) minmax(400px,1fr) minmax(350px,1fr);grid-template-areas:"character currentstats currentstats" "levelclass stats stats" "tabs tabs equipment" "tabs tabs equipment" "tabs tabs equipment" "backstory backstory backstory";gap:.75rem;padding:.75rem;width:100%;max-width:1900px;margin:0 auto;box-sizing:border-box;transition:all .3s ease;align-items:start}.character-grid.current-turn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-glow 2s ease-in-out infinite;border-radius:8px}.character-grid.group-turn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-glow-yellow 2s ease-in-out infinite;border-radius:8px}@keyframes _ngcontent-%COMP%_pulse-glow{0%,to{box-shadow:0 0 #8b5cf600,0 0 30px 8px #8b5cf6b3}50%{box-shadow:0 0 0 6px #8b5cf680,0 0 50px 15px #8b5cf6e6}}@keyframes _ngcontent-%COMP%_pulse-glow-yellow{0%,to{box-shadow:0 0 #eab30800,0 0 30px 8px #eab308b3}50%{box-shadow:0 0 0 6px #eab30880,0 0 50px 15px #eab308e6}}.grid-character[_ngcontent-%COMP%]{grid-area:character}.grid-stats[_ngcontent-%COMP%]{grid-area:stats}.grid-levelclass[_ngcontent-%COMP%]{grid-area:levelclass}.grid-currentstats[_ngcontent-%COMP%]{grid-area:currentstats}.grid-equipment[_ngcontent-%COMP%]{grid-area:equipment}.grid-tabs[_ngcontent-%COMP%]{grid-area:tabs}.grid-backstory[_ngcontent-%COMP%]{grid-area:backstory}@media(max-width:1400px){.character-grid[_ngcontent-%COMP%]{grid-template-columns:minmax(400px,1fr) minmax(400px,1fr);grid-template-areas:"character stats" "levelclass stats" "currentstats equipment" "tabs tabs" "backstory backstory"}}@media(max-width:768px){.character-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;grid-template-areas:"character" "stats" "levelclass" "currentstats" "equipment" "tabs" "backstory"}}.character-grid[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{min-height:auto;height:fit-content}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.dialog-content[_ngcontent-%COMP%]{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1.5rem;width:100%;max-width:500px;box-shadow:0 8px 32px #00000080}.sticky-actions[_ngcontent-%COMP%]{position:fixed;bottom:1.5rem;right:1.5rem;display:flex;flex-direction:column;gap:.5rem;z-index:100}.sticky-actions.horizontal[_ngcontent-%COMP%]{flex-direction:row;gap:.5rem}.action-btn[_ngcontent-%COMP%]{width:48px;height:48px;padding:0;color:#fff;border:2px solid transparent;border-radius:50%;font-size:1.5rem;cursor:pointer;transition:all .2s;box-shadow:0 4px 15px #0000004d;display:flex;align-items:center;justify-content:center}.action-btn.dice-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);box-shadow:0 4px 15px #22c55e66}.action-btn.dice-btn[_ngcontent-%COMP%]:hover, .action-btn.dice-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#16a34a,#15803d);transform:translateY(-2px) scale(1.1);box-shadow:0 6px 20px #22c55e80;border-color:#fff}.action-btn.resource-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#6d28d9);box-shadow:0 4px 15px #8b5cf666}.action-btn.resource-btn[_ngcontent-%COMP%]:hover, .action-btn.resource-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6d28d9,#5b21b6);transform:translateY(-2px) scale(1.1);box-shadow:0 6px 20px #8b5cf680;border-color:#fff}.action-btn.action-macro-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);box-shadow:0 4px 15px #f59e0b66}.action-btn.action-macro-btn[_ngcontent-%COMP%]:hover, .action-btn.action-macro-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#d97706,#b45309);transform:translateY(-2px) scale(1.1);box-shadow:0 6px 20px #f59e0b80;border-color:#fff}.dice-roller-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c55e,#16a34a);box-shadow:0 4px 15px #22c55e66}.dice-roller-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#16a34a,#15803d);transform:translateY(-2px);box-shadow:0 6px 20px #22c55e80}.use-resource-btn[_ngcontent-%COMP%]{background:var(--accent);box-shadow:0 4px 15px #8b5cf666}.use-resource-btn[_ngcontent-%COMP%]:hover{background:var(--accentdark);transform:translateY(-2px);box-shadow:0 6px 20px #8b5cf680}.action-macros-dialog[_ngcontent-%COMP%]{max-width:500px;min-width:400px}.action-macros-dialog[_ngcontent-%COMP%]   .dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:1px solid var(--border)}.action-macros-dialog[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#f59e0b}.action-macros-dialog[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--muted);font-size:24px;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s}.action-macros-dialog[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{color:#fff;background:#ffffff1a}.action-macros-content[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem}.placeholder-text[_ngcontent-%COMP%]{color:var(--muted);font-size:1rem;margin:0 0 .5rem}.placeholder-subtext[_ngcontent-%COMP%]{color:var(--muted);font-size:.875rem;opacity:.7;margin:0}.use-resource-dialog[_ngcontent-%COMP%]{max-width:400px}.use-resource-dialog[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--accent);text-align:center}.resource-selector[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-bottom:1.5rem}.resource-option[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;gap:.5rem;padding:1rem;background:var(--bg);border:2px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s;color:var(--text)}.resource-option[_ngcontent-%COMP%]:hover{border-color:var(--text-muted)}.resource-option.selected.health[_ngcontent-%COMP%]{border-color:var(--health-color);background:#ef44441a}.resource-option.selected.energy[_ngcontent-%COMP%]{border-color:var(--energy-color);background:#22c55e1a}.resource-option.selected.mana[_ngcontent-%COMP%]{border-color:var(--mana-color);background:#3b82f61a}.resource-icon[_ngcontent-%COMP%]{font-size:1.5rem}.resource-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700}.resource-option.health[_ngcontent-%COMP%]   .resource-value[_ngcontent-%COMP%]{color:var(--health-color)}.resource-option.energy[_ngcontent-%COMP%]   .resource-value[_ngcontent-%COMP%]{color:var(--energy-color)}.resource-option.mana[_ngcontent-%COMP%]   .resource-value[_ngcontent-%COMP%]{color:var(--mana-color)}.amount-input[_ngcontent-%COMP%]{margin-bottom:1.5rem}.amount-input[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text)}.amount-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:1.25rem;text-align:center}.amount-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent)}.max-hint[_ngcontent-%COMP%]{display:block;text-align:center;margin-top:.5rem;font-size:.85rem;color:var(--text-muted)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.use-btn[_ngcontent-%COMP%]{flex:1;padding:.875rem;background:var(--accent);color:#fff;border:none;border-radius:6px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}.use-btn.gain-btn[_ngcontent-%COMP%]{background:#22c55e}.use-btn.gain-btn[_ngcontent-%COMP%]:hover:not(.disabled){background:#16a34a}.use-btn.loss-btn[_ngcontent-%COMP%]{background:#ef4444}.use-btn.loss-btn[_ngcontent-%COMP%]:hover:not(.disabled){background:#dc2626}.use-btn[_ngcontent-%COMP%]:hover:not(.disabled){background:var(--accentdark)}.use-btn.disabled[_ngcontent-%COMP%]{background:var(--text-muted);cursor:not-allowed;opacity:.5}.cancel-btn[_ngcontent-%COMP%]{padding:.875rem 1.5rem;background:var(--bg);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:1rem;cursor:pointer;transition:all .2s}.cancel-btn[_ngcontent-%COMP%]:hover{background:var(--border)}.recent-spendings[_ngcontent-%COMP%]{margin:1rem 0;padding:1rem;background:#0003;border-radius:8px;border:1px solid var(--border)}.recent-spendings[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.95rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}.spending-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.spending-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.3rem;padding:.5rem .75rem;background:#ffffff0d;border:2px solid rgba(255,255,255,.1);border-radius:6px;cursor:pointer;transition:all .2s;font-size:.95rem}.spending-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000004d}.spending-btn.health-spending[_ngcontent-%COMP%]{border-color:#ef4444}.spending-btn.health-spending[_ngcontent-%COMP%]:hover{background:#ef444433;border-color:#ef4444}.spending-btn.energy-spending[_ngcontent-%COMP%]{border-color:#22c55e}.spending-btn.energy-spending[_ngcontent-%COMP%]:hover{background:#22c55e33;border-color:#22c55e}.spending-btn.mana-spending[_ngcontent-%COMP%]{border-color:#3b82f6}.spending-btn.mana-spending[_ngcontent-%COMP%]:hover{background:#3b82f633;border-color:#3b82f6}.spending-amount[_ngcontent-%COMP%]{font-weight:600;color:#fff}'],changeDetection:0})};export{vo as SheetComponent};
