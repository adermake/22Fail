<div class="battle-tracker">
  <div class="tracker-header">
    <h3>⚔️ Battle Tracker</h3>
    <span class="view-only-badge">View Only</span>
  </div>

  <div class="tracker-content">
    @if (groups.length === 0) {
      <div class="empty-state">
        <span class="empty-icon">⚔️</span>
        <p>No battle in progress</p>
        <p class="sub-text">The GM can start a battle from the World view</p>
      </div>
    } @else {
      <!-- Current Turn Display -->
      @if (currentTurnDisplay) {
        <div class="current-turn-display">
          <span class="label">Current Turn:</span>
          <span class="names">{{ currentTurnDisplay }}</span>
        </div>
      }

      <!-- Timeline -->
      <div class="timeline">
        @for (group of groups; track trackGroup($index, group); let gIdx = $index) {
          <div 
            class="turn-group"
            [class.scripted]="group.isScripted"
            [class.calculated]="!group.isScripted"
            [class.first-group]="gIdx === 0"
          >
            <!-- Tiles -->
            @for (tile of group.tiles; track trackTile($index, tile)) {
              <div 
                class="tile"
                [class.scripted]="tile.isScripted"
                [class.calculated]="!tile.isScripted"
                [style.--team-color]="getTeamColor(tile.team)"
              >
                @if (tile.portrait) {
                  <img [src]="tile.portrait" [alt]="tile.name" class="tile-portrait">
                } @else {
                  <div class="tile-initials">{{ tile.name.substring(0, 2).toUpperCase() }}</div>
                }
                <span class="tile-name">{{ tile.name }}</span>
                <span class="turn-number">T{{ tile.turnNumber }}</span>
                <div class="team-indicator" [style.background]="getTeamColor(tile.team)"></div>
              </div>
            }

            <!-- Group line at bottom for multi-tile groups -->
            @if (group.tiles.length > 1) {
              <div class="group-line" [style.background]="getTeamColor(group.team)"></div>
            }
          </div>
        }
      </div>
    }
  </div>
</div>
