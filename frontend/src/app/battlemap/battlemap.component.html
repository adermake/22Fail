<div class="battlemap-container">
  <!-- Top Toolbar -->
  <app-battlemap-toolbar
    [currentTool]="currentTool()"
    [brushColor]="brushColor()"
    [penBrushSize]="penBrushSize()"
    [eraserBrushSize]="eraserBrushSize()"
    [drawWithWalls]="drawWithWalls()"
    [dragMode]="dragMode()"
    [drawLayerVisible]="drawLayerVisible()"
    (toolChange)="onToolChange($event)"
    (brushColorChange)="onBrushColorChange($event)"
    (penBrushSizeChange)="onPenBrushSizeChange($event)"
    (eraserBrushSizeChange)="onEraserBrushSizeChange($event)"
    (drawWithWallsChange)="onDrawWithWallsChange($event)"
    (dragModeChange)="onDragModeChange($event)"
    (drawLayerVisibleChange)="onDrawLayerVisibleChange($event)"
    (toggleCharacterList)="toggleCharacterList()"
    (toggleBattleTracker)="toggleBattleTracker()"
    (clearWalls)="onClearWalls()"
    (quickTokenCreate)="onQuickTokenDrop($event)"
  />

  <div class="battlemap-main">
    <div class="battlemap-content">
      <!-- Left Panel: Character List -->
      @if (showCharacterList()) {
        <app-battlemap-character-list
          [characters]="worldCharacters()"
          [tokensOnMap]="battleMap()?.tokens || []"
        />
      }

      <!-- Main Grid Area -->
      <app-battlemap-grid
        [battleMap]="enrichedBattleMap()"
        [currentTool]="currentTool()"
        [brushColor]="brushColor()"
        [penBrushSize]="penBrushSize()"
        [eraserBrushSize]="eraserBrushSize()"
        [drawWithWalls]="drawWithWalls()"
        [dragMode]="dragMode()"
        [currentTurnCharacterId]="currentTurnCharacterId()"
        [battleParticipants]="battleParticipants()"
        [drawLayerVisible]="drawLayerVisible()"
        (tokenDrop)="onTokenDrop($event)"
        (tokenMove)="onTokenMove($event)"
        (tokenRemove)="onTokenRemove($event)"
        (quickTokenDrop)="onQuickTokenDrop($event)"
        (brushSizeChange)="onBrushSizeChange($event)"
      />
    </div>

    <!-- Bottom Panel: Battle Tracker -->
    @if (showBattleTracker()) {
      <app-battlemap-battle-tracker />
    }
  </div>
</div>
