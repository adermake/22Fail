<div class="battlemap-container">
  <!-- Top Toolbar -->
  <app-battlemap-toolbar
    [currentTool]="currentTool()"
    [brushColor]="brushColor()"
    [penBrushSize]="penBrushSize()"
    [eraserBrushSize]="eraserBrushSize()"
    [isWallMode]="isWallMode()"
    [dragMode]="dragMode()"
    (toolChange)="onToolChange($event)"
    (brushColorChange)="onBrushColorChange($event)"
    (penBrushSizeChange)="onPenBrushSizeChange($event)"
    (eraserBrushSizeChange)="onEraserBrushSizeChange($event)"
    (wallModeChange)="onWallModeChange($event)"
    (dragModeChange)="onDragModeChange($event)"
    (toggleCharacterList)="toggleCharacterList()"
    (toggleBattleTracker)="toggleBattleTracker()"
    (quickTokenCreate)="onQuickTokenDrop($event)"
  />

  <div class="battlemap-content">
    <!-- Left Panel: Character List -->
    @if (showCharacterList()) {
      <app-battlemap-character-list
        [characters]="worldCharacters()"
        [tokensOnMap]="battleMap()?.tokens || []"
      />
    }

    <!-- Main Grid Area -->
    <app-battlemap-grid
      [battleMap]="battleMap()"
      [currentTool]="currentTool()"
      [brushColor]="brushColor()"
      [penBrushSize]="penBrushSize()"
      [eraserBrushSize]="eraserBrushSize()"
      [isWallMode]="isWallMode()"
      [dragMode]="dragMode()"
      [currentTurnCharacterId]="currentTurnCharacterId()"
      (tokenDrop)="onTokenDrop($event)"
      (tokenMove)="onTokenMove($event)"
      (tokenRemove)="onTokenRemove($event)"
      (quickTokenDrop)="onQuickTokenDrop($event)"
    />

    <!-- Right Panel: Battle Tracker -->
    @if (showBattleTracker()) {
      <app-battlemap-battle-tracker />
    }
  </div>
</div>
