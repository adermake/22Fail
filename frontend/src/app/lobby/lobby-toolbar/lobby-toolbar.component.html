<div class="toolbar">
  <!-- Sidebar toggle -->
  <button 
    class="tool-btn sidebar-toggle" 
    (click)="toggleSidebar.emit()"
    title="Toggle Sidebar"
  >
    â˜°
  </button>

  <div class="toolbar-divider"></div>

  <!-- Tool buttons -->
  <div class="tool-group">
    @for (tool of tools; track tool.id) {
      <button
        class="tool-btn"
        [class.active]="currentTool === tool.id"
        (click)="selectTool(tool.id)"
        [title]="tool.label + ' (' + tool.shortcut + ')'"
      >
        {{ tool.icon }}
      </button>
    }
  </div>

  <div class="toolbar-divider"></div>

  <!-- Eraser mode indicator (E key toggles) -->
  @if (isEraserMode && (currentTool === 'draw' || currentTool === 'texture')) {
    <div class="tool-group eraser-mode-indicator">
      <span class="eraser-badge" title="Eraser Mode Active (Press E to toggle)">
        ğŸ§¹ ERASE MODE
      </span>
    </div>
    <div class="toolbar-divider"></div>
  }

  <!-- Drawing options (visible when draw tool selected) -->
  @if (currentTool === 'draw') {
    <div class="tool-group drawing-options">
      <!-- Color picker -->
      <div class="color-picker">
        <input 
          type="color" 
          [value]="brushColor"
          (input)="onColorInput($event)"
          class="color-input"
        />
        @for (color of presetColors; track color) {
          <button
            class="color-btn"
            [style.background]="color"
            [class.active]="brushColor === color"
            (click)="selectColor(color)"
          ></button>
        }
      </div>

      <!-- Pen brush sizes -->
      <div class="brush-sizes">
        @for (size of penBrushSizes; track size) {
          <button
            class="size-btn"
            [class.active]="penBrushSize === size"
            (click)="selectPenSize(size)"
            [title]="size + 'px'"
          >
            <span 
              class="size-dot" 
              [style.width.px]="clampSize(size)" 
              [style.height.px]="clampSize(size)"
              [style.background]="brushColor"
            ></span>
          </button>
        }
      </div>

      <!-- Draw with walls checkbox -->
      @if (isGM) {
        <label class="checkbox-label">
          <input 
            type="checkbox" 
            [checked]="drawWithWalls"
            (change)="toggleDrawWithWalls()"
          />
          <span>+ Walls</span>
        </label>
      }
    </div>

    <div class="toolbar-divider"></div>

    <!-- Clear buttons -->
    <div class="tool-group">
      <button 
        class="tool-btn danger" 
        (click)="clearDrawings.emit()"
        title="Clear All Drawings"
      >
        ğŸ—‘ï¸
      </button>
    </div>
  }

  <!-- Texture tool options -->
  @if (currentTool === 'texture') {
    <div class="tool-group texture-options">
      <!-- Brush type selector -->
      <div class="brush-type-selector">
        <button
          class="type-btn"
          [class.active]="textureBrushType === 'hard'"
          (click)="selectTextureBrushType('hard')"
          title="Hard Brush"
        >
          â¬¤
        </button>
        <button
          class="type-btn"
          [class.active]="textureBrushType === 'soft'"
          (click)="selectTextureBrushType('soft')"
          title="Soft/Airbrush"
        >
          â—‰
        </button>
      </div>

      <!-- Texture brush sizes -->
      <div class="brush-sizes">
        <span class="option-label">Size:</span>
        @for (size of textureBrushSizes; track size) {
          <button
            class="size-btn"
            [class.active]="textureBrushSize === size"
            (click)="selectTextureSize(size)"
            [title]="size + 'px (or Shift+drag)'"
          >
            {{ size }}
          </button>
        }
      </div>

      <!-- Texture scale -->
      <div class="texture-scales">
        <span class="option-label">Scale:</span>
        @for (scale of textureScales; track scale) {
          <button
            class="scale-btn"
            [class.active]="textureScale === scale"
            (click)="selectTextureScale(scale)"
            [title]="'Tile scale: ' + scale + 'x'"
          >
            {{ scale }}x
          </button>
        }
      </div>
    </div>

    <div class="toolbar-divider"></div>

    <!-- Color blend controls -->
    <div class="tool-group texture-color-controls">
      <div class="slider-control">
        <span class="option-label">Color Blend:</span>
        <input
          type="range"
          min="0"
          max="100"
          [value]="textureColorBlend"
          (input)="onTextureColorBlendInput($event)"
          class="blend-slider"
          title="0% = pure texture, 100% = solid color"
        />
        <span class="slider-value">{{ textureColorBlend }}%</span>
      </div>

      <input
        type="color"
        [value]="textureBlendColor"
        (input)="onTextureBlendColorInput($event)"
        class="color-input"
        title="Blend Color"
      />

      <div class="slider-control">
        <span class="option-label">Hue:</span>
        <input
          type="range"
          min="-180"
          max="180"
          [value]="textureHue"
          (input)="onTextureHueInput($event)"
          class="hue-slider"
          title="Shift hue (-180Â° to +180Â°)"
        />
        <span class="slider-value">{{ textureHue }}Â°</span>
      </div>

      <div class="slider-control">
        <span class="option-label">Strength:</span>
        <input
          type="range"
          min="0"
          max="100"
          [value]="textureBrushStrength * 100"
          (input)="onTextureBrushStrengthInput($event)"
          class="strength-slider"
          title="Brush strength (0% = transparent, 100% = opaque)"
        />
        <span class="slider-value">{{ (textureBrushStrength * 100).toFixed(0) }}%</span>
      </div>
    </div>

    <div class="toolbar-divider"></div>

    <!-- Clear textures button -->
    @if (isGM) {
      <div class="tool-group">
        <button 
          class="tool-btn danger" 
          (click)="clearTextures.emit()"
          title="Clear All Textures"
        >
          ğŸ—‘ï¸ Textures
        </button>
      </div>
    }
  }

  <!-- Cursor mode options -->
  @if (currentTool === 'cursor') {
    <div class="tool-group">
      <button 
        class="tool-btn" 
        [class.active]="dragMode === 'free'"
        (click)="setDragMode('free')"
        title="Free Movement (no restrictions)"
      >
        ğŸ†“
      </button>
      <button 
        class="tool-btn" 
        [class.active]="dragMode === 'enforced'"
        (click)="setDragMode('enforced')"
        title="Enforced Movement (pathfinding + speed limits)"
      >
        ğŸ›¡ï¸
      </button>
    </div>
  }

  <!-- Walls options -->
  @if (currentTool === 'walls' && isGM) {
    <div class="tool-group">
      <button 
        class="tool-btn danger" 
        (click)="clearWalls.emit()"
        title="Clear All Walls"
      >
        ğŸ—‘ï¸ Walls
      </button>
    </div>
  }

  <!-- Spacer to push layer toggles to the right -->
  <div class="spacer"></div>

  <!-- Layer visibility toggles -->
  <div class="tool-group layer-toggles">
    <button 
      class="tool-btn layer-toggle" 
      [class.layer-hidden]="!drawLayerVisible"
      (click)="drawLayerVisibleChange.emit(!drawLayerVisible)"
      [title]="drawLayerVisible ? 'Hide Drawing Layer' : 'Show Drawing Layer'"
    >
      <span class="layer-icon">{{ drawLayerVisible ? 'ğŸ‘ï¸' : 'ğŸš«' }}</span>
      <span class="layer-label">Draw</span>
    </button>
  </div>
</div>
