<app-card>
  <div class="backstory-header">
    <h2>Hintergrundgeschichte</h2>
    <button class="edit-btn" (click)="toggleEdit()">
      {{ isEditing ? 'ğŸ‘ï¸ Preview' : 'âœï¸ Edit' }}
    </button>
  </div>

  @if (isEditing) {
    <div class="editor">
      <div class="editor-toolbar">
        <div class="toolbar-section">
          <button class="toolbar-btn" (click)="insertMarkdown('# ', '')" title="Heading 1">
            H1
          </button>
          <button class="toolbar-btn" (click)="insertMarkdown('## ', '')" title="Heading 2">
            H2
          </button>
          <button class="toolbar-btn" (click)="insertMarkdown('### ', '')" title="Heading 3">
            H3
          </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-section">
          <button class="toolbar-btn" (click)="insertMarkdown('**', '**')" title="Bold">
            <strong>B</strong>
          </button>
          <button class="toolbar-btn" (click)="insertMarkdown('*', '*')" title="Italic">
            <em>I</em>
          </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-section">
          <button class="toolbar-btn" (click)="insertMarkdown('\n---\n', '')" title="Horizontal Line">
            â€•
          </button>
        </div>
      </div>
      <textarea
        #textArea
        [ngModel]="sheet.backstory"
        (ngModelChange)="updateBackstory($event)"
        placeholder="Write your character's backstory here...\n\nTip: Use the toolbar above to format your text!"
        rows="20">
      </textarea>
    </div>
  } @else {
    <div class="backstory-content" [innerHTML]="renderedBackstory"></div>
  }
</app-card>
