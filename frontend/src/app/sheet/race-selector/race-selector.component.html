<div class="race-selector-overlay">
  <div class="race-selector-container">
    <!-- Header -->
    <div class="header">
      @if (viewMode === 'select') {
        <h1>Select Race</h1>
      } @else if (viewMode === 'view') {
        <button class="back-button" (click)="backToSelect()">&larr; Back to Races</button>
      } @else {
        <button class="back-button" (click)="cancelEdit()">&larr; Cancel</button>
      }
      <button class="close-button" (click)="onClose()">&times;</button>
    </div>

    <!-- Loading State -->
    @if (loading) {
      <div class="loading">Loading races...</div>
    }

    <!-- Selection Screen -->
    @if (!loading && viewMode === 'select') {
      <div class="selection-screen">
        @if (selectedRace) {
          <div class="current-race">
            <span>Currently selected: <strong>{{ selectedRace.name }}</strong></span>
            <button class="btn btn-small btn-danger" (click)="clearRace()">Clear Selection</button>
          </div>
        }

        <div class="race-list">
          @for (race of races; track race.id) {
            <app-race-card
              [race]="race"
              [isSelected]="isCurrentRace(race)"
              (select)="selectRace($event)">
            </app-race-card>
          }

          <div class="create-card" (click)="startCreate()">
            <div class="icon">+</div>
            <div class="text">Create New Race</div>
          </div>
        </div>
      </div>
    }

    <!-- View Race Details -->
    @if (!loading && viewMode === 'view' && selectedRace) {
      <app-race-detail
        [race]="selectedRace"
        (confirm)="confirmSelection()"
        (edit)="startEdit()"
        (delete)="deleteRace()">
      </app-race-detail>
    }

    <!-- Create/Edit Screen -->
    @if (!loading && (viewMode === 'create' || viewMode === 'edit')) {
      <app-race-form
        [race]="editingRace"
        [isCreate]="viewMode === 'create'"
        [saving]="saving"
        [pendingImagePreview]="pendingImagePreview"
        (save)="saveRace()"
        (cancel)="cancelEdit()"
        (imageSelect)="onImageSelect($event)">
      </app-race-form>
    }
  </div>
</div>
