<div class="skill-detail-panel">
  <div class="panel-header">
    <h3>{{ className }}</h3>
    <button class="close-btn" (click)="onClose()">&times;</button>
  </div>

  <div class="panel-content">
    <!-- Class Selection Buttons (available for all classes) -->
    <div class="class-selection">
      <button
        class="class-select-btn primary"
        [class.active]="isPrimaryClass"
        (click)="onSetPrimary()"
        [disabled]="!hasLearnedSkill()"
        [title]="!hasLearnedSkill() ? 'Du musst mindestens einen Skill aus dieser Klasse lernen' : ''"
      >
        @if (isPrimaryClass) {
          Primärklasse
        } @else {
          Als Primärklasse setzen
        }
      </button>
      <button
        class="class-select-btn secondary"
        [class.active]="isSecondaryClass"
        (click)="onSetSecondary()"
        [disabled]="!hasLearnedSkill()"
        [title]="!hasLearnedSkill() ? 'Du musst mindestens einen Skill aus dieser Klasse lernen' : ''"
      >
        @if (isSecondaryClass) {
          Sekundärklasse
        } @else {
          Als Sekundärklasse setzen
        }
      </button>
    </div>

    @if (!canLearnFromClass) {
      <div class="locked-notice">
        {{ getLockedReason() }}
      </div>
    }

    @if (skills.length === 0) {
      <div class="empty-state">
        <p>Keine Skills für diese Klasse definiert.</p>
      </div>
    } @else {
      <div class="skills-list">
        @for (skill of skills; track skill.id) {
          <div
            class="skill-item"            [class.type-dice-bonus]="skill.type === 'dice_bonus'"
            [class.type-active]="skill.type === 'active'"
            [class.type-passive]="skill.type === 'passive'"
            [class.type-stat-bonus]="skill.type === 'stat_bonus'"            [class.learned]="isLearned(skill)"
            [class.can-learn]="canLearn(skill)"
            [class.enlightened]="skill.enlightened"
            [class.infinite-level]="skill.infiniteLevel"
          >
            <div class="skill-header">
              <div class="skill-title">
                <span class="skill-name">{{ skill.name }}</span>
                @if (skill.infiniteLevel && isLearned(skill)) {
                  <span class="skill-level">[Stufe {{ getSkillLevel(skill) }}]</span>
                }
                <span class="skill-type" [class]="getTypeClass(skill.type)">
                  {{ getTypeLabel(skill.type) }}
                </span>
                @if (skill.enlightened) {
                  <span class="enlightened-badge" title="Verinnerlichter Skill">✨</span>
                }
                @if (skill.infiniteLevel) {
                  <span class="infinite-badge" title="Unendlich steigerbar">∞</span>
                }
              </div>

              @if (isLearned(skill)) {
                <div class="learned-actions">
                  @if (skill.infiniteLevel) {
                    <span class="learned-badge">Stufe {{ getSkillLevel(skill) }}</span>
                    @if (canLearn(skill)) {
                      <button class="learn-btn small" (click)="onLearn(skill)" title="Weiter steigern">
                        +
                      </button>
                    }
                    <button class="unlearn-btn" (click)="onUnlearn(skill)" title="Stufe senken">
                      −
                    </button>
                  } @else {
                    <span class="learned-badge">Gelernt</span>
                    <button class="unlearn-btn" (click)="onUnlearn(skill)" title="Verlernen">
                      ✕
                    </button>
                  }
                </div>
              } @else if (canLearn(skill)) {
                <button class="learn-btn" (click)="onLearn(skill)">
                  Lernen (1 Punkt)
                </button>
              } @else {
                <span class="locked-badge">
                  @if (!canLearnFromClass) {
                    Gesperrt
                  } @else if (availablePoints <= 0) {
                    Keine Punkte
                  } @else if (skill.requiresSkill) {
                    Voraussetzung fehlt
                  }
                </span>
              }
            </div>

            <div class="skill-body">
              @if (skill.type === 'stat_bonus' && skill.statBonus) {
                <div class="stat-bonus">
                  {{ getStatBonusDisplay(skill) }}
                </div>
              }

              <p class="skill-description">{{ skill.description }}</p>

              @if (skill.cost && skill.cost.amount > 0) {
                <div class="skill-cost">
                  Kosten: {{ getCostDisplay(skill) }}
                </div>
              }

              @if (skill.requiresSkill) {
                <div class="skill-requirement">
                  Benötigt: {{ skill.requiresSkill }}
                </div>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
