<form (ngSubmit)="createSpell()" class="creator-form">
  <!-- Fullscreen Drawing Modal -->
  @if (hasDrawing && isFullscreenDrawing()) {
    <div class="fullscreen-overlay">
      <div class="fullscreen-header">
        <h3>‚ú® {{ newSpell.drawing ? 'Edit' : 'Create' }} Spell Drawing</h3>
        <button type="button" class="close-fullscreen-btn" (click)="closeFullscreenDrawing()">‚úï Close</button>
      </div>
      <div class="fullscreen-content">
        <!-- Drawing Toolbar -->
        <div class="drawing-toolbar">
          <!-- Tool Selector -->
          <div class="toolbar-section tools">
            <button 
              type="button"
              class="toolbar-btn"
              [class.active]="!isErasing()"
              title="Draw Mode"
              (click)="setDrawMode()"
            >
              <span class="btn-icon">‚úèÔ∏è</span>
            </button>
            <button 
              type="button"
              class="toolbar-btn"
              [class.active]="isErasing()"
              title="Eraser Mode"
              (click)="toggleEraser()"
            >
              <span class="btn-icon">üßπ</span>
            </button>
          </div>

          <!-- Draw Tool Settings -->
          @if (!isErasing()) {
            <div class="toolbar-section brush-settings">
              <!-- Color picker -->
              <div class="color-picker">
                @for (color of presetColors; track color) {
                  <button 
                    type="button"
                    class="color-swatch"
                    [class.active]="strokeColor === color"
                    [style.background]="color"
                    [style.border-color]="color === '#ffffff' ? '#666' : color"
                    [title]="color"
                    (click)="selectColor(color)"
                  ></button>
                }
                <label class="custom-color" title="Custom Color">
                  <input 
                    type="color" 
                    [value]="strokeColor"
                    (input)="onColorInput($event)"
                  />
                  <span class="custom-color-preview" [style.background]="strokeColor"></span>
                </label>
              </div>
            </div>
          }

          <!-- Eraser Settings -->
          @if (isErasing()) {
            <div class="toolbar-section brush-settings">
              <span class="setting-label">Eraser Size:</span>
              <div class="size-picker">
                @for (size of eraserSizes; track size) {
                  <button 
                    type="button"
                    class="size-btn"
                    [class.active]="eraserSize === size"
                    [title]="size + 'px'"
                    (click)="selectEraserSize(size)"
                  >
                    <span class="size-dot" [style.width.px]="Math.min(size, 24)" [style.height.px]="Math.min(size, 24)"></span>
                  </button>
                }
              </div>
            </div>
          }

          <!-- Actions -->
          <div class="toolbar-section actions">
            <button type="button" class="action-btn" (click)="undo()" title="Undo (Ctrl+Z)">
              <span class="btn-icon">‚Ü∂</span> Undo
            </button>
            <button type="button" class="action-btn clear" (click)="clearCanvas()" title="Clear Drawing">
              <span class="btn-icon">üóëÔ∏è</span> Clear
            </button>
          </div>
        </div>

        <!-- Canvas with border expansion buttons -->
        <div class="canvas-area">
          <button type="button" class="expand-btn expand-top" (click)="expandTop()" title="Expand Top">‚ñ≤</button>
          <button type="button" class="expand-btn expand-left" (click)="expandLeft()" title="Expand Left">‚óÑ</button>
          <button type="button" class="expand-btn expand-right" (click)="expandRight()" title="Expand Right">‚ñ∫</button>
          <button type="button" class="expand-btn expand-bottom" (click)="expandBottom()" title="Expand Bottom">‚ñº</button>
          
          <div class="fullscreen-canvas-wrapper" [class.panning]="isPanning()">
            <canvas 
              #canvas
              [attr.width]="canvasWidth()"
              [attr.height]="canvasHeight()"
              (pointerdown)="startDrawing($event)"
              (pointermove)="draw($event)"
              (pointerup)="stopDrawing()"
              (pointerleave)="stopDrawing()"
              (pointercancel)="stopDrawing()"
            ></canvas>
          </div>
        </div>
      </div>
    </div>
  }
  
  <div class="field">
    <label for="name">Spell Name *</label>
    <input
      id="name"
      type="text"
      [(ngModel)]="newSpell.name"
      name="name"
      placeholder="Enter spell name"
      required
    />
  </div>

<div class="field checkbox-field">
  <label class="checkbox-label">
    <input 
      type="checkbox" 
      [(ngModel)]="hasDrawing"
      name="hasDrawing"
    />
    <span>Add spell symbol drawing</span>
  </label>
</div>

@if (hasDrawing) {
  <div class="field">
    <label>Draw Spell Symbol</label>
    @if (newSpell.drawing) {
      <div class="drawing-preview">
        <img [src]="newSpell.drawing | imageUrl" alt="Spell drawing" />
      </div>
    }
    <button type="button" class="edit-drawing-btn" (click)="openFullscreenDrawing()">
      üìù {{ newSpell.drawing ? 'Edit' : 'Create' }} Drawing in Fullscreen
    </button>
  </div>
}

  <div class="field">
    <label for="description">Description</label>
    <textarea
      id="description"
      [(ngModel)]="newSpell.description"
      name="description"
      rows="4"
      placeholder="Describe the spell's effect..."
    ></textarea>
  </div>

  <div class="field">
    <label>Binding Type</label>
    <div class="binding-type-selector">
      <label class="radio-label">
        <input
          type="radio"
          [(ngModel)]="newSpell.binding.type"
          name="bindingType"
          value="learned"
        />
        Learned
      </label>
      <label class="radio-label">
        <input type="radio" [(ngModel)]="newSpell.binding.type" name="bindingType" value="item" />
        Item-Bound
      </label>
    </div>
  </div>

  @if (newSpell.binding.type === 'item') {
  <div class="field">
    <label for="itemName">Bound Item *</label>
    <select id="itemName" [(ngModel)]="newSpell.binding.itemName" name="itemName">
      <option value="">Select an item...</option>
      @for (item of availableItems; track item) {
      <option [value]="item">{{ item }}</option>
      }
    </select>
  </div>

  <div class="durability-fields">
    <div class="field">
      <label for="durability">Current Durability</label>
      <input
        id="durability"
        type="number"
        min="0"
        [(ngModel)]="newSpell.binding.durability"
        name="durability"
        placeholder="10"
      />
    </div>
    <div class="field">
      <label for="maxDurability">Max Durability</label>
      <input
        id="maxDurability"
        type="number"
        min="1"
        [(ngModel)]="newSpell.binding.maxDurability"
        name="maxDurability"
        placeholder="10"
      />
    </div>
  </div>
  }

  <div class="field">
    <label>Tags</label>
    <div class="tag-selector">
      @for (tag of tagOptions; track tag) {
      <button
        type="button"
        class="tag-option"
        [class.selected]="hasTag(tag)"
        (click)="toggleTag(tag)"
      >
        {{ tag }}
      </button>
      }
    </div>
  </div>

  <div class="button-group">
    <button type="submit" class="create-btn">Create</button>
    <button type="button" class="cancel-btn" (click)="cancelCreate()">Cancel</button>
  </div>
</form>
