<form (ngSubmit)="createSpell()" class="creator-form">
  <div class="field">
    <label for="name">Spell Name *</label>
    <input
      id="name"
      type="text"
      [(ngModel)]="newSpell.name"
      name="name"
      placeholder="Enter spell name"
      required
    />
  </div>

<div class="field">
  <label class="checkbox-label">
    <input 
      type="checkbox" 
      [(ngModel)]="hasDrawing"
      name="hasDrawing"
    />
    Add spell symbol drawing
  </label>
</div>

@if (hasDrawing) {
  <div class="field">
    <label>Glow Color</label>
    <input
      type="color"
      [(ngModel)]="strokeColor"
      (ngModelChange)="updateStrokeColor($event)"
      name="strokeColor"
      class="color-picker"
    />
  </div>
  <div class="field">
    <label>Draw Spell Symbol</label>
    <div class="canvas-wrapper">
      <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
        <button type="button" class="expand-btn" (click)="expandLeft()" title="Expand Left">◄</button>
        <button type="button" class="expand-btn" (click)="expandTop()" title="Expand Top">▲</button>
        <button type="button" class="expand-btn" (click)="expandBottom()" title="Expand Bottom">▼</button>
        <button type="button" class="expand-btn" (click)="expandRight()" title="Expand Right">►</button>
      </div>
      <div class="canvas-container" [class.panning]="isPanning()" [style.box-shadow]="'0 0 15px ' + strokeColor + '40'">
        <canvas 
          #canvas
          [attr.width]="canvasWidth()"
          [attr.height]="canvasHeight()"
          (pointerdown)="startDrawing($event)"
          (pointermove)="draw($event)"
          (pointerup)="stopDrawing()"
          (pointerleave)="stopDrawing()"
          (pointercancel)="stopDrawing()"
        ></canvas>
      </div>
      <div style="display: flex; gap: 0.5rem;">
        <button type="button" class="clear-btn" (click)="toggleEraser()">
          {{ isErasing() ? 'Draw Mode' : 'Eraser' }}
        </button>
        <button type="button" class="clear-btn" (click)="undo()">Undo (Ctrl+Z)</button>
        <button type="button" class="clear-btn" (click)="clearCanvas()">Clear Drawing</button>
      </div>
    </div>
  </div>
}

  <div class="field">
    <label for="description">Description</label>
    <textarea
      id="description"
      [(ngModel)]="newSpell.description"
      name="description"
      rows="4"
      placeholder="Describe the spell's effect..."
    ></textarea>
  </div>

  <div class="field">
    <label>Binding Type</label>
    <div class="binding-type-selector">
      <label class="radio-label">
        <input
          type="radio"
          [(ngModel)]="newSpell.binding.type"
          name="bindingType"
          value="learned"
        />
        Learned
      </label>
      <label class="radio-label">
        <input type="radio" [(ngModel)]="newSpell.binding.type" name="bindingType" value="item" />
        Item-Bound
      </label>
    </div>
  </div>

  @if (newSpell.binding.type === 'item') {
  <div class="field">
    <label for="itemName">Bound Item *</label>
    <select id="itemName" [(ngModel)]="newSpell.binding.itemName" name="itemName">
      <option value="">Select an item...</option>
      @for (item of availableItems; track item) {
      <option [value]="item">{{ item }}</option>
      }
    </select>
  </div>

  <div class="durability-fields">
    <div class="field">
      <label for="durability">Current Durability</label>
      <input
        id="durability"
        type="number"
        min="0"
        [(ngModel)]="newSpell.binding.durability"
        name="durability"
        placeholder="10"
      />
    </div>
    <div class="field">
      <label for="maxDurability">Max Durability</label>
      <input
        id="maxDurability"
        type="number"
        min="1"
        [(ngModel)]="newSpell.binding.maxDurability"
        name="maxDurability"
        placeholder="10"
      />
    </div>
  </div>
  }

  <div class="field">
    <label>Tags</label>
    <div class="tag-selector">
      @for (tag of tagOptions; track tag) {
      <button
        type="button"
        class="tag-option"
        [class.selected]="hasTag(tag)"
        (click)="toggleTag(tag)"
      >
        {{ tag }}
      </button>
      }
    </div>
  </div>

  <div class="button-group">
    <button type="submit" class="create-btn">Create</button>
    <button type="button" class="cancel-btn" (click)="cancelCreate()">Cancel</button>
  </div>
</form>
