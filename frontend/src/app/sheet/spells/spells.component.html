<app-card>
  <div class="spells-header">
    <div class="header-left">
      <h2>Spells</h2>
      <div class="fokus-display">
        <span class="fokus-label">Fokus:</span>
        <span class="fokus-value">{{ fokusValue }}</span>
        <button class="fokus-settings-btn" (click)="openFokusSettings()" title="Fokus Settings">⚙️</button>
      </div>
    </div>
    <button class="add-btn" (click)="openCreateDialog()">+ Add Spell</button>
  </div>

  <div class="spells-list" cdkDropList (cdkDropListDropped)="onDrop($event)">
    @for (spell of (sheet.spells || []); track spell.name; let i = $index) {
      <div cdkDrag [cdkDragDisabled]="isSpellEditing(i)" (cdkDragStarted)="onDragStarted($event)">
        <app-spell
          [spell]="spell"
          [sheet]="sheet"
          [index]="i"
          (patch)="updateSpell(i, $event)"
          (delete)="deleteSpell(i)"
          (editingChange)="onEditingChange(i, $event)"
        ></app-spell>
        <div 
          class="drag-placeholder-wrapper" 
          *cdkDragPlaceholder
          [style.height]="placeholderHeight"
          [style.width]="placeholderWidth">
        </div>
      </div>
    }
    
    @if ((sheet.spells || []).length === 0) {
      <p class="empty-message">No spells yet. Click + to add one.</p>
    }
  </div>

  <!-- Create Dialog -->
  @if (showCreateDialog) {
    <div class="dialog-overlay" (click)="closeCreateDialog()">
      <div class="dialog-content" (click)="$event.stopPropagation()">
        <h3>Create New Spell</h3>
        <app-spell-creator
          [sheet]="sheet"
          (create)="createSpell($event)"
          (cancel)="closeCreateDialog()"
        ></app-spell-creator>
      </div>
    </div>
  }

  <!-- Fokus Settings Dialog -->
  @if (showFokusSettings) {
    <div class="dialog-overlay" (click)="closeFokusSettings()">
      <div class="dialog-content" (click)="$event.stopPropagation()">
        <h3>Fokus Settings</h3>
        <div class="settings-form">
          <div class="field">
            <label>Formula: (Intelligence × Multiplier) + Bonus</label>
          </div>
          <div class="field">
            <label for="multiplier">Multiplier</label>
            <input
              id="multiplier"
              type="number"
              step="0.1"
              min="0"
              [ngModel]="sheet.fokusMultiplier"
              (ngModelChange)="updateFokusSetting('fokusMultiplier', $event)"
            />
          </div>
          <div class="field">
            <label for="bonus">Bonus</label>
            <input
              id="bonus"
              type="number"
              step="1"
              [ngModel]="sheet.fokusBonus"
              (ngModelChange)="updateFokusSetting('fokusBonus', $event)"
            />
          </div>
          <div class="field preview">
            <label>Current Fokus:</label>
            <span class="fokus-preview">{{ fokusValue }}</span>
          </div>
          <button class="close-btn" (click)="closeFokusSettings()">Close</button>
        </div>
      </div>
    </div>
  }
</app-card>