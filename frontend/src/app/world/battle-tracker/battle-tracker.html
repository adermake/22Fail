<div class="battle-tracker">
  <div class="battle-header">
    <h2>Battle Tracker</h2>
    <button class="reset-button" (click)="onResetBattle()">Reset Battle</button>
  </div>

  <div class="add-character-section">
    <h3>Add to Battle</h3>
    @if (availableToAdd.length > 0) {
      <div class="character-list">
        @for (char of availableToAdd; track char.id) {
          <div class="character-option">
            <span class="character-name">{{ char.name }}</span>
            <span class="character-speed">Speed: {{ char.speed }}</span>
            <button class="add-button" (click)="onAddCharacter(char.id)">+</button>
          </div>
        }
      </div>
    } @else {
      <p class="empty-message">All characters are in battle</p>
    }
  </div>

  <div class="participants-section">
    <h3>Battle Participants</h3>
    @if (battleParticipants.length > 0) {
      <div class="participants-list">
        @for (participant of battleParticipants; track participant.characterId) {
          <div class="participant-item"
               draggable="true"
               (dragstart)="onDragStartParticipant($event, participant.characterId)"
               (dragover)="onDragOverParticipant($event)"
               (drop)="onDropOnParticipant($event, participant.characterId)"
               (dragend)="onDragEnd()">
            <div class="participant-info">
              @if (participant.portrait) {
                <img [src]="participant.portrait" alt="{{ participant.name }}" class="participant-portrait">
              }
              <div class="participant-details">
                <span class="participant-name">{{ participant.name }}</span>
                <span class="participant-speed">Speed: {{ participant.speed }}</span>
              </div>
            </div>
            <button class="remove-button" (click)="onRemoveCharacter(participant.characterId)">Ã—</button>
          </div>
        }
      </div>
    } @else {
      <p class="empty-message">No participants in battle</p>
    }
  </div>

  @if (turnQueue.length > 0) {
    <div class="turn-queue-section">
      <h3>Turn Order Queue</h3>
      <div class="turn-queue">
        @for (turn of turnQueue; track $index) {
          <div class="queue-item"
               [class.current-turn]="$index === 0"
               draggable="true"
               (dragstart)="onDragStartQueue($event, turn.characterId)"
               (dragover)="onDragOverQueue($event)"
               (drop)="onDropOnQueue($event, $index)"
               (dragend)="onDragEnd()">
            @if (turn.portrait) {
              <img [src]="turn.portrait" alt="{{ turn.name }}" class="queue-portrait">
            } @else {
              <div class="queue-portrait-placeholder">
                {{ turn.name.charAt(0).toUpperCase() }}
              </div>
            }
            @if ($index === 0) {
              <span class="turn-label">Now</span>
            }
          </div>
        }
      </div>

      @if (currentTurn) {
        <div class="current-turn-display">
          <div class="current-turn-info">
            @if (currentTurn.portrait) {
              <img [src]="currentTurn.portrait" alt="{{ currentTurn.name }}" class="current-portrait">
            }
            <div>
              <p><strong>Current Turn:</strong></p>
              <p class="current-name">{{ currentTurn.name }}</p>
            </div>
          </div>
          <button class="complete-turn-button" (click)="onNextTurn()">Complete Turn</button>
        </div>
      }
    </div>
  }
</div>
