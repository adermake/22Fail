
    <div class="battle-tracker-container">
      <div class="battle-header">
        <h2>Battle Tracker</h2>
        <button class="reset-button" (click)="onResetBattle()">Reset Battle</button>
      </div>

      <div class="characters-section">
        <h3>Characters</h3>
        <div class="character-list" *ngIf="availableCharacters.length > 0; else noChars">
          <div *ngFor="let char of availableCharacters; trackBy: trackByCharId" class="character-option" [class.in-battle]="isInBattle(char.id)">
            <div class="character-info">
              <img [src]="getCharacterPortrait(char.id) || 'assets/default-portrait.png'" class="character-portrait-small">
              <div class="character-details">
                <span class="character-name">{{ char.name }}</span>
                <span class="character-speed">Speed: {{ char.speed }}</span>
                <select *ngIf="isInBattle(char.id)" 
                        class="team-selector" 
                        [ngModel]="getParticipant(char.id)?.team" 
                        (ngModelChange)="onTeamChange(char.id, $event)">
                  <option *ngFor="let team of availableTeams" [value]="team">{{ team }}</option>
                </select>
              </div>
            </div>
            <button class="toggle-button" 
                    [class.in-battle]="isInBattle(char.id)"
                    (click)="isInBattle(char.id) ? onRemoveCharacter(char.id) : onAddCharacter(char.id)">
              {{ isInBattle(char.id) ? 'Remove' : 'Add' }}
            </button>
          </div>
        </div>
        <ng-template #noChars>
          <p style="color: var(--text-muted); font-style: italic;">No characters available</p>
        </ng-template>
      </div>
      
      <div class="turn-queue-container">
        <div class="turn-queue" 
             [class.is-dragging]="!!draggedParticipant"
             (dragover)="onDragOverQueue($event)"
             (dragleave)="onDragLeaveQueue($event)"
             (drop)="onDropOnQueue($event)">
             
          <div *ngFor="let group of queueGroups; let gIdx = index; trackBy: trackByGroup"
               class="battle-group"
               [class.fading-out]="group.shouldFadeOut"
               [ngClass]="'team-' + group.team">
            
            <div *ngIf="dragOverIndex === gIdx && dropPosition === 'before'" class="drop-indicator" style="left: -4px;"></div>
            <div *ngIf="dragOverIndex === gIdx && dropPosition === 'after'" class="drop-indicator" style="right: -4px;"></div>
            
            <div *ngFor="let turn of group.participants; trackBy: trackByCharId" 
                 class="battle-card"
                 [class.is-anchor]="turn.isAnchor"
                 [draggable]="turn.isAnchor"
                 (dragstart)="onDragStartQueue($event, turn)"
                 (dragend)="onDragEnd()">
              <img [src]="turn.portrait || 'assets/default-portrait.png'" [alt]="turn.name">
              <span>{{turn.name}}</span>
              <div *ngIf="turn.isAnchor" class="anchor-indicator" title="Anchor Point">âš“</div>
            </div>
          </div>
          
          <div *ngIf="dragOverIndex === queueGroups.length" class="drop-indicator" style="right: 0; position: relative; height: 80px; margin-left: 4px;"></div>
        </div>
      </div>

      <div class="controls">
        <button (click)="onNextTurn()" [disabled]="completingTurn">Next Turn</button>
      </div>
    </div>
  