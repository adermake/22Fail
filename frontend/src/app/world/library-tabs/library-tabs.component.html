<div class="library-tabs-container">
  <div class="tabs-header">
    <button
      class="tab-button"
      [class.active]="activeTab === 'items'"
      (click)="setActiveTab('items')">
      Items ({{ items.length }})
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'runes'"
      (click)="setActiveTab('runes')">
      Runes ({{ runes.length }})
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'spells'"
      (click)="setActiveTab('spells')">
      Spells ({{ spells.length }})
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'skills'"
      (click)="setActiveTab('skills')">
      Skills ({{ skills.length }})
    </button>
  </div>

  <div class="search-container">
    <input
      type="text"
      class="search-input"
      [(ngModel)]="searchTerm"
      placeholder="Search by name or description...">
  </div>

  <div class="tab-content">
    <!-- Items Tab -->
    @if (activeTab === 'items') {
      <div class="library-list">
        @for (item of filteredItems; track item.name; let i = $index) {
          <div class="library-item-wrapper"
               [class.draggable]="!isItemEditing(getOriginalIndex(item, 'items'))"
               [attr.draggable]="!isItemEditing(getOriginalIndex(item, 'items'))"
               (dragstart)="onDragStart($event, 'item', getOriginalIndex(item, 'items'))">
            <app-item
              [item]="item"
              [sheet]="dummySheet"
              [index]="getOriginalIndex(item, 'items')"
              [isEditing]="isItemEditing(getOriginalIndex(item, 'items'))"
              (patch)="onItemUpdate(getOriginalIndex(item, 'items'), $event)"
              (delete)="removeItem.emit(getOriginalIndex(item, 'items'))"
              (editingChange)="onItemEditingChange(getOriginalIndex(item, 'items'), $event)">
            </app-item>
          </div>
        }
        <button class="add-button" (click)="addItem.emit()">+ Add Item</button>
      </div>
    }

    <!-- Runes Tab -->
    @if (activeTab === 'runes') {
      <div class="library-list">
        @for (rune of filteredRunes; track rune.name; let i = $index) {
          <div class="library-item-wrapper"
               [class.draggable]="!isRuneEditing(getOriginalIndex(rune, 'runes'))"
               [attr.draggable]="!isRuneEditing(getOriginalIndex(rune, 'runes'))"
               (dragstart)="onDragStart($event, 'rune', getOriginalIndex(rune, 'runes'))">
            <app-rune
              [rune]="rune"
              [index]="getOriginalIndex(rune, 'runes')"
              [isEditing]="isRuneEditing(getOriginalIndex(rune, 'runes'))"
              (patch)="onRuneUpdate(getOriginalIndex(rune, 'runes'), $event)"
              (delete)="removeRune.emit(getOriginalIndex(rune, 'runes'))"
              (editingChange)="onRuneEditingChange(getOriginalIndex(rune, 'runes'), $event)">
            </app-rune>
          </div>
        }
        <button class="add-button" (click)="addRune.emit()">+ Add Rune</button>
      </div>
    }

    <!-- Spells Tab -->
    @if (activeTab === 'spells') {
      <div class="library-list">
        @for (spell of filteredSpells; track spell.name; let i = $index) {
          <div class="library-item-wrapper"
               [class.draggable]="!isSpellEditing(getOriginalIndex(spell, 'spells'))"
               [attr.draggable]="!isSpellEditing(getOriginalIndex(spell, 'spells'))"
               (dragstart)="onDragStart($event, 'spell', getOriginalIndex(spell, 'spells'))">
            <app-spell
              [spell]="spell"
              [sheet]="dummySheet"
              [index]="getOriginalIndex(spell, 'spells')"
              [isEditing]="isSpellEditing(getOriginalIndex(spell, 'spells'))"
              (patch)="onSpellUpdate(getOriginalIndex(spell, 'spells'), $event)"
              (delete)="removeSpell.emit(getOriginalIndex(spell, 'spells'))"
              (editingChange)="onSpellEditingChange(getOriginalIndex(spell, 'spells'), $event)">
            </app-spell>
          </div>
        }
        <button class="add-button" (click)="addSpell.emit()">+ Add Spell</button>
      </div>
    }

    <!-- Skills Tab -->
    @if (activeTab === 'skills') {
      <div class="library-list">
        @for (skill of filteredSkills; track skill.name; let i = $index) {
          <div class="library-item-wrapper"
               draggable="true"
               (dragstart)="onDragStart($event, 'skill', getOriginalIndex(skill, 'skills'))">
            <app-skill
              [skill]="skill"
              [sheet]="dummySheet"
              [index]="getOriginalIndex(skill, 'skills')"
              (patch)="onSkillUpdate(getOriginalIndex(skill, 'skills'), $event)"
              (delete)="removeSkill.emit(getOriginalIndex(skill, 'skills'))"
              (editingChange)="onSkillEditingChange(getOriginalIndex(skill, 'skills'), $event)">
            </app-skill>
          </div>
        }
        <button class="add-button" (click)="addSkill.emit()">+ Add Skill</button>
      </div>
    }
  </div>
</div>
