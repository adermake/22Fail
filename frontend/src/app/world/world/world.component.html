<div class="world-container">
  <div class="world-header">
    <h1>{{ worldName }} - GM View</h1>
  </div>

  <div class="world-grid">
    <app-card>
      <h2>Characters</h2>
      <div>
        <input placeholder="Character ID" [(ngModel)]="newCharacterId" />
        <button (click)="addCharacterToWorld()">Add</button>
      </div>
      <ul>
        <li *ngFor="let id of world?.characters">
          <b>{{ allCharacters[id]?.name || id }}</b>
          <button (click)="addToParty(id)">Add to Party</button>
          <button (click)="removeCharacter(id)">Remove</button>
        </li>
      </ul>
    </app-card>

    <app-card>
      <h2>Active Party</h2>
      <ul>
        <li *ngFor="let id of world?.party">
          <b>{{ allCharacters[id]?.name || id }}</b>
          <button (click)="removeFromParty(id)">Remove</button>
        </li>
      </ul>
    </app-card>

    <app-card>
      <h2>Party Dashboard</h2>
      <div *ngIf="world">
        <div class="party-dashboard">
          <div class="party-member" *ngFor="let id of world.party" cdkDropList (cdkDropListDropped)="dropToPlayer($event,id)">
            <h3>{{ allCharacters[id]?.name || id }}</h3>
            <div class="stat-row">
              <app-currentstat
                [sheet]="allCharacters[id]"
                [name]="'Life'"
                [current]="getStatusCurrent(id,FormulaType.LIFE)"
                [color]="getStatusObj(id,FormulaType.LIFE).statusColor"
                [base]="getStatusObj(id,FormulaType.LIFE).statusBase"
                [bonus]="getStatusObj(id,FormulaType.LIFE).statusBonus"
                [formula]="FormulaType.LIFE"
              ></app-currentstat>

              <app-currentstat
                [sheet]="allCharacters[id]"
                [name]="'Energy'"
                [current]="getStatusCurrent(id,FormulaType.ENERGY)"
                [color]="getStatusObj(id,FormulaType.ENERGY).statusColor"
                [base]="getStatusObj(id,FormulaType.ENERGY).statusBase"
                [bonus]="getStatusObj(id,FormulaType.ENERGY).statusBonus"
                [formula]="FormulaType.ENERGY"
              ></app-currentstat>

              <app-currentstat
                [sheet]="allCharacters[id]"
                [name]="'Mana'"
                [current]="getStatusCurrent(id,FormulaType.MANA)"
                [color]="getStatusObj(id,FormulaType.MANA).statusColor"
                [base]="getStatusObj(id,FormulaType.MANA).statusBase"
                [bonus]="getStatusObj(id,FormulaType.MANA).statusBonus"
                [formula]="FormulaType.MANA"
              ></app-currentstat>
            </div>
            <div class="party-currency">Gold: {{ allCharacters[id]?.currency?.gold || 0 }}</div>
          </div>
        </div>
      </div>
    </app-card>

    <app-card>
      <h2>Libraries</h2>
      <div class="lib-actions">
        <button (click)="showCreateItem = true">Create Item</button>
      </div>
      <div *ngIf="showCreateItem">
        <app-item-creator (create)="createLibraryItem($event)" (cancel)="cancelCreateItem()"></app-item-creator>
      </div>
      <h3>Items</h3>
      <div cdkDropList [cdkDropListData]="world?.library?.items" class="library-list">
        <div class="lib-item" *ngFor="let it of world?.library?.items; let i = index" cdkDrag>
          {{ it.name }}
        </div>
      </div>
      <h3>Runes</h3>
      <ul>
        <li *ngFor="let r of world?.library?.runes">{{ r.name || r }}</li>
      </ul>
      <h3>Spells</h3>
      <ul>
        <li *ngFor="let s of world?.library?.spells">{{ s.name || s }}</li>
      </ul>
      <h3>Battle Loot</h3>
      <div cdkDropList (cdkDropListDropped)="dropToBattle($event)" class="battle-loot">
        <div *ngFor="let it of world?.battleLoot">{{ it.name || it }}</div>
      </div>
    </app-card>
  </div>
</div>